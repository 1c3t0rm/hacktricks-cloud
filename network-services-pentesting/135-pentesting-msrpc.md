# 135, 593 - Pentesting MSRPC

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodiƒçu PEASS**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Pridru≈æite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Hakerski Uvidi**\
Ukljuƒçite se u sadr≈æaj koji istra≈æuje uzbuƒëenje i izazove hakovanja

**Vesti o Hakovanju u Realnom Vremenu**\
Budite u toku sa brzim svetom hakovanja kroz vesti i uvide u realnom vremenu

**Poslednje Najave**\
Budite informisani o najnovijim nagradama za pronala≈æenje bagova i va≈ænim a≈æuriranjima platformi

**Pridru≈æite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poƒçnite da saraƒëujete sa vrhunskim hakerima danas!

## Osnovne Informacije

Microsoft Remote Procedure Call (MSRPC) protokol, model klijent-server koji omoguƒáava programu da zatra≈æi uslugu od programa sme≈°tenog na drugom raƒçunaru bez razumevanja specifiƒçnosti mre≈æe, prvobitno je izveden iz softvera otvorenog koda, a kasnije razvijen i za≈°tiƒáen autorskim pravima od strane Microsoft-a.

RPC endpoint mapper mo≈æe se pristupiti putem TCP i UDP porta 135, SMB na TCP portovima 139 i 445 (sa null ili autentifikovanom sesijom), i kao web servis na TCP portu 593.

```
135/tcp   open     msrpc         Microsoft Windows RPC
```

## Kako funkcioni≈°e MSRPC?

Pokrenut od strane klijentske aplikacije, MSRPC proces ukljuƒçuje pozivanje lokalne stub procedure koja zatim interaguje sa klijentskom runtime bibliotekom kako bi pripremila i prenela zahtev serveru. Ovo ukljuƒçuje konvertovanje parametara u standardni format Mre≈æne Reprezentacije Podataka. Izbor transportnog protokola odreƒëuje se od strane runtime biblioteke ako je server udaljen, obezbeƒëujuƒái da se RPC dostavi kroz mre≈æni sloj.

![https://0xffsec.com/handbook/images/msrpc.png](https://0xffsec.com/handbook/images/msrpc.png)

## **Identifikacija Izlo≈æenih RPC Servisa**

Izlo≈æenost RPC servisa preko TCP, UDP, HTTP i SMB mo≈æe se odrediti upitom servisu za lociranje RPC-a i pojedinaƒçnim endpointima. Alati poput rpcdump olak≈°avaju identifikaciju jedinstvenih RPC servisa, oznaƒçenih vrednostima **IFID**, otkrivajuƒái detalje servisa i komunikacione veze:

```
D:\rpctools> rpcdump [-p port] <IP>
**IFID**: 5a7b91f8-ff00-11d0-a9b2-00c04fb6e6fc version 1.0
Annotation: Messenger Service
UUID: 00000000-0000-0000-0000-000000000000
Binding: ncadg_ip_udp:<IP>[1028]
```

Pristup slu≈æbi RPC lokatora omoguƒáen je putem odreƒëenih protokola: ncacn\_ip\_tcp i ncadg\_ip\_udp za pristup preko porta 135, ncacn\_np za SMB veze, i ncacn\_http za komunikaciju putem web baziranog RPC-a. Sledeƒáe komande ilustruju kori≈°ƒáenje Metasploit modula za proveru i interakciju sa MSRPC uslugama, sa primarnim fokusom na portu 135:

```bash
use auxiliary/scanner/dcerpc/endpoint_mapper
use auxiliary/scanner/dcerpc/hidden
use auxiliary/scanner/dcerpc/management
use auxiliary/scanner/dcerpc/tcp_dcerpc_auditor
rpcdump.py <IP> -p 135
```

Sve opcije osim `tcp_dcerpc_auditor` su posebno dizajnirane za ciljanje MSRPC na portu 135.

#### Znaƒçajni RPC interfejsi

* **IFID**: 12345778-1234-abcd-ef00-0123456789ab
* **Imenovana cev**: `\pipe\lsarpc`
* **Opis**: LSA interfejs, koristi se za enumeraciju korisnika.
* **IFID**: 3919286a-b10c-11d0-9ba8-00c04fd92ef5
* **Imenovana cev**: `\pipe\lsarpc`
* **Opis**: LSA Directory Services (DS) interfejs, koristi se za enumeraciju domena i poverenja izmeƒëu njih.
* **IFID**: 12345778-1234-abcd-ef00-0123456789ac
* **Imenovana cev**: `\pipe\samr`
* **Opis**: LSA SAMR interfejs, koristi se za pristup javnim elementima baze podataka SAM (npr. korisniƒçkim imenima) i za grubo testiranje lozinki bez obzira na politiku zakljuƒçavanja naloga.
* **IFID**: 1ff70682-0a51-30e8-076d-740be8cee98b
* **Imenovana cev**: `\pipe\atsvc`
* **Opis**: Planer zadataka, koristi se za daljinsko izvr≈°avanje komandi.
* **IFID**: 338cd001-2244-31f1-aaaa-900038001003
* **Imenovana cev**: `\pipe\winreg`
* **Opis**: Usluga daljinskog registra, koristi se za pristupanje i modifikaciju sistema registra.
* **IFID**: 367abb81-9844-35f1-ad32-98f038001003
* **Imenovana cev**: `\pipe\svcctl`
* **Opis**: Upravljaƒç servisima i uslugama servera, koristi se za daljinsko pokretanje i zaustavljanje servisa i izvr≈°avanje komandi.
* **IFID**: 4b324fc8-1670-01d3-1278-5a47bf6ee188
* **Imenovana cev**: `\pipe\srvsvc`
* **Opis**: Upravljaƒç servisima i uslugama servera, koristi se za daljinsko pokretanje i zaustavljanje servisa i izvr≈°avanje komandi.
* **IFID**: 4d9f4ab8-7d1c-11cf-861e-0020af6e7c57
* **Imenovana cev**: `\pipe\epmapper`
* **Opis**: DCOM interfejs, koristi se za grubo testiranje lozinki i prikupljanje informacija putem WM.

### Identifikacija IP adresa

Kori≈°ƒáenjem [https://github.com/mubix/IOXIDResolver](https://github.com/mubix/IOXIDResolver), koji potiƒçe iz [Airbus istra≈æivanja](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/), moguƒáe je zloupotrebiti _**ServerAlive2**_ metod unutar _**IOXIDResolver**_ interfejsa.

Ovaj metod je kori≈°ƒáen za dobijanje informacija o interfejsu kao **IPv6** adresa sa HTB box-a _APT_. Pogledajte [ovde](https://0xdf.gitlab.io/2021/04/10/htb-apt.html) za 0xdf APT analizu, koja ukljuƒçuje alternativni metod kori≈°ƒáenjem rpcmap.py iz [Impacket](https://github.com/SecureAuthCorp/impacket/) sa _stringbinding_ (vidi gore).

### Izvr≈°avanje RCE sa validnim pristupnim podacima

Moguƒáe je izvr≈°iti udaljeni kod na ma≈°ini, ako su pristupni podaci validnog korisnika dostupni kori≈°ƒáenjem [dcomexec.py](https://github.com/fortra/impacket/blob/master/examples/dcomexec.py) iz impacket framework-a.

**Zapamtite da poku≈°ate sa razliƒçitim dostupnim objektima**

* ShellWindows
* ShellBrowserWindow
* MMC20

## Port 593

**rpcdump.exe** sa [rpctools](https://resources.oreilly.com/examples/9780596510305/tree/master/tools/rpctools) mo≈æe komunicirati sa ovim portom.

## Reference

* [https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/](https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/)
* [https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/](https://www.cyber.airbus.com/the-oxid-resolver-part-2-accessing-a-remote-object-inside-dcom/)
* [https://0xffsec.com/handbook/services/msrpc/](https://0xffsec.com/handbook/services/msrpc/)

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Pridru≈æite se [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) serveru kako biste komunicirali sa iskusnim hakerima i lovcima na bagove!

**Hakerski uvidi**\
Ukljuƒçite se u sadr≈æaj koji istra≈æuje uzbuƒëenje i izazove hakovanja

**Vesti o hakovanju u realnom vremenu**\
Budite u toku sa brzim svetom hakovanja kroz vesti i uvide u realnom vremenu

**Najnovije najave**\
Budite informisani o najnovijim nagradama za pronala≈æenje bagova i va≈ænim a≈æuriranjima platforme

**Pridru≈æite nam se na** [**Discord-u**](https://discord.com/invite/N3FrSbmwdy) i poƒçnite da saraƒëujete sa vrhunskim hakerima danas!

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od poƒçetnika do struƒçnjaka sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
