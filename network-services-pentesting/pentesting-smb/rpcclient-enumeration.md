# rpcclient enumeration

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za sajber bezbednost**? Želite li da vidite svoju **kompaniju reklamiranu na HackTricks**? ili želite pristup **najnovijoj verziji PEASS-a ili preuzimanje HackTricks-a u PDF formatu**? Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridružite se** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitteru** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repozitorijum**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repozitorijum**](https://github.com/carlospolop/hacktricks-cloud).

</details>

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

### Pregled Relativnih Identifikatora (RID) i Sigurnosnih Identifikatora (SID)

**Relativni Identifikatori (RID)** i **Sigurnosni Identifikatori (SID)** su ključni komponenti u Windows operativnim sistemima za jedinstveno identifikovanje i upravljanje objektima, kao što su korisnici i grupe, unutar mrežnog domena.

* **SID-ovi** služe kao jedinstveni identifikatori za domene, osiguravajući da svaki domen bude razlikovljiv.
* **RID-ovi** se dodaju SID-ovima kako bi se kreirali jedinstveni identifikatori za objekte unutar tih domena. Ova kombinacija omogućava precizno praćenje i upravljanje dozvolama objekata i kontrolama pristupa.

Na primer, korisnik po imenu `pepe` može imati jedinstveni identifikator koji kombinuje SID domena sa njegovim specifičnim RID-om, predstavljen u heksadecimalnom (`0x457`) i decimalnom (`1111`) formatu. To rezultira potpunim i jedinstvenim identifikatorom za pepe-a unutar domena kao što je: `S-1-5-21-1074507654-1937615267-42093643874-1111`.

### **Enumeracija sa rpcclient-om**

**`rpcclient`** alat iz Samba-e se koristi za interakciju sa **RPC endpointima putem imenovanih cevi**. Ispod su navedene komande koje se mogu izdati SAMR, LSARPC i LSARPC-DS interfejsima nakon što se uspostavi **SMB sesija**, često zahtevajući akreditive.

#### Informacije o Serveru

* Za dobijanje **Informacija o Serveru**: koristi se komanda `srvinfo`.

#### Enumeracija Korisnika

* **Korisnici se mogu listati** korišćenjem: `querydispinfo` i `enumdomusers`.
* **Detalji o korisniku** sa: `queryuser <0xrid>`.
* **Grupe korisnika** sa: `queryusergroups <0xrid>`.
* **SID korisnika se dobija** kroz: `lookupnames <korisničko_ime>`.
* **Alijasi korisnika** sa: `queryuseraliases [builtin|domain] <sid>`.

```bash
# Users' RIDs-forced
for i in $(seq 500 1100); do
rpcclient -N -U "" [IP_ADDRESS] -c "queryuser 0x$(printf '%x\n' $i)" | grep "User Name\|user_rid\|group_rid" && echo "";
done

# samrdump.py can also serve this purpose
```

#### Enumeracija grupa

* **Grupe** pomoću: `enumdomgroups`.
* **Detalji grupe** sa: `querygroup <0xrid>`.
* **Članovi grupe** kroz: `querygroupmem <0xrid>`.

#### Enumeracija Alias grupa

* **Alias grupe** pomoću: `enumalsgroups <builtin|domain>`.
* **Članovi alias grupe** sa: `queryaliasmem builtin|domain <0xrid>`.

#### Enumeracija domena

* **Domeni** korišćenjem: `enumdomains`.
* **SID domena se dobija** kroz: `lsaquery`.
* **Informacije o domenu se dobijaju** sa: `querydominfo`.

#### Enumeracija deljenja

* **Sva dostupna deljenja** pomoću: `netshareenumall`.
* **Informacije o određenom deljenju se dobijaju** sa: `netsharegetinfo <share>`.

#### Dodatne operacije sa SID-ovima

* **SID-ovi po imenu** korišćenjem: `lookupnames <username>`.
* **Više SID-ova** kroz: `lsaenumsid`.
* **Provera više SID-ova kroz cikliranje RID-a** se vrši sa: `lookupsids <sid>`.

#### **Dodatne komande**

| **Komanda**         | **Interfejs**                                                                                                                                                      | **Opis**                                                                                                                                              |
| ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| queryuser           | SAMR                                                                                                                                                               | Dobijanje informacija o korisniku                                                                                                                     |
| querygroup          | Dobijanje informacija o grupi                                                                                                                                      |                                                                                                                                                       |
| querydominfo        | Dobijanje informacija o domenu                                                                                                                                     |                                                                                                                                                       |
| enumdomusers        | Enumeracija korisnika domena                                                                                                                                       |                                                                                                                                                       |
| enumdomgroups       | Enumeracija grupa domena                                                                                                                                           |                                                                                                                                                       |
| createdomuser       | Kreiranje korisnika domena                                                                                                                                         |                                                                                                                                                       |
| deletedomuser       | Brisanje korisnika domena                                                                                                                                          |                                                                                                                                                       |
| lookupnames         | LSARPC                                                                                                                                                             | Pretraga korisničkih imena za SID vrednosti[a](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn8) |
| lookupsids          | Pretraga SID-ova za korisničkim imenima (cikliranje RID[b](https://learning.oreilly.com/library/view/network-security-assessment/9781491911044/ch08.html#ch08fn9)) |                                                                                                                                                       |
| lsaaddacctrights    | Dodavanje prava korisničkom nalogu                                                                                                                                 |                                                                                                                                                       |
| lsaremoveacctrights | Uklanjanje prava sa korisničkog naloga                                                                                                                             |                                                                                                                                                       |
| dsroledominfo       | LSARPC-DS                                                                                                                                                          | Dobijanje osnovnih informacija o domenu                                                                                                               |
| dsenumdomtrusts     | Enumeracija poverenih domena unutar AD šume                                                                                                                        |                                                                                                                                                       |

Za **bolje razumevanje** kako alati _**samrdump**_ **i** _**rpcdump**_ funkcionišu, trebalo bi da pročitate [**Pentesting MSRPC**](../135-pentesting-msrpc.md).

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>Naučite hakovanje AWS-a od početnika do stručnjaka sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetičku bezbednost**? Želite li da vidite vašu **kompaniju reklamiranu na HackTricks**? Ili želite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF-u**? Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridružite se** [**💬**](https://emojipedia.org/speech-balloon/) **Discord grupi** ili **telegram grupi** ili me **pratite** na **Twitteru** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
