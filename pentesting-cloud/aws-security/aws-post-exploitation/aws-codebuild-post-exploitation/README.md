# AWS - CodeBuild Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## CodeBuild

For more information, check:

{% content-ref url="../../aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### Check Secrets

If credentials have been set in Codebuild to connect to Github, Gitlab or Bitbucket in the form of personal tokens, passwords or OAuth token access, these **akreditivi 캖e biti pohranjeni kao tajne u menad쬰ru tajni**.\
Therefore, if you have access to read the secret manager you will be able to get these secrets and pivot to the connected platform.

{% content-ref url="../../aws-privilege-escalation/aws-secrets-manager-privesc.md" %}
[aws-secrets-manager-privesc.md](../../aws-privilege-escalation/aws-secrets-manager-privesc.md)
{% endcontent-ref %}

### Abuse CodeBuild Repo Access

In order to configure **CodeBuild**, it will need **pristup repozitorijumu koda** koji 캖e koristiti. Several platforms could be hosting this code:

<figure><img src="../../../../.gitbook/assets/image (96).png" alt=""><figcaption></figcaption></figure>

The **CodeBuild projekat mora imati pristup** konfigurisanom provajderu izvora, bilo putem **IAM uloge** ili sa github/bitbucket **tokenom ili OAuth pristupom**.

An attacker with **elevated permissions in over a CodeBuild** could abuse this configured access to leak the code of the configured repo and others where the set creds have access.\
In order to do this, an attacker would just need to **promeniti URL repozitorijuma na svaki repozitorijum kojem konfigurisanih akreditiva imaju pristup** (note that the aws web will list all of them for you):

<figure><img src="../../../../.gitbook/assets/image (107).png" alt=""><figcaption></figcaption></figure>

And **promeniti Buildspec komande da exfiltrira svaki repozitorijum**.

{% hint style="warning" %}
However, this **zadatak je ponavljaju캖i i zamoran** and if a github token was configured with **write permissions**, an attacker **ne캖e mo캖i da (zlo)upotrebi te dozvole** as he doesn't have access to the token.\
Or does he? Check the next section
{% endhint %}

### Leaking Access Tokens from AWS CodeBuild

You can leak access given in CodeBuild to platforms like Github. Check if any access to external platforms was given with:
```bash
aws codebuild list-source-credentials
```
{% content-ref url="aws-codebuild-token-leakage.md" %}
[aws-codebuild-token-leakage.md](aws-codebuild-token-leakage.md)
{% endcontent-ref %}

### `codebuild:DeleteProject`

Napada캜 bi mogao da obri코e ceo CodeBuild projekat, uzrokuju캖i gubitak konfiguracije projekta i uti캜u캖i na aplikacije koje se oslanjaju na projekat.
```bash
aws codebuild delete-project --name <value>
```
**Potencijalni uticaj**: Gubitak konfiguracije projekta i prekid usluge za aplikacije koje koriste obrisani projekat.

### `codebuild:TagResource` , `codebuild:UntagResource`

Napada캜 bi mogao da doda, izmeni ili ukloni oznake sa CodeBuild resursa, ometaju캖i alokaciju tro코kova va코e organizacije, pra캖enje resursa i politike kontrole pristupa zasnovane na oznakama.
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**Potencijalni uticaj**: Poreme캖aj alokacije tro코kova, pra캖enja resursa i politika kontrole pristupa zasnovanih na oznakama.

### `codebuild:DeleteSourceCredentials`

Napada캜 bi mogao da obri코e izvorne akreditive za Git repozitorijum, 코to bi uticalo na normalno funkcionisanje aplikacija koje se oslanjaju na repozitorijum.
```sql
aws codebuild delete-source-credentials --arn <value>
```
**Potencijalni uticaj**: Poreme캖aj normalnog funkcionisanja aplikacija koje se oslanjaju na pogo캠eni repozitorijum zbog uklanjanja izvornih kredencijala.

{% hint style="success" %}
U캜ite i ve쬭ajte AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
U캜ite i ve쬭ajte GCP Hacking: <img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Podr쬴te HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
