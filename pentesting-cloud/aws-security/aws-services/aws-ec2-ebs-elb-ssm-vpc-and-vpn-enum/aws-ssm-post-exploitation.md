# AWS - SSM рдкреЛрд╕реНрдЯ-рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреЗрд╢рди

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВред

</details>

## MitM SSM

### MitM SSM рд╕рдВрджреЗрд╢ рдЬреЛ рдПрдХ EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ <a href="#intercept-ec2-messages" id="intercept-ec2-messages"></a>

**EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЗ IAM рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд╕рд╛рде**, рдЖрдк EC2 рд╕рдВрджреЗрд╢реЛрдВ рдФрд░ SSM рд╕рддреНрд░реЛрдВ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ SSM рдХреА рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╣реИрдВрдбрд▓рд┐рдВрдЧ рдХреЗ рдХрд╛рд░рдгред

[**SSM рдПрдЬреЗрдВрдЯ**](https://github.com/aws/amazon-ssm-agent) рд▓рдЧрд╛рддрд╛рд░ **`ec2messages:GetMessages`** рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, **20 рд╕реЗрдХрдВрдб** рдХреЗ рд▓рд┐рдП **рдХрдиреЗрдХреНрд╢рди рдЦреБрд▓рд╛** рд░рдЦрддрд╛ рд╣реИред рдпрджрд┐ рдХреЛрдИ рд╕рдВрджреЗрд╢ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ [**`ssm:SendCommand`**](https://docs.aws.amazon.com/cli/latest/reference/ssm/send-command.html) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ, рддреЛ рдпрд╣ рдЦреБрд▓реЗ рдХрдиреЗрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред

рдПрдХ **рд╣рдорд▓рд╛рд╡рд░** **`ec2messages:GetMessages`** рдХреЛ рдЕрдзрд┐рдХ рдмрд╛рд░ рдХреЙрд▓ рдХрд░рдХреЗ EC2 рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ [**рдкреНрд░реВрдл рдСрдл рдХреЙрдиреНрд╕реЗрдкреНрдЯ**](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-document-interception) рдЗрд╕реЗ рд╕реБрдирдиреЗ рдХреЗ рд▓рд┐рдП send-command рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рджрд┐рдЦрд╛рддрд╛ рд╣реИред рд╣рдорд▓рд╛рд╡рд░ рдпрд╣ рднреА **рдХреЛрдИ рднреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИред

рд╣рдорд▓рд╛рд╡рд░ рдпрд╣ рднреА **рдХреЛрдИ рднреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рдЙрд╕реЗ рдкрд╕рдВрдж рдЖрдиреЗ рд╡рд╛рд▓реА рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рднреЗрдЬ рд╕рдХрддрд╛ рд╣реИред

### MitM SSM рд╕рддреНрд░ рд╕рдВрджреЗрд╢

рдпрд╣ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХрдИ WebSocket рдХрдиреЗрдХреНрд╢рди рдФрд░ рдПрдХ рдЕрдиреВрдард╛ рдмрд╛рдЗрдирд░реА рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИред рдЬрдм **SSM рдПрдЬреЗрдВрдЯ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ**, рдпрд╣ AWS рдХреЗ рд▓рд┐рдП рдПрдХ **WebSocket** рдХрдиреЗрдХреНрд╢рди **рдмрдирд╛рддрд╛ рд╣реИ**ред рдЬрдм рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ SSM рд╕рддреНрд░ ([ssm:StartSession](https://docs.aws.amazon.com/cli/latest/reference/ssm/start-session.html)) рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИ, рддреЛ **рдХрдВрдЯреНрд░реЛрд▓ рдЪреИрдирд▓ рдПрдХ рдбреЗрдЯрд╛ рдЪреИрдирд▓ рдХреА рд╢реБрд░реБрдЖрдд рдХрд░рддрд╛ рд╣реИ** рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдПред

SSM рдПрдЬреЗрдВрдЯ рдХрд╛ рд╕реЛрд░реНрд╕ рдХреЛрдб, рдЬреЛ [рдпрд╣рд╛рдВ](https://github.com/aws/amazon-ssm-agent) рдЙрдкрд▓рдмреНрдз рд╣реИ, рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рдЗрдирд░реА рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ [рдпрд╣](https://github.com/aws/amazon-ssm-agent/blob/21c85d674bbb44dd13cd8738d1b9d86658a6b18e/agent/session/contracts/agentmessage.go#L73)ред

**SSM рд╕рддреНрд░реЛрдВ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдирд╛ EC2 рд╕рдВрджреЗрд╢реЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ **рдХрдВрдЯреНрд░реЛрд▓ рдЪреИрдирд▓ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдЬреАрд╡рд┐рдд рд░рд╣рддреЗ рд╣реИрдВ** рдФрд░ AWS рдХреЗрд╡рд▓ **рдирд╡реАрдирддрдо рд╡рд╛рд▓реЗ** рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рддрд╛ рд╣реИред рдпрд╣ [рдкреНрд░реВрдл рдСрдл рдХреЙрдиреНрд╕реЗрдкреНрдЯ](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-session-interception) рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреИрд╕реЗ рдПрдХ рдХрдВрдЯреНрд░реЛрд▓ рдЪреИрдирд▓ рдмрдирд╛рдпрд╛ рдЬрд╛рдП рдФрд░ рд╕рддреНрд░ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХреА рдЬрд╛рдПред

рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╕реЗ, **SSM рд╕рддреНрд░реЛрдВ рдХреЛ рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ рдХрд░рдирд╛ EC2 рд╕рдВрджреЗрд╢реЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИ**ред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рдпрд╣ рд╣реИ рдХрд┐ **рдХрдВрдЯреНрд░реЛрд▓ рдЪреИрдирд▓ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдЬреАрд╡рд┐рдд рд░рд╣рддреЗ рд╣реИрдВ**, рдФрд░ EC2 рд╕рдВрджреЗрд╢реЛрдВ рдХреА рддрд░рд╣ AWS рдХреЗрд╡рд▓ **рдирд╡реАрдирддрдо рд╡рд╛рд▓реЗ** рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░реЗрдЧрд╛ред рдирддреАрдЬрддрди, рд╣рдо рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдХрдВрдЯреНрд░реЛрд▓ рдЪреИрдирд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдиреЗ рд╡рд╛рд▓реЗ рд╕рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рд╕реБрди рд╕рдХрддреЗ рд╣реИрдВред SSM рдПрдЬреЗрдВрдЯ рд╕реЛрд░реНрд╕ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдо рдмрд╛рдЗрдирд░реА рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рддреИрдпрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдпрджрд┐ рдЖрдк [рдкреНрд░реВрдл рдСрдл рдХреЙрдиреНрд╕реЗрдкреНрдЯ](https://github.com/Frichetten/ssm-agent-research/tree/main/ssm-session-interception) рдХреЛ рджреЗрдЦреЗрдВ, рддреЛ рдЖрдк рджреЗрдЦреЗрдВрдЧреЗ рдХрд┐ рдореИрдВрдиреЗ рд╢рд╛рдмреНрджрд┐рдХ рд░реВрдк рд╕реЗ Go рдХреЛ Python рдореЗрдВ рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд┐рдпрд╛ рд╣реИ), рдФрд░ рд╕рддреНрд░ рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЖрджреЗрд╢реЛрдВ рдХреЛ рдЪреБрд░рд╛рдпрд╛ рдЬрд╛рдП (**рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА**) рдФрд░ рд╣рдорд▓рд╛рд╡рд░ рдХрд╛ рдЖрдЙрдЯрдкреБрдЯ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рдПред

## рд╕рдВрджрд░реНрдн

* [https://frichetten.com/blog/ssm-agent-tomfoolery/](https://frichetten.com/blog/ssm-agent-tomfoolery/)

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВред

</details>
