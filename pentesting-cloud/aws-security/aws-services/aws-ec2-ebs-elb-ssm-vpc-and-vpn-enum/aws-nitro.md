# AWS - Nitro

<details>

<summary><strong>ゼロからヒーローまでAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい**または **HackTricks をPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見る
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**をフォローする。**
* **ハッキングトリックを共有するためにPRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のgithubリポジトリに提出する。

</details>

## 基本情報

AWS Nitro は、AWS EC2 インスタンスの基盤となる **革新的な技術のスイート** です。Amazon によって導入され、**セキュリティ、パフォーマンス、信頼性を向上**させるために、Nitro はカスタム **ハードウェアコンポーネントと軽量ハイパーバイザー** を活用しています。Nitro は従来の仮想化機能の多くを専用ハードウェアとソフトウェアに抽象化し、**攻撃面を最小限に抑え、リソース効率を向上**させています。仮想化機能をオフロードすることで、Nitro は EC2 インスタンスが **ベアメタルに近いパフォーマンス** を提供できるようにし、リソース集約型アプリケーションに特に有益です。さらに、Nitro セキュリティチップは、**ハードウェアとファームウェアのセキュリティ** を確保し、その堅牢なアーキテクチャをさらに強化しています。

### Nitro Enclaves

**AWS Nitro Enclaves** は、Amazon EC2 インスタンス内で **高度に機密性の高いデータを処理するために特別に設計された安全な、隔離された計算環境** を提供します。AWS Nitro システムを活用して、これらのエンクレーブは堅牢な **隔離とセキュリティ** を確保し、PII や財務記録などの **機密情報の取り扱い** に最適です。エンクレーブは、データ露出のリスクを大幅に減らすために、最小限の環境を備えています。さらに、Nitro Enclaves は暗号化アテステーションをサポートし、認証されたコードのみが実行されていることをユーザーが検証できるようにしており、厳格なコンプライアンスとデータ保護基準を維持するために重要です。

{% hint style="danger" %}
Nitro Enclave イメージは **EC2 インスタンス内部から実行**され、AWS ウェブコンソールから EC2 インスタンスが Nitro Enclave でイメージを実行しているかどうかを確認することはできません。
{% endhint %}

### Nitro Enclave CLI インストール

[**ドキュメントから**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)すべての手順に従ってください。ただし、以下が最も重要です:
```bash
# Install tools
sudo amazon-linux-extras install aws-nitro-enclaves-cli -y
sudo yum install aws-nitro-enclaves-cli-devel -y

# Config perms
sudo usermod -aG ne $USER
sudo usermod -aG docker $USER

# Check installation
nitro-cli --version

# Start and enable the Nitro Enclaves allocator service.
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service
```
### Nitro Enclave イメージ

Nitro Enclave で実行できるイメージは、Docker イメージに基づいています。したがって、Nitro Enclave イメージを作成する際には、次のような Docker イメージから作成できます:
```bash
# You need to have the docker image accesible in your running local registry
# Or indicate the full docker image URL to access the image
nitro-cli build-enclave --docker-uri <docker-img>:<tag> --output-file nitro-img.eif
```
Nitro Enclave イメージは、拡張子 **`eif`** (Enclave Image File) を使用しています。

出力は次のようになります：
```
Using the locally available Docker image...
Enclave Image successfully created.
{
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
```
Conforming to [**the documentation**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave), エンクレーブイメージを実行するには、ディスクに取り込む**`eif`**ファイルの4倍以上のメモリを割り当てる必要があります。
