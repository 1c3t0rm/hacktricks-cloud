# AWS - Nitro

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Obtenha o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Informa√ß√µes B√°sicas

O AWS Nitro √© um conjunto de **tecnologias inovadoras** que formam a plataforma subjacente para as inst√¢ncias AWS EC2. Introduzido pela Amazon para **aumentar a seguran√ßa, desempenho e confiabilidade**, o Nitro aproveita componentes de **hardware personalizados e um hipervisor leve**. Ele abstrai grande parte da funcionalidade de virtualiza√ß√£o tradicional para hardware e software dedicados, **minimizando a superf√≠cie de ataque** e melhorando a efici√™ncia de recursos. Ao descarregar fun√ß√µes de virtualiza√ß√£o, o Nitro permite que as inst√¢ncias EC2 ofere√ßam **desempenho quase bare-metal**, tornando-o particularmente ben√©fico para aplicativos intensivos em recursos. Al√©m disso, o Chip de Seguran√ßa Nitro garante especificamente a **seguran√ßa do hardware e firmware**, solidificando ainda mais sua arquitetura robusta.

### Nitro Enclaves

**AWS Nitro Enclaves** fornece um ambiente de computa√ß√£o seguro e **isolado dentro das inst√¢ncias Amazon EC2**, projetado especificamente para processar dados altamente sens√≠veis. Aproveitando o Sistema AWS Nitro, esses enclaves garantem **isolamento e seguran√ßa robustos**, ideais para **lidar com informa√ß√µes confidenciais** como PII ou registros financeiros. Eles apresentam um ambiente minimalista, reduzindo significativamente o risco de exposi√ß√£o de dados. Al√©m disso, os Nitro Enclaves suportam atesta√ß√£o criptogr√°fica, permitindo que os usu√°rios verifiquem que apenas o c√≥digo autorizado est√° em execu√ß√£o, crucial para manter rigorosos padr√µes de conformidade e prote√ß√£o de dados.

{% hint style="danger" %}
As imagens do Nitro Enclave s√£o **executadas de dentro das inst√¢ncias EC2** e voc√™ n√£o pode ver no console da web da AWS se uma inst√¢ncia EC2 est√° executando imagens em Nitro Enclave ou n√£o.
{% endhint %}

### Instala√ß√£o do CLI do Nitro Enclave

Siga todas as instru√ß√µes [**da documenta√ß√£o**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave). No entanto, estas s√£o as mais importantes:
```bash
# Install tools
sudo amazon-linux-extras install aws-nitro-enclaves-cli -y
sudo yum install aws-nitro-enclaves-cli-devel -y

# Config perms
sudo usermod -aG ne $USER
sudo usermod -aG docker $USER

# Check installation
nitro-cli --version

# Start and enable the Nitro Enclaves allocator service.
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service
```
### Imagens do Nitro Enclave

As imagens que voc√™ pode executar no Nitro Enclave s√£o baseadas em imagens docker, ent√£o voc√™ pode criar suas imagens do Nitro Enclave a partir de imagens docker como:
```bash
# You need to have the docker image accesible in your running local registry
# Or indicate the full docker image URL to access the image
nitro-cli build-enclave --docker-uri <docker-img>:<tag> --output-file nitro-img.eif
```
Como voc√™ pode ver, as imagens do Nitro Enclave usam a extens√£o **`eif`** (Enclave Image File).

A sa√≠da ser√° semelhante a:
```
Using the locally available Docker image...
Enclave Image successfully created.
{
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
```
Conforme [**a documenta√ß√£o**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave), para executar uma imagem de enclave, voc√™ precisa atribuir a ela uma mem√≥ria de pelo menos 4 vezes o espa√ßo que o arquivo **`eif`** ocupa no disco.
