# AWS - Nitro

<details>

<summary><strong>htARTE (HackTricks AWS Red Team 전문가)</strong>에서 <a href="https://training.hacktricks.xyz/courses/arte"><strong>AWS 해킹을 처음부터 전문가까지 배우세요</strong></a><strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사가 HackTricks에 광고되길 원하거나** **HackTricks를 PDF로 다운로드하고 싶다면** [**구독 요금제**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스왜그**](https://peass.creator-spring.com)를 구매하세요
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요, 당사의 독점 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **가입**하거나 **트위터** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**를 팔로우**하세요.
* **HackTricks** 및 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

## 기본 정보

AWS Nitro는 AWS EC2 인스턴스의 기본 플랫폼을 형성하는 **혁신적인 기술 모음**입니다. Amazon에 의해 소개된 Nitro는 **보안, 성능 및 신뢰성을 향상**시키기 위해 사용자 정의 **하드웨어 구성 요소 및 가벼운 하이퍼바이저**를 활용합니다. Nitro는 전통적인 가상화 기능의 많은 부분을 전용 하드웨어 및 소프트웨어로 추상화하여 **공격 표면을 최소화**하고 자원 효율성을 향상시킵니다. 가상화 기능을 오프로드함으로써 Nitro는 EC2 인스턴스가 **거의 베어 메탈 성능**을 제공할 수 있도록 하여 자원 집약적인 응용 프로그램에 특히 유익합니다. 또한 Nitro 보안 칩은 **하드웨어 및 펌웨어의 보안**을 특히 보장하여 견고한 아키텍처를 더욱 확고히 합니다.

### Nitro Enclaves

**AWS Nitro Enclaves**는 Amazon EC2 인스턴스 내에서 **고도로 민감한 데이터를 처리하기 위해 특별히 설계된 안전한, 격리된 컴퓨팅 환경**을 제공합니다. AWS Nitro 시스템을 활용하여 이러한 Enclaves는 견고한 **격리 및 보안**을 보장하여 PII 또는 금융 기록과 같은 **기밀 정보를 처리**하는 데 이상적입니다. 이들은 데이터 노출 위험을 크게 줄이는 최소한의 환경을 제공합니다. 또한 Nitro Enclaves는 암호화 인증을 지원하여 사용자가 실행 중인 코드가 인증된 코드인지 확인할 수 있도록 하여 엄격한 규정 준수 및 데이터 보호 표준을 유지하는 데 중요합니다.

{% hint style="danger" %}
Nitro Enclave 이미지는 **EC2 인스턴스 내부에서 실행**되며 AWS 웹 콘솔에서 EC2 인스턴스가 Nitro Enclave 이미지를 실행 중인지 여부를 확인할 수 없습니다.
{% endhint %}

### Nitro Enclave CLI 설치

모든 지침을 [**문서**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)에서 따르세요. 그러나 이것들이 가장 중요합니다:
```bash
# Install tools
sudo amazon-linux-extras install aws-nitro-enclaves-cli -y
sudo yum install aws-nitro-enclaves-cli-devel -y

# Config perms
sudo usermod -aG ne $USER
sudo usermod -aG docker $USER

# Check installation
nitro-cli --version

# Start and enable the Nitro Enclaves allocator service.
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service
```
### Nitro Enclave 이미지

Nitro Enclave에서 실행할 수 있는 이미지들은 도커 이미지를 기반으로 하며, 따라서 다음과 같이 도커 이미지로부터 Nitro Enclave 이미지를 생성할 수 있습니다:
```bash
# You need to have the docker image accesible in your running local registry
# Or indicate the full docker image URL to access the image
nitro-cli build-enclave --docker-uri <docker-img>:<tag> --output-file nitro-img.eif
```
Nitro Enclave 이미지는 **`eif`** (Enclave Image File) 확장자를 사용합니다.

출력은 다음과 유사합니다:
```
Using the locally available Docker image...
Enclave Image successfully created.
{
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
```
[**문서**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)에 따르면, 엔클레이브 이미지를 실행하려면 해당 이미지에 할당된 메모리가 디스크에 저장된 **`eif`** 파일 크기의 최소 4배 이상이어야 합니다.
