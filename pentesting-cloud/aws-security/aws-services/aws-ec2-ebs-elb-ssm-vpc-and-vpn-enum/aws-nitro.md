# AWS - Nitro

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

- 如果您想看到您的**公司在HackTricks中被广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
- 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
- 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)
- **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或 **关注**我们的**Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
- 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 基本信息

AWS Nitro是一套**创新技术**，构成了AWS EC2实例的基础平台。由亚马逊推出，旨在**增强安全性、性能和可靠性**，Nitro利用自定义**硬件组件和轻量级hypervisor**。它将许多传统虚拟化功能抽象到专用硬件和软件中，**减少攻击面**并提高资源效率。通过卸载虚拟化功能，Nitro使EC2实例能够提供**接近裸金属的性能**，特别适用于资源密集型应用程序。此外，Nitro安全芯片专门确保**硬件和固件的安全性**，进一步巩固了其强大的架构。

### Nitro Enclaves

**AWS Nitro Enclaves**提供了一个安全的、**隔离的计算环境，位于Amazon EC2实例内部**，专门用于处理高度敏感数据。利用AWS Nitro系统，这些飞地确保了强大的**隔离和安全性**，非常适合处理诸如PII或财务记录等**机密信息**。它们具有极简环境，显著降低了数据暴露的风险。此外，Nitro Enclaves支持加密认证，允许用户验证只有经授权的代码正在运行，这对于保持严格的合规性和数据保护标准至关重要。

{% hint style="danger" %}
Nitro Enclave镜像是**从EC2实例内部运行**的，您无法从AWS Web控制台看到EC2实例是否在Nitro Enclave中运行镜像。
{% endhint %}

### Nitro Enclave CLI安装

按照[**文档中的所有说明**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)。但是，以下是最重要的指令：
```bash
# Install tools
sudo amazon-linux-extras install aws-nitro-enclaves-cli -y
sudo yum install aws-nitro-enclaves-cli-devel -y

# Config perms
sudo usermod -aG ne $USER
sudo usermod -aG docker $USER

# Check installation
nitro-cli --version

# Start and enable the Nitro Enclaves allocator service.
sudo systemctl start nitro-enclaves-allocator.service && sudo systemctl enable nitro-enclaves-allocator.service
```
### Nitro Enclave镜像

您可以在Nitro Enclave中运行的镜像基于docker镜像，因此您可以从docker镜像创建您的Nitro Enclave镜像，例如：
```bash
# You need to have the docker image accesible in your running local registry
# Or indicate the full docker image URL to access the image
nitro-cli build-enclave --docker-uri <docker-img>:<tag> --output-file nitro-img.eif
```
正如您所看到的，Nitro Enclave 图像使用扩展名 **`eif`**（Enclave Image File）。

输出将类似于：
```
Using the locally available Docker image...
Enclave Image successfully created.
{
"Measurements": {
"HashAlgorithm": "Sha384 { ... }",
"PCR0": "e199261541a944a93129a52a8909d29435dd89e31299b59c371158fc9ab3017d9c450b0a580a487e330b4ac691943284",
"PCR1": "bcdf05fefccaa8e55bf2c8d6dee9e79bbff31e34bf28a99aa19e6b29c37ee80b214a414b7607236edf26fcb78654e63f",
"PCR2": "2e1fca1dbb84622ec141557dfa971b4f8ea2127031b264136a20278c43d1bba6c75fea286cd4de9f00450b6a8db0e6d3"
}
}
```
根据[**文档**](https://catalog.us-east-1.prod.workshops.aws/event/dashboard/en-US/workshop/1-my-first-enclave/1-1-nitro-enclaves-cli#run-connect-and-terminate-the-enclave)，为了运行一个enclave镜像，您需要为其分配至少是**`eif`**文件占用磁盘空间的4倍的内存。
