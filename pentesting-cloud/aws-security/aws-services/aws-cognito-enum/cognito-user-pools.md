# Cognito User Pools

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>!HackTricks</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Basic Information

A user pool is a user directory in Amazon Cognito. With a user pool, your users can **sign in to your web or mobile app** through Amazon Cognito, **or federate** through a **third-party** identity provider (IdP). Whether your users sign in directly or through a third party, all members of the user pool have a directory profile that you can access through an SDK.

User pools provide:

* Sign-up and sign-in services.
* A built-in, customizable web UI to sign in users.
* Social sign-in with Facebook, Google, Login with Amazon, and Sign in with Apple, and through SAML and OIDC identity providers from your user pool.
* User directory management and user profiles.
* Security features such as multi-factor authentication (MFA), checks for compromised credentials, account takeover protection, and phone and email verification.
* Customized workflows and user migration through AWS Lambda triggers.

**Source code** of applications will usually also contain the **user pool ID** and the **client application ID**, (and some times the **application secret**?) which are needed for a **user to login** to a Cognito User Pool.

### Potential attacks

* **Registration**: By default a user can register himself, so he could create a user for himself.
* **User enumeration**: The registration functionality can be used to find usernames that already exists. This information can be useful for the brute-force attack.
* **Login brute-force**: In the [**Authentication**](cognito-user-pools.md#authentication) section you have all the **methods** that a user have to **login**, you could try to brute-force them **find valid credentials**.

### Tools for pentesting

* [Pacu](https://github.com/RhinoSecurityLabs/pacu), the AWS exploitation framework, now includes the "cognito\_\_enum" and "cognito\_\_attack" modules that automate enumeration of all Cognito assets in an account and flag weak configurations, user attributes used for access control, etc., and also automate user creation (including MFA support) and privilege escalation based on modifiable custom attributes, usable identity pool credentials, assumable roles in id tokens, etc.

For a description of the modules' functions see part 2 of the [blog post](https://rhinosecuritylabs.com/aws/attacking-aws-cognito-with-pacu-p2). For installation instructions see the main [Pacu](https://github.com/RhinoSecurityLabs/pacu) page.

#### Usage

Sample cognito\_\_attack usage to attempt user creation and all privesc vectors against a given identity pool and user pool client:
```bash
Pacu (new:test) > run cognito__attack --username randomuser --email XX+sdfs2@gmail.com --identity_pools
us-east-2:a06XXXXX-c9XX-4aXX-9a33-9ceXXXXXXXXX --user_pool_clients
59f6tuhfXXXXXXXXXXXXXXXXXX@us-east-2_0aXXXXXXX
```
Sample cognito\_\_enum usage to gather all user pools, user pool clients, identity pools, users, etc. visible in the current AWS account:

```bash
cognito__enum
```

Translation:

```klingon
cognito__enum
```
```bash
Pacu (new:test) > run cognito__enum
```
* [Cognito Scanner](https://github.com/padok-team/cognito-scanner) vItlh CLI tool python Daq 'oH attacks Cognito including unwanted account creation and account oracle.

#### Installation
```bash
$ pip install cognito-scanner
```
#### Qap

---

#### Enumeration

##### Qap

To enumerate user pools in AWS Cognito, you can use the following command:

```plaintext
aws cognito-idp list-user-pools --max-results 10
```

This command will list the first 10 user pools in your AWS Cognito account. You can adjust the `max-results` parameter to retrieve more or fewer user pools.

##### Qap

To get detailed information about a specific user pool, you can use the following command:

```plaintext
aws cognito-idp describe-user-pool --user-pool-id <user-pool-id>
```

Replace `<user-pool-id>` with the actual ID of the user pool you want to retrieve information about.

##### Qap

To enumerate the users in a user pool, you can use the following command:

```plaintext
aws cognito-idp list-users --user-pool-id <user-pool-id>
```

Replace `<user-pool-id>` with the ID of the user pool you want to enumerate.

##### Qap

To get detailed information about a specific user in a user pool, you can use the following command:

```plaintext
aws cognito-idp admin-get-user --user-pool-id <user-pool-id> --username <username>
```

Replace `<user-pool-id>` with the ID of the user pool and `<username>` with the username of the user you want to retrieve information about.

##### Qap

To enumerate the groups in a user pool, you can use the following command:

```plaintext
aws cognito-idp list-groups --user-pool-id <user-pool-id>
```

Replace `<user-pool-id>` with the ID of the user pool you want to enumerate.

##### Qap

To get detailed information about a specific group in a user pool, you can use the following command:

```plaintext
aws cognito-idp admin-get-group --user-pool-id <user-pool-id> --group-name <group-name>
```

Replace `<user-pool-id>` with the ID of the user pool and `<group-name>` with the name of the group you want to retrieve information about.
```bash
$ cognito-scanner --help
```
For more information check https://github.com/padok-team/cognito-scanner

## Registration

User Pools allows by **default** to **register new users**.

---

## Qapla'!

For more information check https://github.com/padok-team/cognito-scanner

## Qa'vIn

User Pools allows by **default** to **register new users**.
```bash
aws cognito-idp sign-up --client-id <client-id> \
--username <username> --password <password> \
--region <region> --no-sign-request
```
#### vaj vItlhutlh

vaj vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhut
```
An error occurred (InvalidParameterException) when calling the SignUp operation: Attributes did not conform to the schema: address: The attribute is required
```
**JSON Example:**

```
{
  "UserPoolId": "us-west-2_abcd1234",
  "AppClientId": "abcd1234efgh5678",
  "AppClientSecret": "abcdefgh12345678ijklmnopqrstuv",
  "Region": "us-west-2"
}
```

**Klingon Translation:**

```
{
  "UserPoolId": "us-west-2_abcd1234",
  "AppClientId": "abcd1234efgh5678",
  "AppClientSecret": "abcdefgh12345678ijklmnopqrstuv",
  "Region": "us-west-2"
}
```
```json
--user-attributes '[{"Name": "email", "Value": "carlospolop@gmail.com"}, {"Name":"gender", "Value": "M"}, {"Name": "address", "Value": "street"}, {"Name": "custom:custom_name", "Value":"supername&\"*$"}]'
```
**ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhvam** **ghItlhv
```
An error occurred (UsernameExistsException) when calling the SignUp operation: User already exists
```
{% hint style="info" %}
Qapvam vItlhutlh vay' **custom attributes "custom:" lo'laH"**.\
DaH jImejDaq **custom attributes vItlhutlh** (ghorghDaq 'e' vItlhutlh) 'ej **default attributes** (ghorghDaq 'e' vItlhutlh) **value vItlhutlh**.
{% endhint %}

qatlh 'ej client id vItlhutlh vay'. vaj 'ej client-id vItlhutlh 'e' vItlhutlh:
```
An error occurred (ResourceNotFoundException) when calling the SignUp operation: User pool client 3ig612gjm56p1ljls1prq2miut does not exist.
```
#### vaj admin vItlhutlh

vaj error Hoch 'ej vItlhutlh 'e' vItlhutlhbe'lu'chugh users:
```
An error occurred (NotAuthorizedException) when calling the SignUp operation: SignUp is not permitted for this user pool
```
### QaDwI'wI' jImej

Cognito **jImejvam jImej** 'ej **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam jImej** **jImejvam
```bash
aws cognito-idp confirm-sign-up --client-id <cliet_id> \
--username aasdasd2 --confirmation-code <conf_code> \
--no-sign-request --region us-east-1
```
{% hint style="warning" %}
**Qatlh** vItlhutlh **'oH email** je phone number, 'ach qaStaHvIS Cognito user vItlhutlh verify **'ej vItlhutlh account**.
{% endhint %}

### Privilege Escalation / Updating Attributes

By default a user can **modify the value of his attributes** with something like:
```bash
aws cognito-idp update-user-attributes \
--region us-east-1 --no-sign-request \
--user-attributes Name=address,Value=street \
--access-token <access token>
```
#### Custom attribute privesc

{% hint style="danger" %}
**custom attributes** being used (such as `isAdmin`) might be found, as by default you can **change the values of your own attributes** you might be able to **escalate privileges** changing the value yourself!
{% endhint %}

#### Email/username modification privesc

You can use this to **modify the email and phone number** of a user, but then, even if the account remains as verified, those attributes are **set in unverified status** (you need to verify them again).

{% hint style="warning" %}
You **won't be able to login with email or phone number** until you verify them, but you will be **able to login with the username**.\
Note that even if the email was modified and not verified it will appear in the ID Token inside the **`email`** **field** and the filed **`email_verified`** will be **false**, but if the app **isn't checking that you might impersonate other users**.

Moreover, note that you can put anything inside the **`name`** field just modifying the **name attribute**. If an app is **checking** **that** field for some reason **instead of the `email`** (or any other attribute) you might be able to **impersonate other users**.
{% endhint %}

Anyway, if for some reason you changed your email for example to a new one you can access you can **confirm the email with the code you received in that email address**:
```bash
aws cognito-idp verify-user-attribute \
--access-token <access_token> \
--attribute-name email --code <code> \
--region <region> --no-sign-request
```
**`phone_number`** **`email`** **`email`** **`phone_number`** **`new phone number`** **`phone_number`**.

{% hint style="info" %}
**`login with a user preferred username`** **`any username or preferred_username already being used`**
{% endhint %}

### **`Recover/Change Password`**

**`username`** **`email`** **`phone`** **`code`**
```bash
aws cognito-idp forgot-password \
--client-id <client_id> \
--username <username/email/phone> --region <region>
```
{% hint style="info" %}
Qa'vIn server response luq Hoch, username vItlhutlh. username users enumerate laH method vItlhutlh
{% endhint %}

With the code you can change the password with:
```bash
aws cognito-idp confirm-forgot-password \
--client-id <client_id> \
--username <username> \
--confirmation-code <conf_code> \
--password <pwd> --region <region>
```
**ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **vItlhutlh** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **ghItlhvam** **password** **vItlhutlh** **
```bash
aws cognito-idp change-password \
--previous-password <value> \
--proposed-password <value> \
--access-token <value>
```
## Authentication

**Qa'vIn** user pool **vItlhutlh** **authentication** **vItlhutlh**. **username** **'ej password** **vItlhutlh** **login** **vItlhutlh** **methods** **vItlhutlh**.

**vaj** **user** **Pool** **'oH** **authenticated** **user** **3 tokens** **vItlhutlh**: **ID Token**, **Access token**, **Refresh token**.

* [**ID Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-id-token.html): **identity** **authenticated user** **claims** **vItlhutlh**, **name**, **email**, **phone_number** **vItlhutlh**. **ID token** **authenticate users** **resource servers** **server applications** **vItlhutlh**. **ID token** **verify** **signature** **ID token** **claims** **trust** **external applications** **vItlhutlh**.
* **ID Token** **user** **attributes values** **token** **vItlhutlh**, **custom** **vItlhutlh**.
* [**Access Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-access-token.html): **authenticated user** **claims**, **user's groups**, **scopes** **vItlhutlh**. **Access token** **authorize API operations** **user** **user pool** **vItlhutlh**. **Access token** **user access** **add**, **change**, **delete user attributes** **vItlhutlh**.
* [**Refresh Token**](https://docs.aws.amazon.com/cognito/latest/developerguide/amazon-cognito-user-pools-using-the-refresh-token.html): **refresh tokens** **ID Tokens** **Access Tokens** **vItlhutlh** **user** **refresh token** **invalid** **vItlhutlh**. **refresh token** **expires 30 days after** **application user** **user pool** **vItlhutlh**. **application** **user pool** **refresh token expiration** **value between 60 minutes and 10 years** **vItlhutlh**.

### ADMIN\_NO\_SRP\_AUTH & ADMIN\_USER\_PASSWORD\_AUTH

**qaStaHvIS** **server side authentication flow**:

* **server-side app** **`AdminInitiateAuth` API operation** **vItlhutlh** **(instead of `InitiateAuth`)**. **operation** **AWS credentials** **permissions** **`cognito-idp:AdminInitiateAuth`** **`cognito-idp:AdminRespondToAuthChallenge`** **vItlhutlh**. **operation** **authentication parameters** **vItlhutlh**.
* **server-side app** **authentication parameters** **vItlhutlh**, **`AdminRespondToAuthChallenge` API operation** **vItlhutlh**. **`AdminRespondToAuthChallenge` API operation** **AWS credentials** **vItlhutlh**.

**method** **enabled** **vItlhutlh**.

**login** **vItlhutlh** **need** **vItlhutlh**:

* **user pool id**
* **client id**
* **username**
* **password**
* **client secret** **(only if the app is configured to use a secret)**

{% hint style="info" %}
**login** **method** **able** **application** **login** **`ALLOW_ADMIN_USER_PASSWORD_AUTH`** **vItlhutlh**.\
**action** **perform** **credentials** **permissions** **`cognito-idp:AdminInitiateAuth`** **`cognito-idp:AdminRespondToAuthChallenge`** **vItlhutlh**
{% endhint %}
```python
aws cognito-idp admin-initiate-auth \
--client-id <client-id> \
--auth-flow ADMIN_USER_PASSWORD_AUTH \
--region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'
--user-pool-id "<pool-id>"

# Check the python code to learn how to generate the hsecret_hash
```
<details>

<summary>Code to Login</summary>

```
function login(username, password) {
  // Code to authenticate user
}
```

</details>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.admin_initiate_auth(
UserPoolId=user_pool_id,
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_PASSWORD\_AUTH

**tlhIngan Hol:**

**USER\_PASSWORD\_AUTH** vItlhutlh **user & password authentication** flow. **Cognito** vItlhutlh **traditional authentication method** **migrate** **recommended** je **disable** je **ALLOW\_USER\_SRP\_AUTH** method **use** (vaj 'oH password network DaH).\
**method NOT enabled** by default.

**Difference** **previous auth method** code **inside** **main** vItlhutlh **user pool ID** **need** je **extra permissions** Cognito User Pool.

**login** **need** je:

* client id
* username
* password
* client secret (only if the app is configured to use a secret)

{% hint style="info" %}
**login with this method** **able** **order** application **ALLOW\_USER\_PASSWORD\_AUTH** login.
{% endhint %}
```python
aws cognito-idp initiate-auth  --client-id <client-id> \
--auth-flow USER_PASSWORD_AUTH --region <region> \
--auth-parameters 'USERNAME=<username>,PASSWORD=<password>,SECRET_HASH=<hash_if_needed>'

# Check the python code to learn how to generate the secret_hash
```
<details>

<summary>Python code to Login</summary>

```
import requests

url = "https://example.com/login"
data = {
    "username": "admin",
    "password": "password123"
}

response = requests.post(url, data=data)

if response.status_code == 200:
    print("Login successful")
else:
    print("Login failed")
```

</details>
```python
import boto3
import botocore
import hmac
import hashlib
import base64


client_id = "<client-id>"
user_pool_id = "<user-pool-id>"
client_secret = "<client-secret>"
username = "<username>"
password = "<pwd>"

boto_client = boto3.client('cognito-idp', region_name='us-east-1')

def get_secret_hash(username, client_id, client_secret):
key = bytes(client_secret, 'utf-8')
message = bytes(f'{username}{client_id}', 'utf-8')
return base64.b64encode(hmac.new(key, message, digestmod=hashlib.sha256).digest()).decode()

# If the Client App isn't configured to use a secret
## just delete the line setting the SECRET_HASH
def login_user(username_or_alias, password, client_id, client_secret, user_pool_id):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='ADMIN_USER_PASSWORD_AUTH',
AuthParameters={
'USERNAME': username_or_alias,
'PASSWORD': password,
'SECRET_HASH': get_secret_hash(username_or_alias, client_id, client_secret)
}
)
except botocore.exceptions.ClientError as e:
return e.response

print(login_user(username, password, client_id, client_secret, user_pool_id))
```
</details>

### USER\_SRP\_AUTH

**QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH** **QaH**
```python
from warrant.aws_srp import AWSSRP
import os

USERNAME='xxx'
PASSWORD='yyy'
POOL_ID='us-east-1_zzzzz'
CLIENT_ID = '12xxxxxxxxxxxxxxxxxxxxxxx'
CLIENT_SECRET = 'secreeeeet'
os.environ["AWS_DEFAULT_REGION"] = "<region>"

aws = AWSSRP(username=USERNAME, password=PASSWORD, pool_id=POOL_ID,
client_id=CLIENT_ID, client_secret=CLIENT_SECRET)
tokens = aws.authenticate_user()
id_token = tokens['AuthenticationResult']['IdToken']
refresh_token = tokens['AuthenticationResult']['RefreshToken']
access_token = tokens['AuthenticationResult']['AccessToken']
token_type = tokens['AuthenticationResult']['TokenType']
```
</details>

### REFRESH\_TOKEN\_AUTH & REFRESH\_TOKEN

**tlhIngan Hol: vItlhutlh** (qaStaHvIS lo'laHbe'chugh) **ghobe'** 'ej **refresh token** vItlhutlh.
```bash
aws cognito-idp initiate-auth \
--client-id 3ig6h5gjm56p1ljls1prq2miut \
--auth-flow REFRESH_TOKEN_AUTH \
--region us-east-1 \
--auth-parameters 'REFRESH_TOKEN=<token>'
```
<details>

<summary>QaD jImej</summary>
```python
import boto3
import botocore
import hmac
import hashlib
import base64

client_id = "<client-id>"
token = '<token>'

boto_client = boto3.client('cognito-idp', region_name='<region>')

def refresh(client_id, refresh_token):
try:
return boto_client.initiate_auth(
ClientId=client_id,
AuthFlow='REFRESH_TOKEN_AUTH',
AuthParameters={
'REFRESH_TOKEN': refresh_token
}
)
except botocore.exceptions.ClientError as e:
return e.response


print(refresh(client_id, token))
```
</details>

### CUSTOM_AUTH

In this case the **authentication** is going to be performed through the **execution of a lambda function**.

## Extra Security

### Advanced Security

By default it's disabled, but if enabled, Cognito could be able to **find account takeovers**. To minimise the probability you should login from a **network inside the same city, using the same user agent** (and IP is thats possible)**.**

### **MFA Remember device**

If the user logins from the same device, the MFA might be bypassed, therefore try to login from the same browser with the same metadata (IP?) to try to bypass the MFA protection.

## User Pool Groups IAM Roles

It's possible to add **users to User Pool** groups that are related to one **IAM roles**.\
Moreover, **users** can be assigned to **more than 1 group with different IAM roles** attached.

Note that even if a group is inside a group with an IAM role attached, in order to be able to access IAM credentials of that group it's needed that the **User Pool is trusted by an Identity Pool** (and know the details of that Identity Pool).

Another requisite to get the **IAM role indicated in the IdToken** when a user is authenticated in the User Pool (`aws cognito-idp initiate-auth...`) is that the **Identity Provider Authentication provider** needs indicate that the **role must be selected from the token.**

<figure><img src="../../../../.gitbook/assets/image (7) (1) (2).png" alt=""><figcaption></figcaption></figure>

The **roles** a user have access to are **inside the `IdToken`**, and a user can **select which role he would like credentials for** with the **`--custom-role-arn`** from `aws cognito-identity get-credentials-for-identity`.\
However, if the **default option** is the one **configured** (`use default role`), and you try to access a role from the IdToken, you will get **error** (that's why the previous configuration is needed):

{% code overflow="wrap" %}
```
An error occurred (InvalidParameterException) when calling the GetCredentialsForIdentity operation: Only SAML providers and providers with RoleMappings support custom role ARN.
```
{% endcode %}

{% hint style="warning" %}
ghobe' User Pool Group **role** **Identity Provider** **trust** **User Pool** (as the IAM role **session credentials are going to be obtained from it**).
{% endhint %}
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"Federated": "cognito-identity.amazonaws.com"
},
"Action": "sts:AssumeRoleWithWebIdentity",
"Condition": {
"StringEquals": {
"cognito-identity.amazonaws.com:aud": "us-east-1:2361092e-9db6-a876-1027-10387c9de439"
},
"ForAnyValue:StringLike": {
"cognito-identity.amazonaws.com:amr": "authenticated"
}
}
}
]
}js
```
<details>

<summary><strong>qaStaHvIS AWS hacking vItlh</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
