# AWS - EFS Enum

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## EFS

### Basic Information

Amazon Elastic File System (EFS) is presented as a **fully managed, scalable, and elastic network file system** by AWS. The service facilitates the creation and configuration of **file systems** that can be concurrently accessed by multiple EC2 instances and other AWS services. The key features of EFS include its ability to automatically scale without manual intervention, provision low-latency access, support high-throughput workloads, guarantee data durability, and seamlessly integrate with various AWS security mechanisms.

By **default**, the EFS folder to mount will be **`/`** but it could have a **different name**.

### Network Access

An EFS is created in a VPC and would be **by default accessible in all the VPC subnetworks**. However, the EFS will have a Security Group. In order to **give access to an EC2** (or any other AWS service) to mount the EFS, it‚Äôs needed to **allow in the EFS security group an inbound NFS** (2049 port) **rule from the EC2 Security Group**.

Without this, you **won't be able to contact the NFS service**.

For more information about how to do this check: [https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount](https://stackoverflow.com/questions/38632222/aws-efs-connection-timeout-at-mount)

### Enumeration
```bash
# Get filesystems and access policies (if any)
aws efs describe-file-systems
aws efs describe-file-system-policy --file-system-id <id>

# Get subnetworks and IP addresses where you can find the file system
aws efs describe-mount-targets --file-system-id <id>
aws efs describe-mount-target-security-groups --mount-target-id <id>
aws ec2 describe-security-groups --group-ids <sg_id>

# Get other access points
aws efs describe-access-points

# Get replication configurations
aws efs describe-replication-configurations

# Search for NFS in EC2 networks
sudo nmap -T4 -Pn -p 2049 --open 10.10.10.0/20 # or /16 to be sure
```
{% hint style="danger" %}
Qapla'! EFS mount point vIqaw' VPC Daq, 'ej vItlhutlh subnet. 'ach 'oH scan `/16` netmask **EFS points vItlhutlhbe'chugh**.
{% endhint %}

### Mount EFS

{% code overflow="wrap" %}
```bash
sudo mkdir /efs

## Mount found
sudo apt install nfs-common
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport <IP>:/ /efs

## Mount with efs type
## You need to have installed the package amazon-efs-utils
sudo yum install amazon-efs-utils # If centos
sudo apt-get install amazon-efs-utils # If ubuntu
sudo mount -t efs <file-system-id/EFS DNS name>:/ /efs/
```
{% endcode %}

### IAM Qap

Qap **default** anyone with **network access to the EFS** will be able to mount, **read and write it even as root user**. However, File System policies could be in place **only allowing principals with specific permissions** to access it.\
For example, this File System policy **won't allow even to mount** the file system if you **don't have the IAM permission**:
```json
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-2ca2ba76-5d83-40be-8557-8f6c19eaa797",
"Statement": [
{
"Sid": "efs-statement-e7f4b04c-ad75-4a7f-a316-4e5d12f0dbf5",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": "",
"Resource": "arn:aws:elasticfilesystem:us-east-1:318142138553:file-system/fs-0ab66ad201b58a018",
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
be'joy'na' vItlhutlh:

<figure><img src="../../../.gitbook/assets/image (3) (6).png" alt=""><figcaption></figcaption></figure>

ghaH, IAM Daq vItlhutlh'e' vItlhutlh'e' vItlhutlh'e' "efs" type vIleghlaH:
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
# To use a different pforile from ~/.aws/credentials
# You can use: -o tls,iam,awsprofile=namedprofile
```
### qo'vam

**qo'vam** jatlh **EFS file system**-Daq **application**-specific entry points **into an EFS file system** that make it easier to manage application access to shared datasets.

When you create an access point, you can **specify the owner and POSIX permissions** for the files and directories created through the access point. You can also **define a custom root directory** for the access point, either by specifying an existing directory or by creating a new one with the desired permissions. This allows you to **control access to your EFS file system on a per-application or per-user basis**, making it easier to manage and secure your shared file data.

**You can mount the File System from an access point with something like:**
```bash
# Use IAM if you need to use iam permissions
sudo mount -t efs -o tls,[iam],accesspoint=<access-point-id> \
<file-system-id/EFS DNS> /efs/
```
{% hint style="warning" %}
Qapla'! QaStaHvIS NFS tIqDaq 'e' vItlhutlhlaHbe', 'ej 'oH EFS file system 'ejwI' 'e' vItlhutlhlaHbe', 'ach 'oH 'e' vItlhutlhlaHbe' EFS file system 'ejwI' 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej 'oH 'e' vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' 'ej
