# Monitoramento com Falco

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

Este tutorial foi retirado de [https://madhuakula.com/kubernetes-goat/scenarios/scenario-18.html#scenario-information](https://madhuakula.com/kubernetes-goat/scenarios/scenario-18.html#scenario-information)

### Informa√ß√µes do cen√°rio

Este cen√°rio implanta monitoramento e detec√ß√£o de seguran√ßa em tempo de execu√ß√£o para cont√™ineres e recursos do Kubernetes.

* Para come√ßar com este cen√°rio, voc√™ pode implantar o seguinte gr√°fico de Helm com a vers√£o 3

> NOTA: Certifique-se de executar a implanta√ß√£o a seguir usando o Helm com v3.

```bash
helm repo add falcosecurity https://falcosecurity.github.io/charts
helm repo update
helm install falco falcosecurity/falco
```

![Cen√°rio 18 helm falco setup](https://madhuakula.com/kubernetes-goat/scenarios/images/sc-18-1.png)

### [Solu√ß√£o do cen√°rio](https://madhuakula.com/kubernetes-goat/scenarios/scenario-18.html#scenario-solution)

> `Falco`, o projeto de seguran√ßa em tempo de execu√ß√£o nativo da nuvem, √© o mecanismo de detec√ß√£o de amea√ßas Kubernetes de facto. O Falco foi criado pela Sysdig em 2016 e √© o primeiro projeto de seguran√ßa em tempo de execu√ß√£o a ingressar na CNCF como um projeto de incuba√ß√£o. O Falco detecta comportamentos inesperados do aplicativo e alerta sobre amea√ßas em tempo de execu√ß√£o.

O Falco usa chamadas de sistema para proteger e monitorar um sistema, por:

* Analisando as chamadas de sistema do Linux do kernel em tempo de execu√ß√£o
* Verificando o fluxo em rela√ß√£o a um poderoso mecanismo de regras
* Alertando quando uma regra √© violada

O Falco √© fornecido com um conjunto padr√£o de regras que verificam o kernel em busca de comportamentos incomuns, como:

* Escala√ß√£o de privil√©gios usando cont√™ineres privilegiados
* Altera√ß√µes de namespace usando ferramentas como `setns`
* Leituras/Grava√ß√µes em diret√≥rios conhecidos, como /etc, /usr/bin, /usr/sbin, etc
* Cria√ß√£o de links simb√≥licos
* Altera√ß√µes de propriedade e modo
* Conex√µes de rede inesperadas ou muta√ß√µes de soquete
* Processos gerados usando execve
* Executando bin√°rios de shell como sh, bash, csh, zsh, etc
* Executando bin√°rios SSH como ssh, scp, sftp, etc
* Muta√ß√£o de execut√°veis coreutils do Linux
* Muta√ß√£o de bin√°rios de login
* Muta√ß√£o de execut√°veis shadowutil ou passwd, como shadowconfig, pwck, chpasswd, getpasswd, change, useradd, etc, e outros.
* Obtenha mais detalhes sobre a implanta√ß√£o do Falco

```bash
kubectl get pods --selector app=falco
```

![Cen√°rio 18 falco get pods](https://madhuakula.com/kubernetes-goat/scenarios/images/sc-18-2.png)

* Obtendo manualmente os logs dos sistemas do Falco

```bash
kubectl logs -f -l app=falco
```

* Agora, vamos iniciar um cont√™iner hacker e ler um arquivo sens√≠vel e ver se isso √© detectado pelo Falco

```bash
kubectl run --rm --restart=Never -it --image=madhuakula/hacker-container -- bash
```

* Leia o arquivo sens√≠vel

```bash
cat /etc/shadow
```

![Cen√°rio 18 falco detecta /etc/shadow](https://madhuakula.com/kubernetes-goat/scenarios/images/sc-18-3.png)

<details>

<summary><strong>Apoie o HackTricks e obtenha benef√≠cios!</strong></summary>

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou se deseja acessar a **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm).
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>