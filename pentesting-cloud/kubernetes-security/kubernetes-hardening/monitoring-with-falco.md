# Falcoによるモニタリング

<details>

<summary><strong>HackTricksをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**PEASSの最新バージョンにアクセスしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有する**ために、[**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のGitHubリポジトリにPRを提出してください。

</details>

このチュートリアルは[https://madhuakula.com/kubernetes-goat/scenarios/scenario-18.html#scenario-information](https://madhuakula.com/kubernetes-goat/scenarios/scenario-18.html#scenario-information)から取得されました。

### シナリオ情報

このシナリオでは、コンテナとKubernetesリソースのランタイムセキュリティモニタリングと検出を展開します。

* このシナリオを開始するには、以下のhelmチャートをバージョン3で展開できます。

> 注意：以下のデプロイメントをHelm v3を使用して実行してください。
```bash
helm repo add falcosecurity https://falcosecurity.github.io/charts
helm repo update
helm install falco falcosecurity/falco
```
![シナリオ18のhelm falcoセットアップ](https://madhuakula.com/kubernetes-goat/scenarios/images/sc-18-1.png)

### [シナリオの解決策](https://madhuakula.com/kubernetes-goat/scenarios/scenario-18.html#scenario-solution)

> `Falco`は、クラウドネイティブなランタイムセキュリティプロジェクトであり、デファクトのKubernetes脅威検知エンジンです。Falcoは、Sysdigによって2016年に作成され、最初のランタイムセキュリティプロジェクトとしてCNCFにインキュベーションレベルのプロジェクトとして参加しました。Falcoは、予期しないアプリケーションの動作を検出し、ランタイムで脅威を警告します。

Falcoは、システムコールを使用してシステムをセキュアに監視します。具体的には、以下の手順を実行します。

* ランタイムでカーネルからLinuxシステムコールを解析する
* 強力なルールエンジンに対してストリームをアサートする
* ルールが違反した場合に警告する

Falcoには、以下のようなカーネルの異常な動作をチェックするデフォルトのルールセットが付属しています。

* 特権コンテナを使用した特権昇格
* `setns`などのツールを使用した名前空間の変更
* /etc、/usr/bin、/usr/sbinなどのよく知られたディレクトリへの読み書き
* シンボリックリンクの作成
* オーナーシップとモードの変更
* 予期しないネットワーク接続やソケットの変異
* execveを使用した生成されたプロセス
* sh、bash、csh、zshなどのシェルバイナリの実行
* ssh、scp、sftpなどのSSHバイナリの実行
* Linux coreutils実行ファイルの変異
* ログインバイナリの変異
* shadowconfig、pwck、chpasswd、getpasswd、change、useraddなどのshadowutilまたはpasswd実行ファイルの変異など、その他の詳細については、falcoデプロイメントの詳細を参照してください。
```bash
kubectl get pods --selector app=falco
```
![シナリオ18 falco get pods](https://madhuakula.com/kubernetes-goat/scenarios/images/sc-18-2.png)

* falcoシステムからログを手動で取得する
```bash
kubectl logs -f -l app=falco
```
* さあ、ハッカーコンテナを起動して、機密ファイルを読み取り、それがFalcoによって検出されるかどうかを確認しましょう。
```bash
kubectl run --rm --restart=Never -it --image=madhuakula/hacker-container -- bash
```
* 機密ファイルの読み取り

```bash
cat /path/to/sensitive/file
```

このコマンドは、指定したパスにある機密ファイルの内容を表示します。
```bash
cat /etc/shadow
```
![シナリオ18 falcoが/etc/shadowを検出](https://madhuakula.com/kubernetes-goat/scenarios/images/sc-18-3.png)

<details>

<summary><strong>HackTricksをサポートして特典を得る！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新バージョンのPEASSを入手したい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしましょう 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのトリックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **および** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>
