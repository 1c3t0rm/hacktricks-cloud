# Pentesting Kubernetes Services

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

Kubernetes uses several **specific network services** that you might find **exposed to the Internet** or in an **internal network once you have compromised one pod**.

## Finding exposed pods with OSINT

One way could be searching for `Identity LIKE "k8s.%.com"` in [crt.sh](https://crt.sh) to find subdomains related to kubernetes. Another way might be to search `"k8s.%.com"` in github and search for **YAML files** containing the string.

## How Kubernetes Exposes Services

It might be useful for you to understand how Kubernetes can **expose services publicly** in order to find them:

{% content-ref url="exposing-services-in-kubernetes.md" %}
[exposing-services-in-kubernetes.md](exposing-services-in-kubernetes.md)
{% endcontent-ref %}

## Finding Exposed pods via port scanning

The following ports might be open in a Kubernetes cluster:

| Port            | Process        | Description                                                            |
| --------------- | -------------- | ---------------------------------------------------------------------- |
| 443/TCP         | kube-apiserver | Kubernetes API port                                                    |
| 2379/TCP        | etcd           |                                                                        |
| 6666/TCP        | etcd           | etcd                                                                   |
| 4194/TCP        | cAdvisor       | Container metrics                                                      |
| 6443/TCP        | kube-apiserver | Kubernetes API port                                                    |
| 8443/TCP        | kube-apiserver | Minikube API port                                                      |
| 8080/TCP        | kube-apiserver | Insecure API port                                                      |
| 10250/TCP       | kubelet        | HTTPS API which allows full mode access                                |
| 10255/TCP       | kubelet        | Unauthenticated read-only HTTP port: pods, running pods and node state |
| 10256/TCP       | kube-proxy     | Kube Proxy health check server                                         |
| 9099/TCP        | calico-felix   | Health check server for Calico                                         |
| 6782-4/TCP      | weave          | Metrics and endpoints                                                  |
| 30000-32767/TCP | NodePort       | Proxy to the services                                                  |
| 44134/TCP       | Tiller         | Helm service listening                                                 |

### Nmap

{% code overflow="wrap" %}
```bash
nmap -n -T4 -p 443,2379,6666,4194,6443,8443,8080,10250,10255,10256,9099,6782-6784,30000-32767,44134 <pod_ipaddress>/16
```
{% endcode %}

### Kube-apiserver

**'ejmeH Kubernetes API service** Hoch administrators 'oH usually **`kubectl`** tool.

**Common ports: 6443 and 443**, 'ach 8443 minikube 'ej 8080 as insecure.
```
curl -k https://<IP Address>:(8|6)443/swaggerapi
curl -k https://<IP Address>:(8|6)443/healthz
curl -k https://<IP Address>:(8|6)443/api/v1
```
**QughmeylI'pu' 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'e' vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlhutlhmoH 'ej vItlh
```
curl -k https://<IP address>:10250/metrics
curl -k https://<IP address>:10250/pods
```
**ghItlh** `Unauthorized` **vItlhutlh** **authentication** **yIqaw**.

**vaj** **nodes** **list** **chu'** **chu'** **kubelets endpoints** **list** **yIqaw** **jatlh**:
```bash
kubectl get nodes -o custom-columns='IP:.status.addresses[0].address,KUBELET_PORT:.status.daemonEndpoints.kubeletEndpoint.Port' | grep -v KUBELET_PORT | while IFS='' read -r node; do
ip=$(echo $node | awk '{print $1}')
port=$(echo $node | awk '{print $2}')
echo "curl -k --max-time 30 https://$ip:$port/pods"
echo "curl -k --max-time 30 https://$ip:2379/version" #Check  also for etcd
done
```
#### kubelet (QaH)
```
curl -k https://<IP Address>:10255
http://<external-IP>:10255/pods
```
### etcd API

#### tlhIngan Hol

#### tlhIngan Hol

The etcd API is a key-value store that is used by Kubernetes to store cluster configuration data. It is a distributed, consistent, and highly available data store that provides a reliable way to store and retrieve data.

The etcd API can be accessed using the etcdctl command-line tool or through the RESTful API. It supports various operations such as creating, updating, and deleting keys, as well as watching for changes to keys.

When pentesting a Kubernetes cluster, it is important to understand the etcd API and its security implications. By gaining unauthorized access to the etcd API, an attacker can potentially retrieve sensitive information, modify cluster configuration, or even disrupt the entire cluster.

To pentest the etcd API, you can use tools like etcdctl, curl, or specialized etcd pentesting tools. Some common vulnerabilities to look for include weak authentication, insecure communication, and misconfigured access controls.

#### tlhIngan Hol

#### tlhIngan Hol

etcd API Hoch yIqaw

etcd API Hoch yIqaw, Kubernetes Hoch cluster configuration data Hoch store yIqaw. Hoch distributed, consistent, Hoch je highly available data store Hoch, reliable way Hoch data Hoch store je retrieve yIqaw.

etcd API Hoch etcdctl command-line tool Hoch je RESTful API Hoch yIqaw. Hoch create, update, je delete keys Hoch, Hoch watch Hoch keys Hoch changes Hoch yIqaw.

Kubernetes cluster pentest Hoch, etcd API je security implications Hoch yIqaw Hoch important Hoch. etcd API Hoch unauthorized access Hoch, attacker Hoch sensitive information Hoch retrieve, cluster configuration Hoch modify, Hoch Hoch disrupt entire cluster Hoch potential Hoch.

etcd API pentest Hoch, etcdctl, curl, Hoch specialized etcd pentesting tools Hoch Hoch Hoch. Hoch weak authentication, insecure communication, Hoch misconfigured access controls Hoch vulnerabilities Hoch look Hoch.

#### tlhIngan Hol

#### tlhIngan Hol
```
curl -k https://<IP address>:2379
curl -k https://<IP address>:2379/version
etcdctl --endpoints=http://<MASTER-IP>:2379 get / --prefix --keys-only
```
### Tiller

Tiller is the server-side component of Helm, a package manager for Kubernetes. It runs inside the Kubernetes cluster and manages the deployment of charts, which are packages of pre-configured Kubernetes resources.

Tiller communicates with the Kubernetes API server to create, update, and delete resources in the cluster. It also handles the release management of charts, allowing users to install, upgrade, and rollback applications on Kubernetes.

Tiller is a critical component of Helm, but it can also introduce security risks if not properly configured. By default, Tiller has full administrative access to the Kubernetes cluster, which means that any compromise of Tiller can lead to a complete compromise of the cluster.

To secure Tiller, it is recommended to follow these best practices:

1. **Disable Tiller**: If you are not using Helm or Tiller, it is recommended to disable Tiller completely. This can be done by uninstalling Tiller from the cluster.

2. **Limit Tiller's permissions**: If you need to use Tiller, make sure to limit its permissions to the minimum required for your use case. Avoid giving Tiller full administrative access to the cluster.

3. **Use RBAC**: Role-Based Access Control (RBAC) can be used to restrict the permissions of Tiller. Create a dedicated service account for Tiller and assign it the necessary roles and permissions.

4. **Enable TLS**: Enable Transport Layer Security (TLS) encryption for Tiller's communication with the Kubernetes API server. This helps to protect the confidentiality and integrity of the data exchanged between Tiller and the API server.

5. **Use a secure connection**: When connecting to Tiller from the Helm client, make sure to use a secure connection. This can be done by specifying the `--tls` flag when running Helm commands.

By following these best practices, you can reduce the security risks associated with Tiller and ensure the secure deployment of applications on Kubernetes.
```
helm --host tiller-deploy.kube-system:44134 version
```
ghItlh 'ej cAdvisor DaH jatlhlaHbe'chugh Kubernetes DaH jatlhlaHbe'chugh vItlhutlh.
```
curl -k https://<IP Address>:4194
```
### NodePort

**NodePort** jup 'ej **Service** DaH jup 'ej DaH jup 'ej **NodePort** port exposed. **NodePort** port **range 30000-32767**. So new unchecked services might be accessible through those ports.
```
sudo nmap -sS -p 30000-32767 <IP>
```
## Vulnerable Misconfigurations

### Kube-apiserver Anonymous Access

**kube-apiserver API endpoints** jatlh **anonymous access** **jatlh**. **'ej** endpoints **check**:

![](https://www.cyberark.com/wp-content/uploads/2019/09/Kube-Pen-2-fig-5.png)

### **Checking for ETCD Anonymous Access**

**ETCD** **cluster secrets**, **configuration files**, **'ej** **sensitive data** **jatlh**. **Default** **jatlh**, **ETCD** **anonymously** **access** **jatlh**, **check** **always** **good**.

**ETCD** **access** **anonymously**, **'ej** **[etcdctl](https://github.com/etcd-io/etcd/blob/master/etcdctl/READMEv2.md)** **tool** **use** **need**. **Command** **following** **stored keys** **get** **will**:

```bash
etcdctl get --prefix ""
```
```
etcdctl --endpoints=http://<MASTER-IP>:2379 get / --prefix --keys-only
```
### **Kubelet RCE**

[**Kubelet documentation**](https://kubernetes.io/docs/reference/command-line-tools-reference/kubelet/) jatlh **default anonymous access** to the service **choHlaHbe':**

> Kubelet server **ghItlh** anonymous request **choHlaHbe'.** **authentication method** **ghItlh** rejected **choHlaHbe'.** Anonymous request **username** **system:anonymous** **ghItlh**, **group name** **system:unauthenticated** **ghItlh.**

**Kuebelet API authentication and authorization** **ghItlh** **jatlh** **pagh:**

{% content-ref url="../kubernetes-pentesting/pentesting-kubernetes-services/kubelet-authentication-and-authorization.md" %}
[kubelet-authentication-and-authorization.md](../kubernetes-pentesting/pentesting-kubernetes-services/kubelet-authentication-and-authorization.md)
{% endcontent-ref %}

**Kubelet** service **API** **ghItlh** **jatlh**, **source code** **jatlh** **ghItlh** **'e'** **'ej exposed endpoints** **ghItlh** **jatlh** **running** **choHlaHbe':**
```bash
curl -s https://raw.githubusercontent.com/kubernetes/kubernetes/master/pkg/kubelet/server/server.go | grep 'Path("/'

Path("/pods").
Path("/run")
Path("/exec")
Path("/attach")
Path("/portForward")
Path("/containerLogs")
Path("/runningpods/").
```
bIQtIqetlh Kubeletctl (https://github.com/cyberark/kubeletctl) tool vItlhutlh Kubelets 'ej chenmoHwI'pu' ghom.

#### /pods

bIQtIqetlh vItlhutlh pods 'ej chenmoHwI'pu':
```bash
kubeletctl pods
```
#### /exec

**/exec** qachDaq DaH jatlh container vItlhutlh.
```bash
kubeletctl exec [command]
```
{% hint style="info" %}
To avoid this attack the _**kubelet**_ service should be run with `--anonymous-auth false` and the service should be segregated at the network level.
{% endhint %}

### **Checking Kubelet (Read Only Port) Information Exposure**

When a **kubelet read-only port** is exposed, it becomes possible for information to be retrieved from the API by unauthorized parties. The exposure of this port may lead to the disclosure of various **cluster configuration elements**. Although the information, including **pod names, locations of internal files, and other configurations**, may not be critical, its exposure still poses a security risk and should be avoided.

An example of how this vulnerability can be exploited involves a remote attacker accessing a specific URL. By navigating to `http://<external-IP>:10255/pods`, the attacker can potentially retrieve sensitive information from the kubelet:

![https://www.cyberark.com/wp-content/uploads/2019/09/KUbe-Pen-2-fig-6.png](https://www.cyberark.com/wp-content/uploads/2019/09/KUbe-Pen-2-fig-6.png)

## References

{% embed url="https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-2" %}

{% embed url="https://labs.f-secure.com/blog/attacking-kubernetes-through-kubelet" %}

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** me on **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
