# Az - Function Apps

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Temel Bilgiler

Azure Functions, daha az kod yazmanÄ±za, daha az altyapÄ± yÃ¶netmenize ve maliyetleri dÃ¼ÅŸÃ¼rmenize olanak tanÄ±yan **sunucusuz** bir Ã§Ã¶zÃ¼mdÃ¼r. SunucularÄ± daÄŸÄ±tma ve bakÄ±mÄ±nÄ± yapma konusunda endiÅŸelenmek yerine, bulut altyapÄ±sÄ± uygulamalarÄ±nÄ±zÄ±n Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlamak iÃ§in gereken tÃ¼m gÃ¼ncel kaynaklarÄ± saÄŸlar.

Azure portalÄ±nda, Azure Functions ile Azure API Management arasÄ±nda entegrasyon saÄŸlanÄ±r ve **HTTP tetikleyici fonksiyon uÃ§ noktalarÄ±nÄ±n REST API'leri olarak aÃ§Ä±ÄŸa Ã§Ä±karÄ±lmasÄ±na** olanak tanÄ±r. Bu ÅŸekilde aÃ§Ä±ÄŸa Ã§Ä±karÄ±lan API'ler, RESTful API'lere standart, dil baÄŸÄ±msÄ±z bir arayÃ¼z saÄŸlayan bir OpenAPI tanÄ±mÄ± kullanÄ±larak tanÄ±mlanÄ±r.

### FarklÄ± Planlar

* **Flex TÃ¼ketim planÄ±**, esnek hesaplama seÃ§enekleri ile dinamik, olay odaklÄ± Ã¶lÃ§eklendirme sunar. Talebe baÄŸlÄ± olarak otomatik olarak fonksiyon Ã¶rneklerini ekler veya kaldÄ±rÄ±r, bÃ¶ylece kaynaklarÄ±n verimli kullanÄ±mÄ± ve maliyet etkinliÄŸi saÄŸlanÄ±r. Bu plan, artÄ±rÄ±lmÄ±ÅŸ gÃ¼venlik iÃ§in sanal aÄŸ desteÄŸi sunar ve Ã¶nceden tahsis edilmiÅŸ Ã¶rnekler ile soÄŸuk baÅŸlangÄ±Ã§larÄ± azaltmanÄ±za olanak tanÄ±r. DeÄŸiÅŸken iÅŸ yÃ¼kleri yaÅŸayan ve konteyner desteÄŸi olmadan hÄ±zlÄ± Ã¶lÃ§eklendirme gerektiren uygulamalar iÃ§in idealdir.
* Azure Functions iÃ§in geleneksel **TÃ¼ketim planÄ±**, yalnÄ±zca fonksiyonlarÄ±nÄ±z Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda hesaplama kaynaklarÄ± iÃ§in Ã¶deme yaptÄ±ÄŸÄ±nÄ±z varsayÄ±lan sunucusuz barÄ±ndÄ±rma seÃ§eneÄŸidir. Gelen olay sayÄ±sÄ±na baÄŸlÄ± olarak otomatik olarak Ã¶lÃ§eklenir, bu da kesintili veya Ã¶ngÃ¶rÃ¼lemeyen iÅŸ yÃ¼kleri olan uygulamalar iÃ§in son derece maliyet etkin hale getirir. Konteyner daÄŸÄ±tÄ±mlarÄ±nÄ± desteklemese de, soÄŸuk baÅŸlangÄ±Ã§ sÃ¼relerini azaltmak iÃ§in optimizasyonlar iÃ§erir ve altyapÄ±yÄ± yÃ¶netme yÃ¼kÃ¼ olmadan otomatik Ã¶lÃ§eklendirme gerektiren geniÅŸ bir sunucusuz uygulama yelpazesi iÃ§in uygundur.
* Azure Functions iÃ§in **Premium plan**, tutarlÄ± performans ve geliÅŸmiÅŸ Ã¶zellikler gerektiren uygulamalar iÃ§in tasarlanmÄ±ÅŸtÄ±r. SoÄŸuk baÅŸlangÄ±Ã§larÄ± ortadan kaldÄ±rarak ve iÅŸlevlerin hareketsizlik dÃ¶nemlerinden sonra bile zamanÄ±nda Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlayarak talebe baÄŸlÄ± olarak Ã¶nceden Ä±sÄ±tÄ±lmÄ±ÅŸ iÅŸÃ§iler kullanarak otomatik olarak Ã¶lÃ§eklenir. Bu plan, daha gÃ¼Ã§lÃ¼ Ã¶rnekler, uzatÄ±lmÄ±ÅŸ yÃ¼rÃ¼tme sÃ¼releri sunar ve sanal aÄŸ baÄŸlantÄ±sÄ±nÄ± destekler. AyrÄ±ca, Ã¶zel Linux gÃ¶rÃ¼ntÃ¼lerinin kullanÄ±lmasÄ±na olanak tanÄ±r, bu da yÃ¼ksek performans ve kaynaklar Ã¼zerinde daha fazla kontrol gerektiren kritik gÃ¶rev uygulamalarÄ± iÃ§in uygundur.
* **Dedicated plan**, aynÄ± zamanda App Service planÄ± olarak da bilinir, fonksiyonlarÄ±nÄ±zÄ± bir App Service ortamÄ±nda Ã¶zel sanal makinelerde Ã§alÄ±ÅŸtÄ±rÄ±r. Bu plan, Ã¶ngÃ¶rÃ¼lebilir faturalama saÄŸlar ve Ã¶rneklerin manuel veya otomatik olarak Ã¶lÃ§eklenmesine olanak tanÄ±r, bu da uzun sÃ¼reli senaryolar iÃ§in idealdir. AynÄ± plan Ã¼zerinde birden fazla web ve fonksiyon uygulamasÄ±nÄ±n Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ±nÄ± destekler, daha bÃ¼yÃ¼k hesaplama boyutlarÄ± sunar ve App Service Environments (ASE) aracÄ±lÄ±ÄŸÄ±yla tam hesaplama izolasyonu ve gÃ¼venli aÄŸ eriÅŸimi saÄŸlar. Bu seÃ§enek, tutarlÄ± kaynak tahsisi ve kapsamlÄ± Ã¶zelleÅŸtirme gerektiren uygulamalar iÃ§in en iyisidir.
* **Container Apps**, Azure Container Apps tarafÄ±ndan barÄ±ndÄ±rÄ±lan tamamen yÃ¶netilen bir ortamda konteynerleÅŸtirilmiÅŸ fonksiyon uygulamalarÄ±nÄ± daÄŸÄ±tmanÄ±za olanak tanÄ±r. Bu seÃ§enek, diÄŸer mikro hizmetler, API'ler ve iÅŸ akÄ±ÅŸlarÄ±yla birlikte Ã§alÄ±ÅŸan olay odaklÄ±, sunucusuz uygulamalar oluÅŸturmak iÃ§in mÃ¼kemmeldir. Fonksiyon kodunuzla Ã¶zel kÃ¼tÃ¼phaneleri paketlemeyi, eski uygulamalarÄ± bulut yerel mikro hizmetlere taÅŸÄ±mayÄ± ve GPU kaynaklarÄ± ile yÃ¼ksek iÅŸlem gÃ¼cÃ¼nden yararlanmayÄ± destekler. Container Apps, Kubernetes kÃ¼melerini yÃ¶netme ihtiyacÄ±nÄ± ortadan kaldÄ±rarak daÄŸÄ±tÄ±mÄ± basitleÅŸtirir, bu da geliÅŸtiricilerin konteynerleÅŸtirilmiÅŸ bir ortamda esneklik ve Ã¶lÃ§eklenebilirlik arayÄ±ÅŸÄ±nda ideal hale getirir.

### **Depolama Kovalari**

Yeni bir konteynerleÅŸtirilmemiÅŸ Fonksiyon UygulamasÄ± oluÅŸturduÄŸunuzda (ancak Ã§alÄ±ÅŸtÄ±rÄ±lacak kodu veriyorsanÄ±z), **kod ve diÄŸer Fonksiyon ile ilgili veriler bir Depolama hesabÄ±nda saklanacaktÄ±r**. VarsayÄ±lan olarak, web konsolu her fonksiyon iÃ§in kodu saklamak Ã¼zere yeni bir tane oluÅŸturur.

AyrÄ±ca, uygulamanÄ±n yeni bir Ã¶rneÄŸi Ã§alÄ±ÅŸtÄ±rÄ±lmasÄ± gerektiÄŸinde, **uygulamanÄ±n kodu buradan toplanacak ve yÃ¼rÃ¼tÃ¼lecektir**.

{% hint style="danger" %}
Bu, bir saldÄ±rganÄ±n **bu kova Ã¼zerinde yazma eriÅŸimi** olmasÄ± durumunda **kodun ele geÃ§irilmesine ve Fonksiyon UygulamasÄ±ndaki yÃ¶netilen kimliklere yetki yÃ¼kseltmesine** olanak tanÄ±dÄ±ÄŸÄ± iÃ§in saldÄ±rganlar aÃ§Ä±sÄ±ndan Ã§ok ilginÃ§tir.
{% endhint %}

### AÄŸ

* Bir fonksiyona tÃ¼m Ä°nternet'ten eriÅŸim vermek mÃ¼mkÃ¼ndÃ¼r, herhangi bir kimlik doÄŸrulama gerektirmeden veya IAM tabanlÄ± eriÅŸim vermek mÃ¼mkÃ¼ndÃ¼r.
* AyrÄ±ca, Fonksiyon UygulamasÄ±na Ä°nternet'ten eriÅŸimi vermek veya kÄ±sÄ±tlamak, Fonksiyon UygulamasÄ±na bir iÃ§ aÄŸa (VPC) eriÅŸim vermek de mÃ¼mkÃ¼ndÃ¼r.

{% hint style="danger" %}
Bu, bir saldÄ±rganÄ±n Ä°nternet'e aÃ§Ä±lmÄ±ÅŸ bir zayÄ±f Lambda fonksiyonundan **iÃ§ aÄŸlara geÃ§iÅŸ yapma** olasÄ±lÄ±ÄŸÄ± olabileceÄŸi iÃ§in saldÄ±rganlar aÃ§Ä±sÄ±ndan Ã§ok ilginÃ§tir.
{% endhint %}

### **Ortam DeÄŸiÅŸkenleri**

Bir uygulama iÃ§inde ortam deÄŸiÅŸkenlerini yapÄ±landÄ±rmak mÃ¼mkÃ¼ndÃ¼r. AyrÄ±ca, varsayÄ±lan olarak **`AzureWebJobsStorage`** ve **`WEBSITE_CONTENTAZUREFILECONNECTIONSTRING`** (diÄŸerleri arasÄ±nda) ortam deÄŸiÅŸkenleri oluÅŸturulur. Bu deÄŸiÅŸkenler, **uygulamanÄ±n verilerini iÃ§eren depolama hesabÄ±nÄ± tam yetkilerle kontrol etmek iÃ§in hesap anahtarÄ±nÄ± iÃ§erdiÄŸi iÃ§in** Ã¶zellikle ilginÃ§tir.

### **Fonksiyon Sandbox'Ä±**

Sandbox iÃ§inde kaynak kodu **`/home/site/wwwroot`** dizininde **`function_app.py`** dosyasÄ±nda bulunur (Python kullanÄ±lÄ±yorsa) ve kodu Ã§alÄ±ÅŸtÄ±ran kullanÄ±cÄ± **`app`**'dir (sudo izinleri olmadan).

### **YÃ¶netilen Kimlikler**

AyrÄ±ca, Fonksiyon UygulamasÄ±, "admin" veya "anonymous" gibi belirli bir kimlik doÄŸrulama seviyesini gerektiren belirli uÃ§ noktalara sahip olabilir.\
Bir saldÄ±rgan, kÄ±sÄ±tlamalarÄ± aÅŸmak ve hassas verilere veya iÅŸlevselliÄŸe eriÅŸim saÄŸlamak iÃ§in **anonim olarak izin verilen uÃ§ noktalara** eriÅŸmeye Ã§alÄ±ÅŸabilir.

## EriÅŸim AnahtarlarÄ±

{% hint style="info" %}
KullanÄ±cÄ±lara fonksiyonlarÄ± Ã§aÄŸÄ±rma eriÅŸimi vermek iÃ§in RBAC izinleri olmadÄ±ÄŸÄ±nÄ± unutmayÄ±n. **Fonksiyon Ã§aÄŸrÄ±sÄ±, oluÅŸturulurken seÃ§ilen tetikleyiciye baÄŸlÄ±dÄ±r** ve bir HTTP Tetikleyici seÃ§ildiyse, bir **eriÅŸim anahtarÄ±** kullanmanÄ±z gerekebilir.
{% endhint %}

Bir fonksiyon iÃ§inde bir uÃ§ nokta oluÅŸtururken **HTTP tetikleyici** kullanarak, fonksiyonu tetiklemek iÃ§in gereken **eriÅŸim anahtarÄ± yetkilendirme seviyesini** belirtmek mÃ¼mkÃ¼ndÃ¼r. ÃœÃ§ seÃ§enek mevcuttur:

* **ANONYMOUS**: **Herkes**, URL aracÄ±lÄ±ÄŸÄ±yla fonksiyona eriÅŸebilir.
* **FUNCTION**: UÃ§ nokta yalnÄ±zca bir **fonksiyon, ana bilgisayar veya anahtar** kullanan kullanÄ±cÄ±lara aÃ§Ä±ktÄ±r.
* **ADMIN**: UÃ§ nokta yalnÄ±zca bir **anahtar** kullanan kullanÄ±cÄ±lara aÃ§Ä±ktÄ±r.

**Anahtar tÃ¼rleri:**

* **Fonksiyon AnahtarlarÄ±:** Fonksiyon anahtarlarÄ± varsayÄ±lan veya kullanÄ±cÄ± tanÄ±mlÄ± olabilir ve yalnÄ±zca bir Fonksiyon UygulamasÄ± iÃ§indeki **belirli fonksiyon uÃ§ noktalarÄ±na** eriÅŸim vermek iÃ§in tasarlanmÄ±ÅŸtÄ±r. Bu, yalnÄ±zca yetkili kullanÄ±cÄ±larÄ±n veya hizmetlerin belirli fonksiyonlarÄ± Ã§aÄŸÄ±rmasÄ±nÄ± saÄŸlarken, tÃ¼m uygulamanÄ±n aÃ§Ä±ÄŸa Ã§Ä±kmasÄ±nÄ± Ã¶nleyerek gÃ¼venlik kontrolÃ¼nÃ¼ ince ayar yapma imkanÄ± sunar.
* **Ana Bilgisayar AnahtarlarÄ±:** Anahtarlar, varsayÄ±lan veya kullanÄ±cÄ± tanÄ±mlÄ± olabilir ve bir Fonksiyon UygulamasÄ± iÃ§indeki **tÃ¼m fonksiyon uÃ§ noktalarÄ±na** eriÅŸim saÄŸlar. Bu, birden fazla fonksiyona tek bir anahtar kullanarak eriÅŸim gerektiÄŸinde kullanÄ±ÅŸlÄ±dÄ±r, yÃ¶netimi basitleÅŸtirir ve daÄŸÄ±tÄ±lmasÄ± veya gÃ¼venli bir ÅŸekilde saklanmasÄ± gereken anahtar sayÄ±sÄ±nÄ± azaltÄ±r.
* **Anahtar:** Anahtar (`_master`), bir Fonksiyon UygulamasÄ±'nÄ±n Ã§alÄ±ÅŸma zamanÄ± REST API'lerine eriÅŸim de dahil olmak Ã¼zere yÃ¼kseltilmiÅŸ izinler sunan bir yÃ¶netim anahtarÄ±dÄ±r. Bu **anahtar iptal edilemez ve son derece dikkatli bir ÅŸekilde kullanÄ±lmalÄ±dÄ±r**. Yetkisiz yÃ¶netim eriÅŸimini Ã¶nlemek iÃ§in anahtarÄ±n Ã¼Ã§Ã¼ncÃ¼ ÅŸahÄ±slarla paylaÅŸÄ±lmamasÄ± veya yerel istemci uygulamalarÄ±nda yer almasÄ± kritik Ã¶neme sahiptir.
* Bir fonksiyonun kimlik doÄŸrulamasÄ±nÄ± ADMIN (ve ANONYMOUS veya FUNCTION deÄŸil) olarak ayarlarken, bu anahtarÄ±n kullanÄ±lmasÄ± gerekmektedir.
* **Sistem AnahtarlarÄ±:** Sistem anahtarlarÄ±, **belirli uzantÄ±lar tarafÄ±ndan yÃ¶netilir** ve iÃ§ bileÅŸenler tarafÄ±ndan kullanÄ±lan webhook uÃ§ noktalarÄ±na eriÅŸim iÃ§in gereklidir. Ã–rnekler arasÄ±nda, sistem anahtarlarÄ±nÄ± kullanarak ilgili API'leri gÃ¼venli bir ÅŸekilde etkileÅŸimde bulunan Event Grid tetikleyicisi ve DayanÄ±klÄ± Fonksiyonlar bulunur. Sistem anahtarlarÄ±, gÃ¼venliÄŸi saÄŸlamak iÃ§in Azure Portal veya anahtar API'leri aracÄ±lÄ±ÄŸÄ±yla yeniden oluÅŸturulabilir.

{% hint style="success" %}
Anahtar kullanarak bir fonksiyon API uÃ§ noktasÄ±na eriÅŸim Ã¶rneÄŸi:

`https://<function_uniq_name>.azurewebsites.net/api/<endpoint_name>?code=<access_key>`
{% endhint %}

## SayÄ±m

{% code overflow="wrap" %}
```bash
# List all the functions
az functionapp list

# Get info of 1 funciton (although in the list you already get this info)
az functionapp show --name <app-name> --resource-group <res-group>

# Get env variables (and privesc tot he sorage account)
az functionapp config appsettings list --name <app-name> --resource-group <res-group>

# Check if a domain was assigned to a function app
az functionapp config hostname list --webapp-name <app-name> --resource-group <res-group>

# Get SSL certificates
az functionapp config ssl list --resource-group <res-group>

# Get network restrictions
az functionapp config access-restriction show --name <app-name> --resource-group <res-group>
```
{% endcode %}

## Yetki YÃ¼kseltme

{% content-ref url="../az-privilege-escalation/az-functions-app-privesc.md" %}
[az-functions-app-privesc.md](../az-privilege-escalation/az-functions-app-privesc.md)
{% endcontent-ref %}

## Referanslar

* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
