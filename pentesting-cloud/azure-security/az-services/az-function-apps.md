# Az - Function Apps

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Azure Functions ni **serverless** suluhisho linalokuruhusu kuandika msimbo kidogo, kudumisha miundombinu kidogo, na kuokoa gharama. Badala ya kuwa na wasiwasi kuhusu kupeleka na kudumisha seva, miundombinu ya wingu inatoa rasilimali zote za kisasa zinazohitajika ili kuweka programu zako zikifanya kazi.

Katika lango la Azure, ushirikiano kati ya Azure Functions na Azure API Management unarahisishwa, ukiruhusu **HTTP trigger function endpoints kufichuliwa kama REST APIs**. APIs zinazofichuliwa kwa njia hii zinaelezewa kwa kutumia ufafanuzi wa OpenAPI, ukitoa kiolesura cha kawaida, kisicho na lugha kwa APIs za RESTful.

### Different Plans

* **Mpango wa Flex Consumption** unatoa upanuzi wa kiutendaji unaoendeshwa na matukio na chaguzi za kompyuta zinazobadilika. Inajiongeza au kuondoa mifano ya kazi kulingana na mahitaji, kuhakikisha matumizi bora ya rasilimali na ufanisi wa gharama kupitia **mfumo wa malipo kadri unavyotumia**. Mpango huu unasaidia mtandao wa virtual kwa usalama ulioimarishwa na unaruhusu kupunguza kuanza baridi kwa kuandaa mifano mapema. Ni bora kwa programu zinazokutana na mzigo wa kazi unaobadilika na zinahitaji upanuzi wa haraka bila hitaji la msaada wa kontena.
* Mpango wa jadi wa **Consumption** kwa Azure Functions ni chaguo la kawaida la mwenyeji wa serverless, ambapo unalipa tu kwa rasilimali za kompyuta wakati kazi zako zinafanya kazi. Inajiongeza kiotomatiki kulingana na idadi ya matukio yanayoingia, na kuifanya kuwa na ufanisi mkubwa wa gharama kwa programu zenye mzigo wa kazi wa muda mfupi au usiotabirika. Ingawa haisaidii kupeleka kontena, inajumuisha uboreshaji wa kupunguza nyakati za kuanza baridi na inafaa kwa aina mbalimbali za programu za serverless zinazohitaji upanuzi wa kiotomatiki bila mzigo wa kudumisha miundombinu.
* Mpango wa **Premium** kwa Azure Functions umeundwa kwa programu zinazohitaji utendaji thabiti na vipengele vya juu. Inajiongeza kulingana na mahitaji kwa kutumia wafanyakazi waliotayarishwa mapema, ikiondoa kuanza baridi na kuhakikisha kazi zinafanya kazi kwa wakati hata baada ya vipindi vya kutokuwepo. Mpango huu unatoa mifano yenye nguvu zaidi, nyakati za utekelezaji zilizopanuliwa, na unasaidia muunganisho wa mtandao wa virtual. Zaidi ya hayo, inaruhusu matumizi ya picha za Linux za kawaida, ikifanya kuwa bora kwa programu muhimu zinazohitaji utendaji wa juu na udhibiti mkubwa wa rasilimali.
* Mpango wa **Dedicated**, pia unajulikana kama mpango wa App Service, unafanya kazi zako kwenye mashine halisi zilizojitolea ndani ya mazingira ya App Service. Mpango huu unatoa bili inayoweza kutabiriwa na unaruhusu upanuzi wa mifano kwa mikono au kiotomatiki, ukifanya kuwa bora kwa hali za muda mrefu ambapo Kazi za Kudu hazifai. Inasaidia kuendesha programu nyingi za wavuti na kazi kwenye mpango mmoja, inatoa ukubwa mkubwa wa kompyuta, na inahakikisha kutengwa kamili kwa kompyuta na ufikiaji salama wa mtandao kupitia Mazingira ya App Service (ASE). Chaguo hili ni bora kwa programu zinazohitaji ugawaji wa rasilimali thabiti na uboreshaji mkubwa.
* **Container Apps** zinakuruhusu kupeleka programu za kazi zilizowekwa kwenye kontena ndani ya mazingira yanayosimamiwa kikamilifu yanayohudumiwa na Azure Container Apps. Chaguo hili ni bora kwa kujenga programu za serverless zinazotegemea matukio ambazo zinafanya kazi sambamba na huduma nyingine za microservices, APIs, na mifumo ya kazi. Inasaidia kufunga maktaba za kawaida na msimbo wako wa kazi, kuhamasisha programu za zamani kuwa microservices za wingu, na kutumia nguvu ya usindikaji wa hali ya juu na rasilimali za GPU. Container Apps inarahisisha upelelezi kwa kuondoa hitaji la kusimamia vikundi vya Kubernetes, ikifanya kuwa bora kwa wabunifu wanaotafuta kubadilika na upanuzi katika mazingira yaliyowekwa kwenye kontena.

### **Storage Buckets**

Unapounda Programu mpya ya Kazi isiyo na kontena (lakini ukitoa msimbo wa kufanya kazi), **msimbo na data nyingine zinazohusiana na Kazi zitahifadhiwa katika akaunti ya Hifadhi**. Kwa kawaida, console ya wavuti itaunda mpya kwa kila kazi kuhifadhi msimbo.

Zaidi ya hayo, kila wakati mfano mpya wa programu unahitaji kufanya kazi, **msimbo wa programu utakusanywa kutoka hapa na kutekelezwa**.

{% hint style="danger" %}
Hii ni ya kuvutia sana kutoka kwa mtazamo wa washambuliaji kwani **kupata ruhusa ya kuandika kwenye bucket hii** kutaruhusu mshambuliaji **kushambulia msimbo na kupandisha mamlaka** kwa utambulisho unaosimamiwa ndani ya Programu ya Kazi.
{% endhint %}

### Networking

* Inawezekana kutoa ufikiaji kwa kazi kwa kila mtu kwenye Mtandao bila kuhitaji uthibitisho wowote au kutoa ufikiaji wa msingi wa IAM.
* Pia inawezekana kutoa au kuzuia ufikiaji wa Programu ya Kazi kutoka Mtandao kutoa ufikiaji kwa mtandao wa ndani (VPC) kwa Programu ya Kazi.

{% hint style="danger" %}
Hii ni ya kuvutia sana kutoka kwa mtazamo wa washambuliaji kwani inaweza kuwa inawezekana **kuhamasisha kwenye mitandao ya ndani** kutoka kwa kazi dhaifu ya Lambda iliyofichuliwa kwenye Mtandao.
{% endhint %}

### **Environment Variables**

inawezekana kuunda mabadiliko ya mazingira ndani ya programu. Zaidi ya hayo, kwa kawaida mabadiliko ya mazingira **`AzureWebJobsStorage`** na **`WEBSITE_CONTENTAZUREFILECONNECTIONSTRING`** (miongoni mwa mengine) yanaundwa. Haya ni ya kuvutia sana kwa sababu yana **funguo za akaunti kudhibiti kwa ruhusa KAMILI akaunti ya hifadhi inayohifadhi data ya programu**.

### **Function Sandbox**

Ndani ya sandbox msimbo wa chanzo unapatikana katika **`/home/site/wwwroot`** katika faili **`function_app.py`** (ikiwa python inatumika) mtumiaji anayekimbia msimbo ni **`app`** (bila ruhusa za sudo).

### **Managed Identities**

Zaidi ya hayo, Programu ya Kazi inaweza kuwa na baadhi ya mwisho ambayo yanahitaji kiwango fulani cha uthibitisho, kama "admin" au "anonymous".\
Mshambuliaji anaweza kujaribu kufikia **michakato ya mwisho inayoruhusiwa kwa siri** ili kupita vizuizi na kupata ufikiaji wa data nyeti au kazi.

## Access Keys

{% hint style="info" %}
Kumbuka kwamba hakuna ruhusa za RBAC za kutoa ufikiaji kwa watumiaji kuanzisha kazi. **kuanzisha kazi kunategemea kichocheo** kilichochaguliwa wakati ilipoundwa na ikiwa kichocheo cha HTTP kilichaguliwa, inaweza kuwa inahitajika kutumia **funguo za ufikiaji**.
{% endhint %}

Unapounda mwisho ndani ya kazi kwa kutumia **HTTP trigger** inawezekana kuashiria **kiwango cha uthibitisho wa funguo za ufikiaji** zinazohitajika kuanzisha kazi. Chaguzi tatu zinapatikana:

* **ANONYMOUS**: **Kila mtu** anaweza kufikia kazi kupitia URL.
* **FUNCTION**: Mwisho unapatikana tu kwa watumiaji wanaotumia **funguo, mwenyeji au funguo za bosi**.
* **ADMIN**: Mwisho unapatikana tu kwa watumiaji wanafunguo za **bosi**.

**Aina za funguo:**

* **Funguo za Kazi:** Funguo za kazi zinaweza kuwa za kawaida au zilizofanywa na mtumiaji na zimeundwa kutoa ufikiaji pekee kwa **michakato maalum ya kazi** ndani ya Programu ya Kazi. Hii inaruhusu udhibiti wa usalama wa kina, kuhakikisha kwamba watumiaji au huduma walioidhinishwa pekee wanaweza kuanzisha kazi maalum bila kufichua programu nzima.
* **Funguo za Mwenyeji:** Funguo za mwenyeji, ambazo zinaweza pia kuwa za kawaida au zilizofanywa na mtumiaji, zinatoa ufikiaji kwa **michakato yote ya kazi ndani ya Programu ya Kazi**. Hii ni muhimu wakati kazi nyingi zinahitaji kufikiwa kwa kutumia funguo moja, ikirahisisha usimamizi na kupunguza idadi ya funguo zinazohitajika kusambazwa au kuhifadhiwa kwa usalama.
* **Funguo za Bosi:** Funguo za bosi (`_master`) hutumikia kama funguo za kiutawala zinazotoa ruhusa za juu, ikiwa ni pamoja na ufikiaji wa APIs za REST za wakati wa utekelezaji **za Programu ya Kazi**. **funguo hii haiwezi kufutwa na inapaswa kushughulikiwa kwa makini sana**. Ni muhimu **sio** kushiriki funguo za bosi na wahusika wengine au kuziingiza katika programu za mteja asilia ili kuzuia ufikiaji wa kiutawala usioidhinishwa.
* Unapoweka uthibitisho wa kazi kuwa ADMIN (na sio ANONYMOUS au FUNCTION), inahitajika kutumia funguo hii.
* **Funguo za Mfumo:** Funguo za mfumo zinazosimamiwa na **nyongeza maalum** na zinahitajika kwa ufikiaji wa mwisho wa webhook unaotumiwa na vipengele vya ndani. Mifano ni pamoja na kichocheo cha Event Grid na Kazi za Kudu, ambazo hutumia funguo za mfumo kuingiliana kwa usalama na APIs zao. Funguo za mfumo zinaweza kuundwa upya kupitia Lango la Azure au APIs za funguo ili kudumisha usalama.

{% hint style="success" %}
Example to access a function API endpoint using a key:

`https://<function_uniq_name>.azurewebsites.net/api/<endpoint_name>?code=<access_key>`
{% endhint %}

## Enumeration

{% code overflow="wrap" %}
```bash
# List all the functions
az functionapp list

# Get info of 1 funciton (although in the list you already get this info)
az functionapp show --name <app-name> --resource-group <res-group>

# Get env variables (and privesc tot he sorage account)
az functionapp config appsettings list --name <app-name> --resource-group <res-group>

# Check if a domain was assigned to a function app
az functionapp config hostname list --webapp-name <app-name> --resource-group <res-group>

# Get SSL certificates
az functionapp config ssl list --resource-group <res-group>

# Get network restrictions
az functionapp config access-restriction show --name <app-name> --resource-group <res-group>
```
{% endcode %}

## Kuinua Mamlaka

{% content-ref url="../az-privilege-escalation/az-functions-app-privesc.md" %}
[az-functions-app-privesc.md](../az-privilege-escalation/az-functions-app-privesc.md)
{% endcontent-ref %}

## Marejeleo

* [https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition](https://learn.microsoft.com/en-us/azure/azure-functions/functions-openapi-definition)

{% hint style="success" %}
Jifunze na fanya mazoezi ya AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Jifunze na fanya mazoezi ya GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Angalia [**mpango wa usajili**](https://github.com/sponsors/carlospolop)!
* **Jiunge na** üí¨ [**kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuatilie** kwenye **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu za hacking kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
{% endhint %}
