# Az - Service Bus Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Service Bus

Azure Service Bus, farklÄ± uygulama parÃ§alarÄ± veya ayrÄ± uygulamalar arasÄ±nda gÃ¼venilir **iletiÅŸim** saÄŸlamak iÃ§in tasarlanmÄ±ÅŸ bulut tabanlÄ± bir **mesajlaÅŸma hizmetidir**. MesajlarÄ±n gÃ¼venli bir ÅŸekilde iletilmesini saÄŸlayarak, gÃ¶nderici ve alÄ±cÄ±nÄ±n aynÄ± anda Ã§alÄ±ÅŸmadÄ±ÄŸÄ± durumlarda bile gÃ¼venli bir aracÄ± olarak iÅŸlev gÃ¶rÃ¼r. Sistemleri birbirinden ayÄ±rarak, uygulamalarÄ±n baÄŸÄ±msÄ±z Ã§alÄ±ÅŸmasÄ±na olanak tanÄ±rken veri veya talimat alÄ±ÅŸveriÅŸi yapmalarÄ±nÄ± saÄŸlar. Ã–zellikle birden fazla iÅŸÃ§i arasÄ±nda yÃ¼k dengelemesi, gÃ¼venilir mesaj iletimi veya gÃ¶revlerin sÄ±rayla iÅŸlenmesi veya eriÅŸimin gÃ¼venli bir ÅŸekilde yÃ¶netilmesi gibi karmaÅŸÄ±k koordinasyon gerektiren senaryolar iÃ§in faydalÄ±dÄ±r.

### Key Concepts

1. **Queues:** AmacÄ±, alÄ±cÄ± hazÄ±r olana kadar mesajlarÄ± depolamaktÄ±r.
- Mesajlar sÄ±ralÄ±, zaman damgalÄ± ve kalÄ±cÄ± olarak saklanÄ±r.
- Ä°htiyaÃ§ duyulduÄŸunda (talep Ã¼zerine) teslim edilir.
- Noktadan noktaya iletiÅŸimi destekler.
2. **Topics:** YayÄ±nlama-abone mesajlaÅŸmasÄ± iÃ§in yaygÄ±nlaÅŸtÄ±rma.
- Birden fazla baÄŸÄ±msÄ±z abonelik, mesajlarÄ±n kopyalarÄ±nÄ± alÄ±r.
- Abonelikler, teslimatÄ± kontrol etmek veya meta veriler eklemek iÃ§in kurallar/filtreler iÃ§erebilir.
- Ã‡oktan Ã§oÄŸa iletiÅŸimi destekler.
3. **Namespaces:** TÃ¼m mesajlaÅŸma bileÅŸenleri, kuyruklar ve konular iÃ§in bir kapsayÄ±cÄ±dÄ±r; gÃ¼Ã§lÃ¼ bir Azure kÃ¼mesinin kendi diliminiz gibidir ve Ã¶zel kapasite saÄŸlar ve isteÄŸe baÄŸlÄ± olarak Ã¼Ã§ kullanÄ±labilirlik bÃ¶lgesine yayÄ±labilir.

### Advance Features
BazÄ± ileri dÃ¼zey Ã¶zellikler ÅŸunlardÄ±r:

- **Message Sessions**: FIFO iÅŸleme saÄŸlar ve istek-cevap desenlerini destekler.
- **Auto-Forwarding**: AynÄ± ad alanÄ±ndaki kuyruklar veya konular arasÄ±nda mesajlarÄ± aktarÄ±r.
- **Dead-Lettering**: Ä°letilemeyen mesajlarÄ± gÃ¶zden geÃ§irmek iÃ§in yakalar.
- **Scheduled Delivery**: Mesaj iÅŸleme iÅŸlemini gelecekteki gÃ¶revler iÃ§in geciktirir.
- **Message Deferral**: Mesaj alÄ±mÄ±nÄ± hazÄ±r olana kadar erteler.
- **Transactions**: Ä°ÅŸlemleri atomik yÃ¼rÃ¼tme iÃ§in gruplar.
- **Filters & Actions**: MesajlarÄ± filtrelemek veya not eklemek iÃ§in kurallar uygular.
- **Auto-Delete on Idle**: Pasiflik durumunda kuyruklarÄ± siler (min: 5 dakika).
- **Duplicate Detection**: Yeniden gÃ¶nderimler sÄ±rasÄ±nda tekrar eden mesajlarÄ± kaldÄ±rÄ±r.
- **Batch Deletion**: SÃ¼resi dolmuÅŸ veya gereksiz mesajlarÄ± toplu olarak siler.

### Authorization-Rule / SAS Policy

SAS PolitikalarÄ±, Azure Service Bus varlÄ±klarÄ± ad alanÄ± (En Ã–nemli Olan), kuyruklar ve konular iÃ§in eriÅŸim izinlerini tanÄ±mlar. Her politika aÅŸaÄŸÄ±daki bileÅŸenlere sahiptir:

- **Permissions**: EriÅŸim seviyelerini belirtmek iÃ§in onay kutularÄ±:
- Manage: VarlÄ±k Ã¼zerinde tam kontrol saÄŸlar, yapÄ±landÄ±rma ve izin yÃ¶netimi dahil.
- Send: VarlÄ±ÄŸa mesaj gÃ¶ndermeye izin verir.
- Listen: VarlÄ±k Ã¼zerinden mesaj almayÄ± saÄŸlar.
- **Primary and Secondary Keys**: EriÅŸimi kimlik doÄŸrulamak iÃ§in gÃ¼venli token'lar oluÅŸturmak iÃ§in kullanÄ±lan kriptografik anahtarlardÄ±r.
- **Primary and Secondary Connection Strings**: Uygulamalarda kolay kullanÄ±m iÃ§in uÃ§ nokta ve anahtarÄ± iÃ§eren Ã¶nceden yapÄ±landÄ±rÄ±lmÄ±ÅŸ baÄŸlantÄ± dizgeleri.
- **SAS Policy ARM ID**: Programatik tanÄ±mlama iÃ§in politikanÄ±n Azure Resource Manager (ARM) yolu.

### NameSpace

sku, yetkilendirme kuralÄ±,

### Enumeration

{% code overflow="wrap" %}
```bash
# Queue Enumeration
az servicebus queue list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyQueue>

# Topic Enumeration
az servicebus topic list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus topic show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyTopic>

# Susbscription Enumeration
az servicebus topic subscription list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus topic subscription show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic> --name <MySubscription>

# Namespace Enumeration
az servicebus namespace list
az servicebus namespace network-rule-set list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace show --resource-group <MyResourceGroup> --name <MyNamespace>
az servicebus namespace network-rule-set show --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace private-endpoint-connection list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace exists --name ProposedNamespace

# Authorization Rule Enumeration
az servicebus namespace authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --queue-name <MyQueue>
az servicebus topic authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus namespace authorization-rule keys list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyAuthRule>
```
{% endcode %}

### Yetki YÃ¼kseltme

{% content-ref url="../az-services/az-servicebus-privesc.md" %}
[az-servicebus-privesc.md](../az-services/az-servicebus-privesc.md)
{% endcontent-ref %}

### Ä°stismar SonrasÄ±

{% content-ref url="../az-post-exploitation/az-servicebus-post-exploitation.md" %}
[az-servicebus-post-exploitation.md](../az-post-exploitation/az-servicebus-post-exploitation.md)
{% endcontent-ref %}

## Referanslar

* https://learn.microsoft.com/en-us/powershell/module/az.servicebus/?view=azps-13.0.0
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-cli

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶ndererek paylaÅŸÄ±n.**

</details>
{% endhint %}
