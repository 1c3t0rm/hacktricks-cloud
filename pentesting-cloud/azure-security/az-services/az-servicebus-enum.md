# Az - Service Bus Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Service Bus

Azure Service BusëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„œë¡œ ë‹¤ë¥¸ ë¶€ë¶„ ë˜ëŠ” ë³„ë„ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°„ì˜ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” **í†µì‹ ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ í´ë¼ìš°ë“œ ê¸°ë°˜ **ë©”ì‹œì§• ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤. ì´ëŠ” ì•ˆì „í•œ ì¤‘ê°œìë¡œ ì‘ìš©í•˜ì—¬ ë°œì‹ ìì™€ ìˆ˜ì‹ ìê°€ ë™ì‹œì— ì‘ë™í•˜ì§€ ì•Šë”ë¼ë„ ë©”ì‹œì§€ê°€ ì•ˆì „í•˜ê²Œ ì „ë‹¬ë˜ë„ë¡ ë³´ì¥í•©ë‹ˆë‹¤. ì‹œìŠ¤í…œì„ ë¶„ë¦¬í•¨ìœ¼ë¡œì¨ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë…ë¦½ì ìœ¼ë¡œ ì‘ë™í•˜ë©´ì„œë„ ë°ì´í„°ë‚˜ ì§€ì¹¨ì„ êµí™˜í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤. ì´ëŠ” ì—¬ëŸ¬ ì‘ì—…ì ê°„ì˜ ë¶€í•˜ ë¶„ì‚°, ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ë©”ì‹œì§€ ì „ë‹¬ ë˜ëŠ” ì‘ì—…ì„ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬í•˜ê±°ë‚˜ ì•ˆì „í•˜ê²Œ ì•¡ì„¸ìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒê³¼ ê°™ì€ ë³µì¡í•œ ì¡°ì •ì´ í•„ìš”í•œ ì‹œë‚˜ë¦¬ì˜¤ì— íŠ¹íˆ ìœ ìš©í•©ë‹ˆë‹¤.

### Key Concepts

1. **Queues:** ìˆ˜ì‹ ìê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ë©”ì‹œì§€ë¥¼ ì €ì¥í•˜ëŠ” ëª©ì ì…ë‹ˆë‹¤.
- ë©”ì‹œì§€ëŠ” ì •ë ¬ë˜ê³ , íƒ€ì„ìŠ¤íƒ¬í”„ê°€ ì°íˆë©°, ë‚´êµ¬ì„± ìˆê²Œ ì €ì¥ë©ë‹ˆë‹¤.
- í’€ ëª¨ë“œ(ìš”ì²­ ì‹œ ê²€ìƒ‰)ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.
- í¬ì¸íŠ¸ íˆ¬ í¬ì¸íŠ¸ í†µì‹ ì„ ì§€ì›í•©ë‹ˆë‹¤.
2. **Topics:** ë°©ì†¡ì„ ìœ„í•œ ê²Œì‹œ-êµ¬ë… ë©”ì‹œì§•ì…ë‹ˆë‹¤.
- ì—¬ëŸ¬ ë…ë¦½ì ì¸ êµ¬ë…ì´ ë©”ì‹œì§€ì˜ ë³µì‚¬ë³¸ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤.
- êµ¬ë…ì€ ì „ë‹¬ì„ ì œì–´í•˜ê±°ë‚˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê¸° ìœ„í•œ ê·œì¹™/í•„í„°ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë‹¤ëŒ€ë‹¤ í†µì‹ ì„ ì§€ì›í•©ë‹ˆë‹¤.
3. **Namespaces:** ëª¨ë“  ë©”ì‹œì§• êµ¬ì„± ìš”ì†Œ, í ë° ì£¼ì œë¥¼ ìœ„í•œ ì»¨í…Œì´ë„ˆë¡œ, ê°•ë ¥í•œ Azure í´ëŸ¬ìŠ¤í„°ì˜ ìì‹ ì˜ ìŠ¬ë¼ì´ìŠ¤ì™€ ê°™ìœ¼ë©°, ì „ìš© ìš©ëŸ‰ì„ ì œê³µí•˜ê³  ì„ íƒì ìœ¼ë¡œ ì„¸ ê°œì˜ ê°€ìš©ì„± ì˜ì—­ì— ê±¸ì³ í™•ì¥ë©ë‹ˆë‹¤.

### Advance Features
ì¼ë¶€ ê³ ê¸‰ ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **Message Sessions**: FIFO ì²˜ë¦¬ë¥¼ ë³´ì¥í•˜ê³  ìš”ì²­-ì‘ë‹µ íŒ¨í„´ì„ ì§€ì›í•©ë‹ˆë‹¤.
- **Auto-Forwarding**: ë™ì¼í•œ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œ í ë˜ëŠ” ì£¼ê°„ì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
- **Dead-Lettering**: ì „ë‹¬í•  ìˆ˜ ì—†ëŠ” ë©”ì‹œì§€ë¥¼ ê²€í† ë¥¼ ìœ„í•´ ìº¡ì²˜í•©ë‹ˆë‹¤.
- **Scheduled Delivery**: ë¯¸ë˜ ì‘ì—…ì„ ìœ„í•´ ë©”ì‹œì§€ ì²˜ë¦¬ë¥¼ ì§€ì—°ì‹œí‚µë‹ˆë‹¤.
- **Message Deferral**: ì¤€ë¹„ë  ë•Œê¹Œì§€ ë©”ì‹œì§€ ê²€ìƒ‰ì„ ì—°ê¸°í•©ë‹ˆë‹¤.
- **Transactions**: ì‘ì—…ì„ ì›ìì  ì‹¤í–‰ìœ¼ë¡œ ê·¸ë£¹í™”í•©ë‹ˆë‹¤.
- **Filters & Actions**: ë©”ì‹œì§€ë¥¼ í•„í„°ë§í•˜ê±°ë‚˜ ì£¼ì„ì„ ì¶”ê°€í•˜ê¸° ìœ„í•œ ê·œì¹™ì„ ì ìš©í•©ë‹ˆë‹¤.
- **Auto-Delete on Idle**: ë¹„í™œì„± ìƒíƒœì—ì„œ íë¥¼ ì‚­ì œí•©ë‹ˆë‹¤(ìµœì†Œ: 5ë¶„).
- **Duplicate Detection**: ì¬ì „ì†¡ ì¤‘ ì¤‘ë³µ ë©”ì‹œì§€ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
- **Batch Deletion**: ë§Œë£Œë˜ê±°ë‚˜ ë¶ˆí•„ìš”í•œ ë©”ì‹œì§€ë¥¼ ëŒ€ëŸ‰ìœ¼ë¡œ ì‚­ì œí•©ë‹ˆë‹¤.

### Authorization-Rule / SAS Policy

SAS ì •ì±…ì€ Azure Service Bus ì—”í„°í‹° ë„¤ì„ìŠ¤í˜ì´ìŠ¤(ê°€ì¥ ì¤‘ìš”í•œ ê²ƒ), í ë° ì£¼ì œì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ ê¶Œí•œì„ ì •ì˜í•©ë‹ˆë‹¤. ê° ì •ì±…ì€ ë‹¤ìŒ êµ¬ì„± ìš”ì†Œë¥¼ ê°€ì§‘ë‹ˆë‹¤:

- **Permissions**: ì•¡ì„¸ìŠ¤ ìˆ˜ì¤€ì„ ì§€ì •í•˜ëŠ” ì²´í¬ë°•ìŠ¤:
- Manage: ì—”í„°í‹°ì— ëŒ€í•œ ì „ì²´ ì œì–´ë¥¼ ë¶€ì—¬í•˜ë©°, êµ¬ì„± ë° ê¶Œí•œ ê´€ë¦¬ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
- Send: ì—”í„°í‹°ì— ë©”ì‹œì§€ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Listen: ì—”í„°í‹°ë¡œë¶€í„° ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **Primary and Secondary Keys**: ì•¡ì„¸ìŠ¤ ì¸ì¦ì„ ìœ„í•œ ë³´ì•ˆ í† í°ì„ ìƒì„±í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì•”í˜¸í™” í‚¤ì…ë‹ˆë‹¤.
- **Primary and Secondary Connection Strings**: ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì—”ë“œí¬ì¸íŠ¸ì™€ í‚¤ë¥¼ í¬í•¨í•œ ë¯¸ë¦¬ êµ¬ì„±ëœ ì—°ê²° ë¬¸ìì—´ì…ë‹ˆë‹¤.
- **SAS Policy ARM ID**: í”„ë¡œê·¸ë˜ë°ì  ì‹ë³„ì„ ìœ„í•œ ì •ì±…ì˜ Azure Resource Manager (ARM) ê²½ë¡œì…ë‹ˆë‹¤.

### NameSpace

sku, authrorization rule,

### Enumeration

{% code overflow="wrap" %}
```bash
# Queue Enumeration
az servicebus queue list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyQueue>

# Topic Enumeration
az servicebus topic list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus topic show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyTopic>

# Susbscription Enumeration
az servicebus topic subscription list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus topic subscription show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic> --name <MySubscription>

# Namespace Enumeration
az servicebus namespace list
az servicebus namespace network-rule-set list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace show --resource-group <MyResourceGroup> --name <MyNamespace>
az servicebus namespace network-rule-set show --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace private-endpoint-connection list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace exists --name ProposedNamespace

# Authorization Rule Enumeration
az servicebus namespace authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --queue-name <MyQueue>
az servicebus topic authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus namespace authorization-rule keys list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyAuthRule>
```
{% endcode %}

### ê¶Œí•œ ìƒìŠ¹

{% content-ref url="../az-services/az-servicebus-privesc.md" %}
[az-servicebus-privesc.md](../az-services/az-servicebus-privesc.md)
{% endcontent-ref %}

### í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡

{% content-ref url="../az-post-exploitation/az-servicebus-post-exploitation.md" %}
[az-servicebus-post-exploitation.md](../az-post-exploitation/az-servicebus-post-exploitation.md)
{% endcontent-ref %}

## ì°¸ê³  ë¬¸í—Œ

* https://learn.microsoft.com/en-us/powershell/module/az.servicebus/?view=azps-13.0.0
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-cli

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
