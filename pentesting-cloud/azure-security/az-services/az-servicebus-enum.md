# Az - Service Bus Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Service Bus

Azure Service Bus √© um **servi√ßo de mensagens** baseado em nuvem projetado para permitir uma **comunica√ß√£o confi√°vel entre diferentes partes de uma aplica√ß√£o ou aplica√ß√µes separadas**. Ele atua como um intermedi√°rio seguro, garantindo que as mensagens sejam entregues com seguran√ßa, mesmo que o remetente e o receptor n√£o estejam operando simultaneamente. Ao desacoplar sistemas, permite que as aplica√ß√µes funcionem de forma independente enquanto ainda trocam dados ou instru√ß√µes. √â particularmente √∫til para cen√°rios que exigem balanceamento de carga entre v√°rios trabalhadores, entrega confi√°vel de mensagens ou coordena√ß√£o complexa, como processamento de tarefas em ordem ou gerenciamento seguro de acesso.

### Key Concepts

1. **Queues:** seu prop√≥sito √© armazenar mensagens at√© que o receptor esteja pronto.
- As mensagens s√£o ordenadas, carimbadas com data e armazenadas de forma dur√°vel.
- Entregues em modo pull (recupera√ß√£o sob demanda).
- Suporta comunica√ß√£o ponto a ponto.
2. **Topics:** Mensagens de publica√ß√£o-assinatura para transmiss√£o.
- M√∫ltiplas assinaturas independentes recebem c√≥pias das mensagens.
- As assinaturas podem ter regras/filtros para controlar a entrega ou adicionar metadados.
- Suporta comunica√ß√£o muitos-para-muitos.
3. **Namespaces:** Um cont√™iner para todos os componentes de mensagens, filas e t√≥picos, √© como sua pr√≥pria fatia de um poderoso cluster Azure, fornecendo capacidade dedicada e, opcionalmente, abrangendo tr√™s zonas de disponibilidade.

### Advance Features
Alguns recursos avan√ßados s√£o:

- **Message Sessions**: Garante processamento FIFO e suporta padr√µes de solicita√ß√£o-resposta.
- **Auto-Forwarding**: Transfere mensagens entre filas ou t√≥picos no mesmo namespace.
- **Dead-Lettering**: Captura mensagens n√£o entreg√°veis para revis√£o.
- **Scheduled Delivery**: Atrasos no processamento de mensagens para tarefas futuras.
- **Message Deferral**: Adia a recupera√ß√£o de mensagens at√© que esteja pronto.
- **Transactions**: Agrupa opera√ß√µes em execu√ß√£o at√¥mica.
- **Filters & Actions**: Aplica regras para filtrar ou anotar mensagens.
- **Auto-Delete on Idle**: Exclui filas ap√≥s inatividade (m√≠nimo: 5 minutos).
- **Duplicate Detection**: Remove mensagens duplicadas durante reenvios.
- **Batch Deletion**: Exclui em massa mensagens expiradas ou desnecess√°rias.

### Authorization-Rule / SAS Policy

As Pol√≠ticas SAS definem as permiss√µes de acesso para entidades do Azure Service Bus namespace (A Mais Importante), filas e t√≥picos. Cada pol√≠tica tem os seguintes componentes:

- **Permissions**: Caixas de sele√ß√£o para especificar n√≠veis de acesso:
- Manage: Concede controle total sobre a entidade, incluindo configura√ß√£o e gerenciamento de permiss√µes.
- Send: Permite enviar mensagens para a entidade.
- Listen: Permite receber mensagens da entidade.
- **Primary and Secondary Keys**: Estas s√£o chaves criptogr√°ficas usadas para gerar tokens seguros para autenticar o acesso.
- **Primary and Secondary Connection Strings**: Strings de conex√£o pr√©-configuradas que incluem o endpoint e a chave para f√°cil uso em aplica√ß√µes.
- **SAS Policy ARM ID**: O caminho do Azure Resource Manager (ARM) para a pol√≠tica para identifica√ß√£o program√°tica.

### NameSpace

sku, regra de autoriza√ß√£o,

### Enumeration

{% code overflow="wrap" %}
```bash
# Queue Enumeration
az servicebus queue list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyQueue>

# Topic Enumeration
az servicebus topic list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus topic show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyTopic>

# Susbscription Enumeration
az servicebus topic subscription list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus topic subscription show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic> --name <MySubscription>

# Namespace Enumeration
az servicebus namespace list
az servicebus namespace network-rule-set list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace show --resource-group <MyResourceGroup> --name <MyNamespace>
az servicebus namespace network-rule-set show --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace private-endpoint-connection list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace exists --name ProposedNamespace

# Authorization Rule Enumeration
az servicebus namespace authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --queue-name <MyQueue>
az servicebus topic authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus namespace authorization-rule keys list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyAuthRule>
```
{% endcode %}

### Escala√ß√£o de Privil√©gios

{% content-ref url="../az-services/az-servicebus-privesc.md" %}
[az-servicebus-privesc.md](../az-services/az-servicebus-privesc.md)
{% endcontent-ref %}

### P√≥s Explora√ß√£o

{% content-ref url="../az-post-exploitation/az-servicebus-post-exploitation.md" %}
[az-servicebus-post-exploitation.md](../az-post-exploitation/az-servicebus-post-exploitation.md)
{% endcontent-ref %}

## Refer√™ncias

* https://learn.microsoft.com/en-us/powershell/module/az.servicebus/?view=azps-13.0.0
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-cli

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
