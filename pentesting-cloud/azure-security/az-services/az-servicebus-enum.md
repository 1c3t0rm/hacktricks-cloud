# Az - Service Bus Enum

{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}

## Service Bus

Azure Service Bus æ˜¯ä¸€ç§åŸºäºäº‘çš„ **æ¶ˆæ¯æœåŠ¡**ï¼Œæ—¨åœ¨å®ç° **åº”ç”¨ç¨‹åºä¸åŒéƒ¨åˆ†æˆ–ç‹¬ç«‹åº”ç”¨ç¨‹åºä¹‹é—´çš„å¯é é€šä¿¡**ã€‚å®ƒå……å½“å®‰å…¨çš„ä¸­ä»‹ï¼Œç¡®ä¿æ¶ˆæ¯å®‰å…¨é€è¾¾ï¼Œå³ä½¿å‘é€è€…å’Œæ¥æ”¶è€…å¹¶ä¸åŒæ—¶æ“ä½œã€‚é€šè¿‡è§£è€¦ç³»ç»Ÿï¼Œå®ƒå…è®¸åº”ç”¨ç¨‹åºç‹¬ç«‹å·¥ä½œï¼ŒåŒæ—¶ä»ç„¶äº¤æ¢æ•°æ®æˆ–æŒ‡ä»¤ã€‚å®ƒç‰¹åˆ«é€‚ç”¨äºéœ€è¦åœ¨å¤šä¸ªå·¥ä½œè€…ä¹‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡ã€å¯é æ¶ˆæ¯ä¼ é€’æˆ–å¤æ‚åè°ƒçš„åœºæ™¯ï¼Œä¾‹å¦‚æŒ‰é¡ºåºå¤„ç†ä»»åŠ¡æˆ–å®‰å…¨ç®¡ç†è®¿é—®ã€‚

### å…³é”®æ¦‚å¿µ

1. **é˜Ÿåˆ—ï¼š** å…¶ç›®çš„æ˜¯å­˜å‚¨æ¶ˆæ¯ï¼Œç›´åˆ°æ¥æ”¶è€…å‡†å¤‡å¥½ã€‚
- æ¶ˆæ¯æ˜¯æœ‰åºçš„ã€å¸¦æ—¶é—´æˆ³çš„ï¼Œå¹¶ä¸”æŒä¹…å­˜å‚¨ã€‚
- ä»¥æ‹‰å–æ¨¡å¼ï¼ˆæŒ‰éœ€æ£€ç´¢ï¼‰äº¤ä»˜ã€‚
- æ”¯æŒç‚¹å¯¹ç‚¹é€šä¿¡ã€‚
2. **ä¸»é¢˜ï¼š** ç”¨äºå¹¿æ’­çš„å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ã€‚
- å¤šä¸ªç‹¬ç«‹è®¢é˜…æ¥æ”¶æ¶ˆæ¯çš„å‰¯æœ¬ã€‚
- è®¢é˜…å¯ä»¥æœ‰è§„åˆ™/è¿‡æ»¤å™¨æ¥æ§åˆ¶äº¤ä»˜æˆ–æ·»åŠ å…ƒæ•°æ®ã€‚
- æ”¯æŒå¤šå¯¹å¤šé€šä¿¡ã€‚
3. **å‘½åç©ºé—´ï¼š** æ‰€æœ‰æ¶ˆæ¯ç»„ä»¶ã€é˜Ÿåˆ—å’Œä¸»é¢˜çš„å®¹å™¨ï¼Œå°±åƒæ‚¨è‡ªå·±çš„ä¸€éƒ¨åˆ†å¼ºå¤§ Azure é›†ç¾¤ï¼Œæä¾›ä¸“ç”¨å®¹é‡ï¼Œå¹¶å¯é€‰æ‹©è·¨è¶Šä¸‰ä¸ªå¯ç”¨åŒºã€‚

### é«˜çº§åŠŸèƒ½
ä¸€äº›é«˜çº§åŠŸèƒ½åŒ…æ‹¬ï¼š

- **æ¶ˆæ¯ä¼šè¯**ï¼šç¡®ä¿ FIFO å¤„ç†å¹¶æ”¯æŒè¯·æ±‚-å“åº”æ¨¡å¼ã€‚
- **è‡ªåŠ¨è½¬å‘**ï¼šåœ¨åŒä¸€å‘½åç©ºé—´å†…åœ¨é˜Ÿåˆ—æˆ–ä¸»é¢˜ä¹‹é—´è½¬ç§»æ¶ˆæ¯ã€‚
- **æ­»ä¿¡å¤„ç†**ï¼šæ•è·æ— æ³•é€è¾¾çš„æ¶ˆæ¯ä»¥ä¾›å®¡æŸ¥ã€‚
- **å®šæ—¶äº¤ä»˜**ï¼šå»¶è¿Ÿæ¶ˆæ¯å¤„ç†ä»¥è¿›è¡Œæœªæ¥ä»»åŠ¡ã€‚
- **æ¶ˆæ¯å»¶è¿Ÿ**ï¼šæ¨è¿Ÿæ¶ˆæ¯æ£€ç´¢ç›´åˆ°å‡†å¤‡å¥½ã€‚
- **äº‹åŠ¡**ï¼šå°†æ“ä½œåˆ†ç»„ä¸ºåŸå­æ‰§è¡Œã€‚
- **è¿‡æ»¤å™¨å’Œæ“ä½œ**ï¼šåº”ç”¨è§„åˆ™ä»¥è¿‡æ»¤æˆ–æ³¨é‡Šæ¶ˆæ¯ã€‚
- **ç©ºé—²æ—¶è‡ªåŠ¨åˆ é™¤**ï¼šåœ¨ä¸æ´»åŠ¨ååˆ é™¤é˜Ÿåˆ—ï¼ˆæœ€å°ï¼š5åˆ†é’Ÿï¼‰ã€‚
- **é‡å¤æ£€æµ‹**ï¼šåœ¨é‡å‘æœŸé—´åˆ é™¤é‡å¤æ¶ˆæ¯ã€‚
- **æ‰¹é‡åˆ é™¤**ï¼šæ‰¹é‡åˆ é™¤è¿‡æœŸæˆ–ä¸å¿…è¦çš„æ¶ˆæ¯ã€‚

### æˆæƒè§„åˆ™ / SAS ç­–ç•¥

SAS ç­–ç•¥å®šä¹‰äº† Azure Service Bus å®ä½“å‘½åç©ºé—´ï¼ˆæœ€é‡è¦çš„ä¸€ä¸ªï¼‰ã€é˜Ÿåˆ—å’Œä¸»é¢˜çš„è®¿é—®æƒé™ã€‚æ¯ä¸ªç­–ç•¥å…·æœ‰ä»¥ä¸‹ç»„ä»¶ï¼š

- **æƒé™**ï¼šå¤é€‰æ¡†ç”¨äºæŒ‡å®šè®¿é—®çº§åˆ«ï¼š
- ç®¡ç†ï¼šæˆäºˆå¯¹å®ä½“çš„å®Œå…¨æ§åˆ¶ï¼ŒåŒ…æ‹¬é…ç½®å’Œæƒé™ç®¡ç†ã€‚
- å‘é€ï¼šå…è®¸å‘å®ä½“å‘é€æ¶ˆæ¯ã€‚
- ç›‘å¬ï¼šå…è®¸ä»å®ä½“æ¥æ”¶æ¶ˆæ¯ã€‚
- **ä¸»å¯†é’¥å’Œæ¬¡å¯†é’¥**ï¼šè¿™äº›æ˜¯ç”¨äºç”Ÿæˆå®‰å…¨ä»¤ç‰Œä»¥éªŒè¯è®¿é—®çš„åŠ å¯†å¯†é’¥ã€‚
- **ä¸»è¿æ¥å­—ç¬¦ä¸²å’Œæ¬¡è¿æ¥å­—ç¬¦ä¸²**ï¼šé¢„é…ç½®çš„è¿æ¥å­—ç¬¦ä¸²ï¼ŒåŒ…æ‹¬ç«¯ç‚¹å’Œå¯†é’¥ï¼Œä¾¿äºåœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚
- **SAS ç­–ç•¥ ARM ID**ï¼šç”¨äºç¨‹åºè¯†åˆ«çš„ç­–ç•¥çš„ Azure èµ„æºç®¡ç†å™¨ï¼ˆARMï¼‰è·¯å¾„ã€‚

### å‘½åç©ºé—´

skuï¼Œæˆæƒè§„åˆ™ï¼Œ

### æšä¸¾

{% code overflow="wrap" %}
```bash
# Queue Enumeration
az servicebus queue list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyQueue>

# Topic Enumeration
az servicebus topic list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus topic show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyTopic>

# Susbscription Enumeration
az servicebus topic subscription list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus topic subscription show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic> --name <MySubscription>

# Namespace Enumeration
az servicebus namespace list
az servicebus namespace network-rule-set list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace show --resource-group <MyResourceGroup> --name <MyNamespace>
az servicebus namespace network-rule-set show --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace private-endpoint-connection list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace exists --name ProposedNamespace

# Authorization Rule Enumeration
az servicebus namespace authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --queue-name <MyQueue>
az servicebus topic authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus namespace authorization-rule keys list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyAuthRule>
```
{% endcode %}

### æƒé™æå‡

{% content-ref url="../az-services/az-servicebus-privesc.md" %}
[az-servicebus-privesc.md](../az-services/az-servicebus-privesc.md)
{% endcontent-ref %}

### åˆ©ç”¨å

{% content-ref url="../az-post-exploitation/az-servicebus-post-exploitation.md" %}
[az-servicebus-post-exploitation.md](../az-post-exploitation/az-servicebus-post-exploitation.md)
{% endcontent-ref %}

## å‚è€ƒæ–‡çŒ®

* https://learn.microsoft.com/en-us/powershell/module/az.servicebus/?view=azps-13.0.0
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-cli

<details>

<summary>æ”¯æŒ HackTricks</summary>

* æŸ¥çœ‹ [**è®¢é˜…è®¡åˆ’**](https://github.com/sponsors/carlospolop)!
* **åŠ å…¥** ğŸ’¬ [**Discord ç¾¤ç»„**](https://discord.gg/hRep4RUj7f) æˆ– [**Telegram ç¾¤ç»„**](https://t.me/peass) æˆ– **å…³æ³¨** æˆ‘ä»¬çš„ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **é€šè¿‡å‘** [**HackTricks**](https://github.com/carlospolop/hacktricks) å’Œ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚

</details>
{% endhint %}
