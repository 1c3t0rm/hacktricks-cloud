# Az - Service Bus Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 💬 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Service Bus

Azure Service Bus, farklı uygulama parçaları veya ayrı uygulamalar arasında güvenilir **iletişim** sağlamak için tasarlanmış bulut tabanlı bir **mesajlaşma hizmetidir**. Mesajların güvenli bir şekilde iletilmesini sağlayarak, gönderici ve alıcının aynı anda çalışmadığı durumlarda bile güvenli bir aracı olarak işlev görür. Sistemleri birbirinden ayırarak, uygulamaların bağımsız çalışmasına olanak tanırken veri veya talimat alışverişi yapmalarını sağlar. Özellikle birden fazla işçi arasında yük dengelemesi, güvenilir mesaj iletimi veya görevlerin sırayla işlenmesi veya erişimin güvenli bir şekilde yönetilmesi gibi karmaşık koordinasyon gerektiren senaryolar için faydalıdır.

### Key Concepts

1. **Queues:** Amacı, alıcı hazır olana kadar mesajları depolamaktır.
- Mesajlar sıralı, zaman damgalı ve kalıcı olarak saklanır.
- İhtiyaç duyulduğunda (talep üzerine) teslim edilir.
- Noktadan noktaya iletişimi destekler.
2. **Topics:** Yayınlama-abone mesajlaşması için yaygınlaştırma.
- Birden fazla bağımsız abonelik, mesajların kopyalarını alır.
- Abonelikler, teslimatı kontrol etmek veya meta veriler eklemek için kurallar/filtreler içerebilir.
- Çoktan çoğa iletişimi destekler.
3. **Namespaces:** Tüm mesajlaşma bileşenleri, kuyruklar ve konular için bir kapsayıcıdır; güçlü bir Azure kümesinin kendi diliminiz gibidir ve özel kapasite sağlar ve isteğe bağlı olarak üç kullanılabilirlik bölgesine yayılabilir.

### Advance Features
Bazı ileri düzey özellikler şunlardır:

- **Message Sessions**: FIFO işleme sağlar ve istek-cevap desenlerini destekler.
- **Auto-Forwarding**: Aynı ad alanındaki kuyruklar veya konular arasında mesajları aktarır.
- **Dead-Lettering**: İletilemeyen mesajları gözden geçirmek için yakalar.
- **Scheduled Delivery**: Mesaj işleme işlemini gelecekteki görevler için geciktirir.
- **Message Deferral**: Mesaj alımını hazır olana kadar erteler.
- **Transactions**: İşlemleri atomik yürütme için gruplar.
- **Filters & Actions**: Mesajları filtrelemek veya not eklemek için kurallar uygular.
- **Auto-Delete on Idle**: Pasiflik durumunda kuyrukları siler (min: 5 dakika).
- **Duplicate Detection**: Yeniden gönderimler sırasında tekrar eden mesajları kaldırır.
- **Batch Deletion**: Süresi dolmuş veya gereksiz mesajları toplu olarak siler.

### Authorization-Rule / SAS Policy

SAS Politikaları, Azure Service Bus varlıkları ad alanı (En Önemli Olan), kuyruklar ve konular için erişim izinlerini tanımlar. Her politika aşağıdaki bileşenlere sahiptir:

- **Permissions**: Erişim seviyelerini belirtmek için onay kutuları:
- Manage: Varlık üzerinde tam kontrol sağlar, yapılandırma ve izin yönetimi dahil.
- Send: Varlığa mesaj göndermeye izin verir.
- Listen: Varlık üzerinden mesaj almayı sağlar.
- **Primary and Secondary Keys**: Erişimi kimlik doğrulamak için güvenli token'lar oluşturmak için kullanılan kriptografik anahtarlardır.
- **Primary and Secondary Connection Strings**: Uygulamalarda kolay kullanım için uç nokta ve anahtarı içeren önceden yapılandırılmış bağlantı dizgeleri.
- **SAS Policy ARM ID**: Programatik tanımlama için politikanın Azure Resource Manager (ARM) yolu.

### NameSpace

sku, yetkilendirme kuralı,

### Enumeration

{% code overflow="wrap" %}
```bash
# Queue Enumeration
az servicebus queue list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyQueue>

# Topic Enumeration
az servicebus topic list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus topic show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyTopic>

# Susbscription Enumeration
az servicebus topic subscription list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus topic subscription show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic> --name <MySubscription>

# Namespace Enumeration
az servicebus namespace list
az servicebus namespace network-rule-set list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace show --resource-group <MyResourceGroup> --name <MyNamespace>
az servicebus namespace network-rule-set show --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace private-endpoint-connection list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace exists --name ProposedNamespace

# Authorization Rule Enumeration
az servicebus namespace authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --queue-name <MyQueue>
az servicebus topic authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus namespace authorization-rule keys list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyAuthRule>
```
{% endcode %}

### Yetki Yükseltme

{% content-ref url="../az-services/az-servicebus-privesc.md" %}
[az-servicebus-privesc.md](../az-services/az-servicebus-privesc.md)
{% endcontent-ref %}

### İstismar Sonrası

{% content-ref url="../az-post-exploitation/az-servicebus-post-exploitation.md" %}
[az-servicebus-post-exploitation.md](../az-post-exploitation/az-servicebus-post-exploitation.md)
{% endcontent-ref %}

## Referanslar

* https://learn.microsoft.com/en-us/powershell/module/az.servicebus/?view=azps-13.0.0
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-cli

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarını**](https://github.com/sponsors/carlospolop) kontrol edin!
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın ya da **Twitter'da** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuçlarını [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR göndererek paylaşın.**

</details>
{% endhint %}
