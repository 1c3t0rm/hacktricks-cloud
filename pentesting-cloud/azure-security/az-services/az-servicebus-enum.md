# Az - Service Bus Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Service Bus

Azure Service Bus est un **service de messagerie** bas√© sur le cloud con√ßu pour permettre une **communication fiable entre diff√©rentes parties d'une application ou des applications s√©par√©es**. Il agit comme un interm√©diaire s√©curis√©, garantissant que les messages sont livr√©s en toute s√©curit√©, m√™me si l'exp√©diteur et le destinataire ne fonctionnent pas simultan√©ment. En d√©couplant les syst√®mes, il permet aux applications de fonctionner ind√©pendamment tout en √©changeant des donn√©es ou des instructions. Il est particuli√®rement utile pour des sc√©narios n√©cessitant un √©quilibrage de charge entre plusieurs travailleurs, une livraison fiable des messages ou une coordination complexe, comme le traitement des t√¢ches dans l'ordre ou la gestion s√©curis√©e des acc√®s.

### Key Concepts

1. **Queues :** son but est de stocker les messages jusqu'√† ce que le destinataire soit pr√™t.
- Les messages sont ordonn√©s, horodat√©s et stock√©s de mani√®re durable.
- Livr√©s en mode pull (r√©cup√©ration √† la demande).
- Prend en charge la communication point √† point.
2. **Topics :** Messagerie publish-subscribe pour la diffusion.
- Plusieurs abonnements ind√©pendants re√ßoivent des copies des messages.
- Les abonnements peuvent avoir des r√®gles/filtres pour contr√¥ler la livraison ou ajouter des m√©tadonn√©es.
- Prend en charge la communication plusieurs √† plusieurs.
3. **Namespaces :** Un conteneur pour tous les composants de messagerie, files d'attente et sujets, est comme votre propre part d'un puissant cluster Azure, fournissant une capacit√© d√©di√©e et s'√©tendant √©ventuellement sur trois zones de disponibilit√©.

### Advance Features
Certaines fonctionnalit√©s avanc√©es sont :

- **Message Sessions :** Assure le traitement FIFO et prend en charge les mod√®les de demande-r√©ponse.
- **Auto-Forwarding :** Transf√®re des messages entre des files d'attente ou des sujets dans le m√™me espace de noms.
- **Dead-Lettering :** Capture les messages non livrables pour examen.
- **Scheduled Delivery :** Retarde le traitement des messages pour des t√¢ches futures.
- **Message Deferral :** Retarde la r√©cup√©ration des messages jusqu'√† ce qu'ils soient pr√™ts.
- **Transactions :** Regroupe les op√©rations en ex√©cution atomique.
- **Filters & Actions :** Applique des r√®gles pour filtrer ou annoter les messages.
- **Auto-Delete on Idle :** Supprime les files d'attente apr√®s une p√©riode d'inactivit√© (min : 5 minutes).
- **Duplicate Detection :** Supprime les messages en double lors des renvois.
- **Batch Deletion :** Supprime en masse les messages expir√©s ou inutiles.

### Authorization-Rule / SAS Policy

Les politiques SAS d√©finissent les autorisations d'acc√®s pour les entit√©s Azure Service Bus namespace (la plus importante), files d'attente et sujets. Chaque politique a les composants suivants :

- **Permissions :** Cases √† cocher pour sp√©cifier les niveaux d'acc√®s :
- Manage : Accorde un contr√¥le total sur l'entit√©, y compris la configuration et la gestion des autorisations.
- Send : Permet d'envoyer des messages √† l'entit√©.
- Listen : Permet de recevoir des messages de l'entit√©.
- **Primary and Secondary Keys :** Ce sont des cl√©s cryptographiques utilis√©es pour g√©n√©rer des jetons s√©curis√©s pour authentifier l'acc√®s.
- **Primary and Secondary Connection Strings :** Cha√Ænes de connexion pr√©configur√©es qui incluent le point de terminaison et la cl√© pour une utilisation facile dans les applications.
- **SAS Policy ARM ID :** Le chemin Azure Resource Manager (ARM) vers la politique pour identification programmatique.

### NameSpace

sku, r√®gle d'autorisation,

### Enumeration

{% code overflow="wrap" %}
```bash
# Queue Enumeration
az servicebus queue list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyQueue>

# Topic Enumeration
az servicebus topic list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus topic show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyTopic>

# Susbscription Enumeration
az servicebus topic subscription list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus topic subscription show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic> --name <MySubscription>

# Namespace Enumeration
az servicebus namespace list
az servicebus namespace network-rule-set list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace show --resource-group <MyResourceGroup> --name <MyNamespace>
az servicebus namespace network-rule-set show --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace private-endpoint-connection list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace exists --name ProposedNamespace

# Authorization Rule Enumeration
az servicebus namespace authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --queue-name <MyQueue>
az servicebus topic authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus namespace authorization-rule keys list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyAuthRule>
```
{% endcode %}

### Escalade de Privil√®ges

{% content-ref url="../az-services/az-servicebus-privesc.md" %}
[az-servicebus-privesc.md](../az-services/az-servicebus-privesc.md)
{% endcontent-ref %}

### Post Exploitation

{% content-ref url="../az-post-exploitation/az-servicebus-post-exploitation.md" %}
[az-servicebus-post-exploitation.md](../az-post-exploitation/az-servicebus-post-exploitation.md)
{% endcontent-ref %}

## R√©f√©rences

* https://learn.microsoft.com/en-us/powershell/module/az.servicebus/?view=azps-13.0.0
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-cli

<details>

<summary>Support HackTricks</summary>

* Check the [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** nous sur **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
