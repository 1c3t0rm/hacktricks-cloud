# Az - Service Bus Enum

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Service Bus

Azure Service Bus √® un **servizio di messaggistica** basato su cloud progettato per abilitare una **comunicazione affidabile tra diverse parti di un'applicazione o applicazioni separate**. Funziona come un intermediario sicuro, garantendo che i messaggi vengano consegnati in modo sicuro, anche se il mittente e il destinatario non operano simultaneamente. Decoupling dei sistemi consente alle applicazioni di lavorare in modo indipendente pur continuando a scambiare dati o istruzioni. √à particolarmente utile per scenari che richiedono bilanciamento del carico tra pi√π lavoratori, consegna affidabile dei messaggi o coordinamento complesso, come l'elaborazione di compiti in ordine o la gestione sicura degli accessi.

### Key Concepts

1. **Code:** il suo scopo √® memorizzare i messaggi fino a quando il destinatario √® pronto.
- I messaggi sono ordinati, timestamped e memorizzati in modo durevole.
- Consegnati in modalit√† pull (recupero su richiesta).
- Supporta la comunicazione punto a punto.
2. **Argomenti:** Messaggistica publish-subscribe per la trasmissione.
- Pi√π sottoscrizioni indipendenti ricevono copie dei messaggi.
- Le sottoscrizioni possono avere regole/filtri per controllare la consegna o aggiungere metadati.
- Supporta la comunicazione molti-a-molti.
3. **Namespace:** Un contenitore per tutti i componenti di messaggistica, code e argomenti, √® come la tua fetta di un potente cluster Azure, fornendo capacit√† dedicata e, facoltativamente, estendendosi su tre zone di disponibilit√†.

### Advance Features
Alcune funzionalit√† avanzate sono:

- **Sessioni di Messaggi**: Garantisce l'elaborazione FIFO e supporta modelli di richiesta-risposta.
- **Auto-Inoltro**: Trasferisce messaggi tra code o argomenti nello stesso namespace.
- **Dead-Lettering**: Cattura messaggi non consegnabili per la revisione.
- **Consegna Programmata**: Ritarda l'elaborazione dei messaggi per compiti futuri.
- **Rinvio Messaggi**: Posticipa il recupero dei messaggi fino a quando non √® pronto.
- **Transazioni**: Raggruppa operazioni in esecuzione atomica.
- **Filtri & Azioni**: Applica regole per filtrare o annotare messaggi.
- **Auto-Cancellazione in Idle**: Elimina le code dopo inattivit√† (min: 5 minuti).
- **Rilevamento Duplicati**: Rimuove messaggi duplicati durante i reinvii.
- **Cancellazione in Batch**: Elimina in blocco messaggi scaduti o non necessari.

### Authorization-Rule / SAS Policy

Le politiche SAS definiscono i permessi di accesso per le entit√† del namespace di Azure Service Bus (la pi√π importante), code e argomenti. Ogni politica ha i seguenti componenti:

- **Permessi**: Caselle di controllo per specificare i livelli di accesso:
- Gestire: Concede il pieno controllo sull'entit√†, inclusa la gestione della configurazione e dei permessi.
- Invia: Consente di inviare messaggi all'entit√†.
- Ascolta: Consente di ricevere messaggi dall'entit√†.
- **Chiavi Primarie e Secondarie**: Queste sono chiavi crittografiche utilizzate per generare token sicuri per autenticare l'accesso.
- **Stringhe di Connessione Primarie e Secondarie**: Stringhe di connessione preconfigurate che includono l'endpoint e la chiave per un uso facile nelle applicazioni.
- **ID ARM della Politica SAS**: Il percorso di Azure Resource Manager (ARM) per la politica per identificazione programmatica.

### NameSpace

sku, regola di autorizzazione,

### Enumeration

{% code overflow="wrap" %}
```bash
# Queue Enumeration
az servicebus queue list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyQueue>

# Topic Enumeration
az servicebus topic list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus topic show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyTopic>

# Susbscription Enumeration
az servicebus topic subscription list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus topic subscription show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic> --name <MySubscription>

# Namespace Enumeration
az servicebus namespace list
az servicebus namespace network-rule-set list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace show --resource-group <MyResourceGroup> --name <MyNamespace>
az servicebus namespace network-rule-set show --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace private-endpoint-connection list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace exists --name ProposedNamespace

# Authorization Rule Enumeration
az servicebus namespace authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --queue-name <MyQueue>
az servicebus topic authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus namespace authorization-rule keys list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyAuthRule>
```
{% endcode %}

### Escalation dei privilegi

{% content-ref url="../az-services/az-servicebus-privesc.md" %}
[az-servicebus-privesc.md](../az-services/az-servicebus-privesc.md)
{% endcontent-ref %}

### Post Sfruttamento

{% content-ref url="../az-post-exploitation/az-servicebus-post-exploitation.md" %}
[az-servicebus-post-exploitation.md](../az-post-exploitation/az-servicebus-post-exploitation.md)
{% endcontent-ref %}

## Riferimenti

* https://learn.microsoft.com/en-us/powershell/module/az.servicebus/?view=azps-13.0.0
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-cli

<details>

<summary>Supporta HackTricks</summary>

* Controlla i [**piani di abbonamento**](https://github.com/sponsors/carlospolop)!
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos su github.

</details>
{% endhint %}
