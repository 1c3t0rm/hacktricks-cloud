# Az - Service Bus Enum

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## Service Bus

Azure Service Bus ist ein cloudbasierter **Messaging-Dienst**, der entwickelt wurde, um eine zuverl√§ssige **Kommunikation zwischen verschiedenen Teilen einer Anwendung oder separaten Anwendungen** zu erm√∂glichen. Er fungiert als sicherer Mittelsmann und stellt sicher, dass Nachrichten sicher zugestellt werden, selbst wenn Sender und Empf√§nger nicht gleichzeitig arbeiten. Durch die Entkopplung von Systemen erm√∂glicht er es Anwendungen, unabh√§ngig zu arbeiten und dennoch Daten oder Anweisungen auszutauschen. Er ist besonders n√ºtzlich f√ºr Szenarien, die Lastverteilung √ºber mehrere Arbeiter, zuverl√§ssige Nachrichten√ºbermittlung oder komplexe Koordination erfordern, wie z.B. die Verarbeitung von Aufgaben in der richtigen Reihenfolge oder die sichere Verwaltung von Zugriffsrechten.

### Schl√ºsselkonzepte

1. **Warteschlangen:** Ihr Zweck ist es, Nachrichten zu speichern, bis der Empf√§nger bereit ist.
- Nachrichten sind geordnet, zeitgestempelt und dauerhaft gespeichert.
- Lieferung im Pull-Modus (on-demand Abruf).
- Unterst√ºtzt Punkt-zu-Punkt-Kommunikation.
2. **Themen:** Publish-Subscribe-Messaging f√ºr die √úbertragung.
- Mehrere unabh√§ngige Abonnements erhalten Kopien von Nachrichten.
- Abonnements k√∂nnen Regeln/Filter haben, um die Lieferung zu steuern oder Metadaten hinzuzuf√ºgen.
- Unterst√ºtzt Viele-zu-Viele-Kommunikation.
3. **Namespaces:** Ein Container f√ºr alle Messaging-Komponenten, Warteschlangen und Themen, ist wie Ihr eigener Teil eines leistungsstarken Azure-Clusters, der dedizierte Kapazit√§t bietet und optional √ºber drei Verf√ºgbarkeitszonen hinweg reicht.

### Erweiterte Funktionen
Einige erweiterte Funktionen sind:

- **Nachrichtensitzungen**: Stellt FIFO-Verarbeitung sicher und unterst√ºtzt Anfrage-Antwort-Muster.
- **Automatische Weiterleitung**: √úbertr√§gt Nachrichten zwischen Warteschlangen oder Themen im selben Namespace.
- **Dead-Lettering**: Erfasst nicht zustellbare Nachrichten zur √úberpr√ºfung.
- **Geplante Lieferung**: Verz√∂gert die Nachrichtenverarbeitung f√ºr zuk√ºnftige Aufgaben.
- **Nachrichtenschiebung**: Verschiebt den Abruf von Nachrichten, bis sie bereit sind.
- **Transaktionen**: Gruppiert Operationen in atomare Ausf√ºhrung.
- **Filter & Aktionen**: Wendet Regeln an, um Nachrichten zu filtern oder zu annotieren.
- **Automatische L√∂schung bei Inaktivit√§t**: L√∂scht Warteschlangen nach Inaktivit√§t (min: 5 Minuten).
- **Duplikaterkennung**: Entfernt doppelte Nachrichten w√§hrend der erneuten √úbertragung.
- **Batch-L√∂schung**: L√∂scht abgelaufene oder unn√∂tige Nachrichten in gro√üen Mengen.

### Autorisierungsregel / SAS-Richtlinie

SAS-Richtlinien definieren die Zugriffsberechtigungen f√ºr Azure Service Bus-Entit√§ten, Namespace (die wichtigste), Warteschlangen und Themen. Jede Richtlinie hat die folgenden Komponenten:

- **Berechtigungen**: Kontrollk√§stchen zur Angabe von Zugriffslevels:
- Verwalten: Gew√§hrt vollst√§ndige Kontrolle √ºber die Entit√§t, einschlie√ülich Konfiguration und Berechtigungsmanagement.
- Senden: Erlaubt das Senden von Nachrichten an die Entit√§t.
- Anh√∂ren: Erlaubt das Empfangen von Nachrichten von der Entit√§t.
- **Prim√§re und sekund√§re Schl√ºssel**: Dies sind kryptografische Schl√ºssel, die zur Generierung sicherer Token f√ºr die Authentifizierung des Zugriffs verwendet werden.
- **Prim√§re und sekund√§re Verbindungszeichenfolgen**: Vorgefertigte Verbindungszeichenfolgen, die den Endpunkt und den Schl√ºssel f√ºr die einfache Verwendung in Anwendungen enthalten.
- **SAS-Richtlinien-ARM-ID**: Der Azure Resource Manager (ARM)-Pfad zur Richtlinie f√ºr die programmgesteuerte Identifizierung.

### Namespace

sku, autorisierungsregel,

### Aufz√§hlung

{% code overflow="wrap" %}
```bash
# Queue Enumeration
az servicebus queue list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyQueue>

# Topic Enumeration
az servicebus topic list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus topic show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyTopic>

# Susbscription Enumeration
az servicebus topic subscription list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus topic subscription show --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic> --name <MySubscription>

# Namespace Enumeration
az servicebus namespace list
az servicebus namespace network-rule-set list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace show --resource-group <MyResourceGroup> --name <MyNamespace>
az servicebus namespace network-rule-set show --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace private-endpoint-connection list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus namespace exists --name ProposedNamespace

# Authorization Rule Enumeration
az servicebus namespace authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace>
az servicebus queue authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --queue-name <MyQueue>
az servicebus topic authorization-rule list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --topic-name <MyTopic>
az servicebus namespace authorization-rule keys list --resource-group <MyResourceGroup> --namespace-name <MyNamespace> --name <MyAuthRule>
```
{% endcode %}

### Privilegieneskalation

{% content-ref url="../az-services/az-servicebus-privesc.md" %}
[az-servicebus-privesc.md](../az-services/az-servicebus-privesc.md)
{% endcontent-ref %}

### Nach der Ausnutzung

{% content-ref url="../az-post-exploitation/az-servicebus-post-exploitation.md" %}
[az-servicebus-post-exploitation.md](../az-post-exploitation/az-servicebus-post-exploitation.md)
{% endcontent-ref %}

## Referenzen

* https://learn.microsoft.com/en-us/powershell/module/az.servicebus/?view=azps-13.0.0
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-quickstart-cli

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
