# Az - Azure Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Podstawowe informacje

Azure zapewnia **wirtualne sieci (VNet)**, ktÃ³re pozwalajÄ… uÅ¼ytkownikom tworzyÄ‡ **izolowane** **sieci** w chmurze Azure. W ramach tych VNet moÅ¼na bezpiecznie hostowaÄ‡ i zarzÄ…dzaÄ‡ zasobami, takimi jak maszyny wirtualne, aplikacje, bazy danych...\
Ponadto, sieci w Azure wspierajÄ… zarÃ³wno komunikacjÄ™ wewnÄ…trz chmury (miÄ™dzy usÅ‚ugami Azure), jak i poÅ‚Ä…czenie z zewnÄ™trznymi sieciami oraz internetem.\
Co wiÄ™cej, moÅ¼liwe jest **poÅ‚Ä…czenie** VNet z innymi VNet oraz z sieciami lokalnymi.

## Wirtualna sieÄ‡ (VNET) i podsieci

Wirtualna sieÄ‡ Azure (VNet) jest reprezentacjÄ… twojej wÅ‚asnej sieci w chmurze, zapewniajÄ…cÄ… **logiczne izolowanie** w Å›rodowisku Azure dedykowanym dla twojej subskrypcji. VNet pozwala na provisionowanie i zarzÄ…dzanie wirtualnymi sieciami prywatnymi (VPN) w Azure, hostujÄ…c zasoby takie jak maszyny wirtualne (VM), bazy danych i usÅ‚ugi aplikacyjne. OferujÄ… **peÅ‚nÄ… kontrolÄ™ nad ustawieniami sieci**, w tym zakresami adresÃ³w IP, tworzeniem podsieci, tabelami routingu i bramami sieciowymi.

**Podsieci** to podziaÅ‚y w ramach VNet, definiowane przez konkretne **zakresy adresÃ³w IP**. DzielÄ…c VNet na wiele podsieci, moÅ¼esz organizowaÄ‡ i zabezpieczaÄ‡ zasoby zgodnie z architekturÄ… swojej sieci.\
DomyÅ›lnie wszystkie podsieci w tej samej Wirtualnej Sieci Azure (VNet) **mogÄ… komunikowaÄ‡ siÄ™ ze sobÄ…** bez Å¼adnych ograniczeÅ„.

**PrzykÅ‚ad:**

* `MyVNet` z zakresem adresÃ³w IP 10.0.0.0/16.
* **PodsieÄ‡-1:** 10.0.0.0/24 dla serwerÃ³w webowych.
* **PodsieÄ‡-2:** 10.0.1.0/24 dla serwerÃ³w baz danych.

### Enumeracja

Aby wylistowaÄ‡ wszystkie VNet i podsieci w koncie Azure, moÅ¼esz uÅ¼yÄ‡ interfejsu wiersza poleceÅ„ Azure (CLI). Oto kroki:

{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}"

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}

## Grupy zabezpieczeÅ„ sieci (NSG)

**Grupa zabezpieczeÅ„ sieci (NSG)** filtruje ruch sieciowy zarÃ³wno do, jak i z zasobÃ³w Azure w ramach Wirtualnej Sieci Azure (VNet). Zawiera zestaw **reguÅ‚ zabezpieczeÅ„**, ktÃ³re mogÄ… wskazywaÄ‡ **ktÃ³re porty otworzyÄ‡ dla ruchu przychodzÄ…cego i wychodzÄ…cego** wedÅ‚ug portu ÅºrÃ³dÅ‚owego, adresu IP ÅºrÃ³dÅ‚owego, portu docelowego, a takÅ¼e moÅ¼liwe jest przypisanie priorytetu (im niÅ¼szy numer priorytetu, tym wyÅ¼szy priorytet).

NSG mogÄ… byÄ‡ przypisane do **podsieci i NIC.**

**PrzykÅ‚ad reguÅ‚:**

* ReguÅ‚a przychodzÄ…ca zezwalajÄ…ca na ruch HTTP (port 80) z dowolnego ÅºrÃ³dÅ‚a do twoich serwerÃ³w WWW.
* ReguÅ‚a wychodzÄ…ca zezwalajÄ…ca tylko na ruch SQL (port 1433) do okreÅ›lonego zakresu adresÃ³w IP docelowych.

### Enumeracja

{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table
az network nsg show --name <nsg-name>

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table

# Get NICs and subnets using this NSG
az network nsg show --name MyLowCostVM-nsg --resource-group Resource_Group_1 --query "{subnets: subnets, networkInterfaces: networkInterfaces}"
```
{% endcode %}

## Azure Firewall

Azure Firewall to **zarzÄ…dzana usÅ‚uga zabezpieczeÅ„ sieciowych** w Azure, ktÃ³ra chroni zasoby chmurowe poprzez inspekcjÄ™ i kontrolÄ™ ruchu. Jest to **stanowy zapora** filtrujÄ…ca ruch na podstawie reguÅ‚ dla warstw 3 do 7, wspierajÄ…ca komunikacjÄ™ zarÃ³wno **w obrÄ™bie Azure** (ruch wschÃ³d-zachÃ³d), jak i **do/z sieci zewnÄ™trznych** (ruch pÃ³Å‚noc-poÅ‚udnie). WdroÅ¼ona na poziomie **Wirtualnej Sieci (VNet)**, zapewnia scentralizowanÄ… ochronÄ™ dla wszystkich podsieci w VNet. Azure Firewall automatycznie skaluje siÄ™, aby sprostaÄ‡ wymaganiom ruchu i zapewnia wysokÄ… dostÄ™pnoÅ›Ä‡ bez potrzeby rÄ™cznej konfiguracji.

Jest dostÄ™pna w trzech SKUâ€”**Podstawowy**, **Standardowy** i **Premium**, z ktÃ³rych kaÅ¼dy jest dostosowany do specyficznych potrzeb klientÃ³w:

| **Zalecany przypadek uÅ¼ycia**  | MaÅ‚e/Åšrednie PrzedsiÄ™biorstwa (SMB) z ograniczonymi potrzebami | OgÃ³lne zastosowanie w przedsiÄ™biorstwie, filtracja warstw 3â€“7 | Wysoce wraÅ¼liwe Å›rodowiska (np. przetwarzanie pÅ‚atnoÅ›ci)  |
| ------------------------------- | -------------------------------------------------------------- | ------------------------------------------------------------ | --------------------------------------------------------- |
| **WydajnoÅ›Ä‡**                   | Do 250 Mbps przepustowoÅ›ci                                     | Do 30 Gbps przepustowoÅ›ci                                    | Do 100 Gbps przepustowoÅ›ci                                 |
| **Inteligencja zagroÅ¼eÅ„**      | Tylko powiadomienia                                            | Powiadomienia i blokowanie (zÅ‚oÅ›liwe IP/domeny)             | Powiadomienia i blokowanie (zaawansowana inteligencja zagroÅ¼eÅ„) |
| **Filtracja L3â€“L7**            | Podstawowa filtracja                                          | Stanowa filtracja w rÃ³Å¼nych protokoÅ‚ach                      | Stanowa filtracja z zaawansowanÄ… inspekcjÄ…                |
| **Zaawansowana Ochrona przed ZagroÅ¼eniami** | NiedostÄ™pna                                      | Filtracja oparta na inteligencji zagroÅ¼eÅ„                   | Zawiera system wykrywania i zapobiegania wÅ‚amaniom (IDPS) |
| **Inspekcja TLS**              | NiedostÄ™pna                                                  | NiedostÄ™pna                                                  | Wspiera zakoÅ„czenie TLS przychodzÄ…cego/wychodzÄ…cego       |
| **DostÄ™pnoÅ›Ä‡**                  | StaÅ‚e zaplecze (2 VM)                                       | Autoskalowanie                                               | Autoskalowanie                                             |
| **ÅatwoÅ›Ä‡ zarzÄ…dzania**        | Podstawowe kontrole                                         | ZarzÄ…dzane za pomocÄ… MenedÅ¼era Zapory                       | ZarzÄ…dzane za pomocÄ… MenedÅ¼era Zapory                     |

### Enumeration

{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}

## Tabele trasowania Azure

Tabele **trasowania Azure** sÄ… uÅ¼ywane do kontrolowania trasowania ruchu sieciowego w obrÄ™bie podsieci. DefiniujÄ… zasady, ktÃ³re okreÅ›lajÄ…, jak pakiety powinny byÄ‡ przesyÅ‚ane, czy to do zasobÃ³w Azure, internetu, czy do konkretnego nastÄ™pnego skoku, takiego jak Wirtualne UrzÄ…dzenie lub Zapora Azure. MoÅ¼esz powiÄ…zaÄ‡ tabelÄ™ trasowania z **podsieciÄ…**, a wszystkie zasoby w tej podsieci bÄ™dÄ… podÄ…Å¼aÄ‡ za trasami w tabeli.

**PrzykÅ‚ad:** JeÅ›li podsieÄ‡ hostuje zasoby, ktÃ³re muszÄ… kierowaÄ‡ ruch wychodzÄ…cy przez Wirtualne UrzÄ…dzenie Sieciowe (NVA) do inspekcji, moÅ¼esz utworzyÄ‡ **trasÄ™** w tabeli trasowania, aby przekierowaÄ‡ caÅ‚y ruch (np. `0.0.0.0/0`) do prywatnego adresu IP NVA jako nastÄ™pnego skoku.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List routes for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}

## Azure Private Link

Azure Private Link to usÅ‚uga w Azure, ktÃ³ra **umoÅ¼liwia prywatny dostÄ™p do usÅ‚ug Azure**, zapewniajÄ…c, Å¼e **ruch miÄ™dzy twojÄ… wirtualnÄ… sieciÄ… Azure (VNet) a usÅ‚ugÄ… odbywa siÄ™ caÅ‚kowicie w ramach sieci szkieletowej Microsoftu Azure**. Efektywnie wprowadza usÅ‚ugÄ™ do twojej VNet. Ta konfiguracja zwiÄ™ksza bezpieczeÅ„stwo, nie naraÅ¼ajÄ…c danych na publiczny internet.

Private Link moÅ¼e byÄ‡ uÅ¼ywany z rÃ³Å¼nymi usÅ‚ugami Azure, takimi jak Azure Storage, Azure SQL Database i niestandardowymi usÅ‚ugami udostÄ™pnianymi za poÅ›rednictwem Private Link. Zapewnia bezpieczny sposÃ³b korzystania z usÅ‚ug z poziomu wÅ‚asnej VNet lub nawet z rÃ³Å¼nych subskrypcji Azure.

{% hint style="danger" %}
NSG nie majÄ… zastosowania do punktÃ³w koÅ„cowych prywatnych, co wyraÅºnie oznacza, Å¼e przypisanie NSG do podsieci zawierajÄ…cej Private Link nie bÄ™dzie miaÅ‚o Å¼adnego efektu.
{% endhint %}

**PrzykÅ‚ad:**

RozwaÅ¼ scenariusz, w ktÃ³rym masz **Azure SQL Database, do ktÃ³rej chcesz uzyskaÄ‡ bezpieczny dostÄ™p z twojej VNet**. Zwykle moÅ¼e to wymagaÄ‡ przechodzenia przez publiczny internet. DziÄ™ki Private Link moÅ¼esz utworzyÄ‡ **prywatny punkt koÅ„cowy w swojej VNet**, ktÃ³ry Å‚Ä…czy siÄ™ bezpoÅ›rednio z usÅ‚ugÄ… Azure SQL Database. Ten punkt koÅ„cowy sprawia, Å¼e baza danych wydaje siÄ™ byÄ‡ czÄ™Å›ciÄ… twojej wÅ‚asnej VNet, dostÄ™pna za poÅ›rednictwem prywatnego adresu IP, co zapewnia bezpieczny i prywatny dostÄ™p.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List Private Link Services
az network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}

## Punkty koÅ„cowe usÅ‚ugi Azure

Punkty koÅ„cowe usÅ‚ugi Azure rozszerzajÄ… prywatnÄ… przestrzeÅ„ adresowÄ… twojej sieci wirtualnej i toÅ¼samoÅ›Ä‡ twojego VNet do usÅ‚ug Azure za poÅ›rednictwem bezpoÅ›redniego poÅ‚Ä…czenia. WÅ‚Ä…czajÄ…c punkty koÅ„cowe usÅ‚ug, **zasoby w twoim VNet mogÄ… bezpiecznie Å‚Ä…czyÄ‡ siÄ™ z usÅ‚ugami Azure**, takimi jak Azure Storage i Azure SQL Database, korzystajÄ…c z sieci szkieletowej Azure. Zapewnia to, Å¼e **ruch z VNet do usÅ‚ugi Azure pozostaje w sieci Azure**, co zapewnia bardziej bezpiecznÄ… i niezawodnÄ… trasÄ™.

**PrzykÅ‚ad:**

Na przykÅ‚ad, konto **Azure Storage** domyÅ›lnie jest dostÄ™pne przez publiczny internet. WÅ‚Ä…czajÄ…c **punkt koÅ„cowy usÅ‚ugi dla Azure Storage w swoim VNet**, moÅ¼esz zapewniÄ‡, Å¼e tylko ruch z twojego VNet moÅ¼e uzyskaÄ‡ dostÄ™p do konta magazynowego. Zapora konta magazynowego moÅ¼e byÄ‡ nastÄ™pnie skonfigurowana tak, aby akceptowaÄ‡ ruch tylko z twojego VNet.

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}

### RÃ³Å¼nice miÄ™dzy punktami koÅ„cowymi usÅ‚ugi a prywatnymi Å‚Ä…czami

Microsoft zaleca korzystanie z prywatnych Å‚Ä…czy w [**dokumentacji**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Punkty koÅ„cowe usÅ‚ugi:**

* Ruch z Twojej VNet do usÅ‚ugi Azure podrÃ³Å¼uje przez sieÄ‡ szkieletowÄ… Microsoft Azure, omijajÄ…c publiczny internet.
* Punkt koÅ„cowy to bezpoÅ›rednie poÅ‚Ä…czenie z usÅ‚ugÄ… Azure i nie zapewnia prywatnego adresu IP dla usÅ‚ugi w VNet.
* Sama usÅ‚uga jest nadal dostÄ™pna przez swÃ³j publiczny punkt koÅ„cowy z zewnÄ…trz Twojej VNet, chyba Å¼e skonfigurujesz zaporÄ™ usÅ‚ugi, aby zablokowaÄ‡ taki ruch.
* To relacja jeden do jednego miÄ™dzy podsieciÄ… a usÅ‚ugÄ… Azure.
* TaÅ„sze niÅ¼ prywatne Å‚Ä…cza.

**Prywatne Å‚Ä…cza:**

* Prywatne Å‚Ä…cze mapuje usÅ‚ugi Azure do Twojej VNet za pomocÄ… prywatnego punktu koÅ„cowego, ktÃ³ry jest interfejsem sieciowym z prywatnym adresem IP w Twojej VNet.
* UsÅ‚uga Azure jest dostÄ™pna za pomocÄ… tego prywatnego adresu IP, co sprawia, Å¼e wydaje siÄ™, iÅ¼ jest czÄ™Å›ciÄ… Twojej sieci.
* UsÅ‚ugi poÅ‚Ä…czone przez prywatne Å‚Ä…cze mogÄ… byÄ‡ dostÄ™pne tylko z Twojej VNet lub poÅ‚Ä…czonych sieci; nie ma dostÄ™pu do usÅ‚ugi przez publiczny internet.
* UmoÅ¼liwia bezpieczne poÅ‚Ä…czenie z usÅ‚ugami Azure lub wÅ‚asnymi usÅ‚ugami hostowanymi w Azure, a takÅ¼e poÅ‚Ä…czenie z usÅ‚ugami udostÄ™pnionymi przez innych.
* Zapewnia bardziej szczegÃ³Å‚owÄ… kontrolÄ™ dostÄ™pu za pomocÄ… prywatnego punktu koÅ„cowego w Twojej VNet, w przeciwieÅ„stwie do szerszej kontroli dostÄ™pu na poziomie podsieci z punktami koÅ„cowymi usÅ‚ugi.

PodsumowujÄ…c, podczas gdy zarÃ³wno punkty koÅ„cowe usÅ‚ugi, jak i prywatne Å‚Ä…cza zapewniajÄ… bezpieczne poÅ‚Ä…czenie z usÅ‚ugami Azure, **prywatne Å‚Ä…cza oferujÄ… wyÅ¼szy poziom izolacji i bezpieczeÅ„stwa, zapewniajÄ…c, Å¼e usÅ‚ugi sÄ… dostÄ™pne prywatnie, bez naraÅ¼ania ich na publiczny internet**. Punkty koÅ„cowe usÅ‚ugi, z drugiej strony, sÄ… Å‚atwiejsze do skonfigurowania w ogÃ³lnych przypadkach, gdzie wymagany jest prosty, bezpieczny dostÄ™p do usÅ‚ug Azure bez potrzeby posiadania prywatnego adresu IP w VNet.

## Azure Front Door (AFD) i AFD WAF

**Azure Front Door** to skalowalny i bezpieczny punkt wejÅ›cia do **szybkiej dostawy** Twoich globalnych aplikacji internetowych. **ÅÄ…czy** rÃ³Å¼ne usÅ‚ugi, takie jak globalne **rÃ³wnowaÅ¼enie obciÄ…Å¼enia, przyspieszanie witryn, odciÄ…Å¼anie SSL i moÅ¼liwoÅ›ci zapory aplikacji internetowej (WAF)** w jednÄ… usÅ‚ugÄ™. Azure Front Door zapewnia inteligentne routowanie na podstawie **najbliÅ¼szej lokalizacji brzegowej do uÅ¼ytkownika**, zapewniajÄ…c optymalnÄ… wydajnoÅ›Ä‡ i niezawodnoÅ›Ä‡. Dodatkowo oferuje routowanie oparte na URL, hosting wielu witryn, afinityzacjÄ™ sesji i bezpieczeÅ„stwo na poziomie aplikacji.

**Azure Front Door WAF** jest zaprojektowany, aby **chroniÄ‡ aplikacje internetowe przed atakami opartymi na sieci** bez modyfikacji kodu zaplecza. Zawiera niestandardowe zasady i zarzÄ…dzane zestawy zasad, aby chroniÄ‡ przed zagroÅ¼eniami takimi jak wstrzykiwanie SQL, skrypty miÄ™dzywitrynowe i inne powszechne ataki.

**PrzykÅ‚ad:**

WyobraÅº sobie, Å¼e masz globalnie rozproszonÄ… aplikacjÄ™ z uÅ¼ytkownikami na caÅ‚ym Å›wiecie. MoÅ¼esz uÅ¼yÄ‡ Azure Front Door, aby **przekierowaÄ‡ Å¼Ä…dania uÅ¼ytkownikÃ³w do najbliÅ¼szego regionalnego centrum danych** hostujÄ…cego TwojÄ… aplikacjÄ™, co zmniejsza opÃ³Åºnienia, poprawia doÅ›wiadczenia uÅ¼ytkownikÃ³w i **broni jÄ… przed atakami internetowymi dziÄ™ki moÅ¼liwoÅ›ciom WAF**. JeÅ›li w danym regionie wystÄ…pi przestÃ³j, Azure Front Door moÅ¼e automatycznie przekierowaÄ‡ ruch do nastÄ™pnej najlepszej lokalizacji, zapewniajÄ…c wysokÄ… dostÄ™pnoÅ›Ä‡.

### Enumeracja

{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}

## Azure Application Gateway i Azure Application Gateway WAF

Azure Application Gateway to **balanser obciÄ…Å¼enia ruchu sieciowego**, ktÃ³ry umoÅ¼liwia zarzÄ…dzanie ruchem do Twoich **aplikacji** internetowych. Oferuje **balansowanie obciÄ…Å¼enia na warstwie 7, zakoÅ„czenie SSL oraz moÅ¼liwoÅ›ci zapory aplikacji internetowej (WAF)** w ramach usÅ‚ugi Application Delivery Controller (ADC). Kluczowe funkcje obejmujÄ… routowanie oparte na URL, sesje oparte na ciasteczkach oraz odciÄ…Å¼anie warstwy gniazd zabezpieczonych (SSL), ktÃ³re sÄ… niezbÄ™dne dla aplikacji wymagajÄ…cych zÅ‚oÅ¼onych moÅ¼liwoÅ›ci balansowania obciÄ…Å¼enia, takich jak globalne routowanie i routowanie oparte na Å›cieÅ¼kach.

**PrzykÅ‚ad:**

RozwaÅ¼ scenariusz, w ktÃ³rym masz stronÄ™ internetowÄ… e-commerce, ktÃ³ra zawiera wiele subdomen dla rÃ³Å¼nych funkcji, takich jak konta uÅ¼ytkownikÃ³w i przetwarzanie pÅ‚atnoÅ›ci. Azure Application Gateway moÅ¼e **routowaÄ‡ ruch do odpowiednich serwerÃ³w internetowych na podstawie Å›cieÅ¼ki URL**. Na przykÅ‚ad, ruch do `example.com/accounts` mÃ³gÅ‚by byÄ‡ kierowany do usÅ‚ugi kont uÅ¼ytkownikÃ³w, a ruch do `example.com/pay` mÃ³gÅ‚by byÄ‡ kierowany do usÅ‚ugi przetwarzania pÅ‚atnoÅ›ci.\
I **chroÅ„ swojÄ… stronÄ™ internetowÄ… przed atakami, korzystajÄ…c z moÅ¼liwoÅ›ci WAF.**

### **Enumeracja**

{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** to funkcja sieciowa w Azure, ktÃ³ra **pozwala na bezpoÅ›rednie i pÅ‚ynne poÅ‚Ä…czenie rÃ³Å¼nych Wirtualnych Sieci (VNets)**. DziÄ™ki VNet peering, zasoby w jednej VNet mogÄ… komunikowaÄ‡ siÄ™ z zasobami w innej VNet, uÅ¼ywajÄ…c prywatnych adresÃ³w IP, **jakby znajdowaÅ‚y siÄ™ w tej samej sieci**.\
**VNet Peering moÅ¼e byÄ‡ rÃ³wnieÅ¼ uÅ¼ywane z sieciami lokalnymi** poprzez skonfigurowanie VPN site-to-site lub Azure ExpressRoute.

**Azure Hub i Spoke** to topologia sieciowa uÅ¼ywana w Azure do zarzÄ…dzania i organizowania ruchu sieciowego. **"Hub" to centralny punkt, ktÃ³ry kontroluje i kieruje ruchem miÄ™dzy rÃ³Å¼nymi "spokes"**. Hub zazwyczaj zawiera usÅ‚ugi wspÃ³lne, takie jak wirtualne urzÄ…dzenia sieciowe (NVA), Azure VPN Gateway, Azure Firewall lub Azure Bastion. **"Spokes" to VNety, ktÃ³re hostujÄ… obciÄ…Å¼enia i Å‚Ä…czÄ… siÄ™ z hubem za pomocÄ… VNet peering**, co pozwala im korzystaÄ‡ z usÅ‚ug wspÃ³lnych w hubie. Ten model promuje czysty ukÅ‚ad sieci, redukujÄ…c zÅ‚oÅ¼onoÅ›Ä‡ poprzez centralizacjÄ™ wspÃ³lnych usÅ‚ug, z ktÃ³rych mogÄ… korzystaÄ‡ rÃ³Å¼ne obciÄ…Å¼enia w rÃ³Å¼nych VNetach.

{% hint style="danger" %}
**Parowanie VNET jest nieprzechodnie w Azure**, co oznacza, Å¼e jeÅ›li spoke 1 jest poÅ‚Ä…czony ze spoke 2, a spoke 2 jest poÅ‚Ä…czony ze spoke 3, to spoke 1 nie moÅ¼e rozmawiaÄ‡ bezpoÅ›rednio ze spoke 3.
{% endhint %}

**PrzykÅ‚ad:**

WyobraÅº sobie firmÄ™ z oddzielnymi dziaÅ‚ami, takimi jak SprzedaÅ¼, HR i RozwÃ³j, **kaÅ¼dy z wÅ‚asnÄ… VNet (spokes)**. Te VNety **wymagajÄ… dostÄ™pu do wspÃ³lnych zasobÃ³w** takich jak centralna baza danych, zapora ogniowa i brama internetowa, ktÃ³re znajdujÄ… siÄ™ w **innej VNet (hub)**. KorzystajÄ…c z modelu Hub i Spoke, kaÅ¼dy dziaÅ‚ moÅ¼e **bezpiecznie Å‚Ä…czyÄ‡ siÄ™ z wspÃ³lnymi zasobami przez VNet hub, nie naraÅ¼ajÄ…c tych zasobÃ³w na publiczny internet** ani nie tworzÄ…c zÅ‚oÅ¼onej struktury sieciowej z licznymi poÅ‚Ä…czeniami.

### Enumeration

{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}

## Site-to-Site VPN

Site-to-Site VPN w Azure pozwala na **poÅ‚Ä…czenie lokalnej sieci z TwojÄ… sieciÄ… wirtualnÄ… Azure (VNet)**, umoÅ¼liwiajÄ…c zasobom takim jak VM w Azure, aby wydawaÅ‚y siÄ™, jakby byÅ‚y w Twojej lokalnej sieci. To poÅ‚Ä…czenie jest ustanawiane przez **bramÄ™ VPN, ktÃ³ra szyfruje ruch** miÄ™dzy dwiema sieciami.

**PrzykÅ‚ad:**

Firma, ktÃ³rej gÅ‚Ã³wne biuro znajduje siÄ™ w Nowym Jorku, ma lokalne centrum danych, ktÃ³re musi bezpiecznie poÅ‚Ä…czyÄ‡ siÄ™ ze swojÄ… VNet w Azure, ktÃ³ra hostuje jej wirtualizowane obciÄ…Å¼enia. Poprzez skonfigurowanie **Site-to-Site VPN, firma moÅ¼e zapewniÄ‡ szyfrowane poÅ‚Ä…czenie miÄ™dzy lokalnymi serwerami a VM w Azure**, umoÅ¼liwiajÄ…c bezpieczny dostÄ™p do zasobÃ³w w obu Å›rodowiskach, jakby znajdowaÅ‚y siÄ™ w tej samej lokalnej sieci.

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}

## Azure ExpressRoute

Azure ExpressRoute to usÅ‚uga, ktÃ³ra zapewnia **prywatne, dedykowane, szybkie poÅ‚Ä…czenie miÄ™dzy twojÄ… infrastrukturÄ… lokalnÄ… a centrami danych Azure**. To poÅ‚Ä…czenie realizowane jest przez dostawcÄ™ Å‚Ä…cznoÅ›ci, omijajÄ…c publiczny internet i oferujÄ…c wiÄ™kszÄ… niezawodnoÅ›Ä‡, szybsze prÄ™dkoÅ›ci, niÅ¼sze opÃ³Åºnienia oraz wyÅ¼sze bezpieczeÅ„stwo niÅ¼ typowe poÅ‚Ä…czenia internetowe.

**PrzykÅ‚ad:**

MiÄ™dzynarodowa korporacja wymaga **spÃ³jnego i niezawodnego poÅ‚Ä…czenia z usÅ‚ugami Azure z powodu duÅ¼ej iloÅ›ci danych** oraz potrzeby wysokiej przepustowoÅ›ci. Firma decyduje siÄ™ na Azure ExpressRoute, aby bezpoÅ›rednio poÅ‚Ä…czyÄ‡ swoje lokalne centrum danych z Azure, uÅ‚atwiajÄ…c transfery danych na duÅ¼Ä… skalÄ™, takie jak codzienne kopie zapasowe i analizy danych w czasie rzeczywistym, z poprawionÄ… prywatnoÅ›ciÄ… i szybkoÅ›ciÄ….

### **Enumeration**

{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegram**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}
