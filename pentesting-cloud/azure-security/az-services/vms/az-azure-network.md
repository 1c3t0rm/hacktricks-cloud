# Az - Azure Network

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## Grundinformationen

Azure bietet **virtuelle Netzwerke (VNet)**, die es Benutzern erm√∂glichen, **isolierte** **Netzwerke** innerhalb der Azure-Cloud zu erstellen. Innerhalb dieser VNets k√∂nnen Ressourcen wie virtuelle Maschinen, Anwendungen, Datenbanken... sicher gehostet und verwaltet werden. Das Netzwerk in Azure unterst√ºtzt sowohl die Kommunikation innerhalb der Cloud (zwischen Azure-Diensten) als auch die Verbindung zu externen Netzwerken und dem Internet.\
Dar√ºber hinaus ist es m√∂glich, VNets mit anderen VNets und mit lokalen Netzwerken zu **verbinden**.

## Virtuelles Netzwerk (VNET) & Subnetze

Ein Azure Virtual Network (VNet) ist eine Darstellung Ihres eigenen Netzwerks in der Cloud, die **logische Isolation** innerhalb der Azure-Umgebung bietet, die Ihrer Abonnements zugeordnet ist. VNets erm√∂glichen es Ihnen, virtuelle private Netzwerke (VPNs) in Azure bereitzustellen und zu verwalten, die Ressourcen wie virtuelle Maschinen (VMs), Datenbanken und Anwendungsdienste hosten. Sie bieten **vollst√§ndige Kontrolle √ºber Netzwerkeinstellungen**, einschlie√ülich IP-Adressbereiche, Erstellung von Subnetzen, Routentabellen und Netzwerk-Gateways.

**Subnetze** sind Unterteilungen innerhalb eines VNet, die durch spezifische **IP-Adressbereiche** definiert sind. Durch die Segmentierung eines VNet in mehrere Subnetze k√∂nnen Sie Ressourcen gem√§√ü Ihrer Netzwerkarchitektur organisieren und sichern.\
Standardm√§√üig k√∂nnen alle Subnetze innerhalb desselben Azure Virtual Network (VNet) **miteinander kommunizieren**, ohne dass Einschr√§nkungen bestehen.

**Beispiel:**

* `MyVNet` mit einem IP-Adressbereich von 10.0.0.0/16.
* **Subnetz-1:** 10.0.0.0/24 f√ºr Webserver.
* **Subnetz-2:** 10.0.1.0/24 f√ºr Datenbankserver.

### Aufz√§hlung

Um alle VNets und Subnetze in einem Azure-Konto aufzulisten, k√∂nnen Sie die Azure-Befehlszeilenschnittstelle (CLI) verwenden. Hier sind die Schritte:

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}"

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List VNets
Get-AzVirtualNetwork | Select-Object Name, Location, @{Name="AddressSpace"; Expression={$_.AddressSpace.AddressPrefixes}}

# List subnets of a VNet
Get-AzVirtualNetwork -ResourceGroupName <ResourceGroupName> -Name <VNetName> |
Select-Object -ExpandProperty Subnets |
Select-Object Name, AddressPrefix
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Netzwerk-Sicherheitsgruppen (NSG)

Eine **Netzwerk-Sicherheitsgruppe (NSG)** filtert den Netzwerkverkehr sowohl zu als auch von Azure-Ressourcen innerhalb eines Azure Virtual Network (VNet). Sie enth√§lt eine Reihe von **Sicherheitsregeln**, die angeben k√∂nnen, **welche Ports f√ºr eingehenden und ausgehenden Verkehr ge√∂ffnet werden sollen** nach Quellport, Quell-IP, Zielport, und es ist m√∂glich, eine Priorit√§t zuzuweisen (je niedriger die Priorit√§tsnummer, desto h√∂her die Priorit√§t).

NSGs k√∂nnen mit **Subnetzen und NICs** verkn√ºpft werden.

**Beispielregeln:**

* Eine eingehende Regel, die HTTP-Verkehr (Port 80) von jeder Quelle zu Ihren Webservern erlaubt.
* Eine ausgehende Regel, die nur SQL-Verkehr (Port 1433) zu einem bestimmten Ziel-IP-Adressbereich erlaubt.

### Aufz√§hlung

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table
az network nsg show --name <nsg-name>

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table

# Get NICs and subnets using this NSG
az network nsg show --name MyLowCostVM-nsg --resource-group Resource_Group_1 --query "{subnets: subnets, networkInterfaces: networkInterfaces}"
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List NSGs
Get-AzNetworkSecurityGroup | Select-Object Name, Location
Get-AzNetworkSecurityGroup -Name <NSGName> -ResourceGroupName <ResourceGroupName>

# Get NSG rules
(Get-AzNetworkSecurityGroup -ResourceGroupName <NSGName> -Name <ResourceGroupName>).SecurityRules

# Get NICs and subnets using this NSG
(Get-AzNetworkSecurityGroup -Name <NSGName> -ResourceGroupName <ResourceGroupName>).Subnets
```
{% endcode %}
{% endtab %}
{% endtabs %}
## Azure Firewall

Azure Firewall ist ein **verwalteter Netzwerk-Sicherheitsdienst** in Azure, der Cloud-Ressourcen sch√ºtzt, indem er den Datenverkehr inspiziert und kontrolliert. Es handelt sich um eine **zustandsbehaftete Firewall**, die den Datenverkehr basierend auf Regeln f√ºr die Schichten 3 bis 7 filtert und die Kommunikation sowohl **innerhalb von Azure** (East-West-Datenverkehr) als auch **zu/von externen Netzwerken** (North-South-Datenverkehr) unterst√ºtzt. Bereitgestellt auf der **Virtual Network (VNet)-Ebene** bietet es zentralen Schutz f√ºr alle Subnetze im VNet. Azure Firewall skaliert automatisch, um den Anforderungen des Datenverkehrs gerecht zu werden, und gew√§hrleistet hohe Verf√ºgbarkeit, ohne dass eine manuelle Einrichtung erforderlich ist.

Es ist in drei SKUs verf√ºgbar‚Äî**Basic**, **Standard** und **Premium**, die jeweils auf spezifische Kundenbed√ºrfnisse zugeschnitten sind:

| **Empfohlener Anwendungsfall** | Kleine/Mittlere Unternehmen (KMUs) mit begrenztem Bedarf | Allgemeine Unternehmensnutzung, Layer 3‚Äì7 Filtering | Hochsensible Umgebungen (z. B. Zahlungsabwicklung)  |
| ------------------------------- | ------------------------------------------------------- | -------------------------------------------------- | ---------------------------------------------------- |
| **Leistung**                   | Bis zu 250 Mbps Durchsatz                               | Bis zu 30 Gbps Durchsatz                           | Bis zu 100 Gbps Durchsatz                            |
| **Bedrohungsintelligenz**      | Nur Warnungen                                          | Warnungen und Blockierung (b√∂sartige IPs/Domains) | Warnungen und Blockierung (erweiterte Bedrohungsintelligenz) |
| **L3‚ÄìL7 Filtering**            | Grundlegendes Filtern                                   | Zustandsbehaftetes Filtern √ºber Protokolle        | Zustandsbehaftetes Filtern mit erweiterter Inspektion |
| **Erweiterter Bedrohungsschutz** | Nicht verf√ºgbar                                       | Bedrohungsintelligenz-basiertes Filtern           | Beinhaltet Intrusion Detection and Prevention System (IDPS) |
| **TLS-Inspektion**             | Nicht verf√ºgbar                                       | Nicht verf√ºgbar                                    | Unterst√ºtzt eingehende/ausgehende TLS-Terminierung   |
| **Verf√ºgbarkeit**               | Fester Backend (2 VMs)                                 | Autoskalierung                                      | Autoskalierung                                       |
| **Verwaltungsaufwand**         | Grundlegende Steuerung                                  | Verwaltet √ºber Firewall Manager                    | Verwaltet √ºber Firewall Manager                      |

### Enumeration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List Azure Firewalls
Get-AzFirewall

# Get network rules of a firewall
(Get-AzFirewall -Name <FirewallName> -ResourceGroupName <ResourceGroupName>).NetworkRuleCollections

# Get application rules of a firewall
(Get-AzFirewall -Name <FirewallName> -ResourceGroupName <ResourceGroupName>).ApplicationRuleCollections

# Get nat rules of a firewall
(Get-AzFirewall -Name <FirewallName> -ResourceGroupName <ResourceGroupName>).NatRuleCollections
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Azure Routen-Tabellen

Azure **Routen-Tabellen** werden verwendet, um das Routing des Netzwerkverkehrs innerhalb eines Subnetzes zu steuern. Sie definieren Regeln, die angeben, wie Pakete weitergeleitet werden sollen, entweder zu Azure-Ressourcen, dem Internet oder einem bestimmten n√§chsten Hop wie einem Virtuellen Ger√§t oder der Azure-Firewall. Sie k√∂nnen eine Routentabelle mit einem **Subnetz** verkn√ºpfen, und alle Ressourcen innerhalb dieses Subnetzes folgen den Routen in der Tabelle.

**Beispiel:** Wenn ein Subnetz Ressourcen hostet, die ausgehenden Verkehr √ºber ein Netzwerk-Virtual-Appliance (NVA) zur Inspektion routen m√ºssen, k√∂nnen Sie eine **Route** in einer Routentabelle erstellen, um den gesamten Verkehr (z. B. `0.0.0.0/0`) an die private IP-Adresse der NVA als n√§chsten Hop umzuleiten.

### **Enumeration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List routes for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List Route Tables
Get-AzRouteTable

# List routes for a table
(Get-AzRouteTable -Name <RouteTableName> -ResourceGroupName <ResourceGroupName>).Routes
```
{% endcode %}
{% endtab %}
{% endtabs %}
## Azure Private Link

Azure Private Link ist ein Dienst in Azure, der **privaten Zugriff auf Azure-Dienste erm√∂glicht**, indem sichergestellt wird, dass **der Datenverkehr zwischen Ihrem Azure-Virtual-Network (VNet) und dem Dienst vollst√§ndig innerhalb des Backbone-Netzwerks von Microsoft Azure verl√§uft**. Es bringt den Dienst effektiv in Ihr VNet. Diese Konfiguration erh√∂ht die Sicherheit, indem die Daten nicht dem √∂ffentlichen Internet ausgesetzt werden.

Private Link kann mit verschiedenen Azure-Diensten verwendet werden, wie Azure Storage, Azure SQL Database und benutzerdefinierten Diensten, die √ºber Private Link geteilt werden. Es bietet eine sichere M√∂glichkeit, Dienste aus Ihrem eigenen VNet oder sogar aus verschiedenen Azure-Abonnements zu konsumieren.

{% hint style="danger" %}
NSGs gelten nicht f√ºr private Endpunkte, was eindeutig bedeutet, dass die Zuordnung eines NSG zu einem Subnetz, das den Private Link enth√§lt, keine Auswirkungen hat.
{% endhint %}

**Beispiel:**

Betrachten Sie ein Szenario, in dem Sie eine **Azure SQL-Datenbank haben, auf die Sie sicher von Ihrem VNet aus zugreifen m√∂chten**. Normalerweise k√∂nnte dies den Zugriff √ºber das √∂ffentliche Internet erfordern. Mit Private Link k√∂nnen Sie einen **privaten Endpunkt in Ihrem VNet erstellen**, der direkt mit dem Azure SQL-Datenbankdienst verbunden ist. Dieser Endpunkt l√§sst die Datenbank so erscheinen, als w√§re sie Teil Ihres eigenen VNet, zug√§nglich √ºber eine private IP-Adresse, und gew√§hrleistet so einen sicheren und privaten Zugriff.

### **Enumeration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List Private Link Services
az network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List Private Link Services
Get-AzPrivateLinkService | Select-Object Name, Location, ResourceGroupName

# List Private Endpoints
Get-AzPrivateEndpoint | Select-Object Name, Location, ResourceGroupName, PrivateEndpointConnections
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Azure Service Endpoints

Azure Service Endpoints erweitern den privaten Adressraum Ihres virtuellen Netzwerks und die Identit√§t Ihres VNet zu Azure-Diensten √ºber eine direkte Verbindung. Durch das Aktivieren von Service-Endpunkten k√∂nnen **Ressourcen in Ihrem VNet sicher mit Azure-Diensten** verbinden, wie Azure Storage und Azure SQL Database, unter Verwendung des Backbone-Netzwerks von Azure. Dies stellt sicher, dass der **Verkehr vom VNet zum Azure-Dienst innerhalb des Azure-Netzwerks bleibt**, was einen sichereren und zuverl√§ssigeren Pfad bietet.

**Beispiel:**

Ein **Azure Storage**-Konto ist standardm√§√üig √ºber das √∂ffentliche Internet zug√§nglich. Durch das Aktivieren eines **Service-Endpunkts f√ºr Azure Storage innerhalb Ihres VNet** k√∂nnen Sie sicherstellen, dass nur der Verkehr von Ihrem VNet auf das Speicherkonto zugreifen kann. Die Firewall des Speicherkontos kann dann so konfiguriert werden, dass sie nur Verkehr von Ihrem VNet akzeptiert.

### **Enumeration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List Virtual Networks with Service Endpoints
Get-AzVirtualNetwork

# List Subnets with Service Endpoints
(Get-AzVirtualNetwork -ResourceGroupName <ResourceGroupName> -Name <VNetName>).Subnets
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Unterschiede zwischen Service-Endpunkten und privaten Links

Microsoft empfiehlt die Verwendung von privaten Links in den [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Service-Endpunkte:**

* Der Datenverkehr von Ihrem VNet zum Azure-Dienst verl√§uft √ºber das Microsoft Azure Backbone-Netzwerk und umgeht das √∂ffentliche Internet.
* Der Endpunkt ist eine direkte Verbindung zum Azure-Dienst und bietet keine private IP f√ºr den Dienst innerhalb des VNet.
* Der Dienst selbst ist weiterhin √ºber seinen √∂ffentlichen Endpunkt von au√üerhalb Ihres VNet zug√§nglich, es sei denn, Sie konfigurieren die Dienstfirewall, um solchen Datenverkehr zu blockieren.
* Es besteht eine Eins-zu-eins-Beziehung zwischen dem Subnetz und dem Azure-Dienst.
* G√ºnstiger als private Links.

**Private Links:**

* Private Link verbindet Azure-Dienste √ºber einen privaten Endpunkt in Ihr VNet, der eine Netzwerkschnittstelle mit einer privaten IP-Adresse innerhalb Ihres VNet ist.
* Der Azure-Dienst wird √ºber diese private IP-Adresse aufgerufen, wodurch es so aussieht, als w√§re er Teil Ihres Netzwerks.
* Dienste, die √ºber Private Link verbunden sind, k√∂nnen nur von Ihrem VNet oder verbundenen Netzwerken aus aufgerufen werden; es gibt keinen √∂ffentlichen Internetzugang zu dem Dienst.
* Es erm√∂glicht eine sichere Verbindung zu Azure-Diensten oder Ihren eigenen in Azure gehosteten Diensten sowie eine Verbindung zu von anderen geteilten Diensten.
* Es bietet eine granularere Zugriffskontrolle √ºber einen privaten Endpunkt in Ihrem VNet, im Gegensatz zu einer breiteren Zugriffskontrolle auf Subnetzebene mit Service-Endpunkten.

Zusammenfassend l√§sst sich sagen, dass sowohl Service-Endpunkte als auch private Links eine sichere Konnektivit√§t zu Azure-Diensten bieten, **aber private Links ein h√∂heres Ma√ü an Isolation und Sicherheit bieten, indem sie sicherstellen, dass Dienste privat ohne Exposition gegen√ºber dem √∂ffentlichen Internet aufgerufen werden**. Service-Endpunkte hingegen sind einfacher einzurichten f√ºr allgemeine F√§lle, in denen ein einfacher, sicherer Zugriff auf Azure-Dienste erforderlich ist, ohne dass eine private IP im VNet ben√∂tigt wird.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** ist ein skalierbarer und sicherer Einstiegspunkt f√ºr die **schnelle Bereitstellung** Ihrer globalen Webanwendungen. Es **kombiniert** verschiedene Dienste wie globale **Lastverteilung, Standortbeschleunigung, SSL-Offloading und Web Application Firewall (WAF)**-Funktionen in einem einzigen Dienst. Azure Front Door bietet intelligentes Routing basierend auf dem **n√§chsten Edge-Standort zum Benutzer**, um optimale Leistung und Zuverl√§ssigkeit zu gew√§hrleisten. Dar√ºber hinaus bietet es URL-basiertes Routing, Hosting mehrerer Standorte, Sitzungsaffinit√§t und Sicherheit auf Anwendungsebene.

**Azure Front Door WAF** ist darauf ausgelegt, **Webanwendungen vor web-basierten Angriffen** zu sch√ºtzen, ohne dass √Ñnderungen am Backend-Code erforderlich sind. Es umfasst benutzerdefinierte Regeln und verwaltete Regelsets, um vor Bedrohungen wie SQL-Injection, Cross-Site-Scripting und anderen g√§ngigen Angriffen zu sch√ºtzen.

**Beispiel:**

Stellen Sie sich vor, Sie haben eine global verteilte Anwendung mit Benutzern auf der ganzen Welt. Sie k√∂nnen Azure Front Door verwenden, um **Benutzeranfragen an das n√§chstgelegene regionale Rechenzentrum** weiterzuleiten, das Ihre Anwendung hostet, wodurch die Latenz verringert, die Benutzererfahrung verbessert und **es vor Webangriffen mit den WAF-Funktionen gesch√ºtzt wird**. Wenn eine bestimmte Region Ausfallzeiten hat, kann Azure Front Door den Datenverkehr automatisch an den n√§chstbesten Standort umleiten, um eine hohe Verf√ºgbarkeit sicherzustellen.

### Aufz√§hlung

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List Azure Front Door Instances
Get-AzFrontDoor

# List Front Door WAF Policies
Get-AzFrontDoorWafPolicy -Name <policyName> -ResourceGroupName <resourceGroupName>
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Azure Application Gateway und Azure Application Gateway WAF

Azure Application Gateway ist ein **Web-Traffic-Lastenausgleich**-Dienst, der es Ihnen erm√∂glicht, den Traffic zu Ihren **Web**-Anwendungen zu verwalten. Es bietet **Layer 7 Lastenausgleich, SSL-Terminierung und Webanwendungsfirewall (WAF)-Funktionen** im Application Delivery Controller (ADC) als Dienst. Zu den wichtigsten Funktionen geh√∂ren URL-basiertes Routing, cookie-basierten Sitzungsaffinit√§t und SSL-Offloading, die f√ºr Anwendungen, die komplexe Lastenausgleichsfunktionen wie globales Routing und pfadbasiertes Routing erfordern, entscheidend sind.

**Beispiel:**

Betrachten Sie ein Szenario, in dem Sie eine E-Commerce-Website haben, die mehrere Subdomains f√ºr verschiedene Funktionen umfasst, wie z. B. Benutzerkonten und Zahlungsabwicklung. Azure Application Gateway kann **den Traffic basierend auf dem URL-Pfad an die entsprechenden Webserver weiterleiten**. Zum Beispiel k√∂nnte der Traffic zu `example.com/accounts` an den Dienst f√ºr Benutzerkonten geleitet werden, und der Traffic zu `example.com/pay` k√∂nnte an den Zahlungsabwicklungsdienst geleitet werden.\
Und **sch√ºtzen Sie Ihre Website vor Angriffen mit den WAF-Funktionen.**

### **Enumeration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List the Web Application Firewall configurations for your Application Gateways
(Get-AzApplicationGateway -Name <AppGatewayName> -ResourceGroupName <ResourceGroupName>).WebApplicationFirewallConfiguration
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** ist eine Netzwerkfunktion in Azure, die **es erm√∂glicht, verschiedene Virtuelle Netzwerke (VNets) direkt und nahtlos zu verbinden**. Durch VNet Peering k√∂nnen Ressourcen in einem VNet mit Ressourcen in einem anderen VNet √ºber private IP-Adressen kommunizieren, **als ob sie sich im selben Netzwerk bef√§nden**.\
**VNet Peering kann auch mit On-Premise-Netzwerken verwendet werden**, indem ein Site-to-Site-VPN oder Azure ExpressRoute eingerichtet wird.

**Azure Hub und Spoke** ist eine Netzwerk-Topologie, die in Azure verwendet wird, um den Netzwerkverkehr zu verwalten und zu organisieren. **Der "Hub" ist ein zentraler Punkt, der den Verkehr zwischen verschiedenen "Speichen" steuert und leitet**. Der Hub enth√§lt typischerweise gemeinsame Dienste wie Netzwerkvirtualger√§te (NVAs), Azure VPN Gateway, Azure Firewall oder Azure Bastion. Die **"Speichen" sind VNets, die Workloads hosten und √ºber VNet Peering mit dem Hub verbunden sind**, wodurch sie die gemeinsamen Dienste innerhalb des Hubs nutzen k√∂nnen. Dieses Modell f√∂rdert eine saubere Netzwerkstruktur und reduziert die Komplexit√§t, indem es gemeinsame Dienste zentralisiert, die von mehreren Workloads in verschiedenen VNets genutzt werden k√∂nnen.

{% hint style="danger" %}
**VNET-Peering ist in Azure nicht transitiv**, was bedeutet, dass, wenn Speiche 1 mit Speiche 2 verbunden ist und Speiche 2 mit Speiche 3 verbunden ist, Speiche 1 nicht direkt mit Speiche 3 kommunizieren kann.
{% endhint %}

**Beispiel:**

Stellen Sie sich ein Unternehmen mit separaten Abteilungen wie Vertrieb, Personalwesen und Entwicklung vor, **jede mit ihrem eigenen VNet (den Speichen)**. Diese VNets **ben√∂tigen Zugriff auf gemeinsame Ressourcen** wie eine zentrale Datenbank, eine Firewall und ein Internet-Gateway, die sich alle in **einem anderen VNet (dem Hub)** befinden. Durch die Verwendung des Hub- und Spoke-Modells kann jede Abteilung **sicher auf die gemeinsamen Ressourcen √ºber das Hub-VNet zugreifen, ohne diese Ressourcen dem √∂ffentlichen Internet auszusetzen** oder eine komplexe Netzwerkstruktur mit zahlreichen Verbindungen zu schaffen.

### Enumeration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List all VNets in your subscription
Get-AzVirtualNetwork

# List VNet peering connections for a given VNet
(Get-AzVirtualNetwork -ResourceGroupName <ResourceGroupName> -Name <VNetName>).VirtualNetworkPeerings

# List Shared Resources (e.g., Azure Firewall) in the Hub
Get-AzFirewall
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Site-to-Site VPN

Ein Site-to-Site VPN in Azure erm√∂glicht es Ihnen, **Ihr lokales Netzwerk mit Ihrem Azure Virtual Network (VNet) zu verbinden**, sodass Ressourcen wie VMs innerhalb von Azure so erscheinen, als w√§ren sie in Ihrem lokalen Netzwerk. Diese Verbindung wird √ºber ein **VPN-Gateway hergestellt, das den Datenverkehr zwischen den beiden Netzwerken verschl√ºsselt**.

**Beispiel:**

Ein Unternehmen mit seinem Hauptb√ºro in New York hat ein lokales Rechenzentrum, das sicher mit seinem VNet in Azure verbunden werden muss, das seine virtualisierten Workloads hostet. Durch die Einrichtung eines **Site-to-Site VPN kann das Unternehmen eine verschl√ºsselte Verbindung zwischen den lokalen Servern und den Azure VMs sicherstellen**, sodass Ressourcen sicher √ºber beide Umgebungen hinweg zugegriffen werden kann, als w√§ren sie im selben lokalen Netzwerk.

### **Enumeration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List VPN Gateways
Get-AzVirtualNetworkGateway -ResourceGroupName <ResourceGroupName>

# List VPN Connections
Get-AzVirtualNetworkGatewayConnection -ResourceGroupName <ResourceGroupName>
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Azure ExpressRoute

Azure ExpressRoute ist ein Dienst, der eine **private, dedizierte, hochgeschwindigkeits Verbindung zwischen Ihrer lokalen Infrastruktur und den Azure-Rechenzentren** bereitstellt. Diese Verbindung erfolgt √ºber einen Konnektivit√§tsanbieter, umgeht das √∂ffentliche Internet und bietet mehr Zuverl√§ssigkeit, schnellere Geschwindigkeiten, geringere Latenzen und h√∂here Sicherheit als typische Internetverbindungen.

**Beispiel:**

Ein multinationales Unternehmen ben√∂tigt eine **konstante und zuverl√§ssige Verbindung zu seinen Azure-Diensten aufgrund des hohen Datenvolumens** und des Bedarfs an hoher Durchsatzrate. Das Unternehmen entscheidet sich f√ºr Azure ExpressRoute, um sein lokales Rechenzentrum direkt mit Azure zu verbinden, was gro√üangelegte Daten√ºbertragungen, wie t√§gliche Backups und Echtzeitanalysen, mit verbesserter Privatsph√§re und Geschwindigkeit erleichtert.

### **Enumeration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List ExpressRoute Circuits
Get-AzExpressRouteCircuit
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}
