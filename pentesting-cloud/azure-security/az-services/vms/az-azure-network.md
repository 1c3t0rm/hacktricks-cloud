# Az - Azure Network

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

Azure fournit des **r√©seaux virtuels (VNet)** qui permettent aux utilisateurs de cr√©er des **r√©seaux isol√©s** au sein du cloud Azure. Au sein de ces VNets, des ressources telles que des machines virtuelles, des applications, des bases de donn√©es... peuvent √™tre h√©berg√©es et g√©r√©es en toute s√©curit√©. Le r√©seau dans Azure prend en charge √† la fois la communication au sein du cloud (entre les services Azure) et la connexion √† des r√©seaux externes et √† Internet.\
De plus, il est possible de **connecter** des VNets avec d'autres VNets et avec des r√©seaux sur site.

## Virtual Network (VNET) & Subnets

Un r√©seau virtuel Azure (VNet) est une repr√©sentation de votre propre r√©seau dans le cloud, offrant une **isolation logique** au sein de l'environnement Azure d√©di√© √† votre abonnement. Les VNets vous permettent de provisionner et de g√©rer des r√©seaux priv√©s virtuels (VPN) dans Azure, h√©bergeant des ressources comme des machines virtuelles (VM), des bases de donn√©es et des services d'application. Ils offrent **un contr√¥le total sur les param√®tres r√©seau**, y compris les plages d'adresses IP, la cr√©ation de sous-r√©seaux, les tables de routage et les passerelles r√©seau.

**Les sous-r√©seaux** sont des subdivisions au sein d'un VNet, d√©finies par des **plages d'adresses IP** sp√©cifiques. En segmentant un VNet en plusieurs sous-r√©seaux, vous pouvez organiser et s√©curiser les ressources selon votre architecture r√©seau.\
Par d√©faut, tous les sous-r√©seaux au sein du m√™me r√©seau virtuel Azure (VNet) **peuvent communiquer entre eux** sans aucune restriction.

**Exemple :**

* `MyVNet` avec une plage d'adresses IP de 10.0.0.0/16.
* **Sous-r√©seau-1 :** 10.0.0.0/24 pour les serveurs web.
* **Sous-r√©seau-2 :** 10.0.1.0/24 pour les serveurs de bases de donn√©es.

### Enumeration

Pour lister tous les VNets et sous-r√©seaux dans un compte Azure, vous pouvez utiliser l'interface de ligne de commande Azure (CLI). Voici les √©tapes :

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}"

# List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List VNets
Get-AzVirtualNetwork | Select-Object Name, Location, @{Name="AddressSpace"; Expression={$_.AddressSpace.AddressPrefixes}}

# List subnets of a VNet
Get-AzVirtualNetwork -ResourceGroupName <ResourceGroupName> -Name <VNetName> |
Select-Object -ExpandProperty Subnets |
Select-Object Name, AddressPrefix
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Groupes de s√©curit√© r√©seau (NSG)

Un **Groupe de s√©curit√© r√©seau (NSG)** filtre le trafic r√©seau √† la fois vers et depuis les ressources Azure au sein d'un R√©seau Virtuel Azure (VNet). Il contient un ensemble de **r√®gles de s√©curit√©** qui peuvent indiquer **quels ports ouvrir pour le trafic entrant et sortant** par port source, IP source, destination de port et il est possible d'assigner une priorit√© (plus le num√©ro de priorit√© est bas, plus la priorit√© est √©lev√©e).

Les NSG peuvent √™tre associ√©s √† **des sous-r√©seaux et des NIC.**

**Exemple de r√®gles :**

* Une r√®gle entrante permettant le trafic HTTP (port 80) de n'importe quelle source vers vos serveurs web.
* Une r√®gle sortante permettant uniquement le trafic SQL (port 1433) vers une plage d'adresses IP de destination sp√©cifique.

### √ânum√©ration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List NSGs
az network nsg list --query "[].{name:name, location:location}" -o table
az network nsg show --name <nsg-name>

# Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table

# Get NICs and subnets using this NSG
az network nsg show --name MyLowCostVM-nsg --resource-group Resource_Group_1 --query "{subnets: subnets, networkInterfaces: networkInterfaces}"
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List NSGs
Get-AzNetworkSecurityGroup | Select-Object Name, Location
Get-AzNetworkSecurityGroup -Name <NSGName> -ResourceGroupName <ResourceGroupName>

# Get NSG rules
(Get-AzNetworkSecurityGroup -ResourceGroupName <NSGName> -Name <ResourceGroupName>).SecurityRules

# Get NICs and subnets using this NSG
(Get-AzNetworkSecurityGroup -Name <NSGName> -ResourceGroupName <ResourceGroupName>).Subnets
```
{% endcode %}
{% endtab %}
{% endtabs %}
## Azure Firewall

Azure Firewall est un **service de s√©curit√© r√©seau g√©r√©** dans Azure qui prot√®ge les ressources cloud en inspectant et en contr√¥lant le trafic. C'est un **pare-feu √† √©tat** qui filtre le trafic en fonction de r√®gles pour les couches 3 √† 7, prenant en charge la communication √† la fois **au sein d'Azure** (trafic est-ouest) et **vers/depuis des r√©seaux externes** (trafic nord-sud). D√©ploy√© au niveau du **r√©seau virtuel (VNet)**, il fournit une protection centralis√©e pour tous les sous-r√©seaux dans le VNet. Azure Firewall s'adapte automatiquement pour g√©rer les demandes de trafic et garantit une haute disponibilit√© sans n√©cessiter de configuration manuelle.

Il est disponible en trois SKUs‚Äî**Basique**, **Standard** et **Premium**, chacun adapt√© √† des besoins sp√©cifiques des clients :

| **Cas d'utilisation recommand√©** | Petites/Moyennes Entreprises (PME) avec des besoins limit√©s | Utilisation g√©n√©rale en entreprise, filtrage des couches 3‚Äì7 | Environnements hautement sensibles (par exemple, traitement des paiements)  |
| -------------------------------- | ----------------------------------------------------------- | ----------------------------------------------------------- | --------------------------------------------------------- |
| **Performance**                  | Jusqu'√† 250 Mbps de d√©bit                                   | Jusqu'√† 30 Gbps de d√©bit                                    | Jusqu'√† 100 Gbps de d√©bit                                 |
| **Renseignement sur les menaces**| Alertes uniquement                                          | Alertes et blocage (IP/domaines malveillants)              | Alertes et blocage (renseignement sur les menaces avanc√©es) |
| **Filtrage L3‚ÄìL7**              | Filtrage de base                                           | Filtrage √† √©tat √† travers les protocoles                    | Filtrage √† √©tat avec inspection avanc√©e                   |
| **Protection avanc√©e contre les menaces** | Non disponible                                   | Filtrage bas√© sur le renseignement sur les menaces         | Inclut le syst√®me de d√©tection et de pr√©vention des intrusions (IDPS) |
| **Inspection TLS**               | Non disponible                                             | Non disponible                                              | Prend en charge la terminaison TLS entrante/sortante      |
| **Disponibilit√©**                | Backend fixe (2 VMs)                                      | Mise √† l'√©chelle automatique                                 | Mise √† l'√©chelle automatique                               |
| **Facilit√© de gestion**          | Contr√¥les de base                                         | G√©r√© via le Gestionnaire de pare-feu                        | G√©r√© via le Gestionnaire de pare-feu                      |

### Enumeration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

# Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

# Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List Azure Firewalls
Get-AzFirewall

# Get network rules of a firewall
(Get-AzFirewall -Name <FirewallName> -ResourceGroupName <ResourceGroupName>).NetworkRuleCollections

# Get application rules of a firewall
(Get-AzFirewall -Name <FirewallName> -ResourceGroupName <ResourceGroupName>).ApplicationRuleCollections

# Get nat rules of a firewall
(Get-AzFirewall -Name <FirewallName> -ResourceGroupName <ResourceGroupName>).NatRuleCollections
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Tables de routage Azure

Les **Tables de routage Azure** sont utilis√©es pour contr√¥ler le routage du trafic r√©seau au sein d'un sous-r√©seau. Elles d√©finissent des r√®gles qui sp√©cifient comment les paquets doivent √™tre transf√©r√©s, soit vers des ressources Azure, soit vers Internet, soit vers un prochain saut sp√©cifique comme un Appareil Virtuel ou un Pare-feu Azure. Vous pouvez associer une table de routage √† un **sous-r√©seau**, et toutes les ressources au sein de ce sous-r√©seau suivront les routes dans la table.

**Exemple :** Si un sous-r√©seau h√©berge des ressources qui doivent acheminer le trafic sortant via un Appareil Virtuel R√©seau (NVA) pour inspection, vous pouvez cr√©er une **route** dans une table de routage pour rediriger tout le trafic (par exemple, `0.0.0.0/0`) vers l'adresse IP priv√©e du NVA comme prochain saut.

### **√ânum√©ration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List routes for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List Route Tables
Get-AzRouteTable

# List routes for a table
(Get-AzRouteTable -Name <RouteTableName> -ResourceGroupName <ResourceGroupName>).Routes
```
{% endcode %}
{% endtab %}
{% endtabs %}
## Azure Private Link

Azure Private Link est un service dans Azure qui **permet un acc√®s priv√© aux services Azure** en garantissant que **le trafic entre votre r√©seau virtuel Azure (VNet) et le service circule enti√®rement au sein du r√©seau backbone d'Azure de Microsoft**. Cela int√®gre efficacement le service dans votre VNet. Cette configuration am√©liore la s√©curit√© en ne rendant pas les donn√©es accessibles sur Internet public.

Private Link peut √™tre utilis√© avec divers services Azure, comme Azure Storage, Azure SQL Database et des services personnalis√©s partag√©s via Private Link. Il fournit un moyen s√©curis√© de consommer des services depuis votre propre VNet ou m√™me depuis diff√©rentes souscriptions Azure.

{% hint style="danger" %}
Les NSG ne s'appliquent pas aux points de terminaison priv√©s, ce qui signifie clairement qu'associer un NSG √† un sous-r√©seau contenant le Private Link n'aura aucun effet.
{% endhint %}

**Exemple :**

Consid√©rez un sc√©nario o√π vous avez une **base de donn√©es Azure SQL √† laquelle vous souhaitez acc√©der de mani√®re s√©curis√©e depuis votre VNet**. Normalement, cela pourrait impliquer de traverser Internet public. Avec Private Link, vous pouvez cr√©er un **point de terminaison priv√© dans votre VNet** qui se connecte directement au service de base de donn√©es Azure SQL. Ce point de terminaison fait appara√Ætre la base de donn√©es comme si elle faisait partie de votre propre VNet, accessible via une adresse IP priv√©e, garantissant ainsi un acc√®s s√©curis√© et priv√©.

### **√ânum√©ration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List Private Link Services
az network private-link-service list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List Private Endpoints
az network private-endpoint list --query "[].{name:name, location:location, resourceGroup:resourceGroup, privateLinkServiceConnections:privateLinkServiceConnections}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List Private Link Services
Get-AzPrivateLinkService | Select-Object Name, Location, ResourceGroupName

# List Private Endpoints
Get-AzPrivateEndpoint | Select-Object Name, Location, ResourceGroupName, PrivateEndpointConnections
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Points de terminaison de service Azure

Les points de terminaison de service Azure √©tendent l'espace d'adresses priv√©es de votre r√©seau virtuel et l'identit√© de votre VNet aux services Azure via une connexion directe. En activant les points de terminaison de service, **les ressources de votre VNet peuvent se connecter en toute s√©curit√© aux services Azure**, comme Azure Storage et Azure SQL Database, en utilisant le r√©seau de base d'Azure. Cela garantit que le **trafic du VNet vers le service Azure reste au sein du r√©seau Azure**, offrant un chemin plus s√©curis√© et fiable.

**Exemple :**

Par exemple, un **compte Azure Storage** est par d√©faut accessible via Internet public. En activant un **point de terminaison de service pour Azure Storage au sein de votre VNet**, vous pouvez vous assurer que seul le trafic de votre VNet peut acc√©der au compte de stockage. Le pare-feu du compte de stockage peut alors √™tre configur√© pour accepter le trafic uniquement de votre VNet.

### **√ânum√©ration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List Virtual Networks with Service Endpoints
az network vnet list --query "[].{name:name, location:location, serviceEndpoints:serviceEndpoints}" -o table

# List Subnets with Service Endpoints
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, serviceEndpoints:serviceEndpoints}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List Virtual Networks with Service Endpoints
Get-AzVirtualNetwork

# List Subnets with Service Endpoints
(Get-AzVirtualNetwork -ResourceGroupName <ResourceGroupName> -Name <VNetName>).Subnets
```
{% endcode %}
{% endtab %}
{% endtabs %}

### Diff√©rences entre les points de terminaison de service et les liens priv√©s

Microsoft recommande d'utiliser les liens priv√©s dans les [**docs**](https://learn.microsoft.com/en-us/azure/virtual-network/vnet-integration-for-azure-services#compare-private-endpoints-and-service-endpoints):

<figure><img src="../../../../.gitbook/assets/image (25).png" alt=""><figcaption></figcaption></figure>

**Points de terminaison de service :**

* Le trafic de votre VNet vers le service Azure circule sur le r√©seau backbone de Microsoft Azure, contournant l'internet public.
* Le point de terminaison est une connexion directe au service Azure et ne fournit pas d'IP priv√©e pour le service au sein du VNet.
* Le service lui-m√™me est toujours accessible via son point de terminaison public depuis l'ext√©rieur de votre VNet, sauf si vous configurez le pare-feu du service pour bloquer ce type de trafic.
* C'est une relation un √† un entre le sous-r√©seau et le service Azure.
* Moins co√ªteux que les liens priv√©s.

**Liens priv√©s :**

* Le lien priv√© mappe les services Azure dans votre VNet via un point de terminaison priv√©, qui est une interface r√©seau avec une adresse IP priv√©e au sein de votre VNet.
* Le service Azure est accessible en utilisant cette adresse IP priv√©e, ce qui le fait appara√Ætre comme s'il faisait partie de votre r√©seau.
* Les services connect√©s via le lien priv√© ne peuvent √™tre accessibles que depuis votre VNet ou des r√©seaux connect√©s ; il n'y a pas d'acc√®s √† internet public au service.
* Il permet une connexion s√©curis√©e aux services Azure ou √† vos propres services h√©berg√©s dans Azure, ainsi qu'une connexion aux services partag√©s par d'autres.
* Il fournit un contr√¥le d'acc√®s plus granulaire via un point de terminaison priv√© dans votre VNet, par opposition √† un contr√¥le d'acc√®s plus large au niveau du sous-r√©seau avec des points de terminaison de service.

En r√©sum√©, bien que les points de terminaison de service et les liens priv√©s offrent une connectivit√© s√©curis√©e aux services Azure, **les liens priv√©s offrent un niveau d'isolation et de s√©curit√© sup√©rieur en garantissant que les services sont accessibles de mani√®re priv√©e sans les exposer √† l'internet public**. Les points de terminaison de service, en revanche, sont plus faciles √† configurer pour des cas g√©n√©raux o√π un acc√®s simple et s√©curis√© aux services Azure est requis sans avoir besoin d'une IP priv√©e dans le VNet.

## Azure Front Door (AFD) & AFD WAF

**Azure Front Door** est un point d'entr√©e √©volutif et s√©curis√© pour **une livraison rapide** de vos applications web mondiales. Il **combine** divers services tels que l'**√©quilibrage de charge mondial, l'acc√©l√©ration de site, le d√©chargement SSL et les capacit√©s de pare-feu d'application web (WAF)** en un seul service. Azure Front Door fournit un routage intelligent bas√© sur la **localisation de bord la plus proche de l'utilisateur**, garantissant des performances et une fiabilit√© optimales. De plus, il offre un routage bas√© sur l'URL, l'h√©bergement de plusieurs sites, l'affinit√© de session et la s√©curit√© au niveau de l'application.

**Azure Front Door WAF** est con√ßu pour **prot√©ger les applications web contre les attaques bas√©es sur le web** sans modification du code de back-end. Il inclut des r√®gles personnalis√©es et des ensembles de r√®gles g√©r√©es pour se prot√©ger contre des menaces telles que l'injection SQL, le scripting intersite et d'autres attaques courantes.

**Exemple :**

Imaginez que vous avez une application distribu√©e mondialement avec des utilisateurs partout dans le monde. Vous pouvez utiliser Azure Front Door pour **diriger les demandes des utilisateurs vers le centre de donn√©es r√©gional le plus proche** h√©bergeant votre application, r√©duisant ainsi la latence, am√©liorant l'exp√©rience utilisateur et **la prot√©geant contre les attaques web avec les capacit√©s WAF**. Si une r√©gion particuli√®re conna√Æt une panne, Azure Front Door peut automatiquement rediriger le trafic vers le meilleur emplacement suivant, garantissant une haute disponibilit√©.

### √ânum√©ration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List Azure Front Door Instances
az network front-door list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

# List Front Door WAF Policies
az network front-door waf-policy list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List Azure Front Door Instances
Get-AzFrontDoor

# List Front Door WAF Policies
Get-AzFrontDoorWafPolicy -Name <policyName> -ResourceGroupName <resourceGroupName>
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Azure Application Gateway et Azure Application Gateway WAF

Azure Application Gateway est un **√©quilibreur de charge de trafic web** qui vous permet de g√©rer le trafic vers vos **applications** web. Il offre des **capacit√©s d'√©quilibrage de charge de couche 7, de terminaison SSL et de pare-feu d'application web (WAF)** dans le contr√¥leur de livraison d'application (ADC) en tant que service. Les fonctionnalit√©s cl√©s incluent le routage bas√© sur l'URL, l'affinit√© de session bas√©e sur les cookies et le d√©chargement de la couche de sockets s√©curis√©s (SSL), qui sont cruciaux pour les applications n√©cessitant des capacit√©s d'√©quilibrage de charge complexes telles que le routage global et le routage bas√© sur le chemin.

**Exemple :**

Consid√©rez un sc√©nario o√π vous avez un site web de commerce √©lectronique qui comprend plusieurs sous-domaines pour diff√©rentes fonctions, telles que les comptes utilisateurs et le traitement des paiements. Azure Application Gateway peut **router le trafic vers les serveurs web appropri√©s en fonction du chemin de l'URL**. Par exemple, le trafic vers `example.com/accounts` pourrait √™tre dirig√© vers le service des comptes utilisateurs, et le trafic vers `example.com/pay` pourrait √™tre dirig√© vers le service de traitement des paiements.\
Et **prot√©gez votre site web contre les attaques en utilisant les capacit√©s WAF.**

### **√ânum√©ration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List the Web Application Firewall configurations for your Application Gateways
az network application-gateway waf-config list --gateway-name <AppGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, firewallMode:firewallMode, ruleSetType:ruleSetType, ruleSetVersion:ruleSetVersion}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List the Web Application Firewall configurations for your Application Gateways
(Get-AzApplicationGateway -Name <AppGatewayName> -ResourceGroupName <ResourceGroupName>).WebApplicationFirewallConfiguration
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Azure Hub, Spoke & VNet Peering

**VNet Peering** est une fonctionnalit√© de mise en r√©seau dans Azure qui **permet √† diff√©rents R√©seaux Virtuels (VNets) d'√™tre connect√©s directement et de mani√®re transparente**. Gr√¢ce au VNet peering, les ressources dans un VNet peuvent communiquer avec les ressources dans un autre VNet en utilisant des adresses IP priv√©es, **comme si elles √©taient dans le m√™me r√©seau**.\
**Le VNet Peering peut √©galement √™tre utilis√© avec des r√©seaux sur site** en configurant un VPN site-√†-site ou Azure ExpressRoute.

**Azure Hub and Spoke** est une topologie de r√©seau utilis√©e dans Azure pour g√©rer et organiser le trafic r√©seau. **Le "hub" est un point central qui contr√¥le et dirige le trafic entre diff√©rents "spokes"**. Le hub contient g√©n√©ralement des services partag√©s tels que des appliances virtuelles r√©seau (NVA), Azure VPN Gateway, Azure Firewall ou Azure Bastion. Les **"spokes" sont des VNets qui h√©bergent des charges de travail et se connectent au hub via le VNet peering**, leur permettant de tirer parti des services partag√©s au sein du hub. Ce mod√®le favorise une disposition r√©seau claire, r√©duisant la complexit√© en centralisant les services communs que plusieurs charges de travail √† travers diff√©rents VNets peuvent utiliser.

{% hint style="danger" %}
**Le couplage VNET est non transitif dans Azure**, ce qui signifie que si le spoke 1 est connect√© au spoke 2 et que le spoke 2 est connect√© au spoke 3, alors le spoke 1 ne peut pas communiquer directement avec le spoke 3.
{% endhint %}

**Exemple :**

Imaginez une entreprise avec des d√©partements s√©par√©s comme Ventes, RH et D√©veloppement, **chacun avec son propre VNet (les spokes)**. Ces VNets **ont besoin d'acc√©der √† des ressources partag√©es** comme une base de donn√©es centrale, un pare-feu et une passerelle Internet, qui se trouvent tous dans **un autre VNet (le hub)**. En utilisant le mod√®le Hub and Spoke, chaque d√©partement peut **se connecter en toute s√©curit√© aux ressources partag√©es via le VNet hub sans exposer ces ressources √† Internet public** ou cr√©er une structure r√©seau complexe avec de nombreuses connexions.

### √ânum√©ration

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List all VNets in your subscription
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}" -o table

# List VNet peering connections for a given VNet
az network vnet peering list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, peeringState:peeringState, remoteVnetId:remoteVnetId}" -o table

# List Shared Resources (e.g., Azure Firewall) in the Hub
az network firewall list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List all VNets in your subscription
Get-AzVirtualNetwork

# List VNet peering connections for a given VNet
(Get-AzVirtualNetwork -ResourceGroupName <ResourceGroupName> -Name <VNetName>).VirtualNetworkPeerings

# List Shared Resources (e.g., Azure Firewall) in the Hub
Get-AzFirewall
```
{% endcode %}
{% endtab %}
{% endtabs %}

## VPN Site-√†-Site

Un VPN Site-√†-Site dans Azure vous permet de **connecter votre r√©seau local √† votre R√©seau Virtuel Azure (VNet)**, permettant aux ressources telles que les VM dans Azure d'appara√Ætre comme si elles √©taient sur votre r√©seau local. Cette connexion est √©tablie via une **passerelle VPN qui crypte le trafic** entre les deux r√©seaux.

**Exemple :**

Une entreprise dont le bureau principal est situ√© √† New York dispose d'un centre de donn√©es sur site qui doit se connecter de mani√®re s√©curis√©e √† son VNet dans Azure, qui h√©berge ses charges de travail virtualis√©es. En configurant un **VPN Site-√†-Site, l'entreprise peut garantir une connectivit√© crypt√©e entre les serveurs sur site et les VM Azure**, permettant d'acc√©der aux ressources de mani√®re s√©curis√©e √† travers les deux environnements comme si elles √©taient sur le m√™me r√©seau local.

### **√ânum√©ration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List VPN Gateways
az network vnet-gateway list --query "[].{name:name, location:location, resourceGroup:resourceGroup}" -o table

# List VPN Connections
az network vpn-connection list --gateway-name <VpnGatewayName> --resource-group <ResourceGroupName> --query "[].{name:name, connectionType:connectionType, connectionStatus:connectionStatus}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List VPN Gateways
Get-AzVirtualNetworkGateway -ResourceGroupName <ResourceGroupName>

# List VPN Connections
Get-AzVirtualNetworkGatewayConnection -ResourceGroupName <ResourceGroupName>
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Azure ExpressRoute

Azure ExpressRoute est un service qui fournit une **connexion priv√©e, d√©di√©e et √† haute vitesse entre votre infrastructure sur site et les centres de donn√©es Azure**. Cette connexion est √©tablie par l'interm√©diaire d'un fournisseur de connectivit√©, contournant l'internet public et offrant plus de fiabilit√©, des vitesses plus rapides, des latences plus faibles et une s√©curit√© accrue par rapport aux connexions internet typiques.

**Exemple :**

Une multinationale n√©cessite une **connexion coh√©rente et fiable √† ses services Azure en raison du volume √©lev√© de donn√©es** et du besoin d'un d√©bit √©lev√©. L'entreprise opte pour Azure ExpressRoute afin de connecter directement son centre de donn√©es sur site √† Azure, facilitant les transferts de donn√©es √† grande √©chelle, tels que les sauvegardes quotidiennes et l'analyse de donn√©es en temps r√©el, avec une confidentialit√© et une vitesse am√©lior√©es.

### **√ânum√©ration**

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List ExpressRoute Circuits
az network express-route list --query "[].{name:name, location:location, resourceGroup:resourceGroup, serviceProviderName:serviceProviderName, peeringLocation:peeringLocation}" -o table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List ExpressRoute Circuits
Get-AzExpressRouteCircuit
```
{% endcode %}
{% endtab %}
{% endtabs %}

{% hint style="success" %}
Apprenez et pratiquez le hacking AWS :<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team AWS (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Apprenez et pratiquez le hacking GCP : <img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Formation Expert Red Team GCP (GRTE)**<img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Soutenir HackTricks</summary>

* Consultez les [**plans d'abonnement**](https://github.com/sponsors/carlospolop)!
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez-nous sur** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Partagez des astuces de hacking en soumettant des PRs aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts github.

</details>
{% endhint %}
