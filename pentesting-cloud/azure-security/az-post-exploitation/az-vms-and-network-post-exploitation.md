# Az - VMs & Network Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## VMs & Network

–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ Azure VMs —Ç–∞ –º–µ—Ä–µ–∂—ñ –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É:

{% content-ref url="../az-services/vms/" %}
[vms](../az-services/vms/)
{% endcontent-ref %}

### VM Application Pivoting

VM-–¥–æ–¥–∞—Ç–∫–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Å–ø—ñ–ª—å–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –∑ —ñ–Ω—à–∏–º–∏ –ø—ñ–¥–ø–∏—Å–∫–∞–º–∏ —Ç–∞ –æ—Ä–µ–Ω–¥–∞—Ä—è–º–∏. –Ø–∫—â–æ –¥–æ–¥–∞—Ç–æ–∫ –¥—ñ–ª–∏—Ç—å—Å—è, –π–º–æ–≤—ñ—Ä–Ω–æ, —Ü–µ —Ç–æ–º—É, —â–æ –π–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å. –¢–æ–º—É, —è–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∑–º–æ–∂–µ **–∑–ª–∞–º–∞—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫ —ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤–µ—Ä—Å—ñ—é –∑ –±–µ–∫–¥–æ—Ä–æ–º**, –º–æ–∂–ª–∏–≤–æ, —â–æ –≤–æ–Ω–∞ –±—É–¥–µ **–≤–∏–∫–æ–Ω–∞–Ω–∞ –≤ —ñ–Ω—à–æ–º—É –æ—Ä–µ–Ω–¥–∞—Ä—ñ –∞–±–æ –ø—ñ–¥–ø–∏—Å—Ü—ñ**.

### Sensitive information in images

–ú–æ–∂–ª–∏–≤–æ, —â–æ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ **—á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω—å**, –∑—Ä–æ–±–ª–µ–Ω–∏—Ö –∑ VMs —É –º–∏–Ω—É–ª–æ–º—É.

1. **–°–ø–∏—Å–æ–∫ –∑–æ–±—Ä–∞–∂–µ–Ω—å** –∑ –≥–∞–ª–µ—Ä–µ–π
```bash
# Get galleries
az sig list -o table

# List images inside gallery
az sig image-definition list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
-o table

# Get images versions
az sig image-version list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
--gallery-image-definition <IMAGE_DEFINITION> \
-o table
```
2. **–°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö –∑–æ–±—Ä–∞–∂–µ–Ω—å**
```bash
az image list -o table
```
3. **–°—Ç–≤–æ—Ä–∏—Ç–∏ VM –∑ ID –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è** —Ç–∞ —à—É–∫–∞—Ç–∏ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –Ω—å–æ–≥–æ
```bash
# Create VM from image
az vm create \
--resource-group <RESOURCE_GROUP> \
--name <VM_NAME> \
--image /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/galleries/<GALLERY_NAME>/images/<IMAGE_DEFINITION>/versions/<IMAGE_VERSION> \
--admin-username <ADMIN_USERNAME> \
--generate-ssh-keys
```
### –ß—É—Ç–ª–∏–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤ —Ç–æ—á–∫–∞—Ö –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è

–ú–æ–∂–ª–∏–≤–æ, —â–æ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ **—á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ç–æ—á–æ–∫ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è**.

1. **–°–ø–∏—Å–æ–∫ —Ç–æ—á–æ–∫ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è**
```bash
az restore-point list \
--resource-group <RESOURCE_GROUP> \
--restore-point-collection-name <COLLECTION_NAME> \
-o table
```
2. **–°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–∏—Å–∫** –∑ —Ç–æ—á–∫–∏ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è

{% code overflow="wrap" %}
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <NEW_DISK_NAME> \
--source /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/restorePointCollections/<COLLECTION_NAME>/restorePoints/<RESTORE_POINT_NAME>
```
{% endcode %}

3. **–ü—Ä–∏–∫—Ä—ñ–ø—ñ—Ç—å –¥–∏—Å–∫ –¥–æ –í–ú** (–∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –ø–æ–≤–∏–Ω–µ–Ω –≤–∂–µ –∑–ª–∞–º–∞—Ç–∏ –í–ú –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É)
```bash
az vm disk attach \
--resource-group <RESOURCE_GROUP> \
--vm-name <VM_NAME> \
--name <DISK_NAME>
```
4. **–ü—ñ–¥–∫–ª—é—á—ñ—Ç—å** –¥–∏—Å–∫ —ñ **—à—É–∫–∞–π—Ç–µ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é**

{% tabs %}
{% tab title="Linux" %}
```bash
# List all available disks
sudo fdisk -l

# Check disk format
sudo file -s /dev/sdX

# Mount it
sudo mkdir /mnt/mydisk
sudo mount /dev/sdX1 /mnt/mydisk
```
{% endtab %}

{% tab title="Windows" %}
#### **1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –ö–µ—Ä—É–≤–∞–Ω–Ω—è –¥–∏—Å–∫–∞–º–∏**

1. –ö–ª–∞—Ü–Ω—ñ—Ç—å –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ **–ü—É—Å–∫** —ñ –≤–∏–±–µ—Ä—ñ—Ç—å **–ö–µ—Ä—É–≤–∞–Ω–Ω—è –¥–∏—Å–∫–∞–º–∏**.
2. –ü—Ä–∏—î–¥–Ω–∞–Ω–∏–π –¥–∏—Å–∫ –ø–æ–≤–∏–Ω–µ–Ω –∑'—è–≤–∏—Ç–∏—Å—è —è–∫ **–û—Ñ–ª–∞–π–Ω** –∞–±–æ **–ù–µ–≤–∏–¥—ñ–ª–µ–Ω–∏–π**.

#### **2. –ü–µ—Ä–µ–≤–µ–¥—ñ—Ç—å –¥–∏—Å–∫ –≤ –æ–Ω–ª–∞–π–Ω**

1. –ó–Ω–∞–π–¥—ñ—Ç—å –¥–∏—Å–∫ —É –Ω–∏–∂–Ω—ñ–π –ø–∞–Ω–µ–ª—ñ.
2. –ö–ª–∞—Ü–Ω—ñ—Ç—å –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ –¥–∏—Å–∫ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, **–î–∏—Å–∫ 1**) —ñ –≤–∏–±–µ—Ä—ñ—Ç—å **–û–Ω–ª–∞–π–Ω**.

#### **3. –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–π—Ç–µ –¥–∏—Å–∫**

1. –Ø–∫—â–æ –¥–∏—Å–∫ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π, –∫–ª–∞—Ü–Ω—ñ—Ç—å –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ —ñ –≤–∏–±–µ—Ä—ñ—Ç—å **–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–∏—Å–∫**.
2. –í–∏–±–µ—Ä—ñ—Ç—å —Å—Ç–∏–ª—å —Ä–æ–∑–¥—ñ–ª—É:
* **MBR** (–û—Å–Ω–æ–≤–Ω–∏–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª—å–Ω–∏–π –∑–∞–ø–∏—Å) –∞–±–æ **GPT** (GUID —Ç–∞–±–ª–∏—Ü—è —Ä–æ–∑–¥—ñ–ª—ñ–≤). –†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ GPT –¥–ª—è —Å—É—á–∞—Å–Ω–∏—Ö —Å–∏—Å—Ç–µ–º.

#### **4. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π —Ç–æ–º**

1. –ö–ª–∞—Ü–Ω—ñ—Ç—å –ø—Ä–∞–≤–æ—é –∫–Ω–æ–ø–∫–æ—é –º–∏—à—ñ –Ω–∞ –Ω–µ–≤–∏–¥—ñ–ª–µ–Ω–æ–º—É –ø—Ä–æ—Å—Ç–æ—Ä—ñ –Ω–∞ –¥–∏—Å–∫—É —ñ –≤–∏–±–µ—Ä—ñ—Ç—å **–ù–æ–≤–∏–π –ø—Ä–æ—Å—Ç–∏–π —Ç–æ–º**.
2. –°–ª—ñ–¥—É–π—Ç–µ –º–∞–π—Å—Ç—Ä—É –¥–ª—è:
* –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ª—ñ—Ç–µ—Ä–∏ –¥–∏—Å–∫–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `D:`).
* –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–∏—Å–∫–∞ (–≤–∏–±–µ—Ä—ñ—Ç—å NTFS —É –±—ñ–ª—å—à–æ—Å—Ç—ñ –≤–∏–ø–∞–¥–∫—ñ–≤).
{% endtab %}
{% endtabs %}

### –ß—É—Ç–ª–∏–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –Ω–∞ –¥–∏—Å–∫–∞—Ö —Ç–∞ –∑–Ω—ñ–º–∫–∞—Ö

–ú–æ–∂–ª–∏–≤–æ, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **—á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –¥–∏—Å–∫—ñ–≤ –∞–±–æ –Ω–∞–≤—ñ—Ç—å —Å—Ç–∞—Ä–∏—Ö –∑–Ω—ñ–º–∫—ñ–≤ –¥–∏—Å–∫—ñ–≤**.

1. **–°–ø–∏—Å–æ–∫ –∑–Ω—ñ–º–∫—ñ–≤**
```bash
az snapshot list \
--resource-group <RESOURCE_GROUP> \
-o table
```
2. **–°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–∏—Å–∫ –∑ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–Ω—ñ–º–∫–∞** (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <DISK_NAME> \
--source <SNAPSHOT_ID> \
--size-gb <DISK_SIZE>
```
3. **–ü—Ä–∏–∫—Ä—ñ–ø—ñ—Ç—å —ñ –∑–º–æ–Ω—Ç—É–π—Ç–µ –¥–∏—Å–∫** –¥–æ –í–ú —ñ —à—É–∫–∞–π—Ç–µ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é (–ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑–¥—ñ–ª, —â–æ–± –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —è–∫ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏)

### –ß—É—Ç–ª–∏–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è—Ö –í–ú —Ç–∞ –¥–æ–¥–∞—Ç–∫–∞—Ö –í–ú

–ú–æ–∂–ª–∏–≤–æ, –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **—á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä–æ–∑—à–∏—Ä–µ–Ω—å –í–ú —Ç–∞ –¥–æ–¥–∞—Ç–∫—ñ–≤ –í–ú**.

1. **–°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –¥–æ–¥–∞—Ç–∫—ñ–≤ –í–ú**

{% code overflow="wrap" %}
```bash
## List all VM applications inside a gallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table
```
{% endcode %}

2. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —É –≤—ñ—Ä—Ç—É–∞–ª—å–Ω—ñ–π –º–∞—à–∏–Ω—ñ —Ç–∞ **—à—É–∫–∞–π—Ç–µ —á—É—Ç–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é**

{% code overflow="wrap" %}
```bash
az vm application set \
--resource-group <rsc-group> \
--name <vm-name> \
--app-version-ids /subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.Compute/galleries/myGallery/applications/myReverseShellApp/versions/1.0.2 \
--treat-deployment-as-failure true
```
{% endcode %}

{% hint style="success" %}
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
–í–∏–≤—á–∞–π—Ç–µ —Ç–∞ –ø—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>–ü—ñ–¥—Ç—Ä–∏–º–∞–π—Ç–µ HackTricks</summary>

* –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ø–ª–∞–Ω–∏ –ø—ñ–¥–ø–∏—Å–∫–∏**](https://github.com/sponsors/carlospolop)!
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **–î—ñ–ª—ñ—Ç—å—Å—è —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ github.

</details>
{% endhint %}
