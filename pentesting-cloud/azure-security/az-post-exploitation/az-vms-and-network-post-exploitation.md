# Az - VMs & Network Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## VMs & Network

Azure VMs ë° ë„¤íŠ¸ì›Œí‚¹ì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒ í˜ì´ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../az-services/vms/" %}
[vms](../az-services/vms/)
{% endcontent-ref %}

### VM Application Pivoting

VM ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ë‹¤ë¥¸ êµ¬ë… ë° í…Œë„ŒíŠ¸ì™€ ê³µìœ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ê³µìœ ë˜ê³  ìˆë‹¤ë©´, ì•„ë§ˆë„ ì‚¬ìš©ë˜ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ê³µê²©ìê°€ **ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì†ìƒì‹œí‚¤ê³  ë°±ë„ì–´ê°€ í¬í•¨ëœ** ë²„ì „ì„ ì—…ë¡œë“œí•˜ë©´ **ë‹¤ë¥¸ í…Œë„ŒíŠ¸ë‚˜ êµ¬ë…ì—ì„œ ì‹¤í–‰ë  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤**.

### Sensitive information in images

ê³¼ê±°ì— VMì—ì„œ ì´¬ì˜ëœ **ì´ë¯¸ì§€ ì•ˆì— ë¯¼ê°í•œ ì •ë³´**ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. **ê°¤ëŸ¬ë¦¬ì—ì„œ ì´ë¯¸ì§€ ëª©ë¡**
```bash
# Get galleries
az sig list -o table

# List images inside gallery
az sig image-definition list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
-o table

# Get images versions
az sig image-version list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
--gallery-image-definition <IMAGE_DEFINITION> \
-o table
```
2. **ì‚¬ìš©ì ì •ì˜ ì´ë¯¸ì§€ ëª©ë¡**
```bash
az image list -o table
```
3. **ì´ë¯¸ì§€ IDë¡œ VM ìƒì„±** ë° ê·¸ ì•ˆì—ì„œ ë¯¼ê°í•œ ì •ë³´ ê²€ìƒ‰
```bash
# Create VM from image
az vm create \
--resource-group <RESOURCE_GROUP> \
--name <VM_NAME> \
--image /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/galleries/<GALLERY_NAME>/images/<IMAGE_DEFINITION>/versions/<IMAGE_VERSION> \
--admin-username <ADMIN_USERNAME> \
--generate-ssh-keys
```
### ë³µì› ì§€ì ì˜ ë¯¼ê°í•œ ì •ë³´

**ë³µì› ì§€ì  ì•ˆì— ë¯¼ê°í•œ ì •ë³´**ë¥¼ ì°¾ì„ ìˆ˜ ìˆì„ì§€ë„ ëª¨ë¦…ë‹ˆë‹¤.

1. **ë³µì› ì§€ì  ë‚˜ì—´**
```bash
az restore-point list \
--resource-group <RESOURCE_GROUP> \
--restore-point-collection-name <COLLECTION_NAME> \
-o table
```
2. **ë³µì› ì§€ì ì—ì„œ ë””ìŠ¤í¬ ìƒì„±í•˜ê¸°**

{% code overflow="wrap" %}
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <NEW_DISK_NAME> \
--source /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/restorePointCollections/<COLLECTION_NAME>/restorePoints/<RESTORE_POINT_NAME>
```
{% endcode %}

3. **ë””ìŠ¤í¬ë¥¼ VMì— ì—°ê²°í•˜ê¸°** (ê³µê²©ìëŠ” ì´ë¯¸ ê³„ì • ë‚´ì—ì„œ VMì„ ì¹¨í•´í•´ì•¼ í•¨)
```bash
az vm disk attach \
--resource-group <RESOURCE_GROUP> \
--vm-name <VM_NAME> \
--name <DISK_NAME>
```
4. **ë””ìŠ¤í¬ë¥¼ ë§ˆìš´íŠ¸**í•˜ê³  **ë¯¼ê°í•œ ì •ë³´ ê²€ìƒ‰**

{% tabs %}
{% tab title="Linux" %}
```bash
# List all available disks
sudo fdisk -l

# Check disk format
sudo file -s /dev/sdX

# Mount it
sudo mkdir /mnt/mydisk
sudo mount /dev/sdX1 /mnt/mydisk
```
{% endtab %}

{% tab title="Windows" %}
#### **1. ë””ìŠ¤í¬ ê´€ë¦¬ ì—´ê¸°**

1. **ì‹œì‘**ì„ ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ ë²„íŠ¼ìœ¼ë¡œ í´ë¦­í•˜ê³  **ë””ìŠ¤í¬ ê´€ë¦¬**ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
2. ì—°ê²°ëœ ë””ìŠ¤í¬ê°€ **ì˜¤í”„ë¼ì¸** ë˜ëŠ” **í• ë‹¹ë˜ì§€ ì•ŠìŒ**ìœ¼ë¡œ í‘œì‹œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

#### **2. ë””ìŠ¤í¬ ì˜¨ë¼ì¸ìœ¼ë¡œ ì „í™˜**

1. í•˜ë‹¨ ì°½ì—ì„œ ë””ìŠ¤í¬ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
2. ë””ìŠ¤í¬(ì˜ˆ: **ë””ìŠ¤í¬ 1**)ë¥¼ ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ ë²„íŠ¼ìœ¼ë¡œ í´ë¦­í•˜ê³  **ì˜¨ë¼ì¸**ì„ ì„ íƒí•©ë‹ˆë‹¤.

#### **3. ë””ìŠ¤í¬ ì´ˆê¸°í™”**

1. ë””ìŠ¤í¬ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ê²½ìš°, ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ ë²„íŠ¼ì„ í´ë¦­í•˜ê³  **ë””ìŠ¤í¬ ì´ˆê¸°í™”**ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
2. íŒŒí‹°ì…˜ ìŠ¤íƒ€ì¼ì„ ì„ íƒí•©ë‹ˆë‹¤:
* **MBR** (ë§ˆìŠ¤í„° ë¶€íŠ¸ ë ˆì½”ë“œ) ë˜ëŠ” **GPT** (GUID íŒŒí‹°ì…˜ í…Œì´ë¸”). í˜„ëŒ€ ì‹œìŠ¤í…œì—ëŠ” GPTë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.

#### **4. ìƒˆ ë³¼ë¥¨ ë§Œë“¤ê¸°**

1. ë””ìŠ¤í¬ì˜ í• ë‹¹ë˜ì§€ ì•Šì€ ê³µê°„ì„ ë§ˆìš°ìŠ¤ ì˜¤ë¥¸ìª½ ë²„íŠ¼ìœ¼ë¡œ í´ë¦­í•˜ê³  **ìƒˆ ë‹¨ìˆœ ë³¼ë¥¨**ì„ ì„ íƒí•©ë‹ˆë‹¤.
2. ë§ˆë²•ì‚¬ë¥¼ ë”°ë¼:
* ë“œë¼ì´ë¸Œ ë¬¸ì í• ë‹¹ (ì˜ˆ: `D:`).
* ë””ìŠ¤í¬ í¬ë§· (ëŒ€ë¶€ë¶„ì˜ ê²½ìš° NTFS ì„ íƒ).
{% endtab %}
{% endtabs %}

### ë””ìŠ¤í¬ ë° ìŠ¤ëƒ…ìƒ·ì˜ ë¯¼ê°í•œ ì •ë³´

**ë””ìŠ¤í¬ ë˜ëŠ” ì´ì „ ë””ìŠ¤í¬ì˜ ìŠ¤ëƒ…ìƒ· ì•ˆì— ë¯¼ê°í•œ ì •ë³´ë¥¼ ì°¾ëŠ” ê²ƒì´ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

1. **ìŠ¤ëƒ…ìƒ· ëª©ë¡**
```bash
az snapshot list \
--resource-group <RESOURCE_GROUP> \
-o table
```
2. **ìŠ¤ëƒ…ìƒ·ì—ì„œ ë””ìŠ¤í¬ ìƒì„±** (í•„ìš”í•œ ê²½ìš°)
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <DISK_NAME> \
--source <SNAPSHOT_ID> \
--size-gb <DISK_SIZE>
```
3. **ë””ìŠ¤í¬ë¥¼ VMì— ì—°ê²°í•˜ê³  ë§ˆìš´íŠ¸**í•˜ì—¬ ë¯¼ê°í•œ ì •ë³´ë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤ (ì´ ë°©ë²•ì— ëŒ€í•œ ë‚´ìš©ì€ ì´ì „ ì„¹ì…˜ì„ í™•ì¸í•˜ì„¸ìš”)

### VM í™•ì¥ ë° VM ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¯¼ê°í•œ ì •ë³´

**VM í™•ì¥ ë° VM ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ì—ì„œ ë¯¼ê°í•œ ì •ë³´ë¥¼ ì°¾ëŠ” ê²ƒì´ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

1. **ëª¨ë“  VM ì•± ë‚˜ì—´**

{% code overflow="wrap" %}
```bash
## List all VM applications inside a gallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table
```
{% endcode %}

2. VMì— í™•ì¥ì„ ì„¤ì¹˜í•˜ê³  **ë¯¼ê°í•œ ì •ë³´ ê²€ìƒ‰**

{% code overflow="wrap" %}
```bash
az vm application set \
--resource-group <rsc-group> \
--name <vm-name> \
--app-version-ids /subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.Compute/galleries/myGallery/applications/myReverseShellApp/versions/1.0.2 \
--treat-deployment-as-failure true
```
{% endcode %}

{% hint style="success" %}
AWS í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP í•´í‚¹ ë°°ìš°ê¸° ë° ì—°ìŠµí•˜ê¸°: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ê¸°!
* **ğŸ’¬ [**Discord ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŠ¸ë¦­ì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
