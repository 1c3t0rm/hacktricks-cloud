# Az - VMs & Network Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## VMs & Network

Aby uzyskaÄ‡ wiÄ™cej informacji na temat maszyn wirtualnych Azure i sieci, sprawdÅº nastÄ™pujÄ…cÄ… stronÄ™:

{% content-ref url="../az-services/vms/" %}
[vms](../az-services/vms/)
{% endcontent-ref %}

### VM Application Pivoting

Aplikacje VM mogÄ… byÄ‡ udostÄ™pniane innym subskrypcjom i najemcom. JeÅ›li aplikacja jest udostÄ™pniana, prawdopodobnie dlatego, Å¼e jest uÅ¼ywana. JeÅ›li wiÄ™c atakujÄ…cy zdoÅ‚a **skompromitowaÄ‡ aplikacjÄ™ i przesÅ‚aÄ‡ wersjÄ™ z backdoorem**, moÅ¼e byÄ‡ moÅ¼liwe, Å¼e zostanie ona **wykonana w innym najemcy lub subskrypcji**.

### Sensitive information in images

MoÅ¼liwe, Å¼e moÅ¼na znaleÅºÄ‡ **wraÅ¼liwe informacje w obrazach** pobranych z maszyn wirtualnych w przeszÅ‚oÅ›ci.

1. **Lista obrazÃ³w** z galerii
```bash
# Get galleries
az sig list -o table

# List images inside gallery
az sig image-definition list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
-o table

# Get images versions
az sig image-version list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
--gallery-image-definition <IMAGE_DEFINITION> \
-o table
```
2. **Lista niestandardowych obrazÃ³w**
```bash
az image list -o table
```
3. **UtwÃ³rz VM z identyfikatorem obrazu** i przeszukaj go w poszukiwaniu wraÅ¼liwych informacji.
```bash
# Create VM from image
az vm create \
--resource-group <RESOURCE_GROUP> \
--name <VM_NAME> \
--image /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/galleries/<GALLERY_NAME>/images/<IMAGE_DEFINITION>/versions/<IMAGE_VERSION> \
--admin-username <ADMIN_USERNAME> \
--generate-ssh-keys
```
### WraÅ¼liwe informacje w punktach przywracania

MoÅ¼liwe, Å¼e moÅ¼na znaleÅºÄ‡ **wraÅ¼liwe informacje wewnÄ…trz punktÃ³w przywracania**.

1. **Lista punktÃ³w przywracania**
```bash
az restore-point list \
--resource-group <RESOURCE_GROUP> \
--restore-point-collection-name <COLLECTION_NAME> \
-o table
```
2. **UtwÃ³rz dysk** z punktu przywracania

{% code overflow="wrap" %}
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <NEW_DISK_NAME> \
--source /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/restorePointCollections/<COLLECTION_NAME>/restorePoints/<RESTORE_POINT_NAME>
```
{% endcode %}

3. **PodÅ‚Ä…cz dysk do VM** (atakujÄ…cy musi juÅ¼ mieÄ‡ skompromitowanÄ… VM w obrÄ™bie konta)
```bash
az vm disk attach \
--resource-group <RESOURCE_GROUP> \
--vm-name <VM_NAME> \
--name <DISK_NAME>
```
4. **Zamontuj** dysk i **przeszukaj w poszukiwaniu wraÅ¼liwych informacji**

{% tabs %}
{% tab title="Linux" %}
```bash
# List all available disks
sudo fdisk -l

# Check disk format
sudo file -s /dev/sdX

# Mount it
sudo mkdir /mnt/mydisk
sudo mount /dev/sdX1 /mnt/mydisk
```
{% endtab %}

{% tab title="Windows" %}
#### **1. OtwÃ³rz ZarzÄ…dzanie dyskami**

1. Kliknij prawym przyciskiem myszy **Start** i wybierz **ZarzÄ…dzanie dyskami**.
2. PodÅ‚Ä…czony dysk powinien pojawiÄ‡ siÄ™ jako **Offline** lub **Nieprzydzielony**.

#### **2. WÅ‚Ä…cz dysk**

1. Zlokalizuj dysk w dolnym panelu.
2. Kliknij prawym przyciskiem myszy na dysk (np. **Dysk 1**) i wybierz **Online**.

#### **3. Zainicjuj dysk**

1. JeÅ›li dysk nie jest zainicjowany, kliknij prawym przyciskiem myszy i wybierz **Zainicjuj dysk**.
2. Wybierz styl partycji:
* **MBR** (Master Boot Record) lub **GPT** (GUID Partition Table). GPT jest zalecane dla nowoczesnych systemÃ³w.

#### **4. UtwÃ³rz nowÄ… partycjÄ™**

1. Kliknij prawym przyciskiem myszy na nieprzydzielonÄ… przestrzeÅ„ na dysku i wybierz **Nowa prosta partycja**.
2. PostÄ™puj zgodnie z kreatorem, aby:
* PrzypisaÄ‡ literÄ™ dysku (np. `D:`).
* SformatowaÄ‡ dysk (wybierz NTFS w wiÄ™kszoÅ›ci przypadkÃ³w).
{% endtab %}
{% endtabs %}

### WraÅ¼liwe informacje na dyskach i migawkach

MoÅ¼liwe jest znalezienie **wraÅ¼liwych informacji wewnÄ…trz dyskÃ³w lub nawet starych migawek dyskÃ³w**.

1. **Lista migawek**
```bash
az snapshot list \
--resource-group <RESOURCE_GROUP> \
-o table
```
2. **UtwÃ³rz dysk z migawki** (jeÅ›li potrzebne)
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <DISK_NAME> \
--source <SNAPSHOT_ID> \
--size-gb <DISK_SIZE>
```
3. **DoÅ‚Ä…cz i zamontuj dysk** do VM i przeszukaj w poszukiwaniu wraÅ¼liwych informacji (sprawdÅº poprzedniÄ… sekcjÄ™, aby zobaczyÄ‡, jak to zrobiÄ‡)

### WraÅ¼liwe informacje w rozszerzeniach VM i aplikacjach VM

MoÅ¼liwe, Å¼e moÅ¼na znaleÅºÄ‡ **wraÅ¼liwe informacje wewnÄ…trz rozszerzeÅ„ VM i aplikacji VM**.

1. **Wypisz wszystkie aplikacje VM** 

{% code overflow="wrap" %}
```bash
## List all VM applications inside a gallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table
```
{% endcode %}

2. Zainstaluj rozszerzenie w maszynie wirtualnej i **wyszukaj wraÅ¼liwe informacje**

{% code overflow="wrap" %}
```bash
az vm application set \
--resource-group <rsc-group> \
--name <vm-name> \
--app-version-ids /subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.Compute/galleries/myGallery/applications/myReverseShellApp/versions/1.0.2 \
--treat-deployment-as-failure true
```
{% endcode %}

{% hint style="success" %}
Ucz siÄ™ i Ä‡wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Ucz siÄ™ i Ä‡wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* SprawdÅº [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **DoÅ‚Ä…cz do** ğŸ’¬ [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **Å›ledÅº** nas na **Twitterze** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel siÄ™ trikami hackingowymi, przesyÅ‚ajÄ…c PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytoriÃ³w na githubie.

</details>
{% endhint %}
