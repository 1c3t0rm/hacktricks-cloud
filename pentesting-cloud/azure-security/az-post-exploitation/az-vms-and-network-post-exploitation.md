# Az - VMs & Netzwerk Post-Exploitation

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teile Hacking-Tricks, indem du PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

## VMs & Netzwerk

F√ºr weitere Informationen zu Azure VMs und Netzwerken siehe die folgende Seite:

{% content-ref url="../az-services/vms/" %}
[vms](../az-services/vms/)
{% endcontent-ref %}

### VM-Anwendungs-Pivoting

VM-Anwendungen k√∂nnen mit anderen Abonnements und Mandanten geteilt werden. Wenn eine Anwendung geteilt wird, liegt es wahrscheinlich daran, dass sie verwendet wird. Wenn es dem Angreifer gelingt, die **Anwendung zu kompromittieren und eine mit einem Backdoor versehenen** Version hochzuladen, k√∂nnte es m√∂glich sein, dass sie **in einem anderen Mandanten oder Abonnement ausgef√ºhrt wird**.

### Sensible Informationen in Bildern

Es k√∂nnte m√∂glich sein, **sensible Informationen in Bildern** zu finden, die in der Vergangenheit von VMs aufgenommen wurden.

1. **Liste der Bilder** aus Galerien
```bash
# Get galleries
az sig list -o table

# List images inside gallery
az sig image-definition list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
-o table

# Get images versions
az sig image-version list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
--gallery-image-definition <IMAGE_DEFINITION> \
-o table
```
2. **Benutzerdefinierte Images auflisten**
```bash
az image list -o table
```
3. **VM aus Bild-ID erstellen** und nach sensiblen Informationen darin suchen
```bash
# Create VM from image
az vm create \
--resource-group <RESOURCE_GROUP> \
--name <VM_NAME> \
--image /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/galleries/<GALLERY_NAME>/images/<IMAGE_DEFINITION>/versions/<IMAGE_VERSION> \
--admin-username <ADMIN_USERNAME> \
--generate-ssh-keys
```
### Sensible Informationen in Wiederherstellungspunkten

Es k√∂nnte m√∂glich sein, **sensible Informationen in Wiederherstellungspunkten** zu finden.

1. **Wiederherstellungspunkte auflisten**
```bash
az restore-point list \
--resource-group <RESOURCE_GROUP> \
--restore-point-collection-name <COLLECTION_NAME> \
-o table
```
2. **Erstellen Sie eine Festplatte** aus einem Wiederherstellungspunkt

{% code overflow="wrap" %}
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <NEW_DISK_NAME> \
--source /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/restorePointCollections/<COLLECTION_NAME>/restorePoints/<RESTORE_POINT_NAME>
```
{% endcode %}

3. **H√§ngen Sie die Festplatte an eine VM an** (der Angreifer muss bereits eine VM innerhalb des Kontos kompromittiert haben)
```bash
az vm disk attach \
--resource-group <RESOURCE_GROUP> \
--vm-name <VM_NAME> \
--name <DISK_NAME>
```
4. **Mounten** Sie die Festplatte und **suchen Sie nach sensiblen Informationen**

{% tabs %}
{% tab title="Linux" %}
```bash
# List all available disks
sudo fdisk -l

# Check disk format
sudo file -s /dev/sdX

# Mount it
sudo mkdir /mnt/mydisk
sudo mount /dev/sdX1 /mnt/mydisk
```
{% endtab %}

{% tab title="Windows" %}
#### **1. √ñffnen Sie die Datentr√§gerverwaltung**

1. Klicken Sie mit der rechten Maustaste auf **Start** und w√§hlen Sie **Datentr√§gerverwaltung**.
2. Der angeschlossene Datentr√§ger sollte als **Offline** oder **Nicht zugeordnet** angezeigt werden.

#### **2. Bringen Sie den Datentr√§ger online**

1. Suchen Sie den Datentr√§ger im unteren Bereich.
2. Klicken Sie mit der rechten Maustaste auf den Datentr√§ger (z. B. **Datentr√§ger 1**) und w√§hlen Sie **Online**.

#### **3. Initialisieren Sie den Datentr√§ger**

1. Wenn der Datentr√§ger nicht initialisiert ist, klicken Sie mit der rechten Maustaste und w√§hlen Sie **Datentr√§ger initialisieren**.
2. W√§hlen Sie den Partitionstyp:
* **MBR** (Master Boot Record) oder **GPT** (GUID-Partitionstabelle). GPT wird f√ºr moderne Systeme empfohlen.

#### **4. Erstellen Sie ein neues Volume**

1. Klicken Sie mit der rechten Maustaste auf den nicht zugeordneten Speicherplatz auf dem Datentr√§ger und w√§hlen Sie **Neues einfaches Volume**.
2. Folgen Sie dem Assistenten, um:
* Einen Laufwerksbuchstaben zuzuweisen (z. B. `D:`).
* Den Datentr√§ger zu formatieren (w√§hlen Sie NTFS in den meisten F√§llen).
{% endtab %}
{% endtabs %}

### Sensible Informationen in Datentr√§gern & Snapshots

Es k√∂nnte m√∂glich sein, **sensible Informationen in Datentr√§gern oder sogar alten Snapshots von Datentr√§gern** zu finden.

1. **Snapshots auflisten**
```bash
az snapshot list \
--resource-group <RESOURCE_GROUP> \
-o table
```
2. **Erstellen Sie eine Festplatte aus einem Snapshot** (falls erforderlich)
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <DISK_NAME> \
--source <SNAPSHOT_ID> \
--size-gb <DISK_SIZE>
```
3. **H√§ngen Sie die Festplatte an** eine VM an und suchen Sie nach sensiblen Informationen (siehe den vorherigen Abschnitt, um zu erfahren, wie man dies macht)

### Sensible Informationen in VM-Erweiterungen & VM-Anwendungen

Es k√∂nnte m√∂glich sein, **sensible Informationen in VM-Erweiterungen und VM-Anwendungen** zu finden.

1. **Liste aller VM-Apps** 

{% code overflow="wrap" %}
```bash
## List all VM applications inside a gallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table
```
{% endcode %}

2. Installieren Sie die Erweiterung in einer VM und **suchen Sie nach sensiblen Informationen**

{% code overflow="wrap" %}
```bash
az vm application set \
--resource-group <rsc-group> \
--name <vm-name> \
--app-version-ids /subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.Compute/galleries/myGallery/applications/myReverseShellApp/versions/1.0.2 \
--treat-deployment-as-failure true
```
{% endcode %}

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtze HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
