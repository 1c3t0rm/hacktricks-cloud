# Az - VMs & Network Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## VMs & Network

Azure VMsã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ã«é–¢ã™ã‚‹è©³ç´°æƒ…å ±ã¯ã€ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

{% content-ref url="../az-services/vms/" %}
[vms](../az-services/vms/)
{% endcontent-ref %}

### VMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ”ãƒœãƒƒãƒ†ã‚£ãƒ³ã‚°

VMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ä»–ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚„ãƒ†ãƒŠãƒ³ãƒˆã¨å…±æœ‰ã§ãã¾ã™ã€‚ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå…±æœ‰ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãã‚Œã¯ãŠãã‚‰ãä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€æ”»æ’ƒè€…ãŒ**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¾µå®³ã—ã€ãƒãƒƒã‚¯ãƒ‰ã‚¢ä»˜ãã®**ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã«æˆåŠŸã™ã‚Œã°ã€ãã‚ŒãŒ**åˆ¥ã®ãƒ†ãƒŠãƒ³ãƒˆã‚„ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™**ã€‚

### ç”»åƒå†…ã®æ©Ÿå¯†æƒ…å ±

éå»ã«VMã‹ã‚‰å–å¾—ã—ãŸ**ç”»åƒå†…ã«æ©Ÿå¯†æƒ…å ±ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™**ã€‚

1. **ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰ç”»åƒã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—**
```bash
# Get galleries
az sig list -o table

# List images inside gallery
az sig image-definition list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
-o table

# Get images versions
az sig image-version list \
--resource-group <RESOURCE_GROUP> \
--gallery-name <GALLERY_NAME> \
--gallery-image-definition <IMAGE_DEFINITION> \
-o table
```
2. **ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒªã‚¹ãƒˆ**
```bash
az image list -o table
```
3. **ã‚¤ãƒ¡ãƒ¼ã‚¸IDã‹ã‚‰VMã‚’ä½œæˆ**ã—ã€ãã®ä¸­ã«æ©Ÿå¯†æƒ…å ±ãŒãªã„ã‹æ¤œç´¢ã™ã‚‹
```bash
# Create VM from image
az vm create \
--resource-group <RESOURCE_GROUP> \
--name <VM_NAME> \
--image /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/galleries/<GALLERY_NAME>/images/<IMAGE_DEFINITION>/versions/<IMAGE_VERSION> \
--admin-username <ADMIN_USERNAME> \
--generate-ssh-keys
```
### ãƒªã‚¹ãƒˆã‚¢ãƒã‚¤ãƒ³ãƒˆå†…ã®æ©Ÿå¯†æƒ…å ±

**ãƒªã‚¹ãƒˆã‚¢ãƒã‚¤ãƒ³ãƒˆå†…ã«æ©Ÿå¯†æƒ…å ±ãŒå­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™**ã€‚

1. **ãƒªã‚¹ãƒˆã‚¢ãƒã‚¤ãƒ³ãƒˆã‚’ãƒªã‚¹ãƒˆã™ã‚‹**
```bash
az restore-point list \
--resource-group <RESOURCE_GROUP> \
--restore-point-collection-name <COLLECTION_NAME> \
-o table
```
2. **å¾©å…ƒãƒã‚¤ãƒ³ãƒˆã‹ã‚‰ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹**

{% code overflow="wrap" %}
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <NEW_DISK_NAME> \
--source /subscriptions/<SUBSCRIPTION_ID>/resourceGroups/<RESOURCE_GROUP>/providers/Microsoft.Compute/restorePointCollections/<COLLECTION_NAME>/restorePoints/<RESTORE_POINT_NAME>
```
{% endcode %}

3. **ãƒ‡ã‚£ã‚¹ã‚¯ã‚’VMã«ã‚¢ã‚¿ãƒƒãƒã™ã‚‹**ï¼ˆæ”»æ’ƒè€…ã¯ã™ã§ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå†…ã®VMã‚’ä¾µå®³ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰
```bash
az vm disk attach \
--resource-group <RESOURCE_GROUP> \
--vm-name <VM_NAME> \
--name <DISK_NAME>
```
4. **ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ãƒã‚¦ãƒ³ãƒˆ**ã—ã€**æ©Ÿå¯†æƒ…å ±ã‚’æ¤œç´¢**ã—ã¾ã™

{% tabs %}
{% tab title="Linux" %}
```bash
# List all available disks
sudo fdisk -l

# Check disk format
sudo file -s /dev/sdX

# Mount it
sudo mkdir /mnt/mydisk
sudo mount /dev/sdX1 /mnt/mydisk
```
{% endtab %}

{% tab title="Windows" %}
#### **1. ãƒ‡ã‚£ã‚¹ã‚¯ã®ç®¡ç†ã‚’é–‹ã**

1. **ã‚¹ã‚¿ãƒ¼ãƒˆ**ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã€**ãƒ‡ã‚£ã‚¹ã‚¯ã®ç®¡ç†**ã‚’é¸æŠã—ã¾ã™ã€‚
2. æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ãƒ‡ã‚£ã‚¹ã‚¯ã¯**ã‚ªãƒ•ãƒ©ã‚¤ãƒ³**ã¾ãŸã¯**æœªå‰²ã‚Šå½“ã¦**ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

#### **2. ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«ã™ã‚‹**

1. ä¸‹éƒ¨ã®ãƒšã‚¤ãƒ³ã§ãƒ‡ã‚£ã‚¹ã‚¯ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚
2. ãƒ‡ã‚£ã‚¹ã‚¯ï¼ˆä¾‹ï¼š**ãƒ‡ã‚£ã‚¹ã‚¯ 1**ï¼‰ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã€**ã‚ªãƒ³ãƒ©ã‚¤ãƒ³**ã‚’é¸æŠã—ã¾ã™ã€‚

#### **3. ãƒ‡ã‚£ã‚¹ã‚¯ã‚’åˆæœŸåŒ–ã™ã‚‹**

1. ãƒ‡ã‚£ã‚¹ã‚¯ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã€å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦**ãƒ‡ã‚£ã‚¹ã‚¯ã®åˆæœŸåŒ–**ã‚’é¸æŠã—ã¾ã™ã€‚
2. ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸æŠã—ã¾ã™ï¼š
* **MBR**ï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒ–ãƒ¼ãƒˆãƒ¬ã‚³ãƒ¼ãƒ‰ï¼‰ã¾ãŸã¯**GPT**ï¼ˆGUIDãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã€‚ç¾ä»£ã®ã‚·ã‚¹ãƒ†ãƒ ã«ã¯GPTãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚

#### **4. æ–°ã—ã„ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚’ä½œæˆã™ã‚‹**

1. ãƒ‡ã‚£ã‚¹ã‚¯ä¸Šã®æœªå‰²ã‚Šå½“ã¦ã‚¹ãƒšãƒ¼ã‚¹ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã€**æ–°ã—ã„ã‚·ãƒ³ãƒ—ãƒ«ãƒœãƒªãƒ¥ãƒ¼ãƒ **ã‚’é¸æŠã—ã¾ã™ã€‚
2. ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã«å¾“ã£ã¦ï¼š
* ãƒ‰ãƒ©ã‚¤ãƒ–æ–‡å­—ã‚’å‰²ã‚Šå½“ã¦ã¾ã™ï¼ˆä¾‹ï¼š`D:`ï¼‰ã€‚
* ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¾ã™ï¼ˆã»ã¨ã‚“ã©ã®å ´åˆã€NTFSã‚’é¸æŠã—ã¾ã™ï¼‰ã€‚
{% endtab %}
{% endtabs %}

### ãƒ‡ã‚£ã‚¹ã‚¯ã¨ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå†…ã®æ©Ÿå¯†æƒ…å ±

**ãƒ‡ã‚£ã‚¹ã‚¯ã‚„å¤ã„ãƒ‡ã‚£ã‚¹ã‚¯ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå†…ã«æ©Ÿå¯†æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“**ã€‚

1. **ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ãƒªã‚¹ãƒˆ**
```bash
az snapshot list \
--resource-group <RESOURCE_GROUP> \
-o table
```
2. **ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰ãƒ‡ã‚£ã‚¹ã‚¯ã‚’ä½œæˆ** (å¿…è¦ã«å¿œã˜ã¦)
```bash
az disk create \
--resource-group <RESOURCE_GROUP> \
--name <DISK_NAME> \
--source <SNAPSHOT_ID> \
--size-gb <DISK_SIZE>
```
3. **ãƒ‡ã‚£ã‚¹ã‚¯ã‚’VMã«ã‚¢ã‚¿ãƒƒãƒã—ã¦ãƒã‚¦ãƒ³ãƒˆ**ã—ã€æ©Ÿå¯†æƒ…å ±ã‚’æ¤œç´¢ã—ã¾ã™ï¼ˆã“ã‚Œã‚’è¡Œã†æ–¹æ³•ã«ã¤ã„ã¦ã¯å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰

### VMæ‹¡å¼µæ©Ÿèƒ½ãŠã‚ˆã³VMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã®æ©Ÿå¯†æƒ…å ±

**VMæ‹¡å¼µæ©Ÿèƒ½ãŠã‚ˆã³VMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã«æ©Ÿå¯†æƒ…å ±ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“**ã€‚

1. **ã™ã¹ã¦ã®VMã‚¢ãƒ—ãƒªã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹**

{% code overflow="wrap" %}
```bash
## List all VM applications inside a gallery
az sig gallery-application list --gallery-name <gallery-name> --resource-group <res-group> --output table
```
{% endcode %}

2. VMã«æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€**æ©Ÿå¯†æƒ…å ±ã‚’æ¤œç´¢ã™ã‚‹**

{% code overflow="wrap" %}
```bash
az vm application set \
--resource-group <rsc-group> \
--name <vm-name> \
--app-version-ids /subscriptions/9291ff6e-6afb-430e-82a4-6f04b2d05c7f/resourceGroups/Resource_Group_1/providers/Microsoft.Compute/galleries/myGallery/applications/myReverseShellApp/versions/1.0.2 \
--treat-deployment-as-failure true
```
{% endcode %}

{% hint style="success" %}
AWSãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCPãƒãƒƒã‚­ãƒ³ã‚°ã‚’å­¦ã³ã€å®Ÿè·µã™ã‚‹ï¼š<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricksã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹</summary>

* [**ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³**](https://github.com/sponsors/carlospolop)ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼
* **ğŸ’¬ [**Discordã‚°ãƒ«ãƒ¼ãƒ—**](https://discord.gg/hRep4RUj7f)ã¾ãŸã¯[**Telegramã‚°ãƒ«ãƒ¼ãƒ—**](https://t.me/peass)ã«å‚åŠ ã™ã‚‹ã‹ã€**Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã ã•ã„ã€‚**
* **ãƒãƒƒã‚­ãƒ³ã‚°ã®ãƒˆãƒªãƒƒã‚¯ã‚’å…±æœ‰ã™ã‚‹ã«ã¯ã€[**HackTricks**](https://github.com/carlospolop/hacktricks)ã¨[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’æå‡ºã—ã¦ãã ã•ã„ã€‚**

</details>
{% endhint %}
