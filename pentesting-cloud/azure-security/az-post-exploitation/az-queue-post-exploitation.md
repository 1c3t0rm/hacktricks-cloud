# Az - Queue Storage Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Kolejka

For more information check:

{% content-ref url="../az-services/az-queue-enum.md" %}
[az-queue-enum.md](../az-services/az-queue-enum.md)
{% endcontent-ref %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/read`

Atakujcy z tym uprawnieniem mo偶e podglda wiadomoci z Azure Storage Queue. Umo偶liwia to atakujcemu przegldanie treci wiadomoci bez oznaczania ich jako przetworzonych lub zmieniania ich stanu. Mo偶e to prowadzi do nieautoryzowanego dostpu do wra偶liwych informacji, umo偶liwiajc eksfiltracj danych lub zbieranie informacji wywiadowczych do dalszych atak贸w.

{% code overflow="wrap" %}
```bash
az storage message peek --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

**Potencjalny wpyw**: Nieautoryzowany dostp do kolejki, ujawnienie wiadomoci lub manipulacja kolejk przez nieautoryzowanych u偶ytkownik贸w lub usugi.

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/process/action`

Dziki temu uprawnieniu, atakujcy mo偶e pobiera i przetwarza wiadomoci z Azure Storage Queue. Oznacza to, 偶e mog odczyta tre wiadomoci i oznaczy j jako przetworzon, skutecznie ukrywajc j przed legalnymi systemami. Mo偶e to prowadzi do ujawnienia wra偶liwych danych, zak贸ce w sposobie obsugi wiadomoci, a nawet zatrzymania wa偶nych proces贸w, czynic wiadomoci niedostpnymi dla ich zamierzonych u偶ytkownik贸w.

{% code overflow="wrap" %}
```bash
az storage message get --queue-name <queue_name> --account-name <storage_account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/add/action`

Dziki temu uprawnieniu, atakujcy mo偶e doda nowe wiadomoci do kolejki Azure Storage. Umo偶liwia to wstrzykiwanie zoliwych lub nieautoryzowanych danych do kolejki, co mo偶e wywoa niezamierzone dziaania lub zak贸ci dziaanie usug downstream, kt贸re przetwarzaj wiadomoci.

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/write`

To uprawnienie pozwala atakujcemu na dodawanie nowych wiadomoci lub aktualizowanie istniejcych w Azure Storage Queue. U偶ywajc tego, mog wprowadza szkodliwe treci lub zmienia istniejce wiadomoci, co mo偶e wprowadza w bd aplikacje lub powodowa niepo偶dane zachowania w systemach, kt贸re polegaj na kolejce.

{% code overflow="wrap" %}
```bash
az storage message put --queue-name <queue-name> --content "Injected malicious message" --account-name <storage-account>

#Update the message
az storage message update --queue-name <queue-name> \
--id <message-id> \
--pop-receipt <pop-receipt> \
--content "Updated message content" \
--visibility-timeout <timeout-in-seconds> \
--account-name <storage-account>
```
{% endcode %}

### Actions: `Microsoft.Storage/storageAccounts/queueServices/queues/delete`

To uprawnienie pozwala atakujcemu na usunicie kolejek w ramach konta magazynowego. Wykorzystujc t zdolno, atakujcy mo偶e trwale usun kolejki i wszystkie ich powizane wiadomoci, co powoduje znaczne zak贸cenia w przepywie pracy i prowadzi do krytycznej utraty danych dla aplikacji, kt贸re polegaj na dotknitych kolejkach. Ta akcja mo偶e by r贸wnie偶 u偶ywana do sabota偶u usug poprzez usunicie istotnych komponent贸w systemu.

{% code overflow="wrap" %}
```bash
az storage queue delete --name <queue-name> --account-name <storage-account>
```
{% endcode %}

### DataActions: `Microsoft.Storage/storageAccounts/queueServices/queues/messages/delete`

Dziki temu uprawnieniu, atakujcy mo偶e usun wszystkie wiadomoci z kolejki Azure Storage. Ta akcja usuwa wszystkie wiadomoci, zak贸cajc przepywy pracy i powodujc utrat danych dla system贸w zale偶nych od kolejki.

{% code overflow="wrap" %}
```bash
az storage message clear --queue-name <queue-name> --account-name <storage-account>
```
{% endcode %}

### Dziaania: `Microsoft.Storage/storageAccounts/queueServices/queues/write`

To uprawnienie pozwala atakujcemu na tworzenie lub modyfikowanie kolejek i ich waciwoci w ramach konta magazynu. Mo偶e by u偶ywane do tworzenia nieautoryzowanych kolejek, modyfikowania metadanych lub zmiany list kontroli dostpu (ACL), aby przyzna lub ograniczy dostp. Ta zdolno mo偶e zak贸ca przepywy pracy, wstrzykiwa zoliwe dane, eksfiltrujc wra偶liwe informacje lub manipulowa ustawieniami kolejek, aby umo偶liwi dalsze ataki.

{% code overflow="wrap" %}
```bash
az storage queue create --name <new-queue-name> --account-name <storage-account>

az storage queue metadata update --name <queue-name> --metadata key1=value1 key2=value2 --account-name <storage-account>

az storage queue policy set --name <queue-name> --permissions rwd --expiry 2024-12-31T23:59:59Z --account-name <storage-account>
```
{% endcode %}

## References

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel si trikami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w na githubie.

</details>
{% endhint %}
