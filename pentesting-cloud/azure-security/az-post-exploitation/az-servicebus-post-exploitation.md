# Az - Service Bus Post Exploitation

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** bizi takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Service Bus

Daha fazla bilgi iÃ§in kontrol edin:

{% content-ref url="../az-services/az-servicebus-enum.md" %}
[az-servicebus-enum.md](../az-services/az-servicebus-enum.md)
{% endcontent-ref %}

### Eylemler: `Microsoft.ServiceBus/namespaces/Delete`

Bu izne sahip bir saldÄ±rgan, bir Azure Service Bus ad alanÄ±nÄ± tamamen silebilir. Bu eylem, ad alanÄ±nÄ± ve ona baÄŸlÄ± tÃ¼m kaynaklarÄ±, kuyruklar, konular, abonelikler ve bunlarÄ±n mesajlarÄ± dahil olmak Ã¼zere, kaldÄ±rarak tÃ¼m baÄŸÄ±mlÄ± sistemler ve iÅŸ akÄ±ÅŸlarÄ± Ã¼zerinde geniÅŸ Ã§apta kesintiye ve kalÄ±cÄ± veri kaybÄ±na neden olur.

{% code overflow="wrap" %}
```bash
az servicebus namespace delete --resource-group <ResourceGroupName> --name <NamespaceName>
```
{% endcode %}

### Eylemler: `Microsoft.ServiceBus/namespaces/topics/Delete`

Bu izne sahip bir saldÄ±rgan, bir Azure Service Bus konusunu silebilir. Bu eylem, konuyu ve ona baÄŸlÄ± tÃ¼m abonelikleri ve mesajlarÄ± kaldÄ±rÄ±r, bu da kritik verilerin kaybÄ±na ve konuyu kullanan sistemlerin ve iÅŸ akÄ±ÅŸlarÄ±nÄ±n kesintiye uÄŸramasÄ±na neden olabilir.

{% code overflow="wrap" %}
```bash
az servicebus topic delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
{% endcode %}

### Eylemler: `Microsoft.ServiceBus/namespaces/queues/Delete`

Bu izne sahip bir saldÄ±rgan, bir Azure Service Bus kuyruÄŸunu silebilir. Bu eylem, kuyruÄŸu ve iÃ§indeki tÃ¼m mesajlarÄ± kaldÄ±rÄ±r, bu da kritik verilerin kaybÄ±na ve kuyruÄŸa baÄŸÄ±mlÄ± sistemlerin ve iÅŸ akÄ±ÅŸlarÄ±nÄ±n kesintiye uÄŸramasÄ±na neden olabilir.

{% code overflow="wrap" %}
```bash
az servicebus queue delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
{% endcode %}

### Eylemler: `Microsoft.ServiceBus/namespaces/topics/subscriptions/Delete`

Bu izne sahip bir saldÄ±rgan, bir Azure Service Bus aboneliÄŸini silebilir. Bu eylem, aboneliÄŸi ve ona baÄŸlÄ± tÃ¼m mesajlarÄ± kaldÄ±rÄ±r, bu da aboneliÄŸe dayanan iÅŸ akÄ±ÅŸlarÄ±nÄ±, veri iÅŸleme sÃ¼reÃ§lerini ve sistem operasyonlarÄ±nÄ± potansiyel olarak kesintiye uÄŸratabilir.

{% code overflow="wrap" %}
```bash
az servicebus topic subscription delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
{% endcode %}

### Eylemler: `Microsoft.ServiceBus/namespaces/write` & `Microsoft.ServiceBus/namespaces/read`

Azure Service Bus ad alanlarÄ±nÄ± oluÅŸturma veya deÄŸiÅŸtirme izinlerine sahip bir saldÄ±rgan, bunu operasyonlarÄ± kesintiye uÄŸratmak, yetkisiz kaynaklar daÄŸÄ±tmak veya hassas verileri aÃ§Ä±ÄŸa Ã§Ä±karmak iÃ§in kullanabilir. Kamu aÄŸÄ± eriÅŸimini etkinleÅŸtirmek, ÅŸifreleme ayarlarÄ±nÄ± dÃ¼ÅŸÃ¼rmek veya performansÄ± dÃ¼ÅŸÃ¼rmek veya maliyetleri artÄ±rmak iÃ§in SKU'larÄ± deÄŸiÅŸtirmek gibi kritik yapÄ±landÄ±rmalarÄ± deÄŸiÅŸtirebilirler. AyrÄ±ca, yerel kimlik doÄŸrulamayÄ± devre dÄ±ÅŸÄ± bÄ±rakabilir, kopya konumlarÄ±nÄ± manipÃ¼le edebilir veya gÃ¼venlik kontrollerini zayÄ±flatmak iÃ§in TLS sÃ¼rÃ¼mlerini ayarlayabilirler; bu da ad alanÄ± yanlÄ±ÅŸ yapÄ±landÄ±rmasÄ±nÄ± Ã¶nemli bir post-exploitation riski haline getirir.

{% code overflow="wrap" %}
```bash
az servicebus namespace create --resource-group <ResourceGroupName> --name <NamespaceName> --location <Location>
az servicebus namespace update --resource-group <ResourceGroupName> --name <NamespaceName> --tags <Key=Value>
```
{% endcode %}


### Eylemler: `Microsoft.ServiceBus/namespaces/queues/write` (`Microsoft.ServiceBus/namespaces/queues/read`)

Azure Service Bus kuyruklarÄ±nÄ± oluÅŸturma veya deÄŸiÅŸtirme izinlerine sahip bir saldÄ±rgan (kuyruÄŸu deÄŸiÅŸtirmek iÃ§in ayrÄ±ca Action:`Microsoft.ServiceBus/namespaces/queues/read` iznine de ihtiyacÄ±nÄ±z olacak) bunu verileri yakalamak, iÅŸ akÄ±ÅŸlarÄ±nÄ± kesintiye uÄŸratmak veya yetkisiz eriÅŸimi saÄŸlamak iÃ§in kullanabilir. KÃ¶tÃ¼ niyetli uÃ§ noktalara mesaj iletimi gibi kritik yapÄ±landÄ±rmalarÄ± deÄŸiÅŸtirebilir, verileri uygunsuz bir ÅŸekilde saklamak veya silmek iÃ§in mesaj TTL'sini ayarlayabilir veya hata yÃ¶netimini etkilemek iÃ§in Ã¶lÃ¼ mektup iÅŸlemlerini etkinleÅŸtirebilir. AyrÄ±ca, hizmet iÅŸlevselliÄŸini kesintiye uÄŸratmak veya tespiti atlatmak iÃ§in kuyruk boyutlarÄ±nÄ±, kilit sÃ¼relerini veya durumlarÄ± manipÃ¼le edebilir, bu da bunu Ã¶nemli bir post-exploitation riski haline getirir.

{% code overflow="wrap" %}
```bash
az servicebus queue create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
az servicebus queue update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
{% endcode %}

### Eylemler: `Microsoft.ServiceBus/namespaces/topics/write` (`Microsoft.ServiceBus/namespaces/topics/read`)

Azure Service Bus ad alanÄ±nda konularÄ± oluÅŸturma veya deÄŸiÅŸtirme izinlerine sahip bir saldÄ±rgan, bunu mesaj iÅŸ akÄ±ÅŸlarÄ±nÄ± kesintiye uÄŸratmak, hassas verileri aÃ§Ä±ÄŸa Ã§Ä±karmak veya yetkisiz eylemleri etkinleÅŸtirmek iÃ§in kullanabilir. az servicebus topic update gibi komutlar kullanarak, Ã¶lÃ§eklenebilirlik kÃ¶tÃ¼ye kullanÄ±mÄ± iÃ§in bÃ¶lÃ¼mlendirmeyi etkinleÅŸtirme, mesajlarÄ± yanlÄ±ÅŸ bir ÅŸekilde saklamak veya atmak iÃ§in TTL ayarlarÄ±nÄ± deÄŸiÅŸtirme veya kontrolleri atlatmak iÃ§in tekrar kontrolÃ¼nÃ¼ devre dÄ±ÅŸÄ± bÄ±rakma gibi yapÄ±landÄ±rmalarÄ± manipÃ¼le edebilirler. AyrÄ±ca, konu boyut sÄ±nÄ±rlarÄ±nÄ± ayarlayabilir, durumu deÄŸiÅŸtirerek kullanÄ±labilirliÄŸi kesintiye uÄŸratabilir veya yakalanan mesajlarÄ± geÃ§ici olarak depolamak iÃ§in hÄ±zlÄ± konularÄ± yapÄ±landÄ±rabilirler; bu da konu yÃ¶netimini post-exploitation azaltma iÃ§in kritik bir odak haline getirir.

{% code overflow="wrap" %}
```bash
az servicebus topic create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
az servicebus topic update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
{% endcode %}

### Eylemler: `Microsoft.ServiceBus/namespaces/topics/subscriptions/write` (`Microsoft.ServiceBus/namespaces/topics/subscriptions/read`)

Bir Azure Service Bus konusundaki abonelikleri oluÅŸturma veya deÄŸiÅŸtirme izinlerine sahip bir saldÄ±rgan, bunu mesaj iÅŸ akÄ±ÅŸlarÄ±nÄ± kesmek, yÃ¶nlendirmek veya bozmak iÃ§in kullanabilir. az servicebus topic subscription update gibi komutlar kullanarak, mesajlarÄ± saptÄ±rmak iÃ§in Ã¶lÃ¼ mektup Ã¶zelliÄŸini etkinleÅŸtirmek, mesajlarÄ± yetkisiz uÃ§ noktalara iletmek veya mesaj teslimatÄ±nÄ± sÃ¼rdÃ¼rmek veya mÃ¼dahale etmek iÃ§in TTL ve kilit sÃ¼resini deÄŸiÅŸtirmek gibi yapÄ±landÄ±rmalarÄ± manipÃ¼le edebilirler. AyrÄ±ca, operasyonlarÄ± bozmak veya tespiti atlatmak iÃ§in durum veya maksimum teslimat sayÄ±sÄ± ayarlarÄ±nÄ± deÄŸiÅŸtirebilirler; bu da abonelik kontrolÃ¼nÃ¼ post-exploitation senaryolarÄ±nÄ±n kritik bir yÃ¶nÃ¼ haline getirir.

{% code overflow="wrap" %}
```bash
az servicebus topic subscription create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
az servicebus topic subscription update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
{% endcode %}


### Eylemler: `AuthorizationRules` Mesaj GÃ¶nderme ve Alma

Buraya bir gÃ¶z atÄ±n:

{% content-ref url="../az-services/az-queue-privesc.md" %}
[az-queue-privesc.md](../az-services/az-queue-privesc.md)
{% endcontent-ref %}

## Referanslar

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-topics-subscriptions?tabs=passwordless
* https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/integration#microsoftservicebus
* https://learn.microsoft.com/en-us/cli/azure/servicebus/namespace?view=azure-cli-latest
* https://learn.microsoft.com/en-us/cli/azure/servicebus/queue?view=azure-cli-latest

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **Bize katÄ±lÄ±n** ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya **bizi** **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)** takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}
