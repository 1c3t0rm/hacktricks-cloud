# Az - Service Bus P√≥s-Explora√ß√£o

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

## Service Bus

Para mais informa√ß√µes, confira:

{% content-ref url="../az-services/az-servicebus-enum.md" %}
[az-servicebus-enum.md](../az-services/az-servicebus-enum.md)
{% endcontent-ref %}

### A√ß√µes: `Microsoft.ServiceBus/namespaces/Delete`

Um atacante com esta permiss√£o pode excluir todo um namespace do Azure Service Bus. Esta a√ß√£o remove o namespace e todos os recursos associados, incluindo filas, t√≥picos, assinaturas e suas mensagens, causando interrup√ß√µes generalizadas e perda permanente de dados em todos os sistemas e fluxos de trabalho dependentes.

{% code overflow="wrap" %}
```bash
az servicebus namespace delete --resource-group <ResourceGroupName> --name <NamespaceName>
```
{% endcode %}

### A√ß√µes: `Microsoft.ServiceBus/namespaces/topics/Delete`

Um atacante com esta permiss√£o pode excluir um t√≥pico do Azure Service Bus. Esta a√ß√£o remove o t√≥pico e todas as suas assinaturas e mensagens associadas, potencialmente causando a perda de dados cr√≠ticos e interrompendo sistemas e fluxos de trabalho que dependem do t√≥pico.

{% code overflow="wrap" %}
```bash
az servicebus topic delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
{% endcode %}

### A√ß√µes: `Microsoft.ServiceBus/namespaces/queues/Delete`

Um atacante com esta permiss√£o pode excluir uma fila do Azure Service Bus. Esta a√ß√£o remove a fila e todas as mensagens dentro dela, potencialmente causando perda de dados cr√≠ticos e interrompendo sistemas e fluxos de trabalho dependentes da fila.

{% code overflow="wrap" %}
```bash
az servicebus queue delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
{% endcode %}

### A√ß√µes: `Microsoft.ServiceBus/namespaces/topics/subscriptions/Delete`

Um atacante com esta permiss√£o pode excluir uma assinatura do Azure Service Bus. Esta a√ß√£o remove a assinatura e todas as suas mensagens associadas, potencialmente interrompendo fluxos de trabalho, processamento de dados e opera√ß√µes do sistema que dependem da assinatura.

{% code overflow="wrap" %}
```bash
az servicebus topic subscription delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
{% endcode %}

### A√ß√µes: `Microsoft.ServiceBus/namespaces/write` & `Microsoft.ServiceBus/namespaces/read`

Um atacante com permiss√µes para criar ou modificar namespaces do Azure Service Bus pode explorar isso para interromper opera√ß√µes, implantar recursos n√£o autorizados ou expor dados sens√≠veis. Eles podem alterar configura√ß√µes cr√≠ticas, como habilitar o acesso √† rede p√∫blica, rebaixar configura√ß√µes de criptografia ou mudar SKUs para degradar o desempenho ou aumentar custos. Al√©m disso, eles poderiam desativar a autentica√ß√£o local, manipular locais de r√©plica ou ajustar vers√µes do TLS para enfraquecer os controles de seguran√ßa, tornando a m√° configura√ß√£o do namespace um risco significativo p√≥s-explora√ß√£o.

{% code overflow="wrap" %}
```bash
az servicebus namespace create --resource-group <ResourceGroupName> --name <NamespaceName> --location <Location>
az servicebus namespace update --resource-group <ResourceGroupName> --name <NamespaceName> --tags <Key=Value>
```
{% endcode %}


### A√ß√µes: `Microsoft.ServiceBus/namespaces/queues/write` (`Microsoft.ServiceBus/namespaces/queues/read`)

Um atacante com permiss√µes para criar ou modificar filas do Azure Service Bus (para modificar a fila, voc√™ tamb√©m precisar√° da A√ß√£o: `Microsoft.ServiceBus/namespaces/queues/read`) pode explorar isso para interceptar dados, interromper fluxos de trabalho ou permitir acesso n√£o autorizado. Eles podem alterar configura√ß√µes cr√≠ticas, como encaminhar mensagens para endpoints maliciosos, ajustar o TTL das mensagens para reter ou excluir dados de forma inadequada, ou habilitar o dead-lettering para interferir no tratamento de erros. Al√©m disso, eles poderiam manipular tamanhos de fila, dura√ß√µes de bloqueio ou status para interromper a funcionalidade do servi√ßo ou evitar detec√ß√£o, tornando isso um risco significativo de p√≥s-explora√ß√£o.

{% code overflow="wrap" %}
```bash
az servicebus queue create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
az servicebus queue update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
{% endcode %}

### A√ß√µes: `Microsoft.ServiceBus/namespaces/topics/write` (`Microsoft.ServiceBus/namespaces/topics/read`)

Um atacante com permiss√µes para criar ou modificar t√≥picos (para modificar o t√≥pico voc√™ tamb√©m precisar√° da A√ß√£o: `Microsoft.ServiceBus/namespaces/topics/read`) dentro de um namespace do Azure Service Bus pode explorar isso para interromper fluxos de mensagens, expor dados sens√≠veis ou habilitar a√ß√µes n√£o autorizadas. Usando comandos como az servicebus topic update, eles podem manipular configura√ß√µes, como habilitar particionamento para uso indevido de escalabilidade, alterar configura√ß√µes de TTL para reter ou descartar mensagens de forma inadequada, ou desabilitar a detec√ß√£o de duplicatas para contornar controles. Al√©m disso, eles poderiam ajustar limites de tamanho de t√≥picos, mudar o status para interromper a disponibilidade, ou configurar t√≥picos expressos para armazenar temporariamente mensagens interceptadas, tornando a gest√£o de t√≥picos um foco cr√≠tico para mitiga√ß√£o p√≥s-explora√ß√£o.

{% code overflow="wrap" %}
```bash
az servicebus topic create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
az servicebus topic update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
{% endcode %}

### A√ß√µes: `Microsoft.ServiceBus/namespaces/topics/subscriptions/write` (`Microsoft.ServiceBus/namespaces/topics/subscriptions/read`)

Um atacante com permiss√µes para criar ou modificar assinaturas (para modificar a assinatura, voc√™ tamb√©m precisar√° da A√ß√£o: `Microsoft.ServiceBus/namespaces/topics/subscriptions/read`) dentro de um t√≥pico do Azure Service Bus pode explorar isso para interceptar, redirecionar ou interromper fluxos de mensagens. Usando comandos como az servicebus topic subscription update, eles podem manipular configura√ß√µes, como habilitar dead lettering para desviar mensagens, encaminhar mensagens para endpoints n√£o autorizados ou modificar a dura√ß√£o do TTL e do bloqueio para reter ou interferir na entrega de mensagens. Al√©m disso, eles podem alterar o status ou as configura√ß√µes de contagem m√°xima de entrega para interromper opera√ß√µes ou evitar detec√ß√£o, tornando o controle de assinaturas um aspecto cr√≠tico dos cen√°rios de p√≥s-explora√ß√£o.

{% code overflow="wrap" %}
```bash
az servicebus topic subscription create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
az servicebus topic subscription update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
{% endcode %}


### A√ß√µes: `AuthorizationRules` Enviar & Receber Mensagens

D√™ uma olhada aqui:

{% content-ref url="../az-services/az-queue-privesc.md" %}
[az-queue-privesc.md](../az-services/az-queue-privesc.md)
{% endcontent-ref %}

## Refer√™ncias

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-topics-subscriptions?tabs=passwordless
* https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/integration#microsoftservicebus
* https://learn.microsoft.com/en-us/cli/azure/servicebus/namespace?view=azure-cli-latest
* https://learn.microsoft.com/en-us/cli/azure/servicebus/queue?view=azure-cli-latest

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
