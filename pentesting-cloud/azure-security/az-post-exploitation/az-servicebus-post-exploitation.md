# Az - Service Bus Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** 游눫 [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Service Bus

Za vi코e informacija proverite:

{% content-ref url="../az-services/az-servicebus-enum.md" %}
[az-servicebus-enum.md](../az-services/az-servicebus-enum.md)
{% endcontent-ref %}

### Actions: `Microsoft.ServiceBus/namespaces/Delete`

Napada캜 sa ovom dozvolom mo쬰 obrisati 캜itav Azure Service Bus namespace. Ova akcija uklanja namespace i sve povezane resurse, uklju캜uju캖i redove, teme, pretplate i njihove poruke, uzrokuju캖i 코iroku prekid i trajni gubitak podataka u svim zavisnim sistemima i radnim tokovima.

{% code overflow="wrap" %}
```bash
az servicebus namespace delete --resource-group <ResourceGroupName> --name <NamespaceName>
```
{% endcode %}

### Akcije: `Microsoft.ServiceBus/namespaces/topics/Delete`

Napada캜 sa ovom dozvolom mo쬰 da obri코e Azure Service Bus temu. Ova akcija uklanja temu i sve njene povezane pretplate i poruke, 코to mo쬰 dovesti do gubitka kriti캜nih podataka i ometanja sistema i radnih tokova koji se oslanjaju na temu.

{% code overflow="wrap" %}
```bash
az servicebus topic delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
{% endcode %}

### Akcije: `Microsoft.ServiceBus/namespaces/queues/Delete`

Napada캜 sa ovom dozvolom mo쬰 da obri코e Azure Service Bus red. Ova akcija uklanja red i sve poruke unutar njega, 코to mo쬰 dovesti do gubitka kriti캜nih podataka i ometanja sistema i radnih tokova koji zavise od reda.

{% code overflow="wrap" %}
```bash
az servicebus queue delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
{% endcode %}

### Akcije: `Microsoft.ServiceBus/namespaces/topics/subscriptions/Delete`

Napada캜 sa ovom dozvolom mo쬰 da obri코e Azure Service Bus pretplatu. Ova akcija uklanja pretplatu i sve njene povezane poruke, potencijalno ometaju캖i radne tokove, obradu podataka i operacije sistema koje se oslanjaju na pretplatu.

{% code overflow="wrap" %}
```bash
az servicebus topic subscription delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
{% endcode %}

### Akcije: `Microsoft.ServiceBus/namespaces/write` & `Microsoft.ServiceBus/namespaces/read`

Napada캜 sa dozvolama za kreiranje ili modifikovanje Azure Service Bus prostora imena mo쬰 iskoristiti ovo da ometa operacije, implementira neovla코캖ene resurse ili izlo쬴 osetljive podatke. Mogu promeniti kriti캜ne konfiguracije kao 코to su omogu캖avanje pristupa javnoj mre쬴, smanjenje pode코avanja enkripcije ili promenu SKU-ova kako bi pogor코ali performanse ili pove캖ali tro코kove. Pored toga, mogli bi onemogu캖iti lokalnu autentifikaciju, manipulisati lokacijama replika ili prilagoditi TLS verzije kako bi oslabili bezbednosne kontrole, 캜ine캖i pogre코nu konfiguraciju prostora imena zna캜ajnim rizikom nakon eksploatacije.

{% code overflow="wrap" %}
```bash
az servicebus namespace create --resource-group <ResourceGroupName> --name <NamespaceName> --location <Location>
az servicebus namespace update --resource-group <ResourceGroupName> --name <NamespaceName> --tags <Key=Value>
```
{% endcode %}


### Akcije: `Microsoft.ServiceBus/namespaces/queues/write` (`Microsoft.ServiceBus/namespaces/queues/read`)

Napada캜 sa dozvolama za kreiranje ili modifikovanje Azure Service Bus redova (da bi modifikovao red, tako캠e 캖e mu biti potrebna Akcija: `Microsoft.ServiceBus/namespaces/queues/read`) mo쬰 iskoristiti ovo da presretne podatke, ometa radne tokove ili omogu캖i neovla코캖en pristup. Mogu promeniti kriti캜ne konfiguracije kao 코to su prosle캠ivanje poruka na zlonamerne krajnje ta캜ke, pode코avanje TTL poruka da zadr쬰 ili obri코u podatke na nepropisan na캜in, ili omogu캖avanje dead-lettering-a da ometa obradu gre코aka. Pored toga, mogli bi manipulisati veli캜inama redova, trajanjem zaklju캜avanja ili statusima da ometaju funkcionalnost usluge ili izbegnu otkrivanje, 코to ovo 캜ini zna캜ajnim rizikom nakon eksploatacije.

{% code overflow="wrap" %}
```bash
az servicebus queue create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
az servicebus queue update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
{% endcode %}

### Akcije: `Microsoft.ServiceBus/namespaces/topics/write` (`Microsoft.ServiceBus/namespaces/topics/read`)

Napada캜 sa dozvolama za kreiranje ili modifikovanje tema (da bi modifikovao temu, tako캠e 캖e mu biti potrebna Akcija: `Microsoft.ServiceBus/namespaces/topics/read`) unutar Azure Service Bus imenskog prostora mo쬰 to iskoristiti da ometa tokove poruka, izlo쬴 osetljive podatke ili omogu캖i neovla코캖ene radnje. Koriste캖i komande poput az servicebus topic update, mogu manipulisati konfiguracijama kao 코to su omogu캖avanje particionisanja za zloupotrebu skalabilnosti, menjanje TTL pode코avanja da bi se nepravilno zadr쬬le ili odbacile poruke, ili onemogu캖avanje detekcije duplikata da bi se zaobi코li kontrole. Pored toga, mogli bi prilagoditi limite veli캜ine tema, promeniti status da bi ometali dostupnost, ili konfigurisati ekspresne teme za privremeno skladi코tenje presretnutih poruka, 캜ine캖i upravljanje temama kriti캜nim fokusom za ubla쬬vanje post-ekspolatacije.

{% code overflow="wrap" %}
```bash
az servicebus topic create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
az servicebus topic update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
{% endcode %}

### Akcije: `Microsoft.ServiceBus/namespaces/topics/subscriptions/write` (`Microsoft.ServiceBus/namespaces/topics/subscriptions/read`)

Napada캜 sa dozvolama za kreiranje ili modifikovanje pretplata (da bi modifikovao pretplatu, tako캠e 캖e mu biti potrebna Akcija: `Microsoft.ServiceBus/namespaces/topics/subscriptions/read`) unutar Azure Service Bus teme mo쬰 iskoristiti ovo da presretne, preusmeri ili ometa tokove poruka. Koriste캖i komande kao 코to je az servicebus topic subscription update, mogu manipulisati konfiguracijama kao 코to su omogu캖avanje dead lettering-a za preusmeravanje poruka, prosle캠ivanje poruka neovla코캖enim krajnjim ta캜kama, ili modifikovanje TTL i trajanja zaklju캜avanja kako bi zadr쬬li ili ometali isporuku poruka. Pored toga, mogu promeniti pode코avanja statusa ili maksimalnog broja isporuka kako bi ometali operacije ili izbegli otkrivanje, 캜ine캖i kontrolu pretplata kriti캜nim aspektom scenarija post-eksploatacije.

{% code overflow="wrap" %}
```bash
az servicebus topic subscription create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
az servicebus topic subscription update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
{% endcode %}


### Akcije: `AuthorizationRules` Slanje i Primanje Poruka

Pogledajte ovde:

{% content-ref url="../az-services/az-queue-privesc.md" %}
[az-queue-privesc.md](../az-services/az-queue-privesc.md)
{% endcontent-ref %}

## Reference

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-topics-subscriptions?tabs=passwordless
* https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/integration#microsoftservicebus
* https://learn.microsoft.com/en-us/cli/azure/servicebus/namespace?view=azure-cli-latest
* https://learn.microsoft.com/en-us/cli/azure/servicebus/queue?view=azure-cli-latest

<details>

<summary>Podr코ka HackTricks</summary>

* Proverite [**planove pretplate**](https://github.com/sponsors/carlospolop)!
* **Pridru쬴te se** 游눫 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili **pratite** nas na **Twitteru** 游냕 [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Podelite hakerske trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
{% endhint %}
