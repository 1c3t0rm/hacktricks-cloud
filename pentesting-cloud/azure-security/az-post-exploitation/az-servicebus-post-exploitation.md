# Az - Service Bus Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Service Bus

ìì„¸í•œ ì •ë³´ëŠ” ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../az-services/az-servicebus-enum.md" %}
[az-servicebus-enum.md](../az-services/az-servicebus-enum.md)
{% endcontent-ref %}

### Actions: `Microsoft.ServiceBus/namespaces/Delete`

ì´ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” ì „ì²´ Azure Service Bus ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì‘ì—…ì€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì™€ ëª¨ë“  ê´€ë ¨ ë¦¬ì†ŒìŠ¤(í, ì£¼ì œ, êµ¬ë… ë° í•´ë‹¹ ë©”ì‹œì§€ í¬í•¨)ë¥¼ ì œê±°í•˜ì—¬ ëª¨ë“  ì¢…ì† ì‹œìŠ¤í…œ ë° ì›Œí¬í”Œë¡œìš°ì—ì„œ ê´‘ë²”ìœ„í•œ ì¤‘ë‹¨ê³¼ ì˜êµ¬ì ì¸ ë°ì´í„° ì†ì‹¤ì„ ì´ˆë˜í•©ë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az servicebus namespace delete --resource-group <ResourceGroupName> --name <NamespaceName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/topics/Delete`

ì´ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” Azure Service Bus ì£¼ì œë¥¼ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì‘ì—…ì€ ì£¼ì œì™€ ê·¸ì— ì—°ê²°ëœ ëª¨ë“  êµ¬ë… ë° ë©”ì‹œì§€ë¥¼ ì œê±°í•˜ì—¬, ì¤‘ìš”í•œ ë°ì´í„° ì†ì‹¤ì„ ì´ˆë˜í•˜ê³  ì£¼ì œì— ì˜ì¡´í•˜ëŠ” ì‹œìŠ¤í…œ ë° ì›Œí¬í”Œë¡œìš°ë¥¼ ë°©í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az servicebus topic delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/queues/Delete`

ì´ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” Azure Service Bus íë¥¼ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì‘ì—…ì€ íì™€ ê·¸ ì•ˆì˜ ëª¨ë“  ë©”ì‹œì§€ë¥¼ ì œê±°í•˜ì—¬, ì¤‘ìš”í•œ ë°ì´í„° ì†ì‹¤ì„ ì´ˆë˜í•˜ê³  íì— ì˜ì¡´í•˜ëŠ” ì‹œìŠ¤í…œ ë° ì›Œí¬í”Œë¡œìš°ë¥¼ ë°©í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az servicebus queue delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/topics/subscriptions/Delete`

ì´ ê¶Œí•œì„ ê°€ì§„ ê³µê²©ìëŠ” Azure Service Bus êµ¬ë…ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì‘ì—…ì€ êµ¬ë…ê³¼ ê·¸ì— ì—°ê²°ëœ ëª¨ë“  ë©”ì‹œì§€ë¥¼ ì œê±°í•˜ì—¬ êµ¬ë…ì— ì˜ì¡´í•˜ëŠ” ì›Œí¬í”Œë¡œìš°, ë°ì´í„° ì²˜ë¦¬ ë° ì‹œìŠ¤í…œ ìš´ì˜ì— ì ì¬ì ìœ¼ë¡œ ì¤‘ë‹¨ì„ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az servicebus topic subscription delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/write` & `Microsoft.ServiceBus/namespaces/read`

Azure Service Bus ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ìˆëŠ” ê³µê²©ìëŠ” ì´ë¥¼ ì´ìš©í•´ ìš´ì˜ì„ ë°©í•´í•˜ê±°ë‚˜, ë¬´ë‹¨ ë¦¬ì†ŒìŠ¤ë¥¼ ë°°í¬í•˜ê±°ë‚˜, ë¯¼ê°í•œ ë°ì´í„°ë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë“¤ì€ ê³µìš© ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ì„ í™œì„±í™”í•˜ê±°ë‚˜, ì•”í˜¸í™” ì„¤ì •ì„ ë‚®ì¶”ê±°ë‚˜, SKUë¥¼ ë³€ê²½í•˜ì—¬ ì„±ëŠ¥ì„ ì €í•˜ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ë¡œì»¬ ì¸ì¦ì„ ë¹„í™œì„±í™”í•˜ê±°ë‚˜, ë³µì œ ìœ„ì¹˜ë¥¼ ì¡°ì‘í•˜ê±°ë‚˜, TLS ë²„ì „ì„ ì¡°ì •í•˜ì—¬ ë³´ì•ˆ í†µì œë¥¼ ì•½í™”ì‹œí‚¬ ìˆ˜ ìˆì–´, ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì˜ëª» êµ¬ì„±ì€ ì¤‘ìš”í•œ ì‚¬í›„ í™œìš© ìœ„í—˜ì´ ë©ë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az servicebus namespace create --resource-group <ResourceGroupName> --name <NamespaceName> --location <Location>
az servicebus namespace update --resource-group <ResourceGroupName> --name <NamespaceName> --tags <Key=Value>
```
{% endcode %}


### Actions: `Microsoft.ServiceBus/namespaces/queues/write` (`Microsoft.ServiceBus/namespaces/queues/read`)

Azure Service Bus íë¥¼ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ìˆëŠ” ê³µê²©ìëŠ” (íë¥¼ ìˆ˜ì •í•˜ë ¤ë©´ Action:`Microsoft.ServiceBus/namespaces/queues/read`ë„ í•„ìš”í•¨) ì´ë¥¼ ì´ìš©í•´ ë°ì´í„°ë¥¼ ê°€ë¡œì±„ê±°ë‚˜, ì›Œí¬í”Œë¡œë¥¼ ë°©í•´í•˜ê±°ë‚˜, ë¬´ë‹¨ ì ‘ê·¼ì„ ê°€ëŠ¥í•˜ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë“¤ì€ ì•…ì˜ì ì¸ ì—”ë“œí¬ì¸íŠ¸ë¡œ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ë„ë¡ ì„¤ì •í•˜ê±°ë‚˜, ë©”ì‹œì§€ TTLì„ ì¡°ì •í•˜ì—¬ ë°ì´í„°ë¥¼ ë¶€ì ì ˆí•˜ê²Œ ìœ ì§€í•˜ê±°ë‚˜ ì‚­ì œí•˜ê±°ë‚˜, ì˜¤ë¥˜ ì²˜ë¦¬ë¥¼ ë°©í•´í•˜ê¸° ìœ„í•´ ë°ë“œë ˆí„°ë§ì„ í™œì„±í™”í•˜ëŠ” ë“± ì¤‘ìš”í•œ êµ¬ì„±ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, í í¬ê¸°, ì ê¸ˆ ê¸°ê°„ ë˜ëŠ” ìƒíƒœë¥¼ ì¡°ì‘í•˜ì—¬ ì„œë¹„ìŠ¤ ê¸°ëŠ¥ì„ ë°©í•´í•˜ê±°ë‚˜ íƒì§€ë¥¼ í”¼í•  ìˆ˜ ìˆì–´, ì´ëŠ” ì¤‘ìš”í•œ í¬ìŠ¤íŠ¸ ìµìŠ¤í”Œë¡œì‡ ìœ„í—˜ì…ë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az servicebus queue create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
az servicebus queue update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/topics/write` (`Microsoft.ServiceBus/namespaces/topics/read`)

Azure Service Bus ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œ ì£¼ì œë¥¼ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ìˆëŠ” ê³µê²©ìëŠ” ì´ë¥¼ ì´ìš©í•˜ì—¬ ë©”ì‹œì§€ ì›Œí¬í”Œë¡œë¥¼ ë°©í•´í•˜ê±°ë‚˜, ë¯¼ê°í•œ ë°ì´í„°ë¥¼ ë…¸ì¶œì‹œí‚¤ê±°ë‚˜, ë¬´ë‹¨ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. az servicebus topic updateì™€ ê°™ì€ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬, í™•ì¥ì„±ì„ ìœ„í•œ íŒŒí‹°ì…”ë‹ í™œì„±í™”, ë©”ì‹œì§€ë¥¼ ë¶€ì ì ˆí•˜ê²Œ ìœ ì§€í•˜ê±°ë‚˜ íê¸°í•˜ê¸° ìœ„í•œ TTL ì„¤ì • ë³€ê²½, ë˜ëŠ” ì œì–´ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•œ ì¤‘ë³µ ê°ì§€ ë¹„í™œì„±í™”ì™€ ê°™ì€ êµ¬ì„±ì„ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ì£¼ì œ í¬ê¸° ì œí•œì„ ì¡°ì •í•˜ê±°ë‚˜, ê°€ìš©ì„±ì„ ë°©í•´í•˜ê¸° ìœ„í•´ ìƒíƒœë¥¼ ë³€ê²½í•˜ê±°ë‚˜, ê°€ë¡œì±ˆ ë©”ì‹œì§€ë¥¼ ì„ì‹œë¡œ ì €ì¥í•˜ê¸° ìœ„í•´ ìµìŠ¤í”„ë ˆìŠ¤ ì£¼ì œë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆì–´, ì£¼ì œ ê´€ë¦¬ëŠ” ì‚¬í›„ í™œìš© ì™„í™”ë¥¼ ìœ„í•œ ì¤‘ìš”í•œ ì´ˆì ì´ ë©ë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az servicebus topic create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
az servicebus topic update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/topics/subscriptions/write` (`Microsoft.ServiceBus/namespaces/topics/subscriptions/read`)

Azure Service Bus ì£¼ì œ ë‚´ì—ì„œ êµ¬ë…ì„ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ ìˆëŠ” ê³µê²©ìëŠ” ì´ë¥¼ ì´ìš©í•´ ë©”ì‹œì§€ ì›Œí¬í”Œë¡œë¥¼ ê°€ë¡œì±„ê±°ë‚˜, ì¬ë°°ì¹˜í•˜ê±°ë‚˜, ë°©í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. az servicebus topic subscription updateì™€ ê°™ì€ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ë©”ì‹œì§€ë¥¼ ì „í™˜í•˜ê¸° ìœ„í•´ ë°ë“œ ë ˆí„°ë§ì„ í™œì„±í™”í•˜ê±°ë‚˜, ë©”ì‹œì§€ë¥¼ ë¬´ë‹¨ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì „ë‹¬í•˜ê±°ë‚˜, TTL ë° ì ê¸ˆ ê¸°ê°„ì„ ìˆ˜ì •í•˜ì—¬ ë©”ì‹œì§€ ì „ë‹¬ì„ ìœ ì§€í•˜ê±°ë‚˜ ë°©í•´í•˜ëŠ” ë“±ì˜ êµ¬ì„±ì„ ì¡°ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ, ìƒíƒœ ë˜ëŠ” ìµœëŒ€ ì „ë‹¬ ìˆ˜ ì„¤ì •ì„ ë³€ê²½í•˜ì—¬ ì‘ì—…ì„ ë°©í•´í•˜ê±°ë‚˜ íƒì§€ë¥¼ í”¼í•  ìˆ˜ ìˆì–´ êµ¬ë… ì œì–´ëŠ” ì‚¬í›„ í™œìš© ì‹œë‚˜ë¦¬ì˜¤ì˜ ì¤‘ìš”í•œ ì¸¡ë©´ì´ ë©ë‹ˆë‹¤.

{% code overflow="wrap" %}
```bash
az servicebus topic subscription create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
az servicebus topic subscription update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
{% endcode %}


### ì‘ì—…: `AuthorizationRules` ë©”ì‹œì§€ ì „ì†¡ ë° ìˆ˜ì‹ 

ì—¬ê¸°ë¥¼ í™•ì¸í•˜ì„¸ìš”:

{% content-ref url="../az-services/az-queue-privesc.md" %}
[az-queue-privesc.md](../az-services/az-queue-privesc.md)
{% endcontent-ref %}

## ì°¸ì¡°

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-topics-subscriptions?tabs=passwordless
* https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/integration#microsoftservicebus
* https://learn.microsoft.com/en-us/cli/azure/servicebus/namespace?view=azure-cli-latest
* https://learn.microsoft.com/en-us/cli/azure/servicebus/queue?view=azure-cli-latest

<details>

<summary>HackTricks ì§€ì›í•˜ê¸°</summary>

* [**êµ¬ë… ê³„íš**](https://github.com/sponsors/carlospolop) í™•ì¸í•˜ì„¸ìš”!
* **ğŸ’¬ [**ë””ìŠ¤ì½”ë“œ ê·¸ë£¹**](https://discord.gg/hRep4RUj7f) ë˜ëŠ” [**í…”ë ˆê·¸ë¨ ê·¸ë£¹**](https://t.me/peass)ì— ì°¸ì—¬í•˜ê±°ë‚˜ **íŠ¸ìœ„í„°** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**ë¥¼ íŒ”ë¡œìš°í•˜ì„¸ìš”.**
* **[**HackTricks**](https://github.com/carlospolop/hacktricks) ë° [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) ê¹ƒí—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— PRì„ ì œì¶œí•˜ì—¬ í•´í‚¹ íŒì„ ê³µìœ í•˜ì„¸ìš”.**

</details>
{% endhint %}
