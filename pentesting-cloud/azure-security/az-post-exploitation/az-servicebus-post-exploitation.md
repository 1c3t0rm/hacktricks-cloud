# Az - Service Bus Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../.gitbook/assets/image (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Service Bus

Kwa maelezo zaidi angalia:

{% content-ref url="../az-services/az-servicebus-enum.md" %}
[az-servicebus-enum.md](../az-services/az-servicebus-enum.md)
{% endcontent-ref %}

### Actions: `Microsoft.ServiceBus/namespaces/Delete`

Mshambuliaji mwenye ruhusa hii anaweza kufuta namespace nzima ya Azure Service Bus. Kitendo hiki kinafuta namespace na rasilimali zote zinazohusiana, ikiwa ni pamoja na foleni, mada, usajili, na ujumbe wao, na kusababisha usumbufu mkubwa na kupoteza data kwa kudumu katika mifumo na michakato yote inayotegemea. 

{% code overflow="wrap" %}
```bash
az servicebus namespace delete --resource-group <ResourceGroupName> --name <NamespaceName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/topics/Delete`

Mshambuliaji mwenye ruhusa hii anaweza kufuta mada ya Azure Service Bus. Kitendo hiki kinafuta mada na usajili wake wote na ujumbe, na hivyo kuweza kusababisha kupotea kwa data muhimu na kuharibu mifumo na michakato inayotegemea mada hiyo.

{% code overflow="wrap" %}
```bash
az servicebus topic delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/queues/Delete`

Mshambuliaji mwenye ruhusa hii anaweza kufuta foleni ya Azure Service Bus. Kitendo hiki kinafuta foleni na ujumbe wote ndani yake, na huenda kusababisha kupoteza data muhimu na kuharibu mifumo na michakato inayotegemea foleni hiyo.

{% code overflow="wrap" %}
```bash
az servicebus queue delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/topics/subscriptions/Delete`

Mshambuliaji mwenye ruhusa hii anaweza kufuta usajili wa Azure Service Bus. Kitendo hiki kinafuta usajili na ujumbe wote uliohusishwa, na huenda kukatisha mchakato wa kazi, usindikaji wa data, na operesheni za mfumo zinazotegemea usajili huo.

{% code overflow="wrap" %}
```bash
az servicebus topic subscription delete --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/write` & `Microsoft.ServiceBus/namespaces/read`

Mshambuliaji mwenye ruhusa za kuunda au kubadilisha Azure Service Bus namespaces anaweza kutumia hii kuharibu shughuli, kupeleka rasilimali zisizoidhinishwa, au kufichua data nyeti. Wanaweza kubadilisha mipangilio muhimu kama vile kuwezesha ufikiaji wa mtandao wa umma, kupunguza mipangilio ya usimbuaji, au kubadilisha SKUs ili kudhoofisha utendaji au kuongeza gharama. Zaidi ya hayo, wanaweza kuzima uthibitishaji wa ndani, kubadilisha maeneo ya nakala, au kurekebisha toleo la TLS ili kudhoofisha udhibiti wa usalama, na kufanya makosa ya usanidi wa namespace kuwa hatari kubwa baada ya kutekeleza. 

{% code overflow="wrap" %}
```bash
az servicebus namespace create --resource-group <ResourceGroupName> --name <NamespaceName> --location <Location>
az servicebus namespace update --resource-group <ResourceGroupName> --name <NamespaceName> --tags <Key=Value>
```
{% endcode %}


### Actions: `Microsoft.ServiceBus/namespaces/queues/write` (`Microsoft.ServiceBus/namespaces/queues/read`)

Mshambuliaji mwenye ruhusa za kuunda au kubadilisha Azure Service Bus queues (ili kubadilisha foleni unahitaji pia Action: `Microsoft.ServiceBus/namespaces/queues/read`) anaweza kutumia hii kukamata data, kuharibu mchakato, au kuwezesha ufikiaji usioidhinishwa. Wanaweza kubadilisha mipangilio muhimu kama vile kupeleka ujumbe kwa maeneo mabaya, kubadilisha TTL ya ujumbe ili kuhifadhi au kufuta data vibaya, au kuwezesha dead-lettering kuingilia kati usimamizi wa makosa. Zaidi ya hayo, wanaweza kubadilisha saizi za foleni, muda wa kufunga, au hali ili kuharibu utendaji wa huduma au kuepuka kugunduliwa, na kufanya hii kuwa hatari kubwa baada ya kutekeleza. 

{% code overflow="wrap" %}
```bash
az servicebus queue create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
az servicebus queue update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <QueueName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/topics/write` (`Microsoft.ServiceBus/namespaces/topics/read`)

Mshambuliaji mwenye ruhusa za kuunda au kubadilisha mada (ili kubadilisha mada unahitaji pia Kitendo: `Microsoft.ServiceBus/namespaces/topics/read`) ndani ya eneo la Azure Service Bus anaweza kutumia hii kuharibu mchakato wa ujumbe, kufichua data nyeti, au kuwezesha vitendo visivyoidhinishwa. Kwa kutumia amri kama az servicebus topic update, wanaweza kubadilisha mipangilio kama vile kuwezesha ugawaji kwa matumizi mabaya ya upanuzi, kubadilisha mipangilio ya TTL ili kuhifadhi au kutupa ujumbe vibaya, au kuzima ugunduzi wa nakala ili kupita udhibiti. Zaidi ya hayo, wanaweza kurekebisha mipaka ya ukubwa wa mada, kubadilisha hali ili kuharibu upatikanaji, au kuunda mada za haraka kuhifadhi ujumbe waliokamatwa kwa muda, na kufanya usimamizi wa mada kuwa kipaumbele muhimu kwa kupunguza madhara baada ya kutekeleza. 

{% code overflow="wrap" %}
```bash
az servicebus topic create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
az servicebus topic update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --name <TopicName>
```
{% endcode %}

### Actions: `Microsoft.ServiceBus/namespaces/topics/subscriptions/write` (`Microsoft.ServiceBus/namespaces/topics/subscriptions/read`)

Mshambuliaji mwenye ruhusa za kuunda au kubadilisha usajili (ili kubadilisha usajili utahitaji pia Action: `Microsoft.ServiceBus/namespaces/topics/subscriptions/read`) ndani ya mada ya Azure Service Bus anaweza kutumia hii kukamata, kuelekeza upya, au kuharibu mchakato wa ujumbe. Kwa kutumia amri kama az servicebus topic subscription update, wanaweza kubadilisha mipangilio kama vile kuwezesha dead lettering ili kuelekeza ujumbe, kupeleka ujumbe kwa maeneo yasiyoidhinishwa, au kubadilisha TTL na muda wa kufunga ili kuhifadhi au kuingilia kati utoaji wa ujumbe. Zaidi ya hayo, wanaweza kubadilisha hali au mipangilio ya idadi ya juu ya utoaji ili kuharibu shughuli au kuepuka kugunduliwa, na kufanya udhibiti wa usajili kuwa kipengele muhimu katika hali za baada ya unyakuzi.

{% code overflow="wrap" %}
```bash
az servicebus topic subscription create --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
az servicebus topic subscription update --resource-group <ResourceGroupName> --namespace-name <NamespaceName> --topic-name <TopicName> --name <SubscriptionName>
```
{% endcode %}


### Actions: `AuthorizationRules` Tuma & Pokea Ujumbe

Angalia hapa:

{% content-ref url="../az-services/az-queue-privesc.md" %}
[az-queue-privesc.md](../az-services/az-queue-privesc.md)
{% endcontent-ref %}

## Marejeo

* https://learn.microsoft.com/en-us/azure/storage/queues/storage-powershell-how-to-use-queues
* https://learn.microsoft.com/en-us/rest/api/storageservices/queue-service-rest-api
* https://learn.microsoft.com/en-us/azure/storage/queues/queues-auth-abac-attributes
* https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-python-how-to-use-topics-subscriptions?tabs=passwordless
* https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/integration#microsoftservicebus
* https://learn.microsoft.com/en-us/cli/azure/servicebus/namespace?view=azure-cli-latest
* https://learn.microsoft.com/en-us/cli/azure/servicebus/queue?view=azure-cli-latest

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
