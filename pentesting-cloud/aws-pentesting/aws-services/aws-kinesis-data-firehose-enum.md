# AWS - Kinesis Data Firehose Enum

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Kinesis Data Firehose

Amazon Kinesis Data Firehose is 'n **volledig bestuurde diens** wat die aflewering van **real-time streaming data** fasiliteer. Dit ondersteun 'n verskeidenheid bestemmings, insluitend Amazon Simple Storage Service (Amazon S3), Amazon Redshift, Amazon OpenSearch Service, Splunk, en aangepaste HTTP-eindpunte.

Die diens verlig die behoefte om aansoeke te skryf of hulpbronne te bestuur deur data-produsente te konfigureer om data direk na Kinesis Data Firehose te stuur. Hierdie diens is verantwoordelik vir die **outomatiese aflewering van data na die gespesifiseerde bestemming**. Daarbenewens bied Kinesis Data Firehose die opsie om **die data te transformeer voordat dit afgelewer word**, wat die buigsaamheid en toepaslikheid daarvan tot verskeie gevalle verbeter.

### Enumerasie
```bash
# Get delivery streams
aws firehose list-delivery-streams

#¬†Get stream info
aws firehose describe-delivery-stream --delivery-stream-name <name>
## Get roles
aws firehose describe-delivery-stream --delivery-stream-name <name> | grep -i RoleARN
```
## Post-exploitasie / Verdedigingsoorskryding

In die geval waarin firehose gebruik word om logboeke of verdedigingsinsigte te stuur, kan 'n aanvaller deur hierdie funksionaliteite te gebruik, voorkom dat dit behoorlik werk.

### firehose:DeleteDeliveryStream
```
aws firehose delete-delivery-stream --delivery-stream-name <value> --allow-force-delete
```
### firehose:UpdateDestination

#### Omskrywing
Die `firehose:UpdateDestination` aksie word gebruik om 'n bestemming in 'n Kinesis Data Firehose-stroom by te werk. Hierdie aksie vereis `firehose:UpdateDestination` toestemmings.

#### Voorbeeld
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowUpdateDestination",
            "Effect": "Allow",
            "Action": [
                "firehose:UpdateDestination"
            ],
            "Resource": [
                "arn:aws:firehose:us-west-2:123456789012:deliverystream/my-delivery-stream"
            ]
        }
    ]
}
```

#### Aanbevelings
Dit word aanbeveel om streng beperkings op te stel vir die `firehose:UpdateDestination` toestemmings. Slegs geakkrediteerde gebruikers moet toegang h√™ tot hierdie aksie en slegs die spesifieke strome waarvoor hulle verantwoordelik is, moet toegelaat word.
```
aws firehose update-destination --delivery-stream-name <value> --current-delivery-stream-version-id <value> --destination-id <value>
```
### firehose:PutRecord | firehose:PutRecordBatch

#### Omskrywing
Die `firehose:PutRecord` en `firehose:PutRecordBatch` aksies word gebruik om data na 'n Kinesis Data Firehose stroom te stuur. Hierdie aksies kan gebruik word om die teenwoordigheid van 'n Kinesis Data Firehose stroom te bevestig en data na die stroom te stuur.

#### Voorbeeld
```markdown
1. aws firehose put-record --delivery-stream-name <stream_name> --record '{"Data":"<data>"}'
2. aws firehose put-record-batch --delivery-stream-name <stream_name> --records '[{"Data":"<data1>"},{"Data":"<data2>"}]'
```

#### Moontlike Aanvalle
- **Data-injeksie**: 'n Aanvaller kan probeer om skadelike data in die stroom in te spuit deur die `firehose:PutRecord` of `firehose:PutRecordBatch` aksies te misbruik.
- **Oorbelasting van stroom**: 'n Aanvaller kan probeer om die stroom te oorbelas deur 'n groot hoeveelheid data na die stroom te stuur met behulp van die `firehose:PutRecordBatch` aksie.

#### Verdediging
- Beperk die toegang tot die `firehose:PutRecord` en `firehose:PutRecordBatch` aksies tot vertroude gebruikers en rolle.
- Monitor die stroom vir ongewone aktiwiteit en stel waarskuwings in vir verdagte aksies.
- Implementeer data-validasie en sanitasie om te verseker dat slegs geldige data na die stroom gestuur word.
- Stel limiete in vir die hoeveelheid data wat na die stroom gestuur kan word om oorbelasting te voorkom.

#### Bronne
- [AWS Documentation: PutRecord](https://docs.aws.amazon.com/firehose/latest/APIReference/API_PutRecord.html)
- [AWS Documentation: PutRecordBatch](https://docs.aws.amazon.com/firehose/latest/APIReference/API_PutRecordBatch.html)
```
aws firehose put-record --delivery-stream-name my-stream --record '{"Data":"SGVsbG8gd29ybGQ="}'

aws firehose put-record-batch --delivery-stream-name my-stream --records file://records.json
```
## Verwysings

* [https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html](https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
