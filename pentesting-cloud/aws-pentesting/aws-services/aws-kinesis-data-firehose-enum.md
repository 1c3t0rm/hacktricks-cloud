# AWS - Kinesis Data Firehose Enum

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Kinesis Data Firehose

Amazon Kinesis Data Firehose is a **fully managed service** that facilitates the delivery of **real-time streaming data**. It supports a variety of destinations, including Amazon Simple Storage Service (Amazon S3), Amazon Redshift, Amazon OpenSearch Service, Splunk, and custom HTTP endpoints.

The service alleviates the need for writing applications or managing resources by allowing data producers to be configured to forward data directly to Kinesis Data Firehose. This service is responsible for the **automatic delivery of data to the specified destination**. Additionally, Kinesis Data Firehose provides the option to **transform the data prior to its delivery**, enhancing its flexibility and applicability to various use cases.

### Enumeration
```bash
# Get delivery streams
aws firehose list-delivery-streams

#¬†Get stream info
aws firehose describe-delivery-stream --delivery-stream-name <name>
## Get roles
aws firehose describe-delivery-stream --delivery-stream-name <name> | grep -i RoleARN
```
## Post-exploitation / Defense Bypass

In case firehose is used to send logs or defense insights, using these functionalities an attacker could prevent it from working properly.

### firehose:DeleteDeliveryStream

## Post-exploitation / Defense Bypass

ghItlh firehose vItlhutlh logs teH defense insights, using these functionalities an attacker could prevent it from working properly.

### firehose:DeleteDeliveryStream
```
aws firehose delete-delivery-stream --delivery-stream-name <value> --allow-force-delete
```
#### firehose:UpdateDestination

##### Description

The `UpdateDestination` action allows you to update the specified destination of an Amazon Kinesis Data Firehose delivery stream. This can be useful during a penetration test to modify the destination of the stream and redirect the data to a different location.

##### Syntax

```plaintext
aws firehose update-destination --delivery-stream-name <delivery-stream-name> --current-delivery-stream-version-id <current-delivery-stream-version-id> --destination-id <destination-id> --s3-destination-update <s3-destination-update> [--extended-s3-destination-update <extended-s3-destination-update>] [--redshift-destination-update <redshift-destination-update>] [--elasticsearch-destination-update <elasticsearch-destination-update>] [--splunk-destination-update <splunk-destination-update>] [--http-destination-update <http-destination-update>] [--open-xray-destination-update <open-xray-destination-update>] [--cloudwatch-logs-destination-update <cloudwatch-logs-destination-update>] [--http-endpoint-destination-update <http-endpoint-destination-update>] [--extended-http-endpoint-destination-update <extended-http-endpoint-destination-update>] [--kinesis-stream-destination-update <kinesis-stream-destination-update>] [--extended-kinesis-stream-destination-update <extended-kinesis-stream-destination-update>] [--processing-configuration-updates <processing-configuration-updates>] [--vpc-configuration-update <vpc-configuration-update>] [--deserializer-update <deserializer-update>] [--serializer-update <serializer-update>] [--input-format-configuration-update <input-format-configuration-update>] [--output-format-configuration-update <output-format-configuration-update>] [--encryption-configuration-update <encryption-configuration-update>] [--buffering-hints-update <buffering-hints-update>] [--cloudwatch-logging-options-update <cloudwatch-logging-options-update>] [--processing-configuration-update <processing-configuration-update>] [--cloudwatch-alarm-configuration-update <cloudwatch-alarm-configuration-update>] [--metric-namespace-update <metric-namespace-update>] [--metric-name-update <metric-name-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions-update <metric-dimensions-update>] [--metric-value-update <metric-value-update>] [--metric-timestamp-update <metric-timestamp-update>] [--metric-unit-update <metric-unit-update>] [--metric-statistic-update <metric-statistic-update>] [--metric-dimensions
```
aws firehose update-destination --delivery-stream-name <value> --current-delivery-stream-version-id <value> --destination-id <value>
```
### firehose:PutRecord | firehose:PutRecordBatch

#### Description
The `firehose:PutRecord` and `firehose:PutRecordBatch` actions are used to send data records to an Amazon Kinesis Data Firehose delivery stream. 

#### Impact
By exploiting these actions, an attacker can send arbitrary data records to a Kinesis Data Firehose delivery stream, potentially causing data corruption or disruption of downstream processes.

#### Detection
Monitor for API calls to the `firehose:PutRecord` and `firehose:PutRecordBatch` actions in CloudTrail logs.

#### Prevention
To prevent unauthorized access to the `firehose:PutRecord` and `firehose:PutRecordBatch` actions, ensure that only trusted entities have the necessary permissions to interact with the Kinesis Data Firehose service. Implement strong authentication and access controls to protect against unauthorized API calls. Regularly review and update permissions to minimize the risk of misuse.
```
aws firehose put-record --delivery-stream-name my-stream --record '{"Data":"SGVsbG8gd29ybGQ="}'

aws firehose put-record-batch --delivery-stream-name my-stream --records file://records.json
```
## References

* [https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html](https://docs.amazonaws.cn/en\_us/firehose/latest/dev/what-is-this-service.html)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
