# AWS - VPC & Netwerk Basiese Inligting

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy in HackTricks wil adverteer** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## AWS Netwerke in 'n neutedop

'n **VPC** bevat 'n **netwerk CIDR** soos 10.0.0.0/16 (met sy **roetetabel** en **netwerk ACL**).

Hierdie VPC-netwerk is verdeel in **subnetwerke**, so 'n **subnetwerk** is direk **verwant** aan die **VPC**, **roetetabel** en **netwerk ACL**.

Dan is **Netwerkintervlakke** wat aan dienste (soos EC2-instanties) gekoppel is, **verbind** met die **subnetwerke** met **sekuriteitsgroepe**.

Daarom sal 'n **sekuriteitsgroep** die blootgestelde poorte van die netwerk **intervlakke wat dit gebruik**, **beperk**, **onafhanklik van die subnetwerk**. En 'n **netwerk ACL** sal die blootgestelde poorte beperk tot die **hele netwerk**.

Verder, om toegang tot die internet te verkry, is daar 'n paar interessante konfigurasies om te kontroleer:

* 'n **Subnetwerk** kan **outomaties openbare IPv4-adresse toewys**
* 'n **Instansie** wat in die netwerk geskep is en **outomaties IPv4-adresse toewys**, kan een kry
* 'n **Internethek** moet aan die **VPC** **geheg** word
* Jy kan ook **Uitgaan-slegs internethekke** gebruik
* Jy kan ook 'n **NAT-hek** in 'n **privaat subnet** h√™ sodat dit moontlik is om vanuit daardie privaat subnet na eksterne dienste te **verbind**, maar dit is **nie moontlik om van buite af daardie dienste te bereik nie**.
* Die NAT-hek kan **openbaar** (toegang tot die internet) of **privaat** (toegang tot ander VPC's) wees

![](<../../../../.gitbook/assets/image (73).png>)

## VPC

Amazon **Virtual Private Cloud** (Amazon VPC) stel jou in staat om AWS-hulpbronne in 'n virtuele netwerk te **lanceer** wat jy gedefinieer het. Hierdie virtuele netwerk sal verskeie subnetwerke, Internethekke om toegang tot die internet te verkry, ACL's, sekuriteitsgroepe, IP's h√™...

### Subnetwerke

Subnetwerke help om 'n ho√´r vlak van sekuriteit af te dwing. **Logiese groepering van soortgelyke hulpbronne** help jou ook om 'n **maklike bestuur** oor jou infrastruktuur te handhaaf.

* Geldige CIDR's is van 'n /16 netmasker tot 'n /28 netmasker.
* 'n Subnetwerk kan nie terselfdertyd in verskillende beskikbaarheidsone wees nie.
* **AWS reserweer die eerste drie host-IP-adresse** van elke subnet **vir interne AWS-gebruik**: die eerste host-adres wat gebruik word, is vir die VPC-roeternavorser. Die tweede adres word gereserveer vir AWS DNS en die derde adres word gereserveer vir toekomstige gebruik.
* Dit word **openbare subnetwerke** genoem as hulle **direkte toegang tot die internet het, terwyl private subnetwerke dit nie het nie.**

<figure><img src="https://lh5.googleusercontent.com/N_WTrTrDAHwN61FMKJvLSHVua2EM0IazHH1fSTg8JQfTChm-dLN9mn7wkjz2MlpD-uOUqtWdMZpqKOp4VxaHy5-5X66GD1K8y1UGc27r-GbHdFty9ImpXdcjEsC7u4vjxKme_B_HwDOUnG6camxENYECTw=s2048" alt=""><figcaption></figcaption></figure>

<figure><img src="https://lh3.googleusercontent.com/MmjfVzGmV4jM7tO8lVoTKONoeqbq6E40DGeKUoo4kN-lmMDKnEiGNB-gGVx3EvjK9UV844im225CA8aAjomHf1Modt3MramHrHZdEGbeSZncWhVuT9R8f7tQZ2pXjdSJxeNfErmJ-0mmcUaV6dcU0TAd2A=s2048" alt=""><figcaption></figcaption></figure>

### Roetetabelle

Roetetabelle bepaal die verkeersroetes vir 'n subnetwerk binne 'n VPC. Hulle bepaal watter netwerkverkeer na die internet of na 'n VPN-verbinding gestuur word. Jy sal gewoonlik toegang h√™ tot die volgende:

* Plaaslike VPC
* NAT
* Internethekke / Uitgaan-slegs internethekke (nodig om 'n VPC toegang tot die internet te gee).
* Om 'n subnetwerk openbaar te maak, moet jy 'n **Internethek** aan jou VPC **skep** en **heg**.
* VPC-eindpunte (om S3 vanaf private netwerke te bereik)

In die volgende afbeeldings kan jy die verskille in 'n verstek openbare netwerk en 'n private een sien:

<figure><img src="https://lh3.googleusercontent.com/q4ASpcLAYqijdNMLhMLl8EoowDtTMU5I_7YCVfk7-5hxDyeQOik9ImHnD2SYy32XUA2qXjEbXTAxA1lP--znJASdhYOdBveDcrD42f9XBKZ3EmjJCazN3YPLC6oS0xtRMmfORuwCszmMt-KrAkH07_izwg=s2048" alt=""><figcaption></figcaption></figure>

<figure><img src="https://lh5.googleusercontent.com/30psylXAI0gRN6_LK-reP00aGIlMma64E1qafCVPunn6nS-y5jAO6Y2JiempKcf6-LFi7ScicYcOh7BbHEya2VWtksnFX_8SPXQf97tKkg2tNZzrArWbiDCCn2m2LP1QUq6MZ_KayH3yir7t8zpO7CEQOw=s2048" alt=""><figcaption></figcaption></figure>

### ACL's

**Netwerktoegangsbeheerlyste (ACL's)**: Netwerk ACL's is vuremuur-re√´ls wat inkomende en uitgaande netwerkverkeer na 'n subnetwerk beheer. Hulle kan gebruik word om verkeer na spesifieke IP-adresse of reekse toe te laat of te weier.

* Dit is mees algemeen om toegang toe te laat/weier deur sekuriteitsgroepe te gebruik, maar dit is die enigste manier om volledig gevestigde omgekeerde skulpe te sny. 'n Gewysigde re√´l in 'n sekuriteitsgroep stop nie reeds gevestigde verbindings nie.
* Dit geld egter vir die hele subnetwerk, wees versigtig wanneer jy dinge verbied, want nodige funksionaliteit kan versteur word.
### Sekuriteitsgroepe

Sekuriteitsgroepe is 'n virtuele **brandmuur** wat inkomende en uitgaande netwerk **verkeer na instansies** in 'n VPC beheer. Verhouding 1 SG tot M instansies (gewoonlik 1 tot 1).\
Gewoonlik word dit gebruik om gevaarlike poorte in instansies oop te maak, soos byvoorbeeld poort 22:

<figure><img src="https://lh5.googleusercontent.com/LliB7eb3cYfkEyOpyw1-eYgWsn2kq1yF6uRn5VYndvOuTvDlURimYx9UvuK8F2impTLmx50mid4MdTXE-Ljt2i_rxaIfnKUdji_hFjCdU9tdoW-axng9-W4tSL71gbbjrPQ7IYY5lAdH_G3UoMRMGGGOxQ=s2048" alt=""><figcaption></figcaption></figure>

### Elastiese IP-adresse

'n _Elastiese IP-adres_ is 'n **statiese IPv4-adres** wat ontwerp is vir dinamiese wolkrekenaars. 'n Elastiese IP-adres word toegewys aan jou AWS-rekening en is joune totdat jy dit vrylaat. Deur 'n Elastiese IP-adres te gebruik, kan jy die mislukking van 'n instansie of sagteware masker deur die adres vinnig na 'n ander instansie in jou rekening te herkaart.

### Verbinding tussen subnetwerke

Standaard het alle subnetwerke die **outomatiese toekenning van openbare IP-adresse uitgeschakel**, maar dit kan aangeskakel word.

**'n Plaaslike roete binne 'n roetetabel maak kommunikasie tussen VPC-subnetwerke moontlik.**

As jy 'n subnet met 'n ander subnet **verbind, kan jy nie toegang kry tot die subnetwerke wat met die ander subnet verbind is nie**, jy moet direk 'n verbinding daarmee skep. **Dit geld ook vir internethekke**. Jy kan nie deur 'n subnetverbinding gaan om toegang tot die internet te verkry nie, jy moet die internethek aan jou subnet toewys.

### VPC-koppeling

VPC-koppeling stel jou in staat om **twee of meer VPC's met mekaar te verbind**, deur gebruik te maak van IPV4 of IPV6, asof hulle deel is van dieselfde netwerk.

Sodra die koppelvlak tot stand gebring is, kan **hulpbronne in een VPC toegang verkry tot hulpbronne in die ander**. Die koppeling tussen die VPC's word ge√Ømplementeer deur die bestaande AWS-netwerkinfrastruktuur, en dit is dus hoogs beskikbaar sonder bandwydtebeperking. Aangesien **gekoppelde verbindinge werk asof hulle deel is van dieselfde netwerk**, is daar beperkings wanneer dit kom by die CIDR-blokreeks wat gebruik kan word.\
As jy **oorvleuelende of duplikaat CIDR-reeks** het vir jou VPC's, sal jy **nie die VPC's kan koppel nie**.\
Elke AWS VPC sal **slegs kommunikeer met sy eweknie**. Byvoorbeeld, as jy 'n koppelvlakverbinding het tussen VPC 1 en VPC 2, en 'n ander verbinding tussen VPC 2 en VPC 3 soos getoon, kan VPC 1 en 2 direk met mekaar kommunikeer, net soos VPC 2 en VPC 3, maar VPC 1 en VPC 3 nie. **Jy kan nie deur een VPC roete om na 'n ander te kom nie.**

### **VPC-vloei-logboeke**

Binne jou VPC kan jy moontlik honderde of selfs duisende hulpbronne h√™ wat kommunikeer tussen verskillende subnetwerke, beide openbaar en privaat, en ook tussen verskillende VPC's deur VPC-koppelvlakverbindinge. **VPC-vloei-logboeke stel jou in staat om IP-verkeersinligting wat vloei tussen die netwerkinterfaces van jou hulpbronne binne jou VPC, vas te vang**.

In teenstelling met S3-toegangslogboeke en CloudFront-toegangslogboeke, word die **logdata wat deur VPC-vloei-logboeke gegenereer word, nie in S3 gestoor nie. In plaas daarvan word die vasgevangde logdata na CloudWatch-logboeke gestuur**.

Beperkings:

* As jy 'n VPC-gekoppelde verbinding gebruik, sal jy slegs vloei-logboeke van gekoppelde VPC's binne dieselfde rekening kan sien.
* As jy steeds hulpbronne in die EC2-Classic-omgewing gebruik, kan jy ongelukkig nie inligting van hul koppelvlakke herwin nie.
* Sodra 'n VPC-vloei-logboek geskep is, kan dit nie verander word nie. Om die VPC-vloei-logboekkonfigurasie te wysig, moet jy dit uitvee en dan 'n nuwe een skep.
* Die volgende verkeer word nie gemonitor en vasgevang deur die logboeke nie. DHCP-verkeer binne die VPC, verkeer van instansies wat bestem is vir die Amazon DNS-bediener.
* Enige verkeer wat bestem is vir die IP-adres vir die VPC-standaardroetern en verkeer van en na die volgende adresse, 169.254.169.254 wat gebruik word om instansiemetadata in te samel, en 169.254.169.123 wat gebruik word vir die Amazon Time Sync-diens.
* Verkeer wat verband hou met 'n Amazon Windows-aktiveringslisensie van 'n Windows-instansie.
* Verkeer tussen 'n netwerklaaibalanseerderkoppelvlak en 'n eindpunt-netwerkinterface.

Vir elke netwerkinterface wat data na die CloudWatch-loggroep publiseer, sal dit 'n ander logstroom gebruik. En binne elkeen van hierdie strome sal daar die vloei-loggebeurtenisdata wees wat die inhoud van die loginskrywings toon. Elkeen van hierdie **logboeke vang data op gedurende 'n venster van ongeveer 10 tot 15 minute**.

## VPN

### Basiese AWS VPN-komponente

1. **Kli√´nthek**:
* 'n Kli√´nthek is 'n hulpbron wat jy in AWS skep om jou kant van 'n VPN-verbinding te verteenwoordig.
* Dit is in wese 'n fisiese toestel of sagtewaretoepassing aan jou kant van die Site-to-Site VPN-verbinding.
* Jy voorsien roetine-inligting en die openbare IP-adres van jou netwerktoestel (soos 'n router of 'n brandmuur) aan AWS om 'n Kli√´nthek te skep.
* Dit dien as 'n verwysingspunt vir die opstel van die VPN-verbinding en veroorsaak geen addisionele koste nie.
2. **Virtuele privaathek**:
* 'n Virtuele privaathek (VPG) is die VPN-konsentreerder aan die Amazon-kant van die Site-to-Site VPN-verbinding.
* Dit is aan jou VPC geheg en dien as die teiken vir jou VPN-verbinding.
* VPG is die AWS-kantpunt vir die VPN-verbinding.
* Dit hanteer die veilige kommunikasie tussen jou VPC en jou plaaslike netwerk.
3. **Site-to-Site VPN-verbinding**:
* 'n Site-to-Site VPN-verbinding verbind jou plaaslike netwerk met 'n VPC deur 'n veilige, IPsec VPN-tunnel.
* Hierdie tipe verbinding vereis 'n Kli√´nthek en 'n Virtuele privaathek.
* Dit word gebruik vir veilige, stabiele en konsekwente kommunikasie tussen jou data sentrum of netwerk en jou AWS-omgewing.
* Gewoonlik gebruik vir gereelde, langtermynverbindinge en word gefaktureer op grond van die hoeveelheid data wat oor die verbinding oorgedra word.
4. **Kli√´nt-VPN-eindpunt**:
* 'n Kli√´nt-VPN-eindpunt is 'n hulpbron wat jy in AWS skep om kli√´nt-VPN-sessies moontlik te maak en te bestuur.
* Dit word gebruik om individuele toestelle (soos draagbare rekenaars, slimfone, ens.) toe te laat om veilig te koppel aan AWS-hulpbronne of jou plaaslike netwerk.
* Dit verskil van Site-to-Site VPN daarin dat dit ontwerp is vir individuele kli√´nte eerder as om hele netwerke te koppel.
* Met Kli√´nt-VPN gebruik elke kli√´nttoestel 'n VPN-kli√´ntagteware om 'n veilige verbinding tot stand te bring.

### Site-to-Site VPN
#### Beperkings

* IPv6-verkeer word nie ondersteun vir VPN-verbindinge op 'n virtuele privaat gateway nie.
* 'n AWS VPN-verbinding ondersteun nie Path MTU Discovery nie.

Daarbenewens moet jy die volgende in ag neem wanneer jy Site-to-Site VPN gebruik.

* Wanneer jy jou VPC's aan 'n gemeenskaplike on-premises netwerk koppel, beveel ons aan dat jy nie-oorvleuelende CIDR-blokkies vir jou netwerke gebruik nie.

### Kli√´nt VPN <a href="#what-is-components" id="what-is-components"></a>

**Verbind vanaf jou rekenaar na jou VPC**

#### Konsepte

* **Kli√´nt VPN-eindpunt:** Die bron wat jy skep en konfigureer om kli√´nt VPN-sessies te aktiveer en te bestuur. Dit is die bron waar alle kli√´nt VPN-sessies be√´indig word.
* **Teikennetwerk:** 'n Teikennetwerk is die netwerk wat jy koppel aan 'n Kli√´nt VPN-eindpunt. **'n Subnet van 'n VPC is 'n teikennetwerk**. Deur 'n subnet te koppel aan 'n Kli√´nt VPN-eindpunt, kan jy VPN-sessies vestig. Jy kan verskeie subnets koppel aan 'n Kli√´nt VPN-eindpunt vir ho√´ beskikbaarheid. Alle subnets moet van dieselfde VPC wees. Elke subnet moet behoort aan 'n ander beskikbaarheidssone.
* **Roete**: Elke Kli√´nt VPN-eindpunt het 'n roetetabel wat die beskikbare bestemmingsnetwerkroetes beskryf. Elke roete in die roetetabel spesifiseer die pad vir verkeer na spesifieke hulpbronne of netwerke.
* **Goedkeuringsre√´ls:** 'n Goedkeuringsre√´l **beperk die gebruikers wat toegang kan verkry tot 'n netwerk**. Vir 'n gespesifiseerde netwerk konfigureer jy die Active Directory of identiteitsverskaffer (IdP) groep wat toegang toegelaat word. Slegs gebruikers wat tot hierdie groep behoort, kan toegang verkry tot die gespesifiseerde netwerk. **Standaard is daar geen goedkeuringsre√´ls nie** en jy moet goedkeuringsre√´ls konfigureer om gebruikers in staat te stel om hulpbronne en netwerke te benader.
* **Kli√´nt:** Die eindgebruiker wat verbind met die Kli√´nt VPN-eindpunt om 'n VPN-sessie te vestig. Eindgebruikers moet 'n OpenVPN-kli√´nt aflaai en die Kli√´nt VPN-konfigurasie-l√™er wat jy geskep het, gebruik om 'n VPN-sessie te vestig.
* **Kli√´nt CIDR-reeks:** 'n IP-adresreeks waaruit kli√´nt IP-adresse toegewys word. Elke verbinding met die Kli√´nt VPN-eindpunt word 'n unieke IP-adres toegewys uit die kli√´nt CIDR-reeks. Jy kies die kli√´nt CIDR-reeks, byvoorbeeld `10.2.0.0/16`.
* **Kli√´nt VPN-poorte:** AWS Kli√´nt VPN ondersteun poorte 443 en 1194 vir beide TCP en UDP. Die verstekpoort is poort 443.
* **Kli√´nt VPN-netwerkinterfaces:** Wanneer jy 'n subnet koppel aan jou Kli√´nt VPN-eindpunt, skep ons Kli√´nt VPN-netwerkinterfaces in daardie subnet. **Verkeer wat vanaf die Kli√´nt VPN-eindpunt na die VPC gestuur word, word deur 'n Kli√´nt VPN-netwerkinterface gestuur**. Bronnetwerkadresvertaling (SNAT) word dan toegepas, waar die bron-IP-adres van die kli√´nt CIDR-reeks vertaal word na die IP-adres van die Kli√´nt VPN-netwerkinterface.
* **Verbindingslogging:** Jy kan verbindingslogging aktiveer vir jou Kli√´nt VPN-eindpunt om verbindingsgebeure te log. Jy kan hierdie inligting gebruik vir forensiese ondersoeke, analiseer hoe jou Kli√´nt VPN-eindpunt gebruik word, of verbindingsprobleme oplos.
* **Selfbedieningsportaal:** Jy kan 'n selfbedieningsportaal aktiveer vir jou Kli√´nt VPN-eindpunt. Kli√´nte kan inlog op die webgebaseerde portaal met hul geloofsbriewe en die nuutste weergawe van die Kli√´nt VPN-eindpunt-konfigurasie-l√™er aflaai, of die nuutste weergawe van die AWS-verskafte kli√´nt.

#### Beperkings

* **Kli√´nt CIDR-reekse kan nie oorvleuel met die plaaslike CIDR** van die VPC waarin die gekoppelde subnet gele√´ is, of enige roetes wat handmatig by die roetetabel van die Kli√´nt VPN-eindpunt gevoeg is nie.
* Kli√´nt CIDR-reekse moet 'n blokgrootte h√™ van ten minste /22 en mag nie groter as /12 wees nie.
* 'n **Gedeelte van die adresse** in die kli√´nt CIDR-reeks word gebruik om die beskikbaarheidsmodel van die Kli√´nt VPN-eindpunt te ondersteun en kan nie aan kli√´nte toegewys word nie. Daarom beveel ons aan dat jy 'n CIDR-blok toewys wat dubbel die aantal IP-adresse bevat wat benodig word om die maksimum aantal gelyktydige verbindings wat jy beplan om op die Kli√´nt VPN-eindpunt te ondersteun, te aktiveer.
* Die **kli√´nt CIDR-reeks kan nie verander word** nadat jy die Kli√´nt VPN-eindpunt geskep het nie.
* Die **subnets** wat gekoppel is aan 'n Kli√´nt VPN-eindpunt, **moet in dieselfde VPC wees**.
* Jy **kan nie verskeie subnets van dieselfde beskikbaarheidssone koppel aan 'n Kli√´nt VPN-eindpunt**.
* 'n Kli√´nt VPN-eindpunt **ondersteun nie subnetkoppelings in 'n VPC met toegewyde tenansie** nie.
* Kli√´nt VPN ondersteun slegs **IPv4-verkeer**.
* Kli√´nt VPN voldoen **nie** aan die Federale Inligtingsverwerkingstandaarde (**FIPS**) **nie**.
* As multifaktor-autentifikasie (MFA) gedeaktiveer is vir jou Active Directory, kan 'n gebruikerswagwoord nie in die volgende formaat wees nie.

```
SCRV1:<base64_encoded_string>:<base64_encoded_string>
```
* Die selfbedieningsportaal is **nie beskikbaar vir kli√´nte wat outentifiseer met wederkerige outentifikasie** nie.

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks-uitrusting**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
