# AWS - Secrets Manager Post Exploitation

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>!HackTricks</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Secrets Manager

For more information check:

{% content-ref url="../../aws-security/aws-services/aws-secrets-manager-enum.md" %}
[aws-secrets-manager-enum.md](../../aws-security/aws-services/aws-secrets-manager-enum.md)
{% endcontent-ref %}

### Read Secrets

The **secrets themself are sensitive information**, [check the privesc page](../../aws-security/aws-privilege-escalation/aws-secrets-manager-privesc.md) to learn how to read them.

### DoS Change Secret Value

Changing the value of the secret you could **DoS all the system that depends on that value.**

{% hint style="warning" %}
Note that previous values are also stored, so it's easy to just go back to the previous value.
{% endhint %}
```bash
# Requires permission secretsmanager:PutSecretValue
aws secretsmanager put-secret-value \
--secret-id MyTestSecret \
--secret-string "{\"user\":\"diegor\",\"password\":\"EXAMPLE-PASSWORD\"}"
```
### DoS Change KMS key

#### Description

In some cases, it may be possible to perform a Denial of Service (DoS) attack by changing the Key Management Service (KMS) key in AWS Secrets Manager. This can lead to disruption of the encryption and decryption processes, potentially rendering the secrets inaccessible.

#### Exploitation

To exploit this vulnerability, an attacker needs to have access to the AWS Secrets Manager service and the necessary permissions to modify KMS keys. The following steps outline the process:

1. Identify the target AWS Secrets Manager instance.
2. Determine the KMS key associated with the Secrets Manager instance.
3. Gain access to the AWS Secrets Manager service.
4. Modify the KMS key associated with the Secrets Manager instance.
5. Verify that the KMS key has been successfully changed.

#### Mitigation

To mitigate this vulnerability, it is recommended to follow these best practices:

- Implement strong access controls and permissions for AWS Secrets Manager.
- Regularly monitor and audit changes to KMS keys.
- Enable CloudTrail logging to track any unauthorized modifications.
- Implement multi-factor authentication (MFA) for AWS Secrets Manager.
- Regularly rotate KMS keys to minimize the impact of a potential DoS attack.

#### References

- [AWS Secrets Manager Documentation](https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html)
- [AWS Key Management Service Documentation](https://docs.aws.amazon.com/kms/latest/developerguide/overview.html)
```bash
aws secretsmanager update-secret \
--secret-id MyTestSecret \
--kms-key-id arn:aws:kms:us-west-2:123456789012:key/EXAMPLE1-90ab-cdef-fedc-ba987EXAMPLE
```
### DoS Deleting Secret

**tlhIngan Hol Translation:**

**DoS Deletion Secret**

**The minimun num of days to delete a secret are 7**

**tlhIngan Hol Translation:**

**DoS Deletion Secret**

**The minimun num of days to delete a secret are 7**
```bash
aws secretsmanager delete-secret \
--secret-id MyTestSecret \
--recovery-window-in-days 7
```
<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
