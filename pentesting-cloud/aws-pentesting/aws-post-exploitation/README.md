# AWS - Sonrası Sızma

---

## AWS CLI

The AWS Command Line Interface (CLI) is a unified tool to manage your AWS services. It allows you to control multiple AWS services from the command line and automate them through scripts. The AWS CLI is installed by default on Amazon Linux and Amazon Linux 2 instances. 

### Installation

To install the AWS CLI on your local machine, follow the instructions provided in the [official AWS CLI documentation](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-quickstart.html#cli-quickstart-install-awscli).

### Configuration

After installing the AWS CLI, you need to configure it with your AWS access key ID, secret access key, and default region. You can do this by running the `aws configure` command and providing the required information.

### Usage

Once the AWS CLI is installed and configured, you can use it to interact with various AWS services. Some common commands include:

- `aws ec2 describe-instances`: Retrieves information about EC2 instances.
- `aws s3 ls`: Lists all S3 buckets.
- `aws iam list-users`: Lists all IAM users.
- `aws rds describe-db-instances`: Retrieves information about RDS instances.

For a complete list of available commands and their usage, refer to the [AWS CLI Command Reference](https://docs.aws.amazon.com/cli/latest/index.html).

---

## AWS Metadata Service

The AWS Metadata Service allows EC2 instances to retrieve information about themselves and their associated resources. This information can be useful during post-exploitation activities.

### Retrieving Instance Metadata

To retrieve instance metadata, you can make an HTTP GET request to the following URL:

```
http://169.254.169.254/latest/meta-data/
```

This will return a list of available metadata categories. You can then append the desired category to the URL to retrieve specific metadata. For example, to retrieve the instance ID, you can make a request to:

```
http://169.254.169.254/latest/meta-data/instance-id
```

### Retrieving User Data

User data is information that can be passed to an EC2 instance during launch. It can contain scripts, configuration files, or any other data that you want to make available to the instance. To retrieve user data, you can make an HTTP GET request to the following URL:

```
http://169.254.169.254/latest/user-data/
```

### Exploiting Metadata Service

In some cases, the metadata service may be misconfigured and allow unauthorized access to sensitive information. For example, if the IAM role assigned to the instance has excessive permissions, an attacker may be able to retrieve AWS access keys or other sensitive data.

To exploit the metadata service, you can use tools like `curl` or `wget` to make HTTP requests to the metadata URLs mentioned above. Additionally, you can also use programming languages like Python to interact with the metadata service programmatically.

---

## AWS SDKs

AWS provides Software Development Kits (SDKs) for various programming languages, including Python, Java, and .NET. These SDKs allow you to interact with AWS services programmatically, making it easier to automate tasks and integrate AWS functionality into your applications.

### Installation

To install an AWS SDK for your preferred programming language, refer to the [official AWS SDK documentation](https://aws.amazon.com/tools/).

### Usage

Once you have installed an AWS SDK, you can use it to interact with AWS services in your code. Each SDK provides a set of classes and methods that correspond to different AWS services and operations.

For example, using the AWS SDK for Python (Boto3), you can interact with EC2 instances using the `ec2` client object. Here's an example of how to retrieve information about EC2 instances using Boto3:

```python
import boto3

# Create an EC2 client
ec2 = boto3.client('ec2')

# Retrieve information about instances
response = ec2.describe_instances()

# Process the response
for reservation in response['Reservations']:
    for instance in reservation['Instances']:
        print(instance['InstanceId'])
```

For more information on using AWS SDKs, refer to the documentation specific to your chosen programming language.

---

## AWS CloudTrail

AWS CloudTrail is a service that enables governance, compliance, operational auditing, and risk auditing of your AWS account. It provides a history of AWS API calls made by your account, including the identity of the caller, the time of the call, and the parameters passed.

### Enabling CloudTrail

To enable CloudTrail for your AWS account, follow the instructions provided in the [official AWS CloudTrail documentation](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-create-and-update-a-trail.html).

### Retrieving CloudTrail Logs

Once CloudTrail is enabled, it will start logging API calls made by your account. You can retrieve these logs using the AWS CLI or the CloudTrail console.

To retrieve CloudTrail logs using the AWS CLI, you can use the `aws cloudtrail lookup-events` command. For example, to retrieve the last 10 events, you can run:

```
aws cloudtrail lookup-events --max-results 10
```

This will return a list of events in JSON format, including details such as the event name, event time, and event source.

---

## Conclusion

In this section, we have explored various post-exploitation techniques in AWS. We have covered the AWS CLI, the AWS Metadata Service, AWS SDKs, and AWS CloudTrail. These tools and services can be leveraged during post-exploitation activities to gather information, automate tasks, and maintain persistence in an AWS environment.
