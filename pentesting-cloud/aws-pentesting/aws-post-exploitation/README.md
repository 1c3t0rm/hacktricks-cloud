# AWS - Post Exploitation

## Persistence

After gaining access to an AWS environment, it is important to establish persistence to maintain control over the compromised system. Here are some techniques that can be used for persistence:

### Backdooring EC2 Instances

1. **User Data**: Modify the user data script of an EC2 instance to execute malicious commands or scripts upon startup.
2. **Metadata Service**: Exploit the EC2 instance metadata service to execute commands or scripts by modifying the user data of the instance.
3. **AMI Backdooring**: Create a custom Amazon Machine Image (AMI) with a backdoor installed, and launch new instances from this AMI.

### IAM Backdooring

1. **IAM Policies**: Modify the IAM policies to grant additional permissions to the compromised user or role.
2. **IAM Roles**: Create new IAM roles with elevated privileges and assign them to the compromised user or instance.

### CloudTrail Manipulation

1. **Log Manipulation**: Modify or delete CloudTrail logs to cover up malicious activities.
2. **Event Subscription**: Create a new event subscription to capture sensitive information or perform actions on specific events.

## Lateral Movement

Once persistence is established, lateral movement techniques can be used to explore and compromise other resources within the AWS environment. Here are some techniques for lateral movement:

### AWS CLI

1. **Access Key**: Use compromised access keys to authenticate and interact with other AWS services.
2. **STS AssumeRole**: Use the `sts assume-role` command to assume the role of another user or role within the AWS account.

### AWS APIs

1. **Access Key**: Use compromised access keys to make API calls to other AWS services.
2. **Temporary Security Credentials**: Obtain temporary security credentials using the `AssumeRole` API call to assume the role of another user or role.

### EC2 Instance Connect

1. **SSH Key Pair**: Use the compromised SSH key pair to connect to other EC2 instances within the same VPC.
2. **Instance Connect API**: Use the EC2 Instance Connect API to establish SSH connections to other instances.

## Data Exfiltration

Once access to sensitive data is obtained, data exfiltration techniques can be used to steal and extract the data from the AWS environment. Here are some techniques for data exfiltration:

### S3 Bucket

1. **AWS CLI**: Use the AWS CLI to copy sensitive data from S3 buckets to an external location.
2. **AWS SDKs**: Use AWS SDKs to programmatically access and download sensitive data from S3 buckets.

### Database

1. **Database Dump**: Dump the contents of databases to extract sensitive data.
2. **Database APIs**: Use database APIs to programmatically access and extract sensitive data.

### CloudFront

1. **Access Logs**: Access and download CloudFront access logs to obtain sensitive information.
2. **Custom Error Pages**: Modify custom error pages to exfiltrate sensitive data.

## Conclusion

Post-exploitation in AWS requires careful planning and execution to maintain persistence, move laterally, and exfiltrate data. By understanding these techniques, you can better secure your AWS environment and detect any potential compromises.
