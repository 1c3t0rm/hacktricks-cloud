# AWS - 사후 침투

## EC2 Metadata

EC2 인스턴스의 메타데이터는 인스턴스에 대한 정보를 제공합니다. 이 정보는 인스턴스 내부에서 사용되는 IAM 역할, 보안 그룹, IP 주소 등을 포함합니다. 메타데이터는 인스턴스 내부에서 `http://169.254.169.254/latest/meta-data/`를 통해 액세스할 수 있습니다.

### 메타데이터 카테고리

- ami-id: 인스턴스의 AMI ID
- ami-launch-index: AMI에서 인스턴스가 시작된 인덱스
- ami-manifest-path: AMI의 매니페스트 경로
- block-device-mapping/: 블록 장치 매핑 정보
- events/: 인스턴스 이벤트
- hostname: 인스턴스의 호스트 이름
- iam/: IAM 역할 및 보안 자격 증명 정보
- instance-action: 인스턴스에 대한 현재 작업
- instance-id: 인스턴스의 고유 식별자
- instance-life-cycle: 인스턴스의 생명 주기
- instance-type: 인스턴스 유형
- local-hostname: 인스턴스의 로컬 호스트 이름
- local-ipv4: 인스턴스의 로컬 IPv4 주소
- mac: 인스턴스의 MAC 주소
- metrics/: 인스턴스 메트릭
- network/: 인스턴스 네트워크 인터페이스 정보
- placement/: 인스턴스 배치 정보
- profile: 인스턴스 프로파일
- public-hostname: 인스턴스의 공용 호스트 이름
- public-ipv4: 인스턴스의 공용 IPv4 주소
- public-keys/: 인스턴스에 연결된 공개 키
- reservation-id: 예약 ID
- security-groups: 인스턴스의 보안 그룹
- services/: 인스턴스에서 사용 가능한 서비스
- user-data: 인스턴스에 대한 사용자 데이터

## AWS CLI

AWS CLI(Command Line Interface)는 AWS 리소스를 관리하기 위한 명령줄 도구입니다. 이를 사용하여 EC2 인스턴스를 제어하고, S3 버킷을 관리하며, IAM 사용자를 생성하는 등 다양한 작업을 수행할 수 있습니다.

### 설치

AWS CLI를 설치하려면 다음 명령을 실행합니다:

```bash
$ pip install awscli
```

### 구성

AWS CLI를 사용하기 위해 구성 파일을 설정해야 합니다. 구성 파일은 `~/.aws/config`에 저장됩니다. 다음은 구성 파일의 예입니다:

```ini
[default]
region = us-west-2
output = json
```

### 사용법

AWS CLI를 사용하여 EC2 인스턴스의 목록을 가져오려면 다음 명령을 실행합니다:

```bash
$ aws ec2 describe-instances
```

## AWS SDKs

AWS SDKs(Software Development Kits)는 다양한 프로그래밍 언어로 작성된 개발 도구입니다. 이를 사용하여 AWS 리소스를 프로그래밍 방식으로 제어할 수 있습니다. AWS SDKs는 다양한 언어로 제공되며, 각 언어에 대한 설치 및 사용법은 해당 언어의 문서를 참조하시기 바랍니다.

## AWS CloudFormation

AWS CloudFormation은 인프라스트럭처를 코드로 정의하고 프로비저닝, 업데이트 및 관리하는 서비스입니다. CloudFormation 템플릿을 사용하여 AWS 리소스를 생성하고 구성할 수 있습니다.

### 템플릿 작성

CloudFormation 템플릿은 JSON 또는 YAML 형식으로 작성됩니다. 템플릿은 리소스, 매개 변수, 출력 등을 정의합니다. 템플릿 예제는 AWS CloudFormation 문서에서 찾을 수 있습니다.

### 스택 생성

CloudFormation 템플릿을 사용하여 스택을 생성하려면 다음 명령을 실행합니다:

```bash
$ aws cloudformation create-stack --stack-name my-stack --template-body file://template.json
```

### 스택 업데이트

CloudFormation 스택을 업데이트하려면 다음 명령을 실행합니다:

```bash
$ aws cloudformation update-stack --stack-name my-stack --template-body file://template.json
```

### 스택 삭제

CloudFormation 스택을 삭제하려면 다음 명령을 실행합니다:

```bash
$ aws cloudformation delete-stack --stack-name my-stack
```

## AWS Lambda

AWS Lambda는 서버리스 컴퓨팅 서비스로, 코드를 실행하고 관리하는 데 필요한 모든 인프라를 자동으로 관리합니다. Lambda 함수를 사용하여 이벤트에 대한 응답으로 코드를 실행할 수 있습니다.

### 함수 생성

AWS CLI를 사용하여 Lambda 함수를 생성하려면 다음 명령을 실행합니다:

```bash
$ aws lambda create-function --function-name my-function --runtime python3.8 --handler lambda_function.lambda_handler --role arn:aws:iam::123456789012:role/lambda-role --zip-file fileb://function.zip
```

### 함수 업데이트

Lambda 함수를 업데이트하려면 다음 명령을 실행합니다:

```bash
$ aws lambda update-function-code --function-name my-function --zip-file fileb://function.zip
```

### 함수 실행

Lambda 함수를 실행하려면 다음 명령을 실행합니다:

```bash
$ aws lambda invoke --function-name my-function --payload '{"key1": "value1", "key2": "value2"}' output.txt
```

### 함수 삭제

Lambda 함수를 삭제하려면 다음 명령을 실행합니다:

```bash
$ aws lambda delete-function --function-name my-function
```

## AWS S3

AWS S3(Simple Storage Service)는 객체 스토리지 서비스로, 웹 사이트 호스팅, 데이터 백업 및 복원, 애플리케이션 데이터 저장 등 다양한 용도로 사용됩니다.

### 버킷 생성

AWS CLI를 사용하여 S3 버킷을 생성하려면 다음 명령을 실행합니다:

```bash
$ aws s3api create-bucket --bucket my-bucket --region us-west-2
```

### 파일 업로드

S3 버킷에 파일을 업로드하려면 다음 명령을 실행합니다:

```bash
$ aws s3 cp file.txt s3://my-bucket/file.txt
```

### 파일 다운로드

S3 버킷에서 파일을 다운로드하려면 다음 명령을 실행합니다:

```bash
$ aws s3 cp s3://my-bucket/file.txt file.txt
```

### 버킷 삭제

S3 버킷을 삭제하려면 다음 명령을 실행합니다:

```bash
$ aws s3api delete-bucket --bucket my-bucket
```

## AWS IAM

AWS IAM(Identity and Access Management)은 AWS 리소스에 대한 액세스를 관리하는 서비스입니다. IAM을 사용하여 사용자, 그룹, 역할 및 정책을 관리할 수 있습니다.

### 사용자 생성

AWS CLI를 사용하여 IAM 사용자를 생성하려면 다음 명령을 실행합니다:

```bash
$ aws iam create-user --user-name my-user
```

### 그룹 생성

IAM 그룹을 생성하려면 다음 명령을 실행합니다:

```bash
$ aws iam create-group --group-name my-group
```

### 역할 생성

IAM 역할을 생성하려면 다음 명령을 실행합니다:

```bash
$ aws iam create-role --role-name my-role --assume-role-policy-document file://policy.json
```

### 정책 연결

IAM 정책을 그룹, 사용자 또는 역할에 연결하려면 다음 명령을 실행합니다:

```bash
$ aws iam attach-group-policy --group-name my-group --policy-arn arn:aws:iam::123456789012:policy/my-policy
```

### 사용자 삭제

IAM 사용자를 삭제하려면 다음 명령을 실행합니다:

```bash
$ aws iam delete-user --user-name my-user
```

### 그룹 삭제

IAM 그룹을 삭제하려면 다음 명령을 실행합니다:

```bash
$ aws iam delete-group --group-name my-group
```

### 역할 삭제

IAM 역할을 삭제하려면 다음 명령을 실행합니다:

```bash
$ aws iam delete-role --role-name my-role
```

## AWS Secrets Manager

AWS Secrets Manager는 암호, API 키, 데이터베이스 자격 증명 등의 비밀 정보를 안전하게 저장하고 관리하는 서비스입니다.

### 시크릿 생성

AWS CLI를 사용하여 시크릿을 생성하려면 다음 명령을 실행합니다:

```bash
$ aws secretsmanager create-secret --name my-secret --secret-string "my-password"
```

### 시크릿 업데이트

시크릿을 업데이트하려면 다음 명령을 실행합니다:

```bash
$ aws secretsmanager update-secret --secret-id my-secret --secret-string "new-password"
```

### 시크릿 삭제

시크릿을 삭제하려면 다음 명령을 실행합니다:

```bash
$ aws secretsmanager delete-secret --secret-id my-secret
```

## AWS Security Groups

AWS Security Groups는 인스턴스에 대한 인바운드 및 아웃바운드 트래픽을 제어하는 가상 방화벽입니다. Security Groups를 사용하여 특정 포트 및 프로토콜에 대한 액세스를 제한할 수 있습니다.

### 보안 그룹 생성

AWS CLI를 사용하여 보안 그룹을 생성하려면 다음 명령을 실행합니다:

```bash
$ aws ec2 create-security-group --group-name my-security-group --description "My security group"
```

### 보안 그룹 규칙 추가

보안 그룹에 인바운드 또는 아웃바운드 규칙을 추가하려면 다음 명령을 실행합니다:

```bash
$ aws ec2 authorize-security-group-ingress --group-id sg-0123456789abcdef0 --protocol tcp --port 22 --cidr 0.0.0.0/0
```

### 보안 그룹 삭제

보안 그룹을 삭제하려면 다음 명령을 실행합니다:

```bash
$ aws ec2 delete-security-group --group-id sg-0123456789abcdef0
```

## AWS CloudTrail

AWS CloudTrail은 AWS 리소스에 대한 API 호출 및 이벤트를 로깅하는 서비스입니다. CloudTrail을 사용하여 리소스의 변경 사항을 추적하고 보안 및 규정 준수를 강화할 수 있습니다.

### 로깅 활성화

AWS CLI를 사용하여 CloudTrail 로깅을 활성화하려면 다음 명령을 실행합니다:

```bash
$ aws cloudtrail create-trail --name my-trail --s3-bucket-name my-bucket
```

### 로그 확인

CloudTrail 로그를 확인하려면 다음 명령을 실행합니다:

```bash
$ aws cloudtrail lookup-events --lookup-attributes AttributeKey=EventName,AttributeValue=CreateBucket
```

### 로깅 비활성화

CloudTrail 로깅을 비활성화하려면 다음 명령을 실행합니다:

```bash
$ aws cloudtrail delete-trail --name my-trail
```

## AWS GuardDuty

AWS GuardDuty는 AWS 계정에서 악성 활동을 탐지하는 관리형 위협 탐지 서비스입니다. GuardDuty를 사용하여 계정의 보안을 강화하고 이상 징후를 식별할 수 있습니다.

### GuardDuty 활성화

AWS CLI를 사용하여 GuardDuty를 활성화하려면 다음 명령을 실행합니다:

```bash
$ aws guardduty create-detector --enable
```

### 이벤트 확인

GuardDuty 이벤트를 확인하려면 다음 명령을 실행합니다:

```bash
$ aws guardduty list-findings
```

### GuardDuty 비활성화

GuardDuty를 비활성화하려면 다음 명령을 실행합니다:

```bash
$ aws guardduty delete-detector
```

## AWS Inspector

AWS Inspector는 EC2 인스턴스의 보안 및 규정 준수를 평가하는 자동화된 보안 평가 서비스입니다. Inspector를 사용하여 애플리케이션 및 인프라스트럭처의 취약점을 식별하고 보안을 강화할 수 있습니다.

### 평가 시작

AWS CLI를 사용하여 Inspector 평가를 시작하려면 다음 명령을 실행합니다:

```bash
$ aws inspector start-assessment-run --assessment-template-arn arn:aws:inspector:us-west-2:123456789012:target/0-nvgVhaxX/template/0-4T8v9Lm4
```

### 평가 결과 확인

Inspector 평가 결과를 확인하려면 다음 명령을 실행합니다:

```bash
$ aws inspector list-findings --assessment-run-arn arn:aws:inspector:us-west-2:123456789012:target/0-nvgVhaxX/template/0-4T8v9Lm4/run/0-8f8v9Lm4
```

### 평가 중지

Inspector 평가를 중지하려면 다음 명령을 실행합니다:

```bash
$ aws inspector stop-assessment-run --assessment-run-arn arn:aws:inspector:us-west-2:123456789012:target/0-nvgVhaxX/template/0-4T8v9Lm4/run/0-8f8v9Lm4
```

## AWS WAF

AWS WAF(Web Application Firewall)는 웹 애플리케이션을 보호하기 위한 관리형 방화벽 서비스입니다. WAF를 사용하여 악성 트래픽을 차단하고 웹 애플리케이션의 보안을 강화할 수 있습니다.

### 웹 ACL 생성

AWS CLI를 사용하여 웹 ACL을 생성하려면 다음 명령을 실행합니다:

```bash
$ aws wafv2 create-web-acl --name my-web-acl --scope REGIONAL --default-action Allow --rules file://rules.json
```

### 웹 ACL 연결

웹 ACL을 리소스에 연결하려면 다음 명령을 실행합니다:

```bash
$ aws wafv2 associate-web-acl --web-acl-arn arn:aws:wafv2:us-west-2:123456789012:regional/webacl/my-web-acl --resource-arn arn:aws:elasticloadbalancing:us-west-2:123456789012:loadbalancer/app/my-load-balancer/1234567890abcdef
```

### 웹 ACL 삭제

웹 ACL을 삭제하려면 다음 명령을 실행합니다:

```bash
$ aws wafv2 delete-web-acl --name my-web-acl
```

## AWS KMS

AWS KMS(Key Management Service)는 암호화 키를 생성, 관리 및 사용할 수 있는 서비스입니다. KMS를 사용하여 데이터를 안전하게 암호화하고 복호화
