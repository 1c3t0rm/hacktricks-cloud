# AWS - CodeBuild 후처리

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**를** **팔로우**하세요.
* **Hacking 트릭을 공유하려면** [**HackTricks**](https://github.com/carlospolop/hacktricks) 및 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 저장소에 PR을 제출하세요.

</details>

## CodeBuild

자세한 정보는 다음을 참조하세요:

{% content-ref url="../../aws-security/aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-security/aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### CodeBuild Repo 악용

**CodeBuild**를 구성하려면 사용할 **코드 저장소에 대한 액세스**가 필요합니다. 여러 플랫폼에서 이 코드를 호스팅할 수 있습니다:

<figure><img src="../../../.gitbook/assets/image (3) (5).png" alt=""><figcaption></figcaption></figure>

**CodeBuild 프로젝트는** 구성된 소스 제공자에 **액세스해야 합니다**. 이는 **IAM 역할** 또는 github/bitbucket **토큰 또는 OAuth 액세스**를 통해 이루어질 수 있습니다.

**CodeBuild에서 권한이 상승된 사용자**는 구성된 액세스를 악용하여 구성된 저장소와 액세스 권한이 있는 다른 저장소의 코드를 유출할 수 있습니다.\
이를 위해 공격자는 구성된 액세스가 있는 각 저장소의 **저장소 URL을 변경**하기만 하면 됩니다(aws 웹에서 모든 저장소를 나열합니다):

<figure><img src="../../../.gitbook/assets/image (11) (1) (2).png" alt=""><figcaption></figcaption></figure>

그리고 **Buildspec 명령을 변경**하여 각 저장소를 유출합니다.

{% hint style="warning" %}
그러나 이 작업은 **반복적이고 지루**할 수 있으며, github 토큰이 **쓰기 권한**으로 구성된 경우, 공격자는 토큰에 액세스할 수 없으므로 이러한 권한을 **(남용)사용할 수 없습니다**.\
하지만 그럴까요? 다음 섹션을 확인하세요.
{% endhint %}

### AWS CodeBuild에서 액세스 토큰 유출

CodeBuild에서 Github와 같은 플랫폼에 제공된 액세스를 유출할 수 있습니다. 외부 플랫폼에 대한 액세스가 제공되었는지 확인하세요:
```bash
aws codebuild list-source-credentials
```
### `codebuild:DeleteProject`

공격자는 CodeBuild 프로젝트 전체를 삭제하여 프로젝트 구성을 손상시키고 프로젝트에 의존하는 애플리케이션에 영향을 줄 수 있습니다.
```bash
aws codebuild delete-project --name <value>
```
**잠재적 영향**: 삭제된 프로젝트를 사용하는 애플리케이션의 프로젝트 구성 및 서비스 중단.

### `codebuild:TagResource`, `codebuild:UntagResource`

공격자는 CodeBuild 리소스에 태그를 추가, 수정 또는 제거하여 조직의 비용 할당, 리소스 추적 및 태그 기반의 액세스 제어 정책을 방해할 수 있습니다.
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**잠재적 영향**: 비용 할당, 리소스 추적 및 태그 기반 액세스 제어 정책의 중단.

### `codebuild:DeleteSourceCredentials`

공격자는 Git 저장소의 소스 자격 증명을 삭제하여 저장소에 의존하는 응용 프로그램의 정상 작동에 영향을 줄 수 있습니다.
```sql
aws codebuild delete-source-credentials --arn <value>
```
**잠재적 영향**: 소스 자격 증명이 제거되어 영향을 받는 저장소에 의존하는 애플리케이션의 정상 작동이 중단될 수 있습니다.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family)인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
