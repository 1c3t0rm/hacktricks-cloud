# AWS - Εκμετάλλευση μετά την εισβολή στο CodeBuild

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## CodeBuild

Για περισσότερες πληροφορίες, ελέγξτε:

{% content-ref url="../../aws-security/aws-services/aws-codebuild-enum.md" %}
[aws-codebuild-enum.md](../../aws-security/aws-services/aws-codebuild-enum.md)
{% endcontent-ref %}

### Κατάχρηση πρόσβασης στο CodeBuild Repo

Για να διαμορφώσετε το **CodeBuild**, θα χρειαστεί **πρόσβαση στον κώδικα του αποθετηρίου** που θα χρησιμοποιηθεί. Πολλές πλατφόρμες μπορεί να φιλοξενούν αυτόν τον κώδικα:

<figure><img src="../../../.gitbook/assets/image (3) (5).png" alt=""><figcaption></figcaption></figure>

Το **έργο CodeBuild πρέπει να έχει πρόσβαση** στον διαμορφωμένο πάροχο πηγής, είτε μέσω **ρόλου IAM** είτε με ένα **token ή OAuth πρόσβασης** για το github/bitbucket.

Ένας επιτιθέμενος με **αυξημένα δικαιώματα σε ένα CodeBuild** μπορεί να καταχραστεί αυτήν την πρόσβαση για να διαρρεύσει τον κώδικα του διαμορφωμένου αποθετηρίου και άλλων αποθετηρίων στα οποία οι ρυθμισμένες πιστοποιήσεις έχουν πρόσβαση.\
Για να το κάνει αυτό, ένας επιτιθέμενος θα χρειαστεί απλά να **αλλάξει το URL του αποθετηρίου για κάθε αποθετήριο στο οποίο οι πιστοποιήσεις έχουν πρόσβαση** (σημειώστε ότι η ιστοσελίδα της aws θα τα εμφανίσει όλα για εσάς):

<figure><img src="../../../.gitbook/assets/image (11) (1) (2).png" alt=""><figcaption></figcaption></figure>

Και **αλλάξτε τις εντολές Buildspec για να διαρρεύσετε κάθε αποθετήριο**.

{% hint style="warning" %}
Ωστόσο, αυτή η **εργασία είναι επαναλαμβανόμενη και κουραστική** και εάν ένα token του github έχει διαμορφωθεί με **δικαιώματα εγγραφής**, ένας επιτιθέμενος **δεν θα μπορεί να καταχραστεί αυτά τα δικαιώματα** καθώς δεν έχει πρόσβαση στο token.\
Ή μήπως έχει; Ελέγξτε την επόμενη ενότητα
{% endhint %}

### Διαρροή διαπιστευτηρίων πρόσβασης από το AWS CodeBuild

Μπορείτε να διαρρεύσετε την πρόσβαση που δόθηκε στο CodeBuild σε πλατφόρμες όπως το Github. Ελέγξτε εάν δόθηκε πρόσβαση σε εξωτερικές πλατφόρμες με:
```bash
aws codebuild list-source-credentials
```
### `codebuild:DeleteProject`

Ένας επιτιθέμενος μπορεί να διαγράψει ολόκληρο ένα έργο CodeBuild, προκαλώντας απώλεια της διαμόρφωσης του έργου και επηρεάζοντας εφαρμογές που εξαρτώνται από το έργο.
```bash
aws codebuild delete-project --name <value>
```
**Πιθανές Επιπτώσεις**: Απώλεια της διαμόρφωσης του έργου και διακοπή των υπηρεσιών για τις εφαρμογές που χρησιμοποιούν το διαγραμμένο έργο.

### `codebuild:TagResource`, `codebuild:UntagResource`

Ένας επιτιθέμενος μπορεί να προσθέσει, τροποποιήσει ή να αφαιρέσει ετικέτες από τους πόρους του CodeBuild, διαταράσσοντας την κατανομή του κόστους, την παρακολούθηση των πόρων και τις πολιτικές ελέγχου πρόσβασης της οργάνωσής σας βασισμένες στις ετικέτες.
```bash
aws codebuild tag-resource --resource-arn <value> --tags <value>
aws codebuild untag-resource --resource-arn <value> --tag-keys <value>
```
**Πιθανές Επιπτώσεις**: Διαταραχή της κατανομής του κόστους, της παρακολούθησης των πόρων και των πολιτικών ελέγχου πρόσβασης με βάση τις ετικέτες.

### `codebuild:DeleteSourceCredentials`

Ένας επιτιθέμενος μπορεί να διαγράψει τα διαπιστευτήρια πηγής για ένα αποθετήριο Git, επηρεάζοντας την κανονική λειτουργία των εφαρμογών που εξαρτώνται από το αποθετήριο.
```sql
aws codebuild delete-source-credentials --arn <value>
```
**Πιθανές Επιπτώσεις**: Διαταραχή της κανονικής λειτουργίας για εφαρμογές που εξαρτώνται από τον επηρεασμένο αποθετήριο λόγω της αφαίρεσης των διαπιστευτηρίων πηγής. 

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF**, ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
