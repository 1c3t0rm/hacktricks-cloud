# AWS - EC2 지속성

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 **PR을 제출**하여 여러분의 해킹 기교를 공유하세요.

</details>

## EC2

자세한 정보는 다음을 확인하세요:

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### 보안 그룹 연결 추적 지속성

수비 대상자가 **EC2 인스턴스가 침투당했다는 것을 발견**하면, 그는 아마도 기계의 **네트워크를 격리**하기 위해 노력할 것입니다. 그는 명시적인 **Deny NACL**을 사용하여 이를 수행할 수 있습니다(하지만 NACL은 전체 서브넷에 영향을 미칩니다), 또는 **보안 그룹을 변경**하여 **수신 또는 송신** 트래픽을 **허용하지 않도록** 할 수 있습니다.

만약 공격자가 기계에서 시작된 **역쉘을 가지고 있다면**, 보안 그룹이 수정되어 수신 또는 송신 트래픽을 허용하지 않도록 변경되더라도 **[보안 그룹 연결 추적](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/security-group-connection-tracking.html)** 때문에 **연결이 종료되지 않을 것입니다**.

### EC2 라이프사이클 관리자

이 서비스는 AMI 및 스냅샷의 생성을 **일정에 따라 예약**하고 심지어 **다른 계정과 공유**할 수 있습니다.\
공격자는 모든 이미지 또는 모든 볼륨의 **AMI 또는 스냅샷 생성**을 **매주** 예약하고 **자신의 계정과 공유**할 수 있습니다.

### 예약 인스턴스

일일, 주간 또는 심지어 월간으로 인스턴스를 예약할 수 있습니다. 공격자는 고권한이나 흥미로운 액세스가 가능한 기계를 실행할 수 있습니다.

### 스팟 플릿 요청

스팟 인스턴스는 일반 인스턴스보다 **저렴**합니다. 공격자는 **5년 동안의 작은 스팟 플릿 요청**을 시작할 수 있으며, **자동 IP** 할당 및 **사용자 데이터**를 사용하여 공격자에게 **스팟 인스턴스가 시작될 때** **IP 주소**와 **고권한 IAM 역할**을 전송할 수 있습니다.

### 백도어 인스턴스

공격자는 인스턴스에 액세스하여 백도어를 설치할 수 있습니다:

* 전통적인 **루트킷**을 사용하는 경우
* 새로운 **공개 SSH 키**를 추가하는 경우 (EC2 권한 상승 옵션 확인)
* **사용자 데이터**에 백도어를 설치하는 경우

### **백도어 시작 구성**

* 사용된 AMI에 백도어 설치
* 사용자 데이터에 백도어 설치
* 키 페어에 백도어 설치

### VPN

VPN을 생성하여 공격자가 VPC를 통해 직접 연결할 수 있도록 합니다.

### VPC 피어링

피어링 연결을 생성하여 피해 VPC와 공격자 VPC 간에 연결할 수 있도록 합니다.

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* 독점적인 [**NFT**](https://opensea.io/collection/the-peass-family) 컬렉션인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)를 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 **PR을 제출**하여 여러분의 해킹 기교를 공유하세요.

</details>
