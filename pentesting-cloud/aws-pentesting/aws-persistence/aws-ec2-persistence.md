# AWS - EC2 Persistence

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## EC2

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/" %}
[aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum](../../aws-security/aws-services/aws-ec2-ebs-elb-ssm-vpc-and-vpn-enum/)
{% endcontent-ref %}

### рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдХрдиреЗрдХреНрд╢рди рдЯреНрд░реИрдХрд┐рдВрдЧ Persistence

рдпрджрд┐ рдПрдХ рдбрд┐рдлреЗрдВрдбрд░ рдХреЛ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдПрдХ **EC2 рдЗрдВрд╕реНрдЯреЗрдВрд╕ рдХреЛ рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**, рддреЛ рд╡рд╣ рд╢рд╛рдпрдж рдорд╢реАрди рдХреЗ **рдиреЗрдЯрд╡рд░реНрдХ рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдЧрд╛ред рд╡рд╣ рдЗрд╕реЗ рдПрдХ рд╡рд┐рд╢реЗрд╖ **Deny NACL** рдХреЗ рд╕рд╛рде рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рд▓реЗрдХрд┐рди NACL рдкреВрд░реЗ рд╕рдмрдиреЗрдЯ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВ), рдпрд╛ **рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдХреЛ рдмрджрд▓рдХрд░** рдРрд╕рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ **рдЗрдирдмрд╛рдЙрдВрдб рдпрд╛ рдЖрдЙрдЯрдмрд╛рдЙрдВрдб** рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред

рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдорд╢реАрди рд╕реЗ рдЙрддреНрдкрдиреНрди рдПрдХ **рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓** рд╣реЛрддреА рд╣реИ, рддреЛ рдпрджрд┐ SG рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрдирдмрд╛рдЙрдВрдб рдпрд╛ рдЖрдЙрдЯрдмрд╛рдЙрдВрдб рдЯреНрд░реИрдлрд┐рдХ рдХреА рдЕрдиреБрдорддрд┐ рди рджреА рдЬрд╛рдП, рддреЛ **рд╕реБрд░рдХреНрд╖рд╛ рд╕рдореВрд╣ рдХрдиреЗрдХреНрд╢рди рдЯреНрд░реИрдХрд┐рдВрдЧ** рдХреЗ рдХрд╛рд░рдг **рдХрдиреЗрдХреНрд╢рди рдорд░ рдЬрд╛рдПрдЧрд╛ рдирд╣реАрдВ** рд╣реЛрдЧрд╛ред

### EC2 рд▓рд╛рдЗрдлрд╕рд╛рдЗрдХрд▓ рдореИрдиреЗрдЬрд░

рдпрд╣ рд╕реЗрд╡рд╛ AMI рдФрд░ рд╕реНрдиреИрдкрд╢реЙрдЯ рдХреЗ **рдирд┐рд░реНрдорд╛рдг рдХреЛ рд╢реЗрдбреНрдпреВрд▓** рдХрд░рдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ **рдЕрдиреНрдп рдЦрд╛рддреЛрдВ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред\
рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рд╕рднреА рдЫрд╡рд┐рдпреЛрдВ рдпрд╛ рд╕рднреА рд╡реЙрд▓реНрдпреВрдо рдХреЗ **рдирд┐рд░реНрдорд╛рдг** рдпрд╛ **рд╕реНрдиреИрдкрд╢реЙрдЯ** рдХреЛ **рд╣рд░ рд╣рдлреНрддреЗ** рд╢реЗрдбреНрдпреВрд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ **рдЕрдкрдиреЗ рдЦрд╛рддреЗ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛** рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕

рджреИрдирд┐рдХ, рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рдпрд╛ рдорд╛рд╕рд┐рдХ рд░реВрдк рд╕реЗ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдпрд╛ рджрд┐рд▓рдЪрд╕реНрдк рдкрд╣реБрдВрдЪ рд╡рд╛рд▓реА рдорд╢реАрди рдЪрд▓рд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЙрд╕реЗ рдкрд╣реБрдВрдЪ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

### рд╕реНрдкреЙрдЯ рдлреНрд▓реАрдЯ рдЕрдиреБрд░реЛрдз

рд╕реНрдкреЙрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рдирд┐рдпрдорд┐рдд рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рд╕реЗ **рд╕рд╕реНрддреА** рд╣реЛрддреА рд╣реИрдВред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ **рдЫреЛрдЯреА рд╕реНрдкреЙрдЯ рдлреНрд▓реАрдЯ рдЕрдиреБрд░реЛрдз** рд╢реБрд░реВ рдХрд░ рд╕рдХрддрд╛ рд╣реИ 5 рд╕рд╛рд▓ рдХреЗ рд▓рд┐рдП (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП), **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд IP** рдЖрд╡рдВрдЯрди рдФрд░ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛** рдЬреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рднреЗрдЬрддрд╛ рд╣реИ **рдЬрдм рд╕реНрдкреЙрдЯ рдЗрдВрд╕реНрдЯреЗрдВрд╕ рд╕реНрдЯрд╛рд░реНрдЯ рд╣реЛрддреА рд╣реИ** рдФрд░ **IP рдкрддрд╛** рдФрд░ рдПрдХ **рдЙрдЪреНрдЪ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА IAM рд░реЛрд▓** рдХреЗ рд╕рд╛рдеред

### рдмреИрдХрдбреЛрд░ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕

рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рдорд┐рд▓ рд╕рдХрддреА рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдмреИрдХрдбреЛрд░ рдХрд░ рд╕рдХрддреА рд╣реИ:

* рдПрдХ рдкрд╛рд░рдВрдкрд░рд┐рдХ **рд░реВрдЯрдХрд┐рдЯ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП
* рдПрдХ рдирдИ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ SSH рдХреБрдВрдЬреА** рдЬреЛрдбрд╝рдирд╛ (EC2 рдкреНрд░рд┐рд╡реЗрд╕реНрдХ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ)
* **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛** рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░рдирд╛

### **рдмреИрдХрдбреЛрд░ рд▓реЙрдиреНрдЪ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди**

* рдЙрдкрдпреЛрдЧ рдХреА рдЧрдИ AMI рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░реЗрдВ
* рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдбреЗрдЯрд╛ рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░реЗрдВ
* рдХреБрдВрдЬреА рдкреЗрдпрд░ рдХреЛ рдмреИрдХрдбреЛрд░ рдХрд░реЗрдВ

### VPN

рдПрдХ VPN рдмрдирд╛рдПрдВ рддрд╛рдХрд┐ рд╣рдорд▓рд╛рд╡рд░ VPC рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реАрдзреЗ рдХрдиреЗрдХреНрдЯ рд╣реЛ рд╕рдХреЗред

### VPC Peering

рд╣рдорд▓рд╛рд╡рд░ VPC рдФрд░ рдЖрдХреНрд░рдордХ VPC рдХреЗ рдмреАрдЪ рдПрдХ рдкреАрдпрд░рд┐рдВрдЧ рдХрдиреЗрдХреНрд╢рди рдмрдирд╛рдПрдВ рддрд╛рдХрд┐ рд╡рд╣ рд╣рдорд▓рд╛рд╡рд░ VPC рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХреЗред

<details>

<summary><strong>рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВ рдФрд░ рд▓рд╛рдн рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ!</strong></summary>

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ рдпрджрд┐ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [
