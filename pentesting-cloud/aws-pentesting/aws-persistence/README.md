# AWS - 지속성

Persistence is a crucial aspect of any successful attack. Once an attacker gains access to a system, they want to maintain that access for as long as possible. In this section, we will explore various techniques for achieving persistence in AWS environments.

## User Persistence

### IAM User

One way to achieve user persistence in AWS is by creating an IAM user with long-term access keys. These access keys can be used to authenticate API requests and provide ongoing access to AWS resources. By creating an IAM user with elevated privileges and long-term access keys, an attacker can ensure continued access to the AWS environment even if the initial access point is discovered and closed.

To create an IAM user with access keys, follow these steps:

1. Log in to the AWS Management Console.
2. Navigate to the IAM service.
3. Click on "Users" in the left-hand menu.
4. Click on "Add user".
5. Enter a username for the new user.
6. Select the desired access type (programmatic access, AWS Management Console access, or both).
7. Set permissions for the user.
8. Review the user details and click on "Create user".
9. Take note of the access key ID and secret access key.

### EC2 Instance Profile

Another method for achieving user persistence is by modifying the EC2 instance profile. The instance profile is a container for an IAM role that can be assigned to an EC2 instance. By modifying the instance profile, an attacker can grant additional permissions to the EC2 instance, allowing for continued access to AWS resources.

To modify the instance profile, follow these steps:

1. Log in to the AWS Management Console.
2. Navigate to the EC2 service.
3. Click on "Instances" in the left-hand menu.
4. Select the desired EC2 instance.
5. Click on "Actions" and choose "Instance Settings" > "Attach/Replace IAM Role".
6. Select the desired IAM role or create a new one.
7. Review the changes and click on "Apply".

## Service Persistence

### Lambda Function

AWS Lambda allows users to run code without provisioning or managing servers. This serverless compute service can be leveraged by attackers to achieve service persistence. By creating a Lambda function and configuring it to trigger based on specific events, an attacker can ensure that their code is executed periodically, maintaining access to AWS resources.

To create a Lambda function, follow these steps:

1. Log in to the AWS Management Console.
2. Navigate to the Lambda service.
3. Click on "Create function".
4. Choose a function blueprint or create a new one from scratch.
5. Configure the function details, such as name, runtime, and permissions.
6. Write the function code or upload a deployment package.
7. Configure the function's triggers, such as API Gateway, CloudWatch Events, or S3 events.
8. Review the function details and click on "Create function".

### CloudFormation Stack

AWS CloudFormation allows users to define and provision AWS infrastructure as code. By creating a CloudFormation stack, an attacker can ensure that specific AWS resources are always present, even if they are manually deleted. This can be used to maintain persistence by recreating compromised resources or introducing new resources with backdoor access.

To create a CloudFormation stack, follow these steps:

1. Log in to the AWS Management Console.
2. Navigate to the CloudFormation service.
3. Click on "Create stack".
4. Choose a template source (template file, Amazon S3 URL, or AWS CloudFormation Designer).
5. Configure the stack options, such as stack name, parameters, and tags.
6. Review the stack details and click on "Create stack".

## Conclusion

Achieving persistence in AWS environments is essential for attackers to maintain access and control over compromised systems. By leveraging user persistence techniques, such as creating IAM users or modifying EC2 instance profiles, and service persistence techniques, such as using Lambda functions or CloudFormation stacks, attackers can ensure continued access to AWS resources. It is crucial for organizations to regularly review and monitor their AWS environments to detect and mitigate any unauthorized persistence mechanisms.
