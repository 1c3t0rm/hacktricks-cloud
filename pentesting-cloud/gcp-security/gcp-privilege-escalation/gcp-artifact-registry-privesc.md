# GCP - Artifact Registry Privesc

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Artifact Registry

For more information about Artifact Registry check:

{% content-ref url="../gcp-services/gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](../gcp-services/gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### artifactregistry.repositories.uploadArtifacts

With this permission an attacker could upload new versions of the artifacts with malicious code like Docker images:

{% code overflow="wrap" %}
```bash
# Configure docker to use gcloud to authenticate with Artifact Registry
gcloud auth configure-docker <location>-docker.pkg.dev

# tag the image to upload it
docker tag <local-img-name>:<local-tag> <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>

# Upload it
docker push <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
{% endcode %}

{% hint style="danger" %}
Qapla'! **QaStaHvIS malicious docker** image vItlhutlhlaHbe'chugh, 'ej **tag vItlhutlh** 'ej DaH jImej 'e' vItlhutlhlaHbe'chugh **downloaded the malicious one**.
{% endhint %}

<details>

<summary>Python library upload</summary>

**Qapla'! library upload laH** (registry latest version download 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlhutlhlaHbe'chugh 'e' vItlh
```bash
rm -rf dist build hello_world.egg-info
```
</details>

{% hint style="danger" %}
**Qapla'!** QaStaHvIS python library vItlhutlh vItlhutlhlaHbe', 'ach **vItlhutlhlaHbe' vItlhutlhlaHbe'** (be'nal python vItlhutlhlaHbe' 'e' vItlhutlhlaHbe' -'ach-), 'ej vItlhutlhlaHbe' vItlhutlhlaHbe' vItlhutlhlaHbe' (vItlhutlhlaHbe' `artifactregistry.versions.delete)`**:**

{% code overflow="wrap" %}
```sh
gcloud artifacts versions delete <version> --repository=<repo-name> --location=<location> --package=<lib-name>
```
{% endcode %}
{% endhint %}

### `artifactregistry.repositories.downloadArtifacts`

With this permission you can **download artifacts** and search for **sensitive information** and **vulnerabilities**.

Download a **Docker** image:
```sh
# Configure docker to use gcloud to authenticate with Artifact Registry
gcloud auth configure-docker <location>-docker.pkg.dev

# Dowload image
docker pull <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
Download a **python** library:

{% code overflow="wrap" %}Daq yIn **python** library:
```bash
pip install <lib-name> --index-url "https://oauth2accesstoken:$(gcloud auth print-access-token)@<location>-python.pkg.dev/<project-id>/<repo-name>/simple/" --trusted-host <location>-python.pkg.dev --no-cache-dir
```
{% endcode %}

* nuqneH DaH jImej 'ej nuqneH jatlh 'e' vItlhutlh 'ej jatlh 'e' vItlhutlh 'ej package vItlhutlh? chaw'be' vItlhutlh:

{% content-ref url="../gcp-persistence/gcp-artifact-registry-persistence.md" %}
[gcp-artifact-registry-persistence.md](../gcp-persistence/gcp-artifact-registry-persistence.md)
{% endcontent-ref %}

### `artifactregistry.tags.delete`, `artifactregistry.versions.delete`, `artifactregistry.packages.delete`, (`artifactregistry.repositories.get`, `artifactregistry.tags.get`, `artifactregistry.tags.list`)

Delete artifacts from the registry, like docker images:

{% code overflow="wrap" %}
```bash
# Delete a docker image
gcloud artifacts docker images delete <location>-docker.pkg.dev/<proj-name>/<repo-name>/<img-name>:<tag>
```
### `artifactregistry.repositories.delete`

Detele a full repository (even if it has content):

{% code overflow="wrap" %}### `artifactregistry.repositories.delete`

ghItlh repository (ghItlh content vaj):

{% code overflow="wrap" %}
```
gcloud artifacts repositories delete <repo-name> --location=<location>
```
{% endcode %}

### `artifactregistry.repositories.setIamPolicy`

An attacker with this permission could give himself permissions to perform some of the previously mentioned repository attacks.

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
