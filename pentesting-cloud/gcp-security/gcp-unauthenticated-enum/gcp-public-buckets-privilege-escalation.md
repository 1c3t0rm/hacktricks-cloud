# GCP - 公共存储桶权限提升

<details>

<summary><strong>从零开始学习AWS黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您希望在**HackTricks中看到您的公司广告**或**以PDF格式下载HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>

## 存储桶权限提升

如果存储桶策略允许“allUsers”或“allAuthenticatedUsers” **写入他们的存储桶策略**（即**storage.buckets.setIamPolicy**权限），那么任何人都可以修改存储桶策略并授予自己完全访问权限。

### 检查权限

有两种方法可以检查对存储桶的权限。第一种是通过向 `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam` 发出请求或运行 `gsutil iam get gs://BUCKET_NAME` 来请求它们。

然而，如果您的用户（可能属于allUsers或allAuthenticatedUsers）没有权限读取存储桶的iam策略（storage.buckets.getIamPolicy），那么这将不起作用。

另一个总是有效的选项是使用存储桶的testPermissions端点来确定您是否拥有指定的权限，例如访问：`https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### 权限提升

使用“gsutil” Google Storage CLI程序，我们可以运行以下命令，将“allAuthenticatedUsers”访问权限提升为“Storage Admin”角色，从而**提升我们被授予的存储桶权限**：
```
gsutil iam ch group:allAuthenticatedUsers:admin gs://BUCKET_NAME
```
从LegacyBucketOwner升级到Storage Admin的主要吸引力之一是能够使用“storage.buckets.delete”权限。理论上，你可以在提升权限后**删除存储桶，然后在你自己的账户中创建同名存储桶以窃取名称**。

## 参考资料

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

<details>

<summary><strong>从零开始学习AWS黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果你想在HackTricks上看到你的**公司广告**或者**下载HackTricks的PDF版本**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFT系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来**分享你的黑客技巧**。

</details>
