# GCP - √âl√©vation de privil√®ges des seaux publics

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## √âl√©vation de privil√®ges des seaux

Si la politique du seau autorisait soit ‚ÄúallUsers‚Äù soit ‚ÄúallAuthenticatedUsers‚Äù √† **√©crire dans leur politique de seau** (la permission **storage.buckets.setIamPolicy**)**,** alors n'importe qui peut modifier la politique du seau et s'accorder un acc√®s complet.

### V√©rifier les permissions

Il y a 2 fa√ßons de v√©rifier les permissions sur un seau. La premi√®re consiste √† les demander en faisant une requ√™te √† `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam` ou en ex√©cutant `gsutil iam get gs://BUCKET_NAME`.

Cependant, si votre utilisateur (potentiellement appartenant √† allUsers ou allAuthenticatedUsers") n'a pas les permissions pour lire la politique iam du seau (storage.buckets.getIamPolicy), cela ne fonctionnera pas.

L'autre option, qui fonctionnera toujours, est d'utiliser le point de terminaison testPermissions du seau pour d√©terminer si vous avez la permission sp√©cifi√©e, par exemple en acc√©dant √† : `https://www.googleapis.com/storage/v1/b/BUCKET_NAME/iam/testPermissions?permissions=storage.buckets.delete&permissions=storage.buckets.get&permissions=storage.buckets.getIamPolicy&permissions=storage.buckets.setIamPolicy&permissions=storage.buckets.update&permissions=storage.objects.create&permissions=storage.objects.delete&permissions=storage.objects.get&permissions=storage.objects.list&permissions=storage.objects.update`

### √âl√©vation de privil√®ges

Avec le programme CLI ‚Äúgsutil‚Äù de Google Storage, nous pouvons ex√©cuter la commande suivante pour accorder √† ‚ÄúallAuthenticatedUsers‚Äù l'acc√®s au r√¥le ‚ÄúStorage Admin‚Äù, **√©levant ainsi les privil√®ges qui nous ont √©t√© accord√©s** sur le seau :
```
gsutil iam ch group:allAuthenticatedUsers:admin gs://BUCKET_NAME
```
L'un des principaux avantages de l'escalade de privil√®ges d'un LegacyBucketOwner √† Storage Admin est la capacit√© d'utiliser le privil√®ge "storage.buckets.delete". En th√©orie, vous pourriez **supprimer le bucket apr√®s avoir augment√© vos privil√®ges, puis vous pourriez cr√©er le bucket dans votre propre compte pour voler le nom**.

## R√©f√©rences

* [https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/](https://rhinosecuritylabs.com/gcp/google-cloud-platform-gcp-bucket-enumeration/)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez**-moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
