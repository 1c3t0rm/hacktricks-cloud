# GCP - 安全

<details>

<summary><strong>从零开始学习AWS黑客技术，成为专家</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS红队专家）</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

- 如果您想看到您的**公司在HackTricks中做广告**或**下载PDF格式的HackTricks**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)!
- 获取[**官方PEASS & HackTricks周边产品**](https://peass.creator-spring.com)
- 探索[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品
- **加入** 💬 [**Discord群**](https://discord.gg/hRep4RUj7f) 或 [**电报群**](https://t.me/peass) 或在**Twitter**上关注我们 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**。**
- 通过向[**HackTricks**](https://github.com/carlospolop/hacktricks)和[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。

</details>

## 基本信息

Google Cloud Platform（GCP）安全涵盖了一套旨在确保Google Cloud环境中资源和数据安全的**全面工具**和实践，分为四个主要部分：**安全指挥中心，检测和控制，数据保护和零信任。**

## **安全指挥中心**

Google Cloud Platform（GCP）安全指挥中心（SCC）是一种用于GCP资源的**安全和风险管理工具**，使组织能够获得对其云资产的可见性和控制。它通过提供全面的安全分析，**识别配置错误**，确保符合安全标准，并与其他安全工具集成，实现自动化威胁检测和响应，帮助**检测和应对威胁**。

- **概述**：用于**可视化安全指挥中心所有结果**的面板。
- 威胁：\[需要高级订阅] 用于可视化所有**检测到的威胁。查看下面有关威胁的更多信息**
- **漏洞**：用于**可视化在GCP帐户中发现的配置错误**的面板。
- **合规性**：\[需要高级订阅] 此部分允许**针对多个合规性检查**（如PCI-DSS、NIST 800-53、CIS基准...）测试您的GCP环境。
- **资产**：此部分**显示正在使用的所有资产**，对于系统管理员（也许是攻击者）来说非常有用，可以在一个页面上查看正在运行的内容。
- **发现**：这将**汇总**不仅限于指挥中心的GCP安全不同部分的**表中发现**，以便轻松可视化重要的发现。
- **来源**：按**部分**显示GCP安全不同部分的所有发现的**摘要**。
- **姿势**：\[需要高级订阅] 安全姿势允许**定义、评估和监控GCP环境的安全性**。它通过创建定义约束或限制的策略来控制/监控GCP中的资源。在[https://cloud.google.com/security-command-center/docs/security-posture-overview?authuser=2#predefined-policy](https://cloud.google.com/security-command-center/docs/security-posture-overview?authuser=2#predefined-policy)中可以找到几个预定义的姿势模板。

### **威胁**

从攻击者的角度来看，这可能是**最有趣的功能，因为它可以检测到攻击者**。但请注意，此功能需要**高级订阅**（这意味着公司需要支付更多费用），因此**可能甚至未启用**。&#x20;

有三种类型的威胁检测机制：

- **事件威胁**：通过**基于Google内部创建的规则**匹配**Cloud Logging**中的事件产生的发现。它还可以扫描**Google Workspace日志**。
- 可以在[**文档中找到所有检测规则的描述**](https://cloud.google.com/security-command-center/docs/concepts-event-threat-detection-overview?authuser=2#how\_works)
- **容器威胁**：在分析容器内核的低级行为后产生的发现。
- **自定义威胁**：公司创建的规则。

可以在[https://cloud.google.com/security-command-center/docs/how-to-investigate-threats?authuser=2#event\_response](https://cloud.google.com/security-command-center/docs/how-to-investigate-threats?authuser=2#event\_response)中找到对检测到的这两种类型威胁的推荐响应。

### 枚举

{% code overflow="wrap" %}
```bash
# Get a source
gcloud scc sources describe <org-number> --source=5678
## If the response is that the service is disabled or that the source is not found, then, it isn't enabled

# Get notifications
gcloud scc notifications list <org-number>

# Get findings (if not premium these are just vulnerabilities)
gcloud scc findings list <org-number>
```
{% endcode %}

### 后渗透

{% content-ref url="../gcp-post-exploitation/gcp-security-post-exploitation.md" %}
[gcp-security-post-exploitation.md](../gcp-post-exploitation/gcp-security-post-exploitation.md)
{% endcontent-ref %}

## 检测和控制

* **Chronicle SecOps**：一套先进的安全运营套件，旨在帮助团队提高安全运营的速度和影响力，包括威胁检测、调查和响应。
* **reCAPTCHA Enterprise**：一项服务，通过区分人类用户和机器人，保护网站免受诸如抓取、凭证填充和自动攻击等欺诈活动的影响。
* **Web Security Scanner**：自动化安全扫描工具，可检测托管在Google Cloud或其他网络服务上的Web应用程序中的漏洞和常见安全问题。
* **Risk Manager**：一款治理、风险和合规（GRC）工具，帮助组织评估、记录和了解其在Google Cloud上的风险状况。
* **Binary Authorization**：用于容器的安全控制，确保仅根据企业设置的策略部署受信任的容器映像到Kubernetes Engine集群上。
* **Advisory Notifications**：一项提供有关潜在安全问题、漏洞和建议操作的警报和通知服务，以保持资源安全。
* **Access Approval**：一项功能，允许组织在Google员工访问其数据或配置之前要求明确批准，提供额外的控制和可审计性层级。
* **Managed Microsoft AD**：提供托管Microsoft Active Directory（AD）的服务，允许用户在Google Cloud上使用其现有的依赖Microsoft AD的应用程序和工作负载。

## 数据保护

* **敏感数据保护**：旨在保护敏感数据（如个人信息或知识产权）免受未经授权的访问或曝光的工具和实践。
* **数据丢失防护（DLP）**：一组工具和流程，用于通过深度内容检查和应用全面的数据保护规则，识别、监视和保护使用中、传输中和静止中的数据。
* **证书颁发机构服务**：一项可扩展且安全的服务，简化和自动化内部和外部服务的SSL/TLS证书的管理、部署和更新。
* **密钥管理**：一项基于云的服务，允许您为应用程序管理加密密钥，包括加密密钥的创建、导入、轮换、使用和销毁。更多信息请参阅：

{% content-ref url="gcp-kms-enum.md" %}
[gcp-kms-enum.md](gcp-kms-enum.md)
{% endcontent-ref %}

* **证书管理器**：一项管理和部署SSL/TLS证书的服务，确保与您的Web服务和应用程序建立安全加密连接。
* **Secret Manager**：一种安全且便捷的存储系统，用于存储API密钥、密码、证书和其他敏感数据，允许在应用程序中轻松安全地访问和管理这些秘密。更多信息请参阅：

{% content-ref url="../../gcp-pentesting/gcp-services/gcp-secrets-manager-enum.md" %}
[gcp-secrets-manager-enum.md](../../gcp-pentesting/gcp-services/gcp-secrets-manager-enum.md)
{% endcontent-ref %}

## 零信任

* **BeyondCorp Enterprise**：一种零信任安全平台，可在无需传统VPN的情况下实现对内部应用程序的安全访问，通过在授予访问权限之前验证用户和设备的信任。
* **Policy Troubleshooter**：一款旨在帮助管理员了解和解决组织中访问问题的工具，通过识别用户对某些资源具有访问权限或为何被拒绝访问，从而帮助执行零信任策略。
* **Identity-Aware Proxy (IAP)**：一项服务，根据请求的身份和上下文，而不是请求来源的网络，控制对运行在Google Cloud、本地或其他云上的云应用程序和虚拟机的访问。
* **VPC Service Controls**：提供额外保护层的安全边界，用于防止数据外泄并提供细粒度访问控制，适用于托管在Google Cloud的虚拟专用云（VPC）中的资源和服务。
* **Access Context Manager**：作为Google Cloud BeyondCorp Enterprise的一部分，此工具有助于根据用户身份和其请求的上下文（如设备安全状态、IP地址等）定义和执行细粒度访问控制策略。
