# GCP - セキュリティ

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>でAWSハッキングをゼロからヒーローまで学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝**したい場合や **HackTricks をPDFでダウンロード**したい場合は [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
* **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)** に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter** 🐦 で **@hacktricks\_live** をフォローする
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のGitHubリポジトリにPRを提出してください。

</details>

## 基本情報

Google Cloud Platform（GCP）セキュリティは、Google Cloud環境内のリソースとデータの**セキュリティ**を確保するために設計された包括的なツールとプラクティスで構成されており、**セキュリティコマンドセンター、検出とコントロール、データ保護、ゼロトラスト**の4つの主要セクションに分かれています。

## **セキュリティコマンドセンター**

Google Cloud Platform（GCP）セキュリティコマンドセンター（SCC）は、組織がクラウド資産を可視化し、コントロールすることを可能にする**GCPリソースのセキュリティおよびリスク管理ツール**であり、**脅威を検出**し、包括的なセキュリティ分析を提供し、**ミス構成を特定**し、セキュリティ基準に**準拠**し、他のセキュリティツールと統合して脅威の検出と対応を自動化します。

* **概要**: セキュリティコマンドセンターの結果を**視覚化**するパネル。
* 脅威: \[プレミアムが必要] **検出された脅威を視覚化**するパネル。脅威についての詳細は以下を確認してください
* **脆弱性**: GCPアカウントで見つかった**ミス構成を視覚化**するパネル。
* **コンプライアンス**: \[プレミアムが必要] このセクションでは、組織に対してPCI-DSS、NIST 800-53、CISベンチマークなどの**複数のコンプライアンスチェック**を実施できます。
* **アセット**: このセクションは、実行中のアイテムを表示し、システム管理者（おそらく攻撃者も）が1つのページで実行中のアイテムを確認できるため、非常に便利です。
* **調査結果**: GCPセキュリティの異なるセクションの**調査結果を集約**し、重要な調査結果を簡単に視覚化できるようにします。
* **ソース**: GCPセキュリティの異なるセクションの**調査結果の要約**をセクションごとに表示します。
* **姿勢**: \[プレミアムが必要] セキュリティポスチャは、GCP環境のセキュリティを**定義、評価、監視**することを可能にします。 GCPのリソースを制御/監視する制約や制限を定義するポリシーを作成することで機能します。 [https://cloud.google.com/security-command-center/docs/security-posture-overview?authuser=2#predefined-policy](https://cloud.google.com/security-command-center/docs/security-posture-overview?authuser=2#predefined-policy) でいくつかの事前定義のポスチャテンプレートを見つけることができます。

### **脅威**

攻撃者の視点からは、これが**最も興味深い機能**であり、攻撃者を検出できる可能性があります。ただし、この機能には**プレミアム**が必要（つまり、企業は追加料金を支払う必要がある）ため、**有効になっていない**可能性があります。

3種類の脅威検出メカニズムがあります:

* **イベント脅威**: Googleが内部で作成した**ルールに基づいてCloud Logging**からのイベントを一致させて生成された調査結果。**Google Workspaceログ**もスキャンできます。
* すべての[**検出ルールの説明をドキュメントで見つけることができます**](https://cloud.google.com/security-command-center/docs/concepts-event-threat-detection-overview?authuser=2#how\_works)
* **コンテナ脅威**: コンテナのカーネルの低レベルの動作を分析した後に生成された調査結果。
* **カスタム脅威**: 企業が作成したルール。

両方のタイプの検出された脅威に対する推奨される対応策を[こちら](https://cloud.google.com/security-command-center/docs/how-to-investigate-threats?authuser=2#event\_response)で見つけることができます。

### 列挙

{% code overflow="wrap" %}
```bash
# Get a source
gcloud scc sources describe <org-number> --source=5678
## If the response is that the service is disabled or that the source is not found, then, it isn't enabled

# Get notifications
gcloud scc notifications list <org-number>

# Get findings (if not premium these are just vulnerabilities)
gcloud scc findings list <org-number>
```
{% endcode %}

### ポストエクスプロイテーション

{% content-ref url="../gcp-post-exploitation/gcp-security-post-exploitation.md" %}
[gcp-security-post-exploitation.md](../gcp-post-exploitation/gcp-security-post-exploitation.md)
{% endcontent-ref %}

## 検出とコントロール

* **Chronicle SecOps**: セキュリティオペレーションを高速化し、脅威の検出、調査、対応を支援する高度なセキュリティオペレーションスイート。
* **reCAPTCHA Enterprise**: 人間のユーザーとボットを区別して、スクレイピング、資格情報詰め込み、自動攻撃などの不正活動からウェブサイトを保護するサービス。
* **Web Security Scanner**: Google Cloudや他のウェブサービスでホストされているウェブアプリケーションにおける脆弱性や一般的なセキュリティ問題を検出する自動セキュリティスキャンツール。
* **Risk Manager**: Google Cloudのリスクポジションを評価、文書化、理解するのに役立つガバナンス、リスク、コンプライアンス（GRC）ツール。
* **Binary Authorization**: 信頼できるコンテナイメージのみがエンタープライズが設定したポリシーに従ってKubernetes Engineクラスタに展開されることを保証するコンテナ用のセキュリティコントロール。
* **Advisory Notifications**: リソースを安全に保つための潜在的なセキュリティ問題、脆弱性、推奨されるアクションに関するアラートと助言を提供するサービス。
* **Access Approval**: Googleの従業員がデータや構成にアクセスする前に明示的な承認を要求する機能で、追加の制御と監査可能性のレイヤーを提供。
* **Managed Microsoft AD**: Google Cloud上で既存のMicrosoft AD依存アプリケーションやワークロードを使用できる管理されたMicrosoft Active Directory（AD）を提供するサービス。

## データ保護

* **Sensitive Data Protection**: 個人情報や知的財産などの機密データを未承認のアクセスや露出から保護するためのツールとプラクティス。
* **Data Loss Prevention (DLP)**: 深いコンテンツ検査を通じてデータの使用中、移動中、静止中の識別、監視、保護を行うためのツールとプロセスで、包括的なデータ保護ルールを適用する。
* **Certificate Authority Service**: 内部および外部サービスのSSL/TLS証明書の管理、展開、更新を簡素化し自動化するスケーラブルでセキュアなサービス。
* **Key Management**: 暗号キーの作成、インポート、ローテーション、使用、破棄を含むアプリケーションのための暗号キーを管理するクラウドベースのサービス。詳細は以下を参照:

{% content-ref url="gcp-kms-enum.md" %}
[gcp-kms-enum.md](gcp-kms-enum.md)
{% endcontent-ref %}

* **Certificate Manager**: SSL/TLS証明書を管理し展開し、ウェブサービスやアプリケーションへの安全で暗号化された接続を確保するサービス。
* **Secret Manager**: APIキー、パスワード、証明書などの機密データの安全で便利なストレージシステムで、これらのシークレットへの簡単で安全なアクセスと管理をアプリケーションで可能にする。詳細は以下を参照:

{% content-ref url="../../gcp-pentesting/gcp-services/gcp-secrets-manager-enum.md" %}
[gcp-secrets-manager-enum.md](../../gcp-pentesting/gcp-services/gcp-secrets-manager-enum.md)
{% endcontent-ref %}

## ゼロトラスト

* **BeyondCorp Enterprise**: 伝統的なVPNを必要とせずに内部アプリケーションへの安全なアクセスを可能にするゼロトラストセキュリティプラットフォームで、アクセスを許可する前にユーザーとデバイストラストを検証する。
* **Policy Troubleshooter**: 管理者が組織内のアクセス問題を理解し解決するのを支援するツールで、なぜユーザーが特定のリソースにアクセスできるのか、アクセスが拒否されたのかを特定し、ゼロトラストポリシーの施行を支援する。
* **Identity-Aware Proxy (IAP)**: リクエストのネットワークではなく、アイデンティティとリクエストのコンテキストに基づいてGoogle Cloud、オンプレミス、他のクラウドで実行されているクラウドアプリケーションやVMへのアクセスを制御するサービス。
* **VPC Service Controls**: Google CloudのVirtual Private Cloud（VPC）にホストされているリソースとサービスに追加の保護層を提供し、データの外部流出を防止し、細かいアクセス制御を提供するセキュリティ境界。
* **Access Context Manager**: Google CloudのBeyondCorp Enterpriseの一部で、ユーザーのアイデンティティとリクエストのコンテキスト（デバイスのセキュリティステータス、IPアドレスなど）に基づいて細かいアクセス制御ポリシーを定義し強制するツール。
