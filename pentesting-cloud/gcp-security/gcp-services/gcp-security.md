# GCP - Seguran√ßa

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informa√ß√µes B√°sicas

A Seguran√ßa da Google Cloud Platform (GCP) engloba um **conjunto abrangente de ferramentas** e pr√°ticas projetadas para garantir a **seguran√ßa** de recursos e dados dentro do ambiente da Google Cloud, dividido em quatro se√ß√µes principais: **Security Command Center, Detections and Controls, Data Protection e Zero Trust.**

## **Security Command Center**

O Security Command Center (SCC) da Google Cloud Platform (GCP) √© uma **ferramenta de seguran√ßa e gerenciamento de riscos para recursos da GCP** que permite √†s organiza√ß√µes obter visibilidade e controle sobre seus ativos na nuvem. Ele ajuda a **detectar e responder a amea√ßas** oferecendo an√°lises de seguran√ßa abrangentes, **identificando configura√ß√µes incorretas**, garantindo **conformidade** com padr√µes de seguran√ßa e **integrando** com outras ferramentas de seguran√ßa para detec√ß√£o e resposta automatizadas a amea√ßas.

* **Vis√£o Geral**: Painel para **visualizar uma vis√£o geral** de todos os resultados do Security Command Center.
* Amea√ßas: \[Premium Necess√°rio] Painel para visualizar todas as **amea√ßas detectadas. Confira mais sobre Amea√ßas abaixo**
* **Vulnerabilidades**: Painel para **visualizar configura√ß√µes incorretas encontradas na conta GCP**.
* **Conformidade**: \[Premium necess√°rio] Esta se√ß√£o permite **testar seu ambiente GCP em rela√ß√£o a v√°rias verifica√ß√µes de conformidade** (como PCI-DSS, NIST 800-53, benchmarks CIS...) na organiza√ß√£o.
* **Ativos**: Esta se√ß√£o **mostra todos os ativos em uso**, muito √∫til para sysadmins (e talvez atacantes) verem o que est√° sendo executado em uma √∫nica p√°gina.
* **Descobertas**: Isso **agrega** em uma **tabela descobertas** de diferentes se√ß√µes da Seguran√ßa GCP (n√£o apenas do Command Center) para poder visualizar facilmente descobertas que importam.
* **Fontes**: Mostra um **resumo das descobertas** de todas as diferentes se√ß√µes da seguran√ßa GCP **por se√ß√£o**.
* **Postura**: \[Premium Necess√°rio] A Postura de Seguran√ßa permite **definir, avaliar e monitorar a seguran√ßa do ambiente GCP**. Funciona criando uma pol√≠tica que define restri√ß√µes ou restri√ß√µes que controlam/monitoram os recursos no GCP. Existem v√°rios modelos de postura predefinidos que podem ser encontrados em [https://cloud.google.com/security-command-center/docs/security-posture-overview?authuser=2#predefined-policy](https://cloud.google.com/security-command-center/docs/security-posture-overview?authuser=2#predefined-policy)

### **Amea√ßas**

Do ponto de vista de um atacante, esta √© provavelmente a **caracter√≠stica mais interessante, pois poderia detectar o atacante**. No entanto, observe que esta funcionalidade requer **Premium** (o que significa que a empresa precisar√° pagar mais), ent√£o **pode nem mesmo estar habilitada**.&#x20;

Existem 3 tipos de mecanismos de detec√ß√£o de amea√ßas:

* **Amea√ßas de Eventos**: Descobertas produzidas pela correspond√™ncia de eventos do **Cloud Logging** com base em **regras criadas** internamente pela Google. Tamb√©m √© poss√≠vel escanear **logs do Google Workspace**.
* √â poss√≠vel encontrar a descri√ß√£o de todas as [**regras de detec√ß√£o na documenta√ß√£o**](https://cloud.google.com/security-command-center/docs/concepts-event-threat-detection-overview?authuser=2#how\_works)
* **Amea√ßas de Cont√™iner**: Descobertas produzidas ap√≥s analisar o comportamento em baixo n√≠vel do kernel dos cont√™ineres.
* **Amea√ßas Personalizadas**: Regras criadas pela empresa.

√â poss√≠vel encontrar respostas recomendadas para amea√ßas detectadas de ambos os tipos em [https://cloud.google.com/security-command-center/docs/how-to-investigate-threats?authuser=2#event\_response](https://cloud.google.com/security-command-center/docs/how-to-investigate-threats?authuser=2#event\_response)

### Enumera√ß√£o

{% code overflow="wrap" %}
```bash
# Get a source
gcloud scc sources describe <org-number> --source=5678
## If the response is that the service is disabled or that the source is not found, then, it isn't enabled

# Get notifications
gcloud scc notifications list <org-number>

# Get findings (if not premium these are just vulnerabilities)
gcloud scc findings list <org-number>
```
{% endcode %}

### P√≥s-Explora√ß√£o

{% content-ref url="../gcp-post-exploitation/gcp-security-post-exploitation.md" %}
[gcp-security-post-exploitation.md](../gcp-post-exploitation/gcp-security-post-exploitation.md)
{% endcontent-ref %}

## Detec√ß√µes e Controles

* **Chronicle SecOps**: Uma su√≠te avan√ßada de opera√ß√µes de seguran√ßa projetada para ajudar equipes a aumentar a velocidade e o impacto das opera√ß√µes de seguran√ßa, incluindo detec√ß√£o, investiga√ß√£o e resposta a amea√ßas.
* **reCAPTCHA Enterprise**: Um servi√ßo que protege sites de atividades fraudulentas como scraping, preenchimento de credenciais e ataques automatizados, distinguindo entre usu√°rios humanos e bots.
* **Web Security Scanner**: Ferramenta automatizada de varredura de seguran√ßa que detecta vulnerabilidades e problemas de seguran√ßa comuns em aplicativos web hospedados no Google Cloud ou em outro servi√ßo web.
* **Risk Manager**: Uma ferramenta de governan√ßa, risco e conformidade (GRC) que ajuda organiza√ß√µes a avaliar, documentar e entender sua postura de risco no Google Cloud.
* **Binary Authorization**: Um controle de seguran√ßa para cont√™ineres que garante que apenas imagens de cont√™iner confi√°veis sejam implantadas em clusters do Kubernetes Engine de acordo com pol√≠ticas definidas pela empresa.
* **Notifica√ß√µes de Avisos**: Um servi√ßo que fornece alertas e avisos sobre poss√≠veis problemas de seguran√ßa, vulnerabilidades e a√ß√µes recomendadas para manter os recursos seguros.
* **Aprova√ß√£o de Acesso**: Um recurso que permite que organiza√ß√µes exijam aprova√ß√£o expl√≠cita antes que funcion√°rios do Google possam acessar seus dados ou configura√ß√µes, fornecendo uma camada adicional de controle e auditabilidade.
* **Managed Microsoft AD**: Um servi√ßo que oferece o Active Directory (AD) da Microsoft gerenciado, permitindo que os usu√°rios usem seus aplicativos e cargas de trabalho existentes dependentes do Microsoft AD no Google Cloud.

## Prote√ß√£o de Dados

* **Prote√ß√£o de Dados Sens√≠veis**: Ferramentas e pr√°ticas destinadas a proteger dados sens√≠veis, como informa√ß√µes pessoais ou propriedade intelectual, contra acesso ou exposi√ß√£o n√£o autorizados.
* **Preven√ß√£o de Perda de Dados (DLP)**: Um conjunto de ferramentas e processos usados para identificar, monitorar e proteger dados em uso, em movimento e em repouso por meio de inspe√ß√£o profunda de conte√∫do e aplica√ß√£o de um conjunto abrangente de regras de prote√ß√£o de dados.
* **Servi√ßo de Autoridade de Certifica√ß√£o**: Um servi√ßo escal√°vel e seguro que simplifica e automatiza o gerenciamento, implanta√ß√£o e renova√ß√£o de certificados SSL/TLS para servi√ßos internos e externos.
* **Gerenciamento de Chaves**: Um servi√ßo baseado em nuvem que permite gerenciar chaves criptogr√°ficas para suas aplica√ß√µes, incluindo a cria√ß√£o, importa√ß√£o, rota√ß√£o, uso e destrui√ß√£o de chaves de criptografia. Mais informa√ß√µes em:

{% content-ref url="gcp-kms-enum.md" %}
[gcp-kms-enum.md](gcp-kms-enum.md)
{% endcontent-ref %}

* **Gerenciador de Certificados**: Um servi√ßo que gerencia e implanta certificados SSL/TLS, garantindo conex√µes seguras e criptografadas para seus servi√ßos e aplicativos web.
* **Gerenciador de Segredos**: Um sistema de armazenamento seguro e conveniente para chaves de API, senhas, certificados e outros dados sens√≠veis, que permite o acesso e gerenciamento f√°cil e seguro desses segredos em aplica√ß√µes. Mais informa√ß√µes em:

{% content-ref url="../../gcp-pentesting/gcp-services/gcp-secrets-manager-enum.md" %}
[gcp-secrets-manager-enum.md](../../gcp-pentesting/gcp-services/gcp-secrets-manager-enum.md)
{% endcontent-ref %}

## Confian√ßa Zero

* **BeyondCorp Enterprise**: Uma plataforma de seguran√ßa de confian√ßa zero que permite acesso seguro a aplicativos internos sem a necessidade de uma VPN tradicional, confiando na verifica√ß√£o da confian√ßa do usu√°rio e do dispositivo antes de conceder acesso.
* **Solucionador de Problemas de Pol√≠ticas**: Uma ferramenta projetada para ajudar administradores a entender e resolver problemas de acesso em suas organiza√ß√µes, identificando por que um usu√°rio tem acesso a determinados recursos ou por que o acesso foi negado, auxiliando assim na aplica√ß√£o de pol√≠ticas de confian√ßa zero.
* **Proxy com Consci√™ncia de Identidade (IAP)**: Um servi√ßo que controla o acesso a aplicativos em nuvem e VMs em execu√ß√£o no Google Cloud, localmente ou em outras nuvens, com base na identidade e no contexto da solicita√ß√£o, em vez da rede de onde a solicita√ß√£o se origina.
* **Controles de Servi√ßo VPC**: Per√≠metros de seguran√ßa que fornecem camadas adicionais de prote√ß√£o a recursos e servi√ßos hospedados na Virtual Private Cloud (VPC) do Google Cloud, impedindo a exfiltra√ß√£o de dados e fornecendo controle de acesso granular.
* **Gerenciador de Contexto de Acesso**: Parte do BeyondCorp Enterprise do Google Cloud, essa ferramenta ajuda a definir e aplicar pol√≠ticas de controle de acesso detalhadas com base na identidade do usu√°rio e no contexto de sua solicita√ß√£o, como status de seguran√ßa do dispositivo, endere√ßo IP e muito mais.
