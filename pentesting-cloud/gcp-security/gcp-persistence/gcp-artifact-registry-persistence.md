# GCP - Artifact Registry Persistence

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Artifact Registry

Artifact Registry ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¶‡•á‡§ñ‡•á‡§Ç:

{% content-ref url="../gcp-services/gcp-artifact-registry-enum.md" %}
[gcp-artifact-registry-enum.md](../gcp-services/gcp-artifact-registry-enum.md)
{% endcontent-ref %}

### Dependency Confusion

* ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•ã‡§§‡§æ ‡§π‡•à ‡§Ö‡§ó‡§∞ ‡§è‡§ï **remote ‡§î‡§∞ ‡§è‡§ï standard** repositories **‡§è‡§ï virtual** ‡§Æ‡•á‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡§è ‡§ú‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§è‡§ï package ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•ã?
* ‡§µ‡§π ‡§ú‡•ã **virtual repository ‡§Æ‡•á‡§Ç ‡§â‡§ö‡•ç‡§ö‡§§‡§Æ ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ** ‡§∏‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à, ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à
* ‡§Ø‡§¶‡§ø **priority ‡§∏‡§Æ‡§æ‡§® ‡§π‡•à**:
* ‡§Ø‡§¶‡§ø **version** **‡§∏‡§Æ‡§æ‡§®** ‡§π‡•à, ‡§§‡•ã **policy name ‡§µ‡§∞‡•ç‡§£‡§æ‡§®‡•Å‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç** ‡§™‡§π‡§≤‡•á virtual repository ‡§Æ‡•á‡§Ç ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à
* ‡§Ø‡§¶‡§ø ‡§®‡§π‡•Ä‡§Ç, ‡§§‡•ã **‡§â‡§ö‡•ç‡§ö‡§§‡§Æ version** ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à

{% hint style="danger" %}
‡§á‡§∏‡§≤‡§ø‡§è, ‡§Ø‡§¶‡§ø remote repository ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ ‡§â‡§ö‡•ç‡§ö ‡§Ø‡§æ ‡§∏‡§Æ‡§æ‡§® ‡§π‡•à, ‡§§‡•ã ‡§è‡§ï ‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï package registry ‡§Æ‡•á‡§Ç **‡§â‡§ö‡•ç‡§ö‡§§‡§Æ version (dependency confusion)** ‡§ï‡§æ **‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó** ‡§ï‡§∞‡§®‡§æ ‡§∏‡§Ç‡§≠‡§µ ‡§π‡•à
{% endhint %}

‡§Ø‡§π ‡§§‡§ï‡§®‡•Ä‡§ï **persistence** ‡§î‡§∞ **unauthenticated access** ‡§ï‡•á ‡§≤‡§ø‡§è ‡§â‡§™‡§Ø‡•ã‡§ó‡•Ä ‡§π‡•ã ‡§∏‡§ï‡§§‡•Ä ‡§π‡•à ‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§á‡§∏‡•á ‡§¶‡•Å‡§∞‡•Å‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•á‡§µ‡§≤ **Artifact Registry ‡§Æ‡•á‡§Ç ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§è‡§ï ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§ú‡§æ‡§®‡§®‡§æ** ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à ‡§î‡§∞ **‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï repository (‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è python ‡§ï‡•á ‡§≤‡§ø‡§è PyPi) ‡§Æ‡•á‡§Ç ‡§â‡§∏‡•Ä ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä ‡§ï‡•ã ‡§â‡§ö‡•ç‡§ö‡§§‡§∞ version ‡§ï‡•á ‡§∏‡§æ‡§• ‡§¨‡§®‡§æ‡§®‡§æ** ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§π‡•à‡•§

persistence ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡•ã ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§ö‡§∞‡§£‡•ã‡§Ç ‡§ï‡§æ ‡§™‡§æ‡§≤‡§® ‡§ï‡§∞‡§®‡§æ ‡§π‡•ã‡§ó‡§æ:

* **‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§è‡§Å**: ‡§è‡§ï **virtual repository** ‡§ï‡§æ **‡§Ö‡§∏‡•ç‡§§‡§ø‡§§‡•ç‡§µ** ‡§π‡•ã‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§î‡§∞ ‡§á‡§∏‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è, ‡§è‡§ï **internal package** ‡§ú‡§ø‡§∏‡§ï‡§æ **‡§®‡§æ‡§Æ** **‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï repository** ‡§Æ‡•á‡§Ç ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§ø‡§è‡•§
* ‡§Ø‡§¶‡§ø ‡§Ø‡§π ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§§‡•ã ‡§è‡§ï remote repository ‡§¨‡§®‡§æ‡§è‡§Ç
* remote repository ‡§ï‡•ã virtual repository ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç
* virtual registry ‡§ï‡•Ä ‡§®‡•Ä‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø remote repository ‡§ï‡•ã ‡§â‡§ö‡•ç‡§ö‡§§‡§∞ ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ (‡§Ø‡§æ ‡§∏‡§Æ‡§æ‡§®) ‡§¶‡•Ä ‡§ú‡§æ ‡§∏‡§ï‡•á‡•§\
‡§ï‡•Å‡§õ ‡§ê‡§∏‡§æ ‡§ö‡§≤‡§æ‡§è‡§Ç:
* [gcloud artifacts repositories update --upstream-policy-file ...](https://cloud.google.com/sdk/gcloud/reference/artifacts/repositories/update#--upstream-policy-file)
* ‡§µ‡•à‡§ß package ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç, ‡§Ö‡§™‡§®‡•á ‡§¶‡•Å‡§∞‡•ç‡§≠‡§æ‡§µ‡§®‡§æ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ï‡•ã‡§° ‡§ï‡•ã ‡§ú‡•ã‡§°‡§º‡•á‡§Ç ‡§î‡§∞ ‡§á‡§∏‡•á ‡§â‡§∏‡•Ä version ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï repository ‡§Æ‡•á‡§Ç ‡§™‡§Ç‡§ú‡•Ä‡§ï‡•É‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§π‡§∞ ‡§¨‡§æ‡§∞ ‡§ú‡§¨ ‡§è‡§ï developer ‡§á‡§∏‡•á ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à, ‡§§‡•ã ‡§µ‡§π ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§ó‡§æ!

Dependency confusion ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¶‡•á‡§ñ‡•á‡§Ç:

{% embed url="https://book.hacktricks.xyz/pentesting-web/dependency-confusion" %}

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
