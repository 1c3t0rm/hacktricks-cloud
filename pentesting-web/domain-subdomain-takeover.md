# Domain/Subdomain takeover

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da lako izgradite i **automatizujete radne tokove** pokretane najnaprednijim alatima zajednice.\
Dobijte pristup danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Preuzimanje domena

Ako otkrijete neki domen (domen.tld) koji **koristi neka usluga unutar opsega** ali je **kompanija** izgubila **vlasništvo** nad njim, možete pokušati da ga **registrujete** (ako je dovoljno jeftin) i obavestite kompaniju. Ako ovaj domen prima neke **osetljive informacije** poput sesijskog kolačića putem **GET** parametra ili u **Referer** zaglavlju, to je sigurno **ranjivost**.

### Preuzimanje poddomena

Poddomen kompanije pokazuje na **uslugu treće strane sa imenom koje nije registrovano**. Ako možete **napraviti** nalog u ovoj **usluzi treće strane** i **registrovati** ime koje se koristi, možete izvršiti preuzimanje poddomena.

Postoje razni alati sa rečnicima za proveru mogućih preuzimanja:

* [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz)
* [https://github.com/blacklanternsecurity/bbot](https://github.com/blacklanternsecurity/bbot)
* [https://github.com/punk-security/dnsReaper](https://github.com/punk-security/dnsReaper)
* [https://github.com/haccer/subjack](https://github.com/haccer/subjack)
* [https://github.com/anshumanbh/tko-sub](https://github.com/anshumanbh/tko-subs)
* [https://github.com/ArifulProtik/sub-domain-takeover](https://github.com/ArifulProtik/sub-domain-takeover)
* [https://github.com/SaadAhmedx/Subdomain-Takeover](https://github.com/SaadAhmedx/Subdomain-Takeover)
* [https://github.com/Ice3man543/SubOver](https://github.com/Ice3man543/SubOver)
* [https://github.com/m4ll0k/takeover](https://github.com/m4ll0k/takeover)
* [https://github.com/antichown/subdomain-takeover](https://github.com/antichown/subdomain-takeover)
* [https://github.com/musana/mx-takeover](https://github.com/musana/mx-takeover)
* [https://github.com/PentestPad/subzy](https://github.com/PentestPad/subzy)

#### Skeniranje za poddomene podložne preuzimanju sa [BBOT](https://github.com/blacklanternsecurity/bbot):

Provere preuzimanja poddomena su uključene u podrazumevano prebrojavanje poddomena BBOT-a. Potpisi se direktno povlače sa [https://github.com/EdOverflow/can-i-take-over-xyz](https://github.com/EdOverflow/can-i-take-over-xyz).

```bash
bbot -t evilcorp.com -f subdomain-enum
```

### Generisanje preuzimanja poddomena putem DNS zamke

Kada se koristi DNS zamka u domenu, bilo koji zahtevani poddomen tog domena koji nema eksplicitno drugu adresu **će biti rešen na iste informacije**. To može biti A IP adresa, CNAME...

Na primer, ako je `*.testing.com` postavljen kao zamka na `1.1.1.1`. Tada će `not-existent.testing.com` pokazivati ka `1.1.1.1`.

Međutim, ako umesto ka IP adresi, sistem administrator usmeri ka **trećoj stranoj usluzi putem CNAME**, kao što je **github poddomen** na primer (`sohomdatta1.github.io`). Napadač bi mogao **napraviti svoju treću stranu stranicu** (u ovom slučaju na Gihub-u) i reći da `something.testing.com` pokazuje tamo. Zato što će **CNAME zamka** saglasiti, napadač će moći **generisati proizvoljne poddomene za domen žrtve koji pokazuju ka njegovim stranicama**.

Primer ove ranjivosti možete pronaći u CTF izveštaju: [https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api](https://ctf.zeyu2001.com/2022/nitectf-2022/undocumented-js-api)

## Iskorišćavanje preuzimanja poddomena

Preuzimanje poddomena je suštinski DNS spoofing za određeni domen širom interneta, omogućavajući napadačima da postave A zapise za domen, što dovodi do toga da pretraživači prikazuju sadržaj sa servera napadača. Ova **transparentnost** u pretraživačima čini domene podložnim phishingu. Napadači mogu koristiti [_typosquatting_](https://en.wikipedia.org/wiki/Typosquatting) ili [_Doppelganger domene_](https://en.wikipedia.org/wiki/Doppelg%C3%A4nger) u tu svrhu. Posebno ranjivi su domeni gde URL u phishing emailu izgleda legitimno, obmanjujući korisnike i izbegavajući spam filtere zbog inherentnog poverenja u domen.

Proverite ovaj [post za dodatne detalje](https://0xpatrik.com/subdomain-takeover/)

### **SSL Sertifikati**

SSL sertifikati, ako su generisani od strane napadača putem usluga poput [_Let's Encrypt_](https://letsencrypt.org/), doprinose legitimnosti ovih lažnih domena, čineći phishing napade ubedljivijim.

### **Sigurnost kolačića i transparentnost pretraživača**

Transparentnost pretraživača se takođe odnosi na sigurnost kolačića, koju uređuju politike poput [Politike istog porekla](https://en.wikipedia.org/wiki/Same-origin\_policy). Kolačići, često korišćeni za upravljanje sesijama i čuvanje tokena za prijavu, mogu biti iskorišćeni putem preuzimanja poddomena. Napadači mogu **prikupiti sesijske kolačiće** jednostavno usmeravajući korisnike ka kompromitovanom poddomenu, ugrožavajući podatke i privatnost korisnika.

### **Emailovi i preuzimanje poddomena**

Još jedan aspekt preuzimanja poddomena uključuje email usluge. Napadači mogu manipulisati **MX zapisima** kako bi primili ili poslali emailove sa legitimnog poddomena, povećavajući efikasnost phishing napada.

### **Rizici višeg reda**

Dodatni rizici uključuju **preuzimanje NS zapisa**. Ako napadač preuzme kontrolu nad jednim NS zapisom domena, potencijalno može usmeriti deo saobraćaja ka serveru pod njihovom kontrolom. Ovaj rizik se povećava ako napadač postavi visok **TTL (Vreme života)** za DNS zapise, produžavajući trajanje napada.

### Ranjivost CNAME zapisa

Napadači mogu iskoristiti neiskorišćene CNAME zapise koji pokazuju ka eksternim uslugama koje više nisu u upotrebi ili su dekomisionirane. Ovo im omogućava da naprave stranicu pod pouzdanim domenom, dodatno olakšavajući phishing ili distribuciju malvera.

### **Strategije ublažavanja**

Strategije ublažavanja uključuju:

1. **Uklanjanje ranjivih DNS zapisa** - Ovo je efikasno ako poddomen više nije potreban.
2. **Preuzimanje imena domena** - Registracija resursa kod odgovarajućeg provajdera u oblaku ili ponovna kupovina isteklog domena.
3. **Redovno praćenje ranjivosti** - Alati poput [aquatone](https://github.com/michenriksen/aquatone) mogu pomoći u identifikaciji podložnih domena. Organizacije takođe treba da revidiraju svoje procese upravljanja infrastrukturom, osiguravajući da je kreiranje DNS zapisa poslednji korak u kreiranju resursa i prvi korak u uništavanju resursa.

Za provajdere u oblaku, provera vlasništva nad domenom je ključna kako bi se sprečilo preuzimanje poddomena. Neki, poput [GitLab-a](https://about.gitlab.com/2018/02/05/gitlab-pages-custom-domain-validation/), prepoznali su ovaj problem i implementirali mehanizme provere domena.

## Reference

* [https://0xpatrik.com/subdomain-takeover/](https://0xpatrik.com/subdomain-takeover/)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Koristite [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) da lako izgradite i **automatizujete radne tokove** pokretane najnaprednijim alatima zajednice na svetu.\
Pristupite danas:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
