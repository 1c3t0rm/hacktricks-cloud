# BrowExt - permissions & host\_permissions

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite svoju **kompaniju reklamiranu na HackTricks-u** ili da **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

### **`dozvole`**

Dozvole su definisane u **`manifest.json`** fajlu proširenja koristeći svojstvo **`permissions`** i omogućavaju pristup skoro svemu čemu browser može pristupiti (kolačići ili fizičko skladište):

Prethodni manifest deklariše da proširenje zahteva dozvolu `storage`. Ovo znači da može koristiti [API za skladištenje](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) da bi trajno čuvalo svoje podatke. Za razliku od kolačića ili `localStorage` API-ja koji daju korisnicima određeni nivo kontrole, **skladište proširenja se obično može očistiti samo deinstaliranjem proširenja**.

Proširenje će zatražiti dozvole navedene u svom **`manifest.json`** fajlu i Nakon instaliranja proširenja, uvek možete **proveriti njegove dozvole u svom browseru**, kao što je prikazano na ovoj slici:

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Možete pronaći [**kompletan spisak dozvola koje Chromium Browser Extension može zatražiti ovde**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) i [**kompletan spisak za Firefox ekstenzije ovde**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

Opciono, ali moćno podešavanje **`host_permissions`** ukazuje sa kojim domenima će proširenje moći da interaguje putem API-ja kao što su [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) i [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs).

Sledeće `host_permissions` praktično dozvoljavaju svakom veb sajtu:

```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```

Ovo su domaćini kojima proširenje pregledača može slobodno pristupiti. To je zato što kada proširenje pregledača pozove **`fetch("https://gmail.com/")`** nije ograničeno od strane CORS-a.

## Zloupotreba `permissions` i `host_permissions`

### Tabovi

Osim toga, **`host_permissions`** takođe otključavaju "napredno" [**tabs API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **funkcionalnosti**. Dozvoljavaju proširenju da pozove [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) i ne samo da dobije **listu korisničkih tabova pregledača** već i sazna koje **web stranice (znači adresu i naslov) su učitane**.

{% hint style="danger" %}
Nije samo to, slušači poput [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) takođe postaju mnogo korisniji. Biće obavešteni svaki put kada se nova stranica učita u tab.
{% endhint %}

### Pokretanje skripti sadržaja <a href="#running-content-scripts" id="running-content-scripts"></a>

Skripte sadržaja nisu nužno statički napisane u manifestu proširenja. Sa dovoljnim **`host_permissions`**, **proširenja takođe mogu da ih dinamički učitaju pozivajući** [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **ili** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript).

Oba API-ja omogućavaju izvršavanje ne samo datoteka sadržanih u proširenjima kao skripte sadržaja već i **proizvoljnog koda**. Prvi omogućava prosleđivanje JavaScript koda kao string dok drugi očekuje JavaScript funkciju koja je manje podložna ranjivostima ubacivanja. Ipak, oba API-ja će napraviti haos ako se zloupotrebe.

{% hint style="danger" %}
Pored gore navedenih mogućnosti, skripte sadržaja na primer mogu **interceptovati akreditive** dok se unose na web stranice. Još jedan klasičan način zloupotrebe je **ubacivanje reklama** na svaku web lokaciju. Dodavanje **prevara poruka** za zloupotrebu kredibiliteta vesti je takođe moguće. Na kraju, mogu **manipulisati bankarskim** web lokacijama kako bi preusmerile novčane transfere.
{% endhint %}

### Implicitne privilegije <a href="#implicit-privileges" id="implicit-privileges"></a>

Neki privilegiji proširenja **ne moraju biti eksplicitno deklarisani**. Jedan primer je [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): njegova osnovna funkcionalnost je dostupna bez ikakvih privilegija. Svako proširenje može biti obavešteno kada otvorite i zatvorite tabove, jednostavno neće znati sa kojom web lokacijom se ti tabovi odnose.

Zvuči previše bezopasno? [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) je nešto manje bezopasan. Može se koristiti za **kreiranje novog taba**, suštinski isto kao [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) koji može biti pozvan od strane bilo koje web lokacije. Ipak, dok je `window.open()` podložan **blokatoru iskačućih prozora, `tabs.create()` nije**.

{% hint style="danger" %}
Proširenje može kreirati bilo koji broj tabova kad god želi.
{% endhint %}

Ako pogledate moguće parametre `tabs.create()`, primetićete da njegove mogućnosti daleko premašuju ono što je `window.open()` dozvoljeno da kontroliše. I dok Firefox ne dozvoljava korišćenje `data:` URI-ja sa ovim API-jem, Chrome nema takvu zaštitu. **Korišćenje takvih URI-ja na najvišem nivou je** [**zabranjeno zbog zloupotrebe za ribarenje**](https://bugzilla.mozilla.org/show\_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) je vrlo sličan `tabs.create()` ali će **modifikovati postojeći tab**. Dakle, zlonamerno proširenje na primer može proizvoljno učitati stranicu sa reklamama u jedan od vaših tabova, i može aktivirati odgovarajući tab takođe.

### Veb kamera, geolokacija i prijatelji <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Verovatno znate da web lokacije mogu zatražiti posebne dozvole, na primer za pristup vašoj veb kameri (alati za video konferencije) ili geografskoj lokaciji (mape). To su funkcije sa značajnim potencijalom za zloupotrebu, pa korisnici svaki put moraju potvrditi da to i dalje žele.

{% hint style="danger" %}
Nije tako sa proširenjima pregledača. **Ako proširenje pregledača** [**želi pristup vašoj veb kameri ili mikrofonu**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, potrebno je samo jednom zatražiti dozvolu**
{% endhint %}

Tipično, proširenje će to učiniti odmah nakon instalacije. Nakon što se ovaj dijalog prihvati, **pristup veb kameri je moguć u bilo koje vreme**, čak i ako korisnik nije interaktivan sa proširenjem u tom trenutku. Da, korisnik će prihvatiti ovaj dijalog samo ako proširenje zaista treba pristup veb kameri. Ali nakon toga moraju da veruju proširenju da ne snima ništa tajno.

Sa pristupom [vašoj tačnoj geografskoj lokaciji](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) ili [sadržaju vašeg clipboard-a](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard\_API), eksplicitno odobravanje dozvole nije potrebno uopšte. **Proširenje jednostavno dodaje `geolocation` ili `clipboard` u** [**unos dozvola**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **svog manifesta**. Ovi pristupni privilegiji se zatim implicitno odobravaju prilikom instalacije proširenja. Dakle, zlonamerno ili kompromitovano proširenje sa ovim privilegijama može kreirati vaš profil kretanja ili pratiti vaš clipboard za kopirane lozinke bez da primetite bilo šta.

Dodavanje ključne reči **`history`** u [unos dozvola](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) manifesta proširenja omogućava **pristup** [**history API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). To omogućava dobijanje celokupne istorije pregledanja korisnika odjednom, bez čekanja da korisnik ponovo poseti ove web lokacije.

Dozvola **`bookmarks`** ima sličan potencijal za zloupotrebu, ova dozvola omogućava **čitanje svih obeleživača putem** [**bookmarks API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks).

### Dozvola za skladištenje <a href="#the-storage-permission" id="the-storage-permission"></a>

Skladište proširenja je samo kolekcija ključ-vrednost, vrlo slično [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) koju bi mogla koristiti bilo koja web lokacija. Dakle, ovde ne bi trebale biti smeštene osetljive informacije.

Međutim, kompanije za oglašavanje takođe mogu zloupotrebiti ovo skladište.

### Više dozvola

Možete pronaći [**kompletan spisak dozvola koje Chromium Browser Extension može zatražiti ovde**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) i [**kompletan spisak za Firefox proširenja ovde**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

## Prevencija <a href="#why-not-restrict-extension-privileges" id="why-not-restrict-extension-privileges"></a>

Politika Google-ovog razvojnog tima eksplicitno zabranjuje proširenjima da traže više privilegija nego što je potrebno za njihovu funkcionalnost, efikasno umanjujući prekomerne zahteve za dozvolama. Primer gde je proširenje pregledača prekoračilo ovu granicu uključivao je njegovu distribuciju sa samim pregledačem umesto putem prodavnice dodataka.

Pregledači bi mogli dalje ograničiti zloupotrebu privilegija proširenja. Na primer, Chrome-ovi [tabCapture](https://developer.chrome.com/docs/extensions/reference/tabCapture/) i [desktopCapture](https://developer.chrome.com/docs/extensions/reference/desktopCapture/) API-ji, korišćeni za snimanje ekrana, dizajnirani su da minimiziraju zloupotrebu. TabCapture API može biti aktiviran samo putem direktnog korisničkog interakcije, kao što je klik na ikonu proširenja, dok desktopCapture zahteva potvrdu korisnika da bi prozor bio snimljen, sprečavajući tajno snimanje aktivnosti.

Međutim, pooštravanje mera bezbednosti često rezultira smanjenom fleksibilnošću i korisničkom prijateljskošću proširenja. Dozvola [activeTab](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#activetab\_permission) ilustruje ovu kompromis. Uvedena je kako bi se eliminisala potreba za proširenjima da traže privilegije domaćina širom interneta, omogućavajući proširenjima pristup samo trenutnom tabu prilikom eksplicitne aktivacije od strane korisnika. Ovaj model je efikasan za proširenja koja zahtevaju akcije inicirane od strane korisnika, ali nije dovoljan za ona koja zahtevaju automatske ili preventivne akcije, time kompromitujući praktičnost i trenutnu odzivnost.

## **Reference**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitteru** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
