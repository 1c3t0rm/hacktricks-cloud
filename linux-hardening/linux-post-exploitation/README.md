# Linux Post-Exploitation

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Snimanje lozinki za prijavljivanje pomoću PAM-a

Konfigurišimo PAM modul da beleži svaku lozinku koju korisnik koristi za prijavljivanje. Ako ne znate šta je PAM, proverite:

{% content-ref url="pam-pluggable-authentication-modules.md" %}
[pam-pluggable-authentication-modules.md](pam-pluggable-authentication-modules.md)
{% endcontent-ref %}

**Za dodatne detalje proverite** [**originalni post**](https://embracethered.com/blog/posts/2022/post-exploit-pam-ssh-password-grabbing/). Ovo je samo sažetak:

**Pregled tehnike:** Pluggable Authentication Modules (PAM) pružaju fleksibilnost u upravljanju autentifikacijom na Unix baziranim sistemima. Mogu poboljšati bezbednost prilagođavanjem procesa prijavljivanja, ali takođe mogu predstavljati rizike ako se zloupotrebljavaju. Ovaj sažetak opisuje tehniku za snimanje podataka za prijavljivanje pomoću PAM-a, zajedno sa strategijama za ublažavanje rizika.

**Snimanje podataka za prijavljivanje:**

* Napravljen je bash skript nazvan `toomanysecrets.sh` koji beleži pokušaje prijavljivanja, snimajući datum, korisničko ime (`$PAM_USER`), lozinku (putem stdin-a) i IP adresu udaljenog hosta (`$PAM_RHOST`) u `/var/log/toomanysecrets.log`.
* Skript je postavljen kao izvršiv i integrisan u PAM konfiguraciju (`common-auth`) koristeći modul `pam_exec.so` sa opcijama za tiho izvršavanje i izlaganje autentifikacionog tokena skripti.
* Ovaj pristup pokazuje kako se kompromitovan Linux host može iskoristiti za diskretno beleženje podataka za prijavljivanje.

```bash
#!/bin/sh
echo " $(date) $PAM_USER, $(cat -), From: $PAM_RHOST" >> /var/log/toomanysecrets.log
sudo touch /var/log/toomanysecrets.sh
sudo chmod 770 /var/log/toomanysecrets.sh
sudo nano /etc/pam.d/common-auth
# Add: auth optional pam_exec.so quiet expose_authtok /usr/local/bin/toomanysecrets.sh
sudo chmod 700 /usr/local/bin/toomanysecrets.sh
```

### Backdooring PAM

**Za dalje detalje pogledajte** [**originalni post**](https://infosecwriteups.com/creating-a-backdoor-in-pam-in-5-line-of-code-e23e99579cd9). Ovo je samo sažetak:

Pluggable Authentication Module (PAM) je sistem koji se koristi pod Linuxom za autentifikaciju korisnika. Radi na tri osnovna koncepta: **korisničko ime**, **lozinka** i **servis**. Konfiguracioni fajlovi za svaki servis se nalaze u direktorijumu `/etc/pam.d/`, gde se autentifikacija vrši pomoću deljenih biblioteka.

**Cilj**: Modifikovati PAM kako bi se omogućila autentifikacija sa određenom lozinkom, zaobilazeći stvarnu korisničku lozinku. Poseban fokus je na deljenoj biblioteci `pam_unix.so` koja se koristi u fajlu `common-auth`, a koja se uključuje u skoro sve servise radi provere lozinke.

### Koraci za modifikaciju `pam_unix.so`:

1. **Locirajte direktivu za autentifikaciju** u fajlu `common-auth`:

* Linija koja proverava korisničku lozinku poziva `pam_unix.so`.

2. **Modifikujte izvorni kod**:

* Dodajte uslovnu izjavu u izvorni fajl `pam_unix_auth.c` koja omogućava pristup ako se koristi unapred definisana lozinka, inače se nastavlja sa uobičajenim procesom autentifikacije.

3. **Rekompajlirajte i zamenite** modifikovanu biblioteku `pam_unix.so` u odgovarajućem direktorijumu.
4. **Testiranje**:

* Pristup je omogućen putem različitih servisa (login, ssh, sudo, su, screensaver) sa unapred definisanom lozinkom, dok uobičajeni procesi autentifikacije ostaju nepromenjeni.

{% hint style="info" %}
Ovaj proces možete automatizovati pomoću [https://github.com/zephrax/linux-pam-backdoor](https://github.com/zephrax/linux-pam-backdoor)
{% endhint %}

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
