# Bypass Biometric Authentication (Android)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetičku bezbednost**? Želite li da vidite svoju **kompaniju reklamiranu na HackTricks-u**? Ili želite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridružite se** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Metod 1 - Zaobilaženje bez korišćenja Crypto Object-a**

Fokus je ovde na _onAuthenticationSucceeded_ povratnom pozivu, koji je ključan u procesu autentifikacije. Istraživači iz WithSecure-a razvili su [Frida skriptu](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass.js), koja omogućava zaobilaženje NULL _CryptoObject_-a u _onAuthenticationSucceeded(...)_. Skripta automatski zaobilazi biometrijsku autentifikaciju prilikom poziva metode. U nastavku je prikazan pojednostavljeni isečak koji demonstrira zaobilaženje u kontekstu Android otiska prsta, a cela aplikacija je dostupna na [GitHub-u](https://github.com/St3v3nsS/InsecureBanking).

```javascript
biometricPrompt = new BiometricPrompt(this, executor, new BiometricPrompt.AuthenticationCallback() {
@Override
public void onAuthenticationSucceeded(@NonNull BiometricPrompt.AuthenticationResult result) {
Toast.makeText(MainActivity.this,"Success",Toast.LENGTH_LONG).show();
}
});
```

Komanda za pokretanje Frida skripte:

```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass.js
```

## **Metod 2 - Pristup obradi izuzetaka**

Još jedan [Frida skript](https://github.com/WithSecureLABS/android-keystore-audit/blob/master/frida-scripts/fingerprint-bypass-via-exception-handling.js) od strane WithSecure se bavi zaobilaženjem nebezbedne upotrebe kripto objekta. Skript poziva _onAuthenticationSucceeded_ sa _CryptoObject_ koji nije autorizovan otiskom prsta. Ako aplikacija pokuša da koristi drugi kripto objekat, izazvaće izuzetak. Skript priprema poziv _onAuthenticationSucceeded_ i obrađuje _javax.crypto.IllegalBlockSizeException_ u klasi _Cipher_, obezbeđujući da se naknadni objekti koje koristi aplikacija šifruju novim ključem.

Komanda za pokretanje Frida skripta:

```bash
frida -U -f com.generic.insecurebankingfingerprint --no-pause -l fingerprint-bypass-via-exception-handling.js
```

Po dostizanju ekrana otiska prsta i pokretanju `authenticate()`, u Frida konzoli unesite `bypass()` da biste aktivirali zaobilaženje:

```
Spawning com.generic.insecurebankingfingerprint...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> Hooking BiometricPrompt.authenticate()...
Hooking BiometricPrompt.authenticate2()...
Hooking FingerprintManager.authenticate()...
[Android Emulator 5554::com.generic.insecurebankingfingerprint]-> bypass()
```

## **Metod 3 - Instrumentacioni okviri**

Instrumentacioni okviri poput Xposed ili Frida mogu se koristiti za povezivanje sa metodama aplikacije tokom izvršavanja. Za biometrijsku autentifikaciju, ovi okviri mogu:

1. **Lažirati povratne pozive autentifikacije**: Povezivanjem sa metodama `onAuthenticationSucceeded`, `onAuthenticationFailed` ili `onAuthenticationError` u klasi `BiometricPrompt.AuthenticationCallback`, možete kontrolisati ishod procesa biometrijske autentifikacije.
2. **Obilaziti SSL Pinning**: Ovo omogućava napadaču da presretne i izmeni saobraćaj između klijenta i servera, potencijalno menjajući proces autentifikacije ili krađu osetljivih podataka.

Primer komande za Frida:

```bash
frida -U -l script-to-bypass-authentication.js --no-pause -f com.generic.in
```

## **Metoda 4 - Reverse inženjering i modifikacija koda**

Alati za reverse inženjering poput `APKTool`, `dex2jar` i `JD-GUI` mogu se koristiti za dekompilaciju Android aplikacije, čitanje njenog izvornog koda i razumevanje mehanizma autentifikacije. Koraci uključuju:

1. **Dekompilacija APK-a**: Pretvorite APK datoteku u format koji je čitljiviji ljudima (poput Java koda).
2. **Analiza koda**: Potražite implementaciju autentifikacije otiska prsta i identifikujte potencijalne slabosti (poput rezervnih mehanizama ili nepravilnih provera validacije).
3. **Rekompilacija APK-a**: Nakon modifikacije koda za zaobilaženje autentifikacije otiska prsta, aplikacija se rekompilira, potpisuje i instalira na uređaju radi testiranja.

## **Metoda 5 - Korišćenje prilagođenih alata za autentifikaciju**

Postoje specijalizovani alati i skripte dizajnirane za testiranje i zaobilaženje mehanizama autentifikacije. Na primer:

1. **MAGISK moduli**: MAGISK je alat za Android koji korisnicima omogućava rootovanje uređaja i dodavanje modula koji mogu menjati ili lažirati informacije na nivou hardvera, uključujući otiske prstiju.
2. **Prilagođene skripte**: Skripte se mogu pisati kako bi se komuniciralo sa Android Debug Bridge (ADB) ili direktno sa pozadinskim sistemom aplikacije kako bi se simulirala ili zaobišla autentifikacija otiska prsta.

## Reference

* [https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/](https://securitycafe.ro/2022/09/05/mobile-pentesting-101-bypassing-biometric-authentication/)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za kibernetičku bezbednost**? Želite li da vidite **vašu kompaniju reklamiranu na HackTricks-u**? Ili želite da imate pristup **najnovijoj verziji PEASS-a ili preuzmete HackTricks u PDF formatu**? Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridružite se** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitter-u** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikova slanjem PR-ova na** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
