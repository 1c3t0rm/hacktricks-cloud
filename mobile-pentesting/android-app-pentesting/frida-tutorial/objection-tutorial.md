# Objection Tutorial

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini da podržite HackTricks:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Bug bounty savet**: **registrujte se** za **Intigriti**, premium **platformu za bug bounty kreiranu od strane hakera, za hakere**! Pridružite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas i počnite da zarađujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## **Uvod**

**objection - Runtime Mobile Exploration**

[**Objection**](https://github.com/sensepost/objection) je alat za istraživanje mobilnih aplikacija u toku izvršavanja, pokretan od strane [Frida](https://www.frida.re). Napravljen je sa ciljem da pomogne u proceni mobilnih aplikacija i njihovoj bezbednosti, bez potrebe za jailbroken ili root-ovanim mobilnim uređajem.

**Napomena:** Ovo nije neka vrsta jailbreak / root zaobilaženja. Korišćenjem `objection`, i dalje ste ograničeni svim restrikcijama koje nameće odgovarajući sandbox sa kojim se suočavate.

### Rezime

**Cilj** objekcije je omogućiti korisniku da pozove **glavne akcije koje nudi Frida**. **Inače**, korisnik će morati da napravi **jedan skript za svaku aplikaciju** koju želi da testira.

## Tutorijal

Za ovaj tutorijal ću koristiti APK koji možete preuzeti ovde:

{% file src="../../../.gitbook/assets/app-release.zip" %}

Ili sa njegovog [originalnog repozitorijuma](https://github.com/asvid/FridaApp)(preuzmite app-release.apk)

### Instalacija

```bash
pip3 install objection
```

### Povezivanje

Napravite **običnu ADB konekciju** i **pokrenite** Frida server na uređaju (i proverite da li Frida radi i na klijentu i na serveru).

Ako koristite **rootovani uređaj**, potrebno je odabrati aplikaciju koju želite testirati unutar opcije _**--gadget**_. U ovom slučaju:

```bash
frida-ps -Uai
objection --gadget asvid.github.io.fridaapp explore
```

### Osnovne radnje

Neće biti navedene sve moguće komande objections u ovom tutorijalu, samo one koje sam smatrao korisnima.

#### Okruženje

Neki zanimljivi podaci (poput lozinki ili putanja) mogu se pronaći unutar okruženja.

```bash
env
```

![](<../../../.gitbook/assets/image (64).png>)

#### Informacije o Fridi

Frida je open-source alat koji omogućava dinamičko analiziranje i manipulaciju aplikacija na Android platformi. Koristi se za pentestiranje mobilnih aplikacija i otkrivanje ranjivosti. Frida pruža mogućnost da se prati i modifikuje izvršavanje koda u realnom vremenu, omogućavajući istraživačima da analiziraju i testiraju aplikacije na dubljem nivou.

Frida se sastoji od dva dela: Frida Server i Frida Client. Frida Server se instalira na ciljanom uređaju, dok se Frida Client koristi na napadačevom računaru. Frida Client se koristi za komunikaciju sa Frida Serverom i izvršavanje različitih komandi.

Da biste koristili Fridu, potrebno je da imate root pristup na ciljanom uređaju ili da koristite uređaj sa Android verzijom 5.0 ili novijom, gde je podržana funkcionalnost "debuggable".

Frida pruža mnoge korisne funkcionalnosti za analizu i manipulaciju aplikacija, kao što su:

* Interception: Omogućava praćenje i modifikaciju poziva funkcija u aplikaciji.
* Enumeration: Pruža informacije o instaliranim aplikacijama, procesima, servisima, aktivnostima i drugim komponentama.
* Injection: Omogućava ubacivanje koda u aplikaciju kako bi se izvršile određene akcije.
* Scripting: Omogućava pisanje skripti za automatizaciju određenih zadataka.
* SSL Pinning Bypass: Omogućava zaobilaženje SSL povezivanja kako bi se analizirao saobraćaj između aplikacije i servera.

Frida je veoma moćan alat za analizu i testiranje Android aplikacija. Kombinovanje Frida sa drugim alatima i tehnikama može pružiti dublji uvid u bezbednost aplikacija i otkrivanje ranjivosti koje bi mogle biti iskorišćene.

```bash
frida
```

![](<../../../.gitbook/assets/image (65).png>)

#### Učitavanje/Preuzimanje

```bash
file download <remote path> [<local path>]
file upload <local path> [<remote path>]
```

#### Uvoz frida skripte

```javascript
const script = await Session.createScript(`
// Frida script code here
`);
```

#### Load frida script into the application

```javascript
await script.load();
```

#### Hook a function with frida script

```javascript
await script.exports.functionName();
```

#### Unload frida script from the application

```javascript
await script.unload();
```

#### Importuj frida skriptu

```javascript
const script = await Session.createScript(`
// Frida kod skripte ovde
`);
```

#### Učitaj frida skriptu u aplikaciju

```javascript
await script.load();
```

#### Hook-uj funkciju sa frida skriptom

```javascript
await script.exports.functionName();
```

#### Isključi frida skriptu iz aplikacije

```javascript
await script.unload();
```

```bash
import <local path frida-script>
```

#### SSLPinning

SSLPinning je tehnika koja se koristi u Android aplikacijama kako bi se osiguralo da se komunikacija između aplikacije i servera odvija samo preko validnog SSL sertifikata. Ova tehnika sprečava napadače da presretnu ili modifikuju podatke koji se prenose između aplikacije i servera.

Kada se koristi SSLPinning, aplikacija proverava da li SSL sertifikat koji je izdat od strane servera odgovara očekivanom sertifikatu. Ako se sertifikati ne podudaraju, aplikacija prekida komunikaciju sa serverom.

Napadači mogu pokušati da zaobiđu SSLPinning kako bi presreli ili modifikovali podatke. Jedan od načina za to je korišćenje alata kao što je Frida i Objection. Ovi alati omogućavaju hakerima da izvrše "hooking" funkcija u aplikaciji i promene njen ponašanje.

Da biste zaobišli SSLPinning pomoću Objection alata, možete koristiti komandu `android sslpinning disable`. Ova komanda će onemogućiti SSLPinning u aplikaciji, omogućavajući vam da presretnete i modifikujete podatke koji se prenose između aplikacije i servera.

Važno je napomenuti da je zaobiđanje SSLPinninga nezakonito i može imati ozbiljne pravne posledice. Ove tehnike treba koristiti samo u okviru zakonitog pentestinga ili u svrhu obrazovanja.

```bash
android sslpinning disable #Attempts to disable SSL Pinning on Android devices.
```

#### Otkrivanje root pristupa

Root pristup na Android uređaju omogućava korisniku da ima potpunu kontrolu nad operativnim sistemom. Međutim, u nekim slučajevima, aplikacije mogu pokušati da otkriju da li je uređaj rootovan kako bi sprečile njihovo izvršavanje na takvim uređajima. Ovo se često radi iz sigurnosnih razloga, jer root pristup može predstavljati potencijalnu pretnju za aplikaciju.

Da bi se otkrilo da li je uređaj rootovan, aplikacije mogu koristiti različite tehnike. Neki od najčešćih načina su:

* Provera postojanja poznatih fajlova ili direktorijuma koji su karakteristični za root pristup.
* Provera postojanja poznatih binarnih fajlova koji se koriste za root pristup.
* Provera postojanja privilegovanih komandi koje su dostupne samo sa root pristupom.
* Provera postojanja privilegovanih sistemskih propertija koji su karakteristični za root pristup.

Da biste zaobišli ove tehnike otkrivanja root pristupa, možete koristiti alate kao što je Magisk Hide ili Xposed Framework. Ovi alati omogućavaju sakrivanje root pristupa od aplikacija koje pokušavaju da ga otkriju.

Takođe, možete koristiti alate kao što je Frida ili Objection kako biste izmenili ili zaobisli kod koji se koristi za otkrivanje root pristupa. Ovi alati omogućavaju dinamičku analizu aplikacija i manipulaciju njihovim izvršnim kodom.

```bash
android root disable  #Attempts to disable root detection on Android devices.
android root simulate #Attempts to simulate a rooted Android environment.
```

#### Izvršavanje komande

The `exec` command in Objection allows you to execute shell commands on the target Android device. This can be useful for various purposes, such as exploring the device's file system, running additional tools, or performing actions that require shell access.

To use the `exec` command, you need to specify the command you want to execute as an argument. For example, to list the files in the current directory, you can use the following command:

```
objection> exec ls
```

The output of the command will be displayed in the Objection console. You can also redirect the output to a file by using the `>` operator. For example, to save the output of the `ls` command to a file named `files.txt`, you can use the following command:

```
objection> exec ls > files.txt
```

Keep in mind that the `exec` command runs the specified command as the user running the target application. Therefore, the available commands and their outputs may vary depending on the permissions and restrictions of the application.

It's important to use the `exec` command responsibly and only execute commands that you have permission to run. Unauthorized execution of commands can lead to unintended consequences and may be illegal. Always ensure that you have proper authorization and follow ethical guidelines when performing any actions on a target device.

```bash
android shell_exec whoami
```

#### Snimci ekrana

```bash
android ui screenshot /tmp/screenshot
android ui FLAG_SECURE false  #This may enable you to take screenshots using the hardware keys
```

### Statička analiza postaje Dinamička

U stvarnoj aplikaciji trebali bismo znati sve informacije otkrivene u ovom dijelu prije korištenja objekcije zahvaljujući **statičkoj analizi**. U svakom slučaju, na ovaj način možda možete vidjeti **nešto novo**, jer ćete ovdje imati samo potpuni popis klasa, metoda i izvezenih objekata.

Ovo je također korisno ako iz nekog razloga **ne možete dobiti čitljiv izvorni kod** aplikacije.

#### Popis aktivnosti, prijemnika i usluga

```bash
android hooking list activities
```

![](<../../../.gitbook/assets/image (78).png>)

```bash
android hooking list services
android hooking list receivers
```

Frida će prikazati grešku ako ne pronađe nijednu.

#### Dobijanje trenutne aktivnosti

```bash
android hooking get current_activity
```

![](<../../../.gitbook/assets/image (73) (1).png>)

#### Pretraga klasa

Hajde da počnemo sa traženjem klasa unutar naše aplikacije

```bash
android hooking search classes asvid.github.io.fridaapp
```

![](<../../../.gitbook/assets/image (69).png>)

#### Pretraga metoda u klasi

Sada ćemo izvući metode unutar klase _MainActivity:_

```bash
android hooking search methods asvid.github.io.fridaapp MainActivity
```

![](<../../../.gitbook/assets/image (70) (1).png>)

#### Lista deklarisanih metoda klase sa njihovim parametrima

Hajde da saznamo koje parametre metode klase zahtevaju:

```bash
android hooking list class_methods asvid.github.io.fridaapp.MainActivity
```

![](<../../../.gitbook/assets/image (79).png>)

#### Lista klasa

Takođe možete izlistati sve klase koje su učitane unutar trenutne aplikacije:

```bash
android hooking list classes #List all loaded classes, As the target application gets usedmore, this command will return more classes.
```

Ovo je veoma korisno ako želite da **povežete metodu klase, a znate samo ime klase**. Možete koristiti ovu funkciju da **pretražite koja modul poseduje klasu** i zatim povežete njenu metodu.

### Povezivanje je jednostavno

#### Povezivanje (praćenje) metode

Iz [izvornog koda](https://github.com/asvid/FridaApp/blob/master/app/src/main/java/asvid/github/io/fridaapp/MainActivity.kt) aplikacije znamo da se **funkcija** _**sum()**_ **iz klase** _**MainActivity**_ izvršava **svaku sekundu**. Hajde da pokušamo da **izbacimo sve moguće informacije** svaki put kada se funkcija pozove (argumente, povratnu vrednost i trag izvršavanja):

```bash
android hooking watch class_method asvid.github.io.fridaapp.MainActivity.sum --dump-args --dump-backtrace --dump-return
```

![](<../../../.gitbook/assets/image (71).png>)

#### Hookovanje (praćenje) cele klase

Zapravo, smatram da su svi metodi klase MainActivity veoma interesantni, hajde da ih **hookujemo sve**. Budite oprezni, ovo može **pokrenuti pad** aplikacije.

```bash
android hooking watch class asvid.github.io.fridaapp.MainActivity --dump-args --dump-return
```

Ako igrate sa aplikacijom dok je klasa povezana, videćete kada se poziva **svaka funkcija**, njene **argumente** i **vrednost povratka**.

![](<../../../.gitbook/assets/image (72).png>)

#### Menjanje boolean vrednosti funkcije

Iz izvornog koda možete videti da funkcija _checkPin_ prima _String_ kao argument i vraća _boolean_. Hajde da funkcija **uvek vraća true**:

![](<../../../.gitbook/assets/image (74).png>)

Sada, ako unesete bilo šta u polje za unos PIN koda, videćete da je sve validno:

![](<../../../.gitbook/assets/image (77).png>)

### Instance klase

Pretražite i ispišite **aktivne instance određene Java klase**, koje su navedene pomoću potpunog imena klase. Rezultat je pokušaj dobijanja string vrednosti za otkrivenu primedbu koja obično **sadrži vrednosti svojstava objekta**.

```
android heap print_instances <class>
```

![](<../../../.gitbook/assets/image (80).png>)

### Keystore/Intents

Možete se igrati sa keystore-om i intentima koristeći:

```bash
android keystore list
android intents launch_activity
android intent launch_service
```

#### Memorija

#### Dumpovanje

```bash
memory dump all <local destination> #Dump all memory
memory dump from_base <base_address> <size_to_dump> <local_destination> #Dump a part
```

#### Lista

```bash
memory list modules
```

![](<../../../.gitbook/assets/image (66).png>)

Na dnu liste možete videti fridu:

![](<../../../.gitbook/assets/image (67).png>)

Pogledajmo šta frida izvozi:

![](<../../../.gitbook/assets/image (68).png>)

#### Pretraga/Pisanje

Takođe možete pretraživati i pisati unutar memorije pomoću objection-a:

```bash
memory search "<pattern eg: 41 41 41 ?? 41>" (--string) (--offsets-only)
memory write "<address>" "<pattern eg: 41 41 41 41>" (--string)
```

### SQLite

Možete koristiti komandu `sqlite` za interakciju sa SQLite bazama podataka.

### Izlaz

```bash
exit
```

## Šta mi nedostaje u Objection-u

* Metode za hakovanje ponekad ruše aplikaciju (ovo je takođe zbog Frida-e).
* Ne možete koristiti instance klasa da biste pozvali funkcije instance. I ne možete kreirati nove instance klasa i koristiti ih za pozivanje funkcija.
* Ne postoji prečica (poput one za sslpinnin) za hakovanje svih uobičajenih kripto metoda koje koristi aplikacija kako biste videli šifrovani tekst, običan tekst, ključeve, IV-ove i korišćene algoritme.

<img src="../../../.gitbook/assets/i3.png" alt="" data-size="original">

**Savet za bug bounty**: **Prijavite se** za **Intigriti**, premium **platformu za bug bounty kreiranu od strane hakera, za hakere**! Pridružite nam se na [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) danas i počnite da zarađujete nagrade do **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu u HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Pogledajte [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje trikove hakovanja slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
