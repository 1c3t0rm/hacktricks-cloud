# Serverless.com Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the**  [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Podstawowe informacje

### Organizacja

**Organizacja** to najwy偶szy poziom podmiotu w ekosystemie Serverless Framework. Reprezentuje **zbiorow grup**, tak jak firma, dzia lub jakikolwiek du偶y podmiot, kt贸ry obejmuje wiele projekt贸w, zespo贸w i aplikacji.

### Zesp贸

**Zesp贸** to u偶ytkownicy z dostpem wewntrz organizacji. Zespoy pomagaj w organizowaniu czonk贸w na podstawie r贸l. **`Wsp贸pracownicy`** mog przeglda i wdra偶a istniejce aplikacje, podczas gdy **`Administratorzy`** mog tworzy nowe aplikacje i zarzdza ustawieniami organizacji.

### Aplikacja

**Aplikacja** to logiczne grupowanie powizanych usug w ramach Organizacji. Reprezentuje kompletn aplikacj skadajc si z wielu usug serverless, kt贸re wsp贸pracuj, aby zapewni sp贸jn funkcjonalno.

### **Usugi**

**Usuga** to podstawowy komponent aplikacji Serverless. Reprezentuje cay projekt serverless, kapsukujc wszystkie funkcje, konfiguracje i zasoby potrzebne. Zwykle jest definiowana w pliku `serverless.yml`, usuga zawiera metadane, takie jak nazwa usugi, konfiguracje dostawcy, funkcje, zdarzenia, zasoby, wtyczki i zmienne niestandardowe.
```yaml
service: my-service
provider:
name: aws
runtime: nodejs14.x
functions:
hello:
handler: handler.hello
```
<details>

<summary>Funkcja</summary>

A **Funkcja** reprezentuje pojedyncz funkcj serverless, tak jak funkcja AWS Lambda. Zawiera kod, kt贸ry jest wykonywany w odpowiedzi na zdarzenia.

Jest zdefiniowana w sekcji `functions` w `serverless.yml`, okrelajc handler, runtime, zdarzenia, zmienne rodowiskowe i inne ustawienia.
```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
```
</details>

<details>

<summary>Wydarzenie</summary>

**Wydarzenia** to wyzwalacze, kt贸re uruchamiaj Twoje funkcje serverless. Okrelaj, jak i kiedy funkcja powinna by wykonywana.

Typowe rodzaje wydarze to 偶dania HTTP, wydarzenia zaplanowane (zadania cron), wydarzenia z bazy danych, przesyanie plik贸w i inne.
```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
- schedule:
rate: rate(10 minutes)
```
</details>

<details>

<summary>Resource</summary>

**Zasoby** pozwalaj na zdefiniowanie dodatkowych zasob贸w chmurowych, od kt贸rych zale偶y Twoja usuga, takich jak bazy danych, kosze pamici lub role IAM.

S one okrelane w sekcji `resources`, czsto u偶ywajc skadni CloudFormation dla AWS.
```yaml
resources:
Resources:
MyDynamoDBTable:
Type: AWS::DynamoDB::Table
Properties:
TableName: my-table
AttributeDefinitions:
- AttributeName: id
AttributeType: S
KeySchema:
- AttributeName: id
KeyType: HASH
ProvisionedThroughput:
ReadCapacityUnits: 1
WriteCapacityUnits: 1
```
</details>

<details>

<summary>Dostawca</summary>

Obiekt **Dostawca** okrela dostawc usug chmurowych (np. AWS, Azure, Google Cloud) i zawiera ustawienia konfiguracyjne istotne dla tego dostawcy.

Zawiera szczeg贸y takie jak rodowisko uruchomieniowe, region, etap i dane uwierzytelniajce.
```yaml
yamlCopy codeprovider:
name: aws
runtime: nodejs14.x
region: us-east-1
stage: dev
```
</details>

<details>

<summary>Etap i Region</summary>

Etap reprezentuje r贸偶ne rodowiska (np. rozw贸j, staging, produkcja), w kt贸rych Twoja usuga mo偶e by wdro偶ona. Umo偶liwia to konfiguracje i wdro偶enia specyficzne dla rodowiska.
```yaml
provider:
stage: dev
```
Region okrela geograficzny obszar, w kt贸rym Twoje zasoby bd wdra偶ane. Jest to wa偶ne z uwagi na op贸藕nienia, zgodno i dostpno.
```yaml
provider:
region: us-west-2
```
</details>

<details>

<summary>Wtyczki</summary>

**Wtyczki** rozszerzaj funkcjonalno Frameworka Serverless, dodajc nowe funkcje lub integrujc z innymi narzdziami i usugami. S definiowane w sekcji `plugins` i instalowane za pomoc npm.
```yaml
plugins:
- serverless-offline
- serverless-webpack
```
</details>

<details>

<summary>Warstwy</summary>

**Warstwy** pozwalaj na pakowanie i zarzdzanie wsp贸lnym kodem lub zale偶nociami oddzielnie od twoich funkcji. To promuje ponowne u偶ycie i zmniejsza rozmiary pakiet贸w wdro偶eniowych. S definiowane w sekcji `layers` i s odniesione przez funkcje.
```yaml
layers:
commonLibs:
path: layer-common
functions:
hello:
handler: handler.hello
layers:
- { Ref: CommonLibsLambdaLayer }
```
</details>

<details>

<summary>Zmienne i Zmienne Niestandardowe</summary>

**Zmienne** umo偶liwiaj dynamiczn konfiguracj, pozwalajc na u偶ycie miejsc zastpczych, kt贸re s rozwizywane w czasie wdra偶ania.

*   **Skadnia:** skadnia `${variable}` mo偶e odnosi si do zmiennych rodowiskowych, zawartoci plik贸w lub innych parametr贸w konfiguracyjnych.

```yaml
functions:
hello:
handler: handler.hello
environment:
TABLE_NAME: ${self:custom.tableName}
```

-   **Zmienne Niestandardowe:** sekcja `custom` jest u偶ywana do definiowania zmiennych i konfiguracji specyficznych dla u偶ytkownika, kt贸re mog by ponownie u偶ywane w caym pliku `serverless.yml`.

```yaml
custom:
tableName: my-dynamodb-table
stage: ${opt:stage, 'dev'}
```

</details>

<details>

<summary>Wyjcia</summary>

**Wyjcia** definiuj wartoci, kt贸re s zwracane po wdro偶eniu usugi, takie jak ARNy zasob贸w, punkty kocowe lub inne przydatne informacje. S one okrelone w sekcji `outputs` i czsto u偶ywane do udostpniania informacji innym usugom lub do atwego dostpu po wdro偶eniu.
```yaml
隆outputs:
ApiEndpoint:
Description: "API Gateway endpoint URL"
Value:
Fn::Join:
- ""
- - "https://"
- Ref: ApiGatewayRestApi
- ".execute-api."
- Ref: AWS::Region
- ".amazonaws.com/"
- Ref: AWS::Stage
```
</details>

<details>

<summary>Role i uprawnienia IAM</summary>

**Role i uprawnienia IAM** definiuj dane uwierzytelniajce i prawa dostpu do Twoich funkcji i innych zasob贸w. S zarzdzane w ramach ustawie `provider` lub indywidualnych ustawie funkcji, aby okreli niezbdne uprawnienia.
```yaml
provider:
[...]
iam:
role:
statements:
- Effect: 'Allow'
Action:
- 'dynamodb:PutItem'
- 'dynamodb:Get*'
- 'dynamodb:Scan*'
- 'dynamodb:UpdateItem'
- 'dynamodb:DeleteItem'
Resource: arn:aws:dynamodb:${aws:region}:${aws:accountId}:table/${self:service}-customerTable-${sls:stage}
```
</details>

<details>

<summary>Zmienne rodowiskowe</summary>

**Zmienne** pozwalaj na przekazywanie ustawie konfiguracyjnych i sekret贸w do twoich funkcji bez ich twardego kodowania. S definiowane w sekcji `environment` dla dostawcy lub poszczeg贸lnych funkcji.
```yaml
provider:
environment:
STAGE: ${self:provider.stage}
functions:
hello:
handler: handler.hello
environment:
TABLE_NAME: ${self:custom.tableName}
```
</details>

<details>

<summary>Dependencies</summary>

**Dependencies** zarzdzaj zewntrznymi bibliotekami i moduami, kt贸rych potrzebuj Twoje funkcje. Zwykle s obsugiwane za pomoc mened偶er贸w pakiet贸w, takich jak npm lub pip, i pakowane z Twoim pakietem wdro偶eniowym przy u偶yciu narzdzi lub wtyczek, takich jak `serverless-webpack`.
```yaml
plugins:
- serverless-webpack
```
</details>

<details>

<summary>Hooks</summary>

**Hooks** pozwalaj na uruchamianie niestandardowych skrypt贸w lub polece w okrelonych punktach cyklu 偶ycia wdro偶enia. S definiowane za pomoc wtyczek lub w pliku `serverless.yml`, aby wykonywa dziaania przed lub po wdro偶eniach.
```yaml
custom:
hooks:
before:deploy:deploy: echo "Starting deployment..."
```
</details>

### Tutorial

To jest podsumowanie oficjalnego tutorialu [**z dokumentacji**](https://www.serverless.com/framework/docs/tutorial):

1. Utw贸rz konto AWS (Serverless.com zaczyna w infrastrukturze AWS)
2. Utw贸rz konto w serverless.com
3. Utw贸rz aplikacj:
```bash
# Create temp folder for the tutorial
mkdir /tmp/serverless-tutorial
cd /tmp/serverless-tutorial

# Install Serverless cli
npm install -g serverless

# Generate template
serverless #Choose first one (AWS / Node.js / HTTP API)
## Indicate a name like "Tutorial"
## Login/Register
## Create A New App
## Indicate a name like "tutorialapp)
```
To powinno stworzy **aplikacj** o nazwie `tutorialapp`, kt贸r mo偶esz sprawdzi w [serverless.com](serverless.com-security.md), oraz folder o nazwie `Tutorial` z plikiem **`handler.js`** zawierajcym kod JS z kodem `helloworld` oraz plikiem **`serverless.yml`** deklarujcym t funkcj:

{% tabs %}
{% tab title="handler.js" %}
```javascript
exports.hello = async (event) => {
return {
statusCode: 200,
body: JSON.stringify({
message: "Go Serverless v4! Your function executed successfully!",
}),
};
};
```
{% endtab %}

{% tab title="serverless.yml" %}
```yaml
# "org" ensures this Service is used with the correct Serverless Framework Access Key.
org: testing12342
# "app" enables Serverless Framework Dashboard features and sharing them with other Services.
app: tutorialapp
# "service" is the name of this project. This will also be added to your AWS resource names.
service: Tutorial

provider:
name: aws
runtime: nodejs20.x

functions:
hello:
handler: handler.hello
events:
- httpApi:
path: /
method: get
```
{% endtab %}
{% endtabs %}

4. Utw贸rz dostawc AWS, przechodzc do **dashboardu** pod `https://app.serverless.com/<org name>/settings/providers?providerId=new&provider=aws`.
1. Aby da `serverless.com` dostp do AWS, poprosi o uruchomienie stosu cloudformation przy u偶yciu tego pliku konfiguracyjnego (w momencie pisania tego tekstu): [https://serverless-framework-template.s3.amazonaws.com/roleTemplate.yml](https://serverless-framework-template.s3.amazonaws.com/roleTemplate.yml)
2. Ten szablon generuje rol o nazwie **`SFRole-<ID>`** z **`arn:aws:iam::aws:policy/AdministratorAccess`** dla konta z to偶samoci zaufania, kt贸ra pozwala na dostp konta `Serverless.com` do tej roli.

<details>

<summary>Yaml roleTemplate</summary>
```yaml
Description: This stack creates an IAM role that can be used by Serverless Framework for use in deployments.
Resources:
SFRole:
Type: AWS::IAM::Role
Properties:
AssumeRolePolicyDocument:
Version: '2012-10-17'
Statement:
- Effect: Allow
Principal:
AWS: arn:aws:iam::486128539022:root
Action:
- sts:AssumeRole
Condition:
StringEquals:
sts:ExternalId: !Sub 'ServerlessFramework-${OrgUid}'
Path: /
RoleName: !Ref RoleName
ManagedPolicyArns:
- arn:aws:iam::aws:policy/AdministratorAccess
ReporterFunction:
Type: Custom::ServerlessFrameworkReporter
Properties:
ServiceToken: 'arn:aws:lambda:us-east-1:486128539022:function:sp-providers-stack-reporter-custom-resource-prod-tmen2ec'
OrgUid: !Ref OrgUid
RoleArn: !GetAtt SFRole.Arn
Alias: !Ref Alias
Outputs:
SFRoleArn:
Description: 'ARN for the IAM Role used by Serverless Framework'
Value: !GetAtt SFRole.Arn
Parameters:
OrgUid:
Description: Serverless Framework Org Uid
Type: String
Alias:
Description: Serverless Framework Provider Alias
Type: String
RoleName:
Description: Serverless Framework Role Name
Type: String
```
</details>

<details>

<summary>Relacja Zaufania</summary>
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::486128539022:root"
},
"Action": "sts:AssumeRole",
"Condition": {
"StringEquals": {
"sts:ExternalId": "ServerlessFramework-7bf7ddef-e1bf-43eb-a111-4d43e0894ccb"
}
}
}
]
}
```
</details>

5. Tutorial prosi o utworzenie pliku `createCustomer.js`, kt贸ry zasadniczo utworzy nowy punkt kocowy API obsugiwany przez nowy plik JS i prosi o modyfikacj pliku `serverless.yml`, aby wygenerowa **now tabel DynamoDB**, zdefiniowa **zmienn rodowiskow**, rol, kt贸ra bdzie u偶ywa wygenerowanych lambd.

{% tabs %}
{% tab title="createCustomer.js" %}
```javascript
'use strict'
const AWS = require('aws-sdk')
module.exports.createCustomer = async (event) => {
const body = JSON.parse(Buffer.from(event.body, 'base64').toString())
const dynamoDb = new AWS.DynamoDB.DocumentClient()
const putParams = {
TableName: process.env.DYNAMODB_CUSTOMER_TABLE,
Item: {
primary_key: body.name,
email: body.email,
},
}
await dynamoDb.put(putParams).promise()
return {
statusCode: 201,
}
}
```
{% endtab %}

{% tab title="serverless.yml" %}
```yaml
# "org" ensures this Service is used with the correct Serverless Framework Access Key.
org: testing12342
# "app" enables Serverless Framework Dashboard features and sharing them with other Services.
app: tutorialapp
# "service" is the name of this project. This will also be added to your AWS resource names.
service: Tutorial

provider:
name: aws
runtime: nodejs20.x
environment:
DYNAMODB_CUSTOMER_TABLE: ${self:service}-customerTable-${sls:stage}
iam:
role:
statements:
- Effect: 'Allow'
Action:
- 'dynamodb:PutItem'
- 'dynamodb:Get*'
- 'dynamodb:Scan*'
- 'dynamodb:UpdateItem'
- 'dynamodb:DeleteItem'
Resource: arn:aws:dynamodb:${aws:region}:${aws:accountId}:table/${self:service}-customerTable-${sls:stage}

functions:
hello:
handler: handler.hello
events:
- httpApi:
path: /
method: get
createCustomer:
handler: createCustomer.createCustomer
events:
- httpApi:
path: /
method: post

resources:
Resources:
CustomerTable:
Type: AWS::DynamoDB::Table
Properties:
AttributeDefinitions:
- AttributeName: primary_key
AttributeType: S
BillingMode: PAY_PER_REQUEST
KeySchema:
- AttributeName: primary_key
KeyType: HASH
TableName: ${self:service}-customerTable-${sls:stage}
```
{% endtab %}
{% endtabs %}

6. Wdr贸偶 to, uruchamiajc **`serverless deploy`**
1. Wdro偶enie zostanie przeprowadzone za pomoc CloudFormation Stack
2. Zauwa偶, 偶e **lambdy s udostpniane za porednictwem API gateway** a nie za pomoc bezporednich adres贸w URL
7. **Przetestuj to**
1. Poprzedni krok wydrukuje **adresy URL**, pod kt贸rymi zostay wdro偶one funkcje lambda twojego API

## Przegld bezpieczestwa Serverless.com

### **殴le skonfigurowane role IAM i uprawnienia**

Zbyt szerokie role IAM mog przyzna nieautoryzowany dostp do zasob贸w chmurowych, prowadzc do narusze danych lub manipulacji zasobami.

Gdy nie okrelono uprawnie dla funkcji Lambda, zostanie utworzona rola z uprawnieniami tylko do generowania log贸w, jak:

<details>

<summary>Minimalne uprawnienia lambda</summary>
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Action": [
"logs:CreateLogStream",
"logs:CreateLogGroup",
"logs:TagResource"
],
"Resource": [
"arn:aws:logs:us-east-1:123456789012:log-group:/aws/lambda/jito-cranker-scripts-dev*:*"
],
"Effect": "Allow"
},
{
"Action": [
"logs:PutLogEvents"
],
"Resource": [
"arn:aws:logs:us-east-1:123456789012:log-group:/aws/lambda/jito-cranker-scripts-dev*:*:*"
],
"Effect": "Allow"
}
]
}
```
</details>

#### **Strategie agodzenia**

*   **Zasada najmniejszych uprawnie:** Przydzielaj tylko niezbdne uprawnienia do ka偶dej funkcji.

```yaml
provider:
[...]
iam:
role:
statements:
- Effect: 'Allow'
Action:
- 'dynamodb:PutItem'
- 'dynamodb:Get*'
- 'dynamodb:Scan*'
- 'dynamodb:UpdateItem'
- 'dynamodb:DeleteItem'
Resource: arn:aws:dynamodb:${aws:region}:${aws:accountId}:table/${self:service}-customerTable-${sls:stage}
```
* **U偶ywaj oddzielnych r贸l:** Rozr贸偶niaj role w zale偶noci od wymaga funkcji.

***

### **Niebezpieczne sekrety i zarzdzanie konfiguracj**

Przechowywanie wra偶liwych informacji (np. kluczy API, powiadcze bazy danych) bezporednio w **`serverless.yml`** lub kodzie mo偶e prowadzi do ujawnienia, jeli repozytoria zostan skompromitowane.

**Zalecanym** sposobem przechowywania zmiennych rodowiskowych w pliku **`serverless.yml`** z serverless.com (w momencie pisania tego tekstu) jest u偶ycie dostawc贸w `ssm` lub `s3`, co pozwala na pobranie **wartoci rodowiskowych z tych 藕r贸de w czasie wdra偶ania** i **konfigurowanie** zmiennych rodowiskowych **lambd** z **czystym tekstem wartoci**!

{% hint style="danger" %}
Dlatego ka偶dy, kto ma uprawnienia do odczytu konfiguracji lambd w AWS, bdzie m贸g **uzyska dostp do wszystkich tych zmiennych rodowiskowych w czystym tekcie!**
{% endhint %}

Na przykad, poni偶szy przykad u偶yje SSM do pobrania zmiennej rodowiskowej:
```yaml
provider:
environment:
DB_PASSWORD: ${ssm:/aws/reference/secretsmanager/my-db-password~true}
```
I nawet jeli to zapobiega twardemu kodowaniu wartoci zmiennej rodowiskowej w pliku **`serverless.yml`**, warto zostanie uzyskana w czasie wdra偶ania i bdzie **dodana w postaci czystego tekstu wewntrz zmiennej rodowiskowej lambda**.

{% hint style="success" %}
Zalecanym sposobem przechowywania zmiennych rodowiskowych przy u偶yciu serveless.com byoby **przechowywanie ich w tajemnicy AWS** i po prostu przechowywanie nazwy tajemnicy w zmiennej rodowiskowej, a **kod lambda powinien j zebra**.
{% endhint %}

#### **Strategie agodzenia**

* **Integracja z Mened偶erem Tajemnic:** U偶yj usug takich jak **AWS Secrets Manager.**
* **Szyfrowane Zmienne:** Wykorzystaj funkcje szyfrowania Frameworka Serverless dla wra偶liwych danych.
* **Kontrola Dostpu:** Ogranicz dostp do tajemnic w oparciu o role.

***

### **Wra偶liwy Kod i Zale偶noci**

Nieaktualne lub niebezpieczne zale偶noci mog wprowadza luki, podczas gdy niewaciwe przetwarzanie danych wejciowych mo偶e prowadzi do atak贸w typu injection.

#### **Strategie agodzenia**

*   **Zarzdzanie Zale偶nociami:** Regularnie aktualizuj zale偶noci i skanuj pod ktem luk.

```yaml
plugins:
- serverless-webpack
- serverless-plugin-snyk
```
* **Walidacja Danych Wejciowych:** Wprowad藕 cis walidacj i sanitacj wszystkich danych wejciowych.
* **Przegldy Kodu:** Przeprowadzaj dokadne przegldy, aby zidentyfikowa wady bezpieczestwa.
* **Analiza Statyczna:** U偶yj narzdzi do wykrywania luk w kodzie.

***

### **Niewystarczajce Logowanie i Monitorowanie**

Bez odpowiedniego logowania i monitorowania, zoliwe dziaania mog pozosta niezauwa偶one, op贸藕niajc reakcj na incydenty.

#### **Strategie agodzenia**

*   **Centralne Logowanie:** Agreguj logi za pomoc usug takich jak **AWS CloudWatch** lub **Datadog**.

```yaml
plugins:
- serverless-plugin-datadog
```
* **Wcz Szczeg贸owe Logowanie:** Zbieraj istotne informacje bez ujawniania wra偶liwych danych.
* **Ustaw Powiadomienia:** Skonfiguruj powiadomienia o podejrzanych dziaaniach lub anomaliach.
* **Regularne Monitorowanie:** Cige monitorowanie log贸w i metryk w poszukiwaniu potencjalnych incydent贸w bezpieczestwa.

***

### **Niezabezpieczone Konfiguracje API Gateway**

Otwarte lub niewaciwie zabezpieczone API mog by wykorzystywane do nieautoryzowanego dostpu, atak贸w typu Denial of Service (DoS) lub atak贸w midzy witrynami.

#### **Strategie agodzenia**

*   **Uwierzytelnianie i Autoryzacja:** Wprowad藕 solidne mechanizmy, takie jak OAuth, klucze API lub JWT.

```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
authorizer: aws_iam
```
*   **Ograniczenie Ruchu i Throttling:** Zapobiegaj nadu偶yciom, ograniczajc tempo 偶da.

```yaml
provider:
apiGateway:
throttle:
burstLimit: 200
rateLimit: 100
```
*   **Bezpieczna Konfiguracja CORS:** Ogranicz dozwolone 藕r贸da, metody i nag贸wki.

```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
cors:
origin: https://yourdomain.com
headers:
- Content-Type
```
* **U偶yj Zap贸r Aplikacji Webowych (WAF):** Filtruj i monitoruj 偶dania HTTP w poszukiwaniu zoliwych wzorc贸w.

***

### **Niewystarczajca Izolacja Funkcji**

Wsp贸lne zasoby i niewystarczajca izolacja mog prowadzi do eskalacji uprawnie lub niezamierzonych interakcji midzy funkcjami.

#### **Strategie agodzenia**

* **Izoluj Funkcje:** Przypisz odrbne zasoby i role IAM, aby zapewni niezale偶ne dziaanie.
* **Podzia Zasob贸w:** U偶yj oddzielnych baz danych lub koszyk贸w do przechowywania dla r贸偶nych funkcji.
*   **U偶yj VPC:** Wdra偶aj funkcje w Wirtualnych Chmurach Prywatnych dla lepszej izolacji sieci.

```yaml
provider:
vpc:
securityGroupIds:
- sg-xxxxxxxx
subnetIds:
- subnet-xxxxxx
```
* **Ogranicz Uprawnienia Funkcji:** Upewnij si, 偶e funkcje nie mog uzyskiwa dostpu do zasob贸w innych funkcji, chyba 偶e jest to wyra藕nie wymagane.

***

### **Niewystarczajca Ochrona Danych**

Niezaszyfrowane dane w spoczynku lub w tranzycie mog by nara偶one, prowadzc do narusze danych lub manipulacji.

#### **Strategie agodzenia**

*   **Szyfruj Dane w Spoczynku:** Wykorzystaj funkcje szyfrowania usug chmurowych.

```yaml
resources:
Resources:
MyDynamoDBTable:
Type: AWS::DynamoDB::Table
Properties:
SSESpecification:
SSEEnabled: true
```
* **Szyfruj Dane w Tranzycie:** U偶yj HTTPS/TLS dla wszystkich transmisji danych.
* **Zabezpiecz Komunikacj API:** Wymu protokoy szyfrowania i waliduj certyfikaty.
* **Zarzdzaj Kluczami Szyfrujcymi Bezpiecznie:** U偶yj zarzdzanych usug kluczy i regularnie rotuj klucze.

***

### **Brak Odpowiedniego Obsugi Bd贸w**

Szczeg贸owe komunikaty o bdach mog ujawnia wra偶liwe informacje o infrastrukturze lub kodzie, podczas gdy nieobsugiwane wyjtki mog prowadzi do awarii aplikacji.

#### **Strategie agodzenia**

*   **Og贸lne Komunikaty o Bdach:** Unikaj ujawniania wewntrznych szczeg贸贸w w odpowiedziach bd贸w.

```javascript
javascriptCopy code// Przykad w Node.js
exports.hello = async (event) => {
try {
// Logika funkcji
} catch (error) {
console.error(error);
return {
statusCode: 500,
body: JSON.stringify({ message: 'Internal Server Error' }),
};
}
};
```
* **Centralna Obsuga Bd贸w:** Zarzdzaj i sanitizuj bdy konsekwentnie we wszystkich funkcjach.
* **Monitoruj i Loguj Bdy:** led藕 i analizuj bdy wewntrznie, nie ujawniajc szczeg贸贸w u偶ytkownikom kocowym.

***

### **Niezabezpieczone Praktyki Wdra偶ania**

Ujawnie konfiguracje wdro偶eniowe lub nieautoryzowany dostp do pipeline'贸w CI/CD mog prowadzi do wdro偶e zoliwego kodu lub bdnych konfiguracji.

#### **Strategie agodzenia**

* **Zabezpiecz Pipeline'y CI/CD:** Wprowad藕 cise kontrole dostpu, uwierzytelnianie wieloskadnikowe (MFA) i regularne audyty.
* **Przechowuj Konfiguracj Bezpiecznie:** Utrzymuj pliki wdro偶eniowe wolne od twardo zakodowanych tajemnic i wra偶liwych danych.
* **U偶yj Narzdzi Bezpieczestwa Infrastruktury jako Kodu (IaC):** Wykorzystaj narzdzia takie jak **Checkov** lub **Terraform Sentinel** do egzekwowania polityk bezpieczestwa.
* **Niezmienno Wdro偶e:** Zapobiegaj nieautoryzowanym zmianom po wdro偶eniu, przyjmujc praktyki niezmiennej infrastruktury.

***

### **Luki w Wtyczkach i Rozszerzeniach**

U偶ywanie nieweryfikowanych lub zoliwych wtyczek stron trzecich mo偶e wprowadza luki do aplikacji serverless.

#### **Strategie agodzenia**

* **Dokadnie Weryfikuj Wtyczki:** Oce bezpieczestwo wtyczek przed integracj, preferujc te z wiarygodnych 藕r贸de.
* **Ogranicz U偶ycie Wtyczek:** U偶ywaj tylko niezbdnych wtyczek, aby zminimalizowa powierzchni ataku.
* **Monitoruj Aktualizacje Wtyczek:** Utrzymuj wtyczki zaktualizowane, aby korzysta z poprawek bezpieczestwa.
* **Izoluj rodowiska Wtyczek:** Uruchamiaj wtyczki w izolowanych rodowiskach, aby ograniczy potencjalne kompromitacje.

***

### **Ujawnienie Wra偶liwych Punkt贸w Kocowych**

Funkcje dostpne publicznie lub nieograniczone API mog by wykorzystywane do nieautoryzowanych operacji.

#### **Strategie agodzenia**

* **Ogranicz Dostp do Funkcji:** U偶yj VPC, grup zabezpiecze i regu zapory, aby ograniczy dostp do zaufanych 藕r贸de.
* **Wprowad藕 Solidne Uwierzytelnianie:** Upewnij si, 偶e wszystkie ujawnione punkty kocowe wymagaj odpowiedniego uwierzytelnienia i autoryzacji.
* **Bezpiecznie U偶ywaj Bramek API:** Skonfiguruj bramki API, aby egzekwowa polityki bezpieczestwa, w tym walidacj danych wejciowych i ograniczenie ruchu.
* **Wycz Nieu偶ywane Punkty Kocowe:** Regularnie przegldaj i wyczaj wszelkie punkty kocowe, kt贸re nie s ju偶 u偶ywane.

***

### **Nadmierne Uprawnienia dla Czonk贸w Zespou i Zewntrznych Wsp贸pracownik贸w**

Przyznawanie nadmiernych uprawnie czonkom zespou i zewntrznym wsp贸pracownikom mo偶e prowadzi do nieautoryzowanego dostpu, narusze danych i nadu偶y zasob贸w. Ryzyko to wzrasta w rodowiskach, w kt贸rych wiele os贸b ma r贸偶ne poziomy dostpu, zwikszajc powierzchni ataku i potencja zagro偶e wewntrznych.

#### **Strategie agodzenia**

* **Zasada Najmniejszych Uprawnie:** Upewnij si, 偶e czonkowie zespou i wsp贸pracownicy maj tylko te uprawnienia, kt贸re s niezbdne do wykonywania swoich zada.

***

### **Bezpieczestwo Kluczy Dostpu i Kluczy Licencyjnych**

**Klucze Dostpu** i **Klucze Licencyjne** to krytyczne powiadczenia u偶ywane do uwierzytelniania i autoryzacji interakcji z interfejsem CLI Frameworka Serverless.

* **Klucze Licencyjne:** To unikalne identyfikatory wymagane do uwierzytelnienia dostpu do Frameworka Serverless Wersja 4, kt贸ry umo偶liwia logowanie przez CLI.
* **Klucze Dostpu:** Powiadczenia, kt贸re pozwalaj interfejsowi CLI Frameworka Serverless uwierzytelni si z Dashboardem Frameworka Serverless. Podczas logowania za pomoc `serverless` cli klucz dostpu zostanie **wygenerowany i zapisany na laptopie**. Mo偶esz r贸wnie偶 ustawi go jako zmienn rodowiskow o nazwie `SERVERLESS_ACCESS_KEY`.

#### **Ryzyka Bezpieczestwa**

1. **Ujawnienie przez Repozytoria Kodu:**
* Twarde kodowanie lub przypadkowe zatwierdzanie Kluczy Dostpu i Kluczy Licencyjnych do system贸w kontroli wersji mo偶e prowadzi do nieautoryzowanego dostpu.
2. **Niezabezpieczone Przechowywanie:**
* Przechowywanie kluczy w postaci tekstu jawnego w zmiennych rodowiskowych lub plikach konfiguracyjnych bez odpowiedniego szyfrowania zwiksza prawdopodobiestwo wycieku.
3. **Niewaciwa Dystrybucja:**
* Udostpnianie kluczy przez niezabezpieczone kanay (np. e-mail, czat) mo偶e skutkowa przechwyceniem przez zoliwe podmioty.
4. **Brak Rotacji:**
* Nieregularna rotacja kluczy wydu偶a okres nara偶enia, jeli klucze zostan skompromitowane.
5. **Nadmierne Uprawnienia:**
* Klucze z szerokimi uprawnieniami mog by wykorzystywane do wykonywania nieautoryzowanych dziaa w wielu zasobach.

{% hint style="success" %}
Ucz si i wicz Hacking AWS:<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Ucz si i wicz Hacking GCP: <img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Wsparcie dla HackTricks</summary>

* Sprawd藕 [**plany subskrypcyjne**](https://github.com/sponsors/carlospolop)!
* **Docz do**  [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **led藕** nas na **Twitterze**  [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Dziel si sztuczkami hackingowymi, przesyajc PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repozytori贸w github.

</details>
{% endhint %}
