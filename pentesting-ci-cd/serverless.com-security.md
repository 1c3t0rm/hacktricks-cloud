# Serverless.com GÃ¼venliÄŸi

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks EÄŸitim AWS KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks EÄŸitim GCP KÄ±rmÄ±zÄ± TakÄ±m UzmanÄ± (GRTE)**<img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.

</details>
{% endhint %}

## Temel Bilgiler

### Organizasyon

Bir **Organizasyon**, Serverless Framework ekosistemindeki en yÃ¼ksek dÃ¼zeydeki varlÄ±ktÄ±r. Birden fazla projeyi, takÄ±mÄ± ve uygulamayÄ± kapsayan bir **kolektif grup** olarak bir ÅŸirketi, departmanÄ± veya herhangi bir bÃ¼yÃ¼k varlÄ±ÄŸÄ± temsil eder.

### TakÄ±m

**TakÄ±m**, organizasyon iÃ§inde eriÅŸimi olan kullanÄ±cÄ±lardÄ±r. TakÄ±mlar, Ã¼yeleri rollere gÃ¶re organize etmeye yardÄ±mcÄ± olur. **`Ä°ÅŸbirlikÃ§ileri`**, mevcut uygulamalarÄ± gÃ¶rÃ¼ntÃ¼leyebilir ve daÄŸÄ±tabilirken, **`YÃ¶neticiler`** yeni uygulamalar oluÅŸturabilir ve organizasyon ayarlarÄ±nÄ± yÃ¶netebilir.

### Uygulama

Bir **Uygulama**, bir Organizasyon iÃ§indeki ilgili hizmetlerin mantÄ±ksal bir gruplamasÄ±dÄ±r. Birlikte Ã§alÄ±ÅŸarak uyumlu bir iÅŸlevsellik saÄŸlamak iÃ§in bir araya gelen birden fazla sunucusuz hizmetten oluÅŸan tam bir uygulamayÄ± temsil eder.

### **Hizmetler**

Bir **Hizmet**, bir Sunucusuz uygulamanÄ±n temel bileÅŸenidir. TÃ¼m sunucusuz projenizi temsil eder ve gereken tÃ¼m iÅŸlevleri, yapÄ±landÄ±rmalarÄ± ve kaynaklarÄ± kapsar. Genellikle bir `serverless.yml` dosyasÄ±nda tanÄ±mlanÄ±r; bir hizmet, hizmet adÄ±, saÄŸlayÄ±cÄ± yapÄ±landÄ±rmalarÄ±, iÅŸlevler, olaylar, kaynaklar, eklentiler ve Ã¶zel deÄŸiÅŸkenler gibi meta verileri iÃ§erir.
```yaml
service: my-service
provider:
name: aws
runtime: nodejs14.x
functions:
hello:
handler: handler.hello
```
<details>

<summary>Fonksiyon</summary>

Bir **Fonksiyon**, bir AWS Lambda fonksiyonu gibi tek bir sunucusuz fonksiyonu temsil eder. Olaylara yanÄ±t olarak yÃ¼rÃ¼tÃ¼len kodu iÃ§erir.

`serverless.yml` dosyasÄ±ndaki `functions` bÃ¶lÃ¼mÃ¼nde tanÄ±mlanÄ±r ve iÅŸleyici, Ã§alÄ±ÅŸma zamanÄ±, olaylar, ortam deÄŸiÅŸkenleri ve diÄŸer ayarlarÄ± belirtir.
```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
```
</details>

<details>

<summary>Olay</summary>

**Olaylar**, sunucusuz iÅŸlevlerinizi tetikleyen tetikleyicilerdir. Bir iÅŸlevin nasÄ±l ve ne zaman Ã§alÄ±ÅŸtÄ±rÄ±lacaÄŸÄ±nÄ± tanÄ±mlar.

YaygÄ±n olay tÃ¼rleri arasÄ±nda HTTP istekleri, planlÄ± olaylar (cron iÅŸleri), veritabanÄ± olaylarÄ±, dosya yÃ¼klemeleri ve daha fazlasÄ± bulunur.
```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
- schedule:
rate: rate(10 minutes)
```
</details>

<details>

<summary>Kaynak</summary>

**Kaynaklar**, hizmetinizin baÄŸÄ±mlÄ± olduÄŸu ek bulut kaynaklarÄ±nÄ± tanÄ±mlamanÄ±za olanak tanÄ±r; Ã¶rneÄŸin veritabanlarÄ±, depolama alanlarÄ± veya IAM rolleri.

`resources` bÃ¶lÃ¼mÃ¼nde belirtilir, genellikle AWS iÃ§in CloudFormation sÃ¶zdizimi kullanÄ±larak.
```yaml
resources:
Resources:
MyDynamoDBTable:
Type: AWS::DynamoDB::Table
Properties:
TableName: my-table
AttributeDefinitions:
- AttributeName: id
AttributeType: S
KeySchema:
- AttributeName: id
KeyType: HASH
ProvisionedThroughput:
ReadCapacityUnits: 1
WriteCapacityUnits: 1
```
</details>

<details>

<summary>SaÄŸlayÄ±cÄ±</summary>

**SaÄŸlayÄ±cÄ±** nesnesi, bulut hizmet saÄŸlayÄ±cÄ±sÄ±nÄ± (Ã¶rneÄŸin, AWS, Azure, Google Cloud) belirtir ve o saÄŸlayÄ±cÄ±ya iliÅŸkin yapÄ±landÄ±rma ayarlarÄ±nÄ± iÃ§erir.

Ã‡alÄ±ÅŸma zamanÄ±, bÃ¶lge, aÅŸama ve kimlik bilgileri gibi ayrÄ±ntÄ±larÄ± iÃ§erir.
```yaml
yamlCopy codeprovider:
name: aws
runtime: nodejs14.x
region: us-east-1
stage: dev
```
</details>

<details>

<summary>AÅŸama ve BÃ¶lge</summary>

AÅŸama, hizmetinizin daÄŸÄ±tÄ±labileceÄŸi farklÄ± ortamlarÄ± (Ã¶rneÄŸin, geliÅŸtirme, test, Ã¼retim) temsil eder. Ortama Ã¶zgÃ¼ yapÄ±landÄ±rmalar ve daÄŸÄ±tÄ±mlar iÃ§in olanak tanÄ±r.
```yaml
provider:
stage: dev
```
BÃ¶lge, kaynaklarÄ±nÄ±zÄ±n daÄŸÄ±tÄ±lacaÄŸÄ± coÄŸrafi bÃ¶lgeyi belirtir. Gecikme, uyumluluk ve kullanÄ±labilirlik aÃ§Ä±sÄ±ndan Ã¶nemlidir.
```yaml
provider:
region: us-west-2
```
</details>

<details>

<summary>Eklentiler</summary>

**Eklentiler**, Serverless Framework'Ã¼n iÅŸlevselliÄŸini yeni Ã¶zellikler ekleyerek veya diÄŸer araÃ§lar ve hizmetlerle entegre olarak geniÅŸletir. `plugins` bÃ¶lÃ¼mÃ¼nde tanÄ±mlanÄ±r ve npm aracÄ±lÄ±ÄŸÄ±yla yÃ¼klenir.
```yaml
plugins:
- serverless-offline
- serverless-webpack
```
</details>

<details>

<summary>Katmanlar</summary>

**Katmanlar**, paylaÅŸÄ±lan kodu veya baÄŸÄ±mlÄ±lÄ±klarÄ± iÅŸlevlerinizden ayrÄ± olarak paketlemenize ve yÃ¶netmenize olanak tanÄ±r. Bu, yeniden kullanÄ±labilirliÄŸi teÅŸvik eder ve daÄŸÄ±tÄ±m paketlerinin boyutunu azaltÄ±r. `layers` bÃ¶lÃ¼mÃ¼nde tanÄ±mlanÄ±r ve iÅŸlevler tarafÄ±ndan referans gÃ¶sterilir.
```yaml
layers:
commonLibs:
path: layer-common
functions:
hello:
handler: handler.hello
layers:
- { Ref: CommonLibsLambdaLayer }
```
</details>

<details>

<summary>DeÄŸiÅŸkenler ve Ã–zel DeÄŸiÅŸkenler</summary>

**DeÄŸiÅŸkenler**, yerleÅŸtirme zamanÄ±nda Ã§Ã¶zÃ¼mlenen yer tutucularÄ±n kullanÄ±lmasÄ±na izin vererek dinamik yapÄ±landÄ±rmayÄ± saÄŸlar.

*   **SÃ¶zdizimi:** `${variable}` sÃ¶zdizimi, ortam deÄŸiÅŸkenlerini, dosya iÃ§eriklerini veya diÄŸer yapÄ±landÄ±rma parametrelerini referans alabilir.

```yaml
functions:
hello:
handler: handler.hello
environment:
TABLE_NAME: ${self:custom.tableName}
```

-   **Ã–zel DeÄŸiÅŸkenler:** `custom` bÃ¶lÃ¼mÃ¼, `serverless.yml` dosyasÄ± boyunca yeniden kullanÄ±labilecek kullanÄ±cÄ±ya Ã¶zel deÄŸiÅŸkenler ve yapÄ±landÄ±rmalar tanÄ±mlamak iÃ§in kullanÄ±lÄ±r.

```yaml
custom:
tableName: my-dynamodb-table
stage: ${opt:stage, 'dev'}
```

</details>

<details>

<summary>Ã‡Ä±ktÄ±lar</summary>

**Ã‡Ä±ktÄ±lar**, bir hizmet daÄŸÄ±tÄ±ldÄ±ktan sonra dÃ¶ndÃ¼rÃ¼len deÄŸerleri tanÄ±mlar; bu deÄŸerler kaynak ARN'leri, uÃ§ noktalar veya diÄŸer yararlÄ± bilgiler olabilir. `outputs` bÃ¶lÃ¼mÃ¼nde belirtilir ve genellikle diÄŸer hizmetlere bilgi saÄŸlamak veya daÄŸÄ±tÄ±m sonrasÄ± kolay eriÅŸim iÃ§in kullanÄ±lÄ±r.
```yaml
Â¡outputs:
ApiEndpoint:
Description: "API Gateway endpoint URL"
Value:
Fn::Join:
- ""
- - "https://"
- Ref: ApiGatewayRestApi
- ".execute-api."
- Ref: AWS::Region
- ".amazonaws.com/"
- Ref: AWS::Stage
```
</details>

<details>

<summary>IAM Rolleri ve Ä°zinler</summary>

**IAM Rolleri ve Ä°zinler**, fonksiyonlarÄ±nÄ±z ve diÄŸer kaynaklarÄ±nÄ±z iÃ§in gÃ¼venlik kimlik bilgilerini ve eriÅŸim haklarÄ±nÄ± tanÄ±mlar. Gerekli izinleri belirtmek iÃ§in `provider` veya bireysel fonksiyon ayarlarÄ± altÄ±nda yÃ¶netilir.
```yaml
provider:
[...]
iam:
role:
statements:
- Effect: 'Allow'
Action:
- 'dynamodb:PutItem'
- 'dynamodb:Get*'
- 'dynamodb:Scan*'
- 'dynamodb:UpdateItem'
- 'dynamodb:DeleteItem'
Resource: arn:aws:dynamodb:${aws:region}:${aws:accountId}:table/${self:service}-customerTable-${sls:stage}
```
</details>

<details>

<summary>Ortam DeÄŸiÅŸkenleri</summary>

**DeÄŸiÅŸkenler**, yapÄ±landÄ±rma ayarlarÄ±nÄ± ve gizli bilgileri iÅŸlevlerinize sabit kodlama yapmadan geÃ§irmenizi saÄŸlar. Bunlar, saÄŸlayÄ±cÄ± veya bireysel iÅŸlevler iÃ§in `environment` bÃ¶lÃ¼mÃ¼nde tanÄ±mlanÄ±r.
```yaml
provider:
environment:
STAGE: ${self:provider.stage}
functions:
hello:
handler: handler.hello
environment:
TABLE_NAME: ${self:custom.tableName}
```
</details>

<details>

<summary>BaÄŸÄ±mlÄ±lÄ±klar</summary>

**BaÄŸÄ±mlÄ±lÄ±klar**, fonksiyonlarÄ±nÄ±zÄ±n ihtiyaÃ§ duyduÄŸu dÄ±ÅŸ kÃ¼tÃ¼phaneleri ve modÃ¼lleri yÃ¶netir. Genellikle npm veya pip gibi paket yÃ¶neticileri aracÄ±lÄ±ÄŸÄ±yla yÃ¶netilir ve `serverless-webpack` gibi araÃ§lar veya eklentiler kullanÄ±larak daÄŸÄ±tÄ±m paketiyle birleÅŸtirilir.
```yaml
plugins:
- serverless-webpack
```
</details>

<details>

<summary>Hooks</summary>

**Hooks**, daÄŸÄ±tÄ±m yaÅŸam dÃ¶ngÃ¼sÃ¼ndeki belirli noktalarda Ã¶zel betikler veya komutlar Ã§alÄ±ÅŸtÄ±rmanÄ±za olanak tanÄ±r. DaÄŸÄ±tÄ±mlardan Ã¶nce veya sonra eylemler gerÃ§ekleÅŸtirmek iÃ§in `serverless.yml` iÃ§inde veya eklentiler kullanÄ±larak tanÄ±mlanÄ±rlar.
```yaml
custom:
hooks:
before:deploy:deploy: echo "Starting deployment..."
```
</details>

### Tutorial

Bu, resmi Ã¶ÄŸreticinin bir Ã¶zetidir [**belgelerden**](https://www.serverless.com/framework/docs/tutorial):

1. Bir AWS hesabÄ± oluÅŸturun (Serverless.com AWS altyapÄ±sÄ±nda baÅŸlar)
2. serverless.com'da bir hesap oluÅŸturun
3. Bir uygulama oluÅŸturun:
```bash
# Create temp folder for the tutorial
mkdir /tmp/serverless-tutorial
cd /tmp/serverless-tutorial

# Install Serverless cli
npm install -g serverless

# Generate template
serverless #Choose first one (AWS / Node.js / HTTP API)
## Indicate a name like "Tutorial"
## Login/Register
## Create A New App
## Indicate a name like "tutorialapp)
```
Bu, [serverless.com](serverless.com-security.md) adresinde kontrol edebileceÄŸiniz `tutorialapp` adÄ±nda bir **app** oluÅŸturmuÅŸ olmalÄ± ve iÃ§inde `helloworld` kodu bulunan bazÄ± JS kodlarÄ± iÃ§eren **`handler.js`** dosyasÄ±nÄ± ve bu fonksiyonu beyan eden **`serverless.yml`** dosyasÄ±nÄ± iÃ§eren `Tutorial` adÄ±nda bir klasÃ¶r oluÅŸturmuÅŸ olmalÄ±:

{% tabs %}
{% tab title="handler.js" %}
```javascript
exports.hello = async (event) => {
return {
statusCode: 200,
body: JSON.stringify({
message: "Go Serverless v4! Your function executed successfully!",
}),
};
};
```
{% endtab %}

{% tab title="serverless.yml" %}
```yaml
# "org" ensures this Service is used with the correct Serverless Framework Access Key.
org: testing12342
# "app" enables Serverless Framework Dashboard features and sharing them with other Services.
app: tutorialapp
# "service" is the name of this project. This will also be added to your AWS resource names.
service: Tutorial

provider:
name: aws
runtime: nodejs20.x

functions:
hello:
handler: handler.hello
events:
- httpApi:
path: /
method: get
```
{% endtab %}
{% endtabs %}

4. Bir AWS saÄŸlayÄ±cÄ±sÄ± oluÅŸturun, `https://app.serverless.com/<org name>/settings/providers?providerId=new&provider=aws` adresindeki **dashboard**'a giderek.
1. `serverless.com`'a AWS eriÅŸimi vermek iÃ§in, bu yapÄ±landÄ±rma dosyasÄ±nÄ± kullanarak bir cloudformation yÄ±ÄŸÄ±nÄ± Ã§alÄ±ÅŸtÄ±rmanÄ±zÄ± isteyecektir (bu yazÄ±nÄ±n yazÄ±ldÄ±ÄŸÄ± sÄ±rada): [https://serverless-framework-template.s3.amazonaws.com/roleTemplate.yml](https://serverless-framework-template.s3.amazonaws.com/roleTemplate.yml)
2. Bu ÅŸablon, **`Serverless.com`** AWS hesabÄ±nÄ±n role eriÅŸmesine izin veren bir GÃ¼ven Ä°liÅŸkisi ile birlikte **`arn:aws:iam::aws:policy/AdministratorAccess`** Ã¼zerinde **`SFRole-<ID>`** adÄ±nda bir rol oluÅŸturur.

<details>

<summary>Yaml roleTemplate</summary>
```yaml
Description: This stack creates an IAM role that can be used by Serverless Framework for use in deployments.
Resources:
SFRole:
Type: AWS::IAM::Role
Properties:
AssumeRolePolicyDocument:
Version: '2012-10-17'
Statement:
- Effect: Allow
Principal:
AWS: arn:aws:iam::486128539022:root
Action:
- sts:AssumeRole
Condition:
StringEquals:
sts:ExternalId: !Sub 'ServerlessFramework-${OrgUid}'
Path: /
RoleName: !Ref RoleName
ManagedPolicyArns:
- arn:aws:iam::aws:policy/AdministratorAccess
ReporterFunction:
Type: Custom::ServerlessFrameworkReporter
Properties:
ServiceToken: 'arn:aws:lambda:us-east-1:486128539022:function:sp-providers-stack-reporter-custom-resource-prod-tmen2ec'
OrgUid: !Ref OrgUid
RoleArn: !GetAtt SFRole.Arn
Alias: !Ref Alias
Outputs:
SFRoleArn:
Description: 'ARN for the IAM Role used by Serverless Framework'
Value: !GetAtt SFRole.Arn
Parameters:
OrgUid:
Description: Serverless Framework Org Uid
Type: String
Alias:
Description: Serverless Framework Provider Alias
Type: String
RoleName:
Description: Serverless Framework Role Name
Type: String
```
</details>

<details>

<summary>GÃ¼ven Ä°liÅŸkisi</summary>
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::486128539022:root"
},
"Action": "sts:AssumeRole",
"Condition": {
"StringEquals": {
"sts:ExternalId": "ServerlessFramework-7bf7ddef-e1bf-43eb-a111-4d43e0894ccb"
}
}
}
]
}
```
</details>

5. EÄŸitim, temel olarak yeni bir API uÃ§ noktasÄ± oluÅŸturacak olan `createCustomer.js` dosyasÄ±nÄ± oluÅŸturmanÄ±zÄ± istiyor ve oluÅŸturulan lambdalarÄ± kullanacak rolÃ¼ tanÄ±mlamak iÃ§in **yeni bir DynamoDB tablosu** oluÅŸturacak ÅŸekilde `serverless.yml` dosyasÄ±nÄ± deÄŸiÅŸtirmenizi istiyor.

{% tabs %}
{% tab title="createCustomer.js" %}
```javascript
'use strict'
const AWS = require('aws-sdk')
module.exports.createCustomer = async (event) => {
const body = JSON.parse(Buffer.from(event.body, 'base64').toString())
const dynamoDb = new AWS.DynamoDB.DocumentClient()
const putParams = {
TableName: process.env.DYNAMODB_CUSTOMER_TABLE,
Item: {
primary_key: body.name,
email: body.email,
},
}
await dynamoDb.put(putParams).promise()
return {
statusCode: 201,
}
}
```
{% endtab %}

{% tab title="serverless.yml" %}
```yaml
# "org" ensures this Service is used with the correct Serverless Framework Access Key.
org: testing12342
# "app" enables Serverless Framework Dashboard features and sharing them with other Services.
app: tutorialapp
# "service" is the name of this project. This will also be added to your AWS resource names.
service: Tutorial

provider:
name: aws
runtime: nodejs20.x
environment:
DYNAMODB_CUSTOMER_TABLE: ${self:service}-customerTable-${sls:stage}
iam:
role:
statements:
- Effect: 'Allow'
Action:
- 'dynamodb:PutItem'
- 'dynamodb:Get*'
- 'dynamodb:Scan*'
- 'dynamodb:UpdateItem'
- 'dynamodb:DeleteItem'
Resource: arn:aws:dynamodb:${aws:region}:${aws:accountId}:table/${self:service}-customerTable-${sls:stage}

functions:
hello:
handler: handler.hello
events:
- httpApi:
path: /
method: get
createCustomer:
handler: createCustomer.createCustomer
events:
- httpApi:
path: /
method: post

resources:
Resources:
CustomerTable:
Type: AWS::DynamoDB::Table
Properties:
AttributeDefinitions:
- AttributeName: primary_key
AttributeType: S
BillingMode: PAY_PER_REQUEST
KeySchema:
- AttributeName: primary_key
KeyType: HASH
TableName: ${self:service}-customerTable-${sls:stage}
```
{% endtab %}
{% endtabs %}

6. **`serverless deploy`** komutunu Ã§alÄ±ÅŸtÄ±rarak daÄŸÄ±tÄ±mÄ± yapÄ±n
1. DaÄŸÄ±tÄ±m, bir CloudFormation YÄ±ÄŸÄ±nÄ± aracÄ±lÄ±ÄŸÄ±yla gerÃ§ekleÅŸtirilecektir
2. **lambdalarÄ±n API gateway aracÄ±lÄ±ÄŸÄ±yla** ve doÄŸrudan URL'ler aracÄ±lÄ±ÄŸÄ±yla deÄŸil, aÃ§Ä±k olduÄŸunu unutmayÄ±n
7. **Test edin**
1. Ã–nceki adÄ±m, API uÃ§ noktalarÄ±nÄ±zÄ±n lambda fonksiyonlarÄ±nÄ±n daÄŸÄ±tÄ±ldÄ±ÄŸÄ± **URL'leri** yazdÄ±racaktÄ±r

## Serverless.com GÃ¼venlik Ä°ncelemesi

### **YanlÄ±ÅŸ YapÄ±landÄ±rÄ±lmÄ±ÅŸ IAM Rolleri ve Ä°zinleri**

AÅŸÄ±rÄ± izinli IAM rolleri, bulut kaynaklarÄ±na yetkisiz eriÅŸim saÄŸlayabilir ve bu da veri ihlallerine veya kaynak manipÃ¼lasyonuna yol aÃ§abilir.

Bir Lambda fonksiyonu iÃ§in izinler belirtilmediÄŸinde, yalnÄ±zca gÃ¼nlÃ¼k oluÅŸturma izinlerine sahip bir rol oluÅŸturulacaktÄ±r, Ã¶rneÄŸin:

<details>

<summary>Minimum lambda izinleri</summary>
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Action": [
"logs:CreateLogStream",
"logs:CreateLogGroup",
"logs:TagResource"
],
"Resource": [
"arn:aws:logs:us-east-1:123456789012:log-group:/aws/lambda/jito-cranker-scripts-dev*:*"
],
"Effect": "Allow"
},
{
"Action": [
"logs:PutLogEvents"
],
"Resource": [
"arn:aws:logs:us-east-1:123456789012:log-group:/aws/lambda/jito-cranker-scripts-dev*:*:*"
],
"Effect": "Allow"
}
]
}
```
</details>

#### **Azaltma Stratejileri**

*   **En Az AyrÄ±calÄ±k Ä°lkesi:** Her iÅŸlev iÃ§in yalnÄ±zca gerekli izinleri atayÄ±n.

```yaml
provider:
[...]
iam:
role:
statements:
- Effect: 'Allow'
Action:
- 'dynamodb:PutItem'
- 'dynamodb:Get*'
- 'dynamodb:Scan*'
- 'dynamodb:UpdateItem'
- 'dynamodb:DeleteItem'
Resource: arn:aws:dynamodb:${aws:region}:${aws:accountId}:table/${self:service}-customerTable-${sls:stage}
```
* **AyrÄ± Roller KullanÄ±n:** Roller, iÅŸlev gereksinimlerine gÃ¶re farklÄ±laÅŸtÄ±rÄ±lmalÄ±dÄ±r.

***

### **GÃ¼vensiz Gizli Bilgiler ve KonfigÃ¼rasyon YÃ¶netimi**

Hassas bilgilerin (Ã¶rneÄŸin, API anahtarlarÄ±, veritabanÄ± kimlik bilgileri) doÄŸrudan **`serverless.yml`** veya kodda saklanmasÄ±, depolarÄ±n ele geÃ§irilmesi durumunda ifÅŸaya yol aÃ§abilir.

**Ã–nerilen** yÃ¶ntem, **`serverless.yml`** dosyasÄ±nda ortam deÄŸiÅŸkenlerini saklamak iÃ§in serverless.com'dan (bu yazÄ±nÄ±n yazÄ±ldÄ±ÄŸÄ± sÄ±rada) `ssm` veya `s3` saÄŸlayÄ±cÄ±larÄ±nÄ± kullanmaktÄ±r; bu, **daÄŸÄ±tÄ±m zamanÄ±** bu kaynaklardan **ortam deÄŸerlerini almayÄ±** ve **lambdalarÄ±n** ortam deÄŸiÅŸkenlerini **deÄŸerlerin metin olarak temiz bir ÅŸekilde** yapÄ±landÄ±rmayÄ± saÄŸlar!

{% hint style="danger" %}
Bu nedenle, AWS iÃ§indeki lambdalarÄ±n konfigÃ¼rasyonunu okuma iznine sahip olan herkes, **tÃ¼m bu ortam deÄŸiÅŸkenlerine temiz metin olarak eriÅŸebilecektir!**
{% endhint %}

Ã–rneÄŸin, aÅŸaÄŸÄ±daki Ã¶rnek bir ortam deÄŸiÅŸkeni almak iÃ§in SSM kullanacaktÄ±r:
```yaml
provider:
environment:
DB_PASSWORD: ${ssm:/aws/reference/secretsmanager/my-db-password~true}
```
Ve bu, **`serverless.yml`** dosyasÄ±nda ortam deÄŸiÅŸkeni deÄŸerinin sabitlenmesini Ã¶nlese bile, deÄŸer daÄŸÄ±tÄ±m zamanÄ±nda elde edilecek ve **lambda ortam deÄŸiÅŸkeni iÃ§inde dÃ¼z metin olarak eklenecektir**.

{% hint style="success" %}
serveless.com kullanarak ortam deÄŸiÅŸkenlerini saklamanÄ±n Ã¶nerilen yolu, **bunu bir AWS sÄ±rrÄ±nda saklamak** ve sadece sÄ±rrÄ±n adÄ±nÄ± ortam deÄŸiÅŸkeninde tutmak ve **lambda kodunun bunu toplamasÄ±dÄ±r**.
{% endhint %}

#### **Azaltma Stratejileri**

* **SÄ±r YÃ¶netimi Entegrasyonu:** **AWS Secrets Manager** gibi hizmetleri kullanÄ±n.
* **Åifreli DeÄŸiÅŸkenler:** Hassas veriler iÃ§in Serverless Frameworkâ€™Ã¼n ÅŸifreleme Ã¶zelliklerinden yararlanÄ±n.
* **EriÅŸim Kontrolleri:** Rollere dayalÄ± olarak sÄ±rlarÄ±n eriÅŸimini kÄ±sÄ±tlayÄ±n.

***

### **ZayÄ±f Kod ve BaÄŸÄ±mlÄ±lÄ±klar**

Eski veya gÃ¼vensiz baÄŸÄ±mlÄ±lÄ±klar zayÄ±flÄ±klara yol aÃ§abilirken, yanlÄ±ÅŸ giriÅŸ iÅŸleme kod enjeksiyonu saldÄ±rÄ±larÄ±na neden olabilir.

#### **Azaltma Stratejileri**

*   **BaÄŸÄ±mlÄ±lÄ±k YÃ¶netimi:** BaÄŸÄ±mlÄ±lÄ±klarÄ± dÃ¼zenli olarak gÃ¼ncelleyin ve zayÄ±flÄ±klarÄ± tarayÄ±n.

```yaml
plugins:
- serverless-webpack
- serverless-plugin-snyk
```
* **GiriÅŸ DoÄŸrulama:** TÃ¼m giriÅŸlerin katÄ± bir ÅŸekilde doÄŸrulanmasÄ±nÄ± ve temizlenmesini uygulayÄ±n.
* **Kod Ä°ncelemeleri:** GÃ¼venlik aÃ§Ä±klarÄ±nÄ± belirlemek iÃ§in kapsamlÄ± incelemeler yapÄ±n.
* **Statik Analiz:** Kod tabanÄ±ndaki zayÄ±flÄ±klarÄ± tespit etmek iÃ§in araÃ§lar kullanÄ±n.

***

### **Yetersiz GÃ¼nlÃ¼kleme ve Ä°zleme**

Uygun gÃ¼nlÃ¼kleme ve izleme olmadan, kÃ¶tÃ¼ niyetli faaliyetler tespit edilemeyebilir ve olay yanÄ±tÄ±nÄ± geciktirebilir.

#### **Azaltma Stratejileri**

*   **Merkezi GÃ¼nlÃ¼kleme:** **AWS CloudWatch** veya **Datadog** gibi hizmetleri kullanarak gÃ¼nlÃ¼kleri birleÅŸtirin.

```yaml
plugins:
- serverless-plugin-datadog
```
* **AyrÄ±ntÄ±lÄ± GÃ¼nlÃ¼klemeyi EtkinleÅŸtirin:** Hassas verileri aÃ§Ä±ÄŸa Ã§Ä±karmadan temel bilgileri yakalayÄ±n.
* **UyarÄ±lar Kurun:** ÅÃ¼pheli faaliyetler veya anormallikler iÃ§in uyarÄ±lar yapÄ±landÄ±rÄ±n.
* **DÃ¼zenli Ä°zleme:** Potansiyel gÃ¼venlik olaylarÄ± iÃ§in gÃ¼nlÃ¼kleri ve metrikleri sÃ¼rekli izleyin.

***

### **GÃ¼vensiz API Gateway YapÄ±landÄ±rmalarÄ±**

AÃ§Ä±k veya yanlÄ±ÅŸ gÃ¼vence altÄ±na alÄ±nmÄ±ÅŸ API'ler, yetkisiz eriÅŸim, Hizmet Reddi (DoS) saldÄ±rÄ±larÄ± veya Ã§apraz site saldÄ±rÄ±larÄ± iÃ§in istismar edilebilir.

#### **Azaltma Stratejileri**

*   **Kimlik DoÄŸrulama ve Yetkilendirme:** OAuth, API anahtarlarÄ± veya JWT gibi saÄŸlam mekanizmalarÄ± uygulayÄ±n.

```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
authorizer: aws_iam
```
*   **HÄ±z SÄ±nÄ±rlama ve KÄ±sÄ±tlama:** Ä°stismarlarÄ± Ã¶nlemek iÃ§in istek oranlarÄ±nÄ± sÄ±nÄ±rlayÄ±n.

```yaml
provider:
apiGateway:
throttle:
burstLimit: 200
rateLimit: 100
```
*   **GÃ¼venli CORS YapÄ±landÄ±rmasÄ±:** Ä°zin verilen kÃ¶kenleri, yÃ¶ntemleri ve baÅŸlÄ±klarÄ± kÄ±sÄ±tlayÄ±n.

```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
cors:
origin: https://yourdomain.com
headers:
- Content-Type
```
* **Web Uygulama GÃ¼venlik DuvarlarÄ± (WAF) KullanÄ±n:** KÃ¶tÃ¼ niyetli kalÄ±plar iÃ§in HTTP isteklerini filtreleyin ve izleyin.

***

### **Yetersiz Fonksiyon Ä°zolasyonu**

PaylaÅŸÄ±lan kaynaklar ve yetersiz izolasyon, ayrÄ±calÄ±k yÃ¼kselmelerine veya fonksiyonlar arasÄ±nda istenmeyen etkileÅŸimlere yol aÃ§abilir.

#### **Azaltma Stratejileri**

* **FonksiyonlarÄ± Ä°zole Edin:** BaÄŸÄ±msÄ±z Ã§alÄ±ÅŸmayÄ± saÄŸlamak iÃ§in farklÄ± kaynaklar ve IAM rolleri atayÄ±n.
* **Kaynak BÃ¶lÃ¼mlendirmesi:** FarklÄ± fonksiyonlar iÃ§in ayrÄ± veritabanlarÄ± veya depolama alanlarÄ± kullanÄ±n.
*   **VPC'leri KullanÄ±n:** GeliÅŸtirilmiÅŸ aÄŸ izolasyonu iÃ§in fonksiyonlarÄ± Sanal Ã–zel Bulutlar iÃ§inde daÄŸÄ±tÄ±n.

```yaml
provider:
vpc:
securityGroupIds:
- sg-xxxxxxxx
subnetIds:
- subnet-xxxxxx
```
* **Fonksiyon Ä°zinlerini SÄ±nÄ±rlayÄ±n:** FonksiyonlarÄ±n, aÃ§Ä±kÃ§a gerekli olmadÄ±kÃ§a birbirlerinin kaynaklarÄ±na eriÅŸemediÄŸinden emin olun.

***

### **Yetersiz Veri Koruma**

Dinlenme veya iletim sÄ±rasÄ±nda ÅŸifrelenmemiÅŸ veriler aÃ§Ä±ÄŸa Ã§Ä±kabilir, bu da veri ihlallerine veya mÃ¼dahalelere yol aÃ§abilir.

#### **Azaltma Stratejileri**

*   **Dinlenme Halindeki Verileri Åifreleyin:** Bulut hizmeti ÅŸifreleme Ã¶zelliklerini kullanÄ±n.

```yaml
resources:
Resources:
MyDynamoDBTable:
Type: AWS::DynamoDB::Table
Properties:
SSESpecification:
SSEEnabled: true
```
* **Ä°letim Halindeki Verileri Åifreleyin:** TÃ¼m veri iletimleri iÃ§in HTTPS/TLS kullanÄ±n.
* **API Ä°letiÅŸimini GÃ¼vence AltÄ±na AlÄ±n:** Åifreleme protokollerini zorlayÄ±n ve sertifikalarÄ± doÄŸrulayÄ±n.
* **Åifreleme AnahtarlarÄ±nÄ± GÃ¼venli Bir Åekilde YÃ¶netin:** YÃ¶netilen anahtar hizmetlerini kullanÄ±n ve anahtarlarÄ± dÃ¼zenli olarak dÃ¶ndÃ¼rÃ¼n.

***

### **Uygun Hata YÃ¶netiminin OlmamasÄ±**

AyrÄ±ntÄ±lÄ± hata mesajlarÄ±, altyapÄ± veya kod tabanÄ± hakkÄ±nda hassas bilgileri aÃ§Ä±ÄŸa Ã§Ä±karabilirken, ele alÄ±nmamÄ±ÅŸ istisnalar uygulama Ã§Ã¶kmesine neden olabilir.

#### **Azaltma Stratejileri**

*   **Genel Hata MesajlarÄ±:** Hata yanÄ±tlarÄ±nda iÃ§ detaylarÄ± aÃ§Ä±ÄŸa Ã§Ä±karmaktan kaÃ§Ä±nÄ±n.

```javascript
javascriptCopy code// Node.js Ã¶rneÄŸi
exports.hello = async (event) => {
try {
// Fonksiyon mantÄ±ÄŸÄ±
} catch (error) {
console.error(error);
return {
statusCode: 500,
body: JSON.stringify({ message: 'Internal Server Error' }),
};
}
};
```
* **Merkezi Hata YÃ¶netimi:** TÃ¼m fonksiyonlar arasÄ±nda hatalarÄ± tutarlÄ± bir ÅŸekilde yÃ¶netin ve temizleyin.
* **HatalarÄ± Ä°zleyin ve GÃ¼nlÃ¼ÄŸe GeÃ§irin:** HatalarÄ± iÃ§sel olarak izleyin ve analiz edin, son kullanÄ±cÄ±ya detaylarÄ± aÃ§Ä±ÄŸa Ã§Ä±karmayÄ±n.

***

### **GÃ¼vensiz DaÄŸÄ±tÄ±m UygulamalarÄ±**

AÃ§Ä±k daÄŸÄ±tÄ±m yapÄ±landÄ±rmalarÄ± veya CI/CD boru hatlarÄ±na yetkisiz eriÅŸim, kÃ¶tÃ¼ niyetli kod daÄŸÄ±tÄ±mlarÄ±na veya yanlÄ±ÅŸ yapÄ±landÄ±rmalara yol aÃ§abilir.

#### **Azaltma Stratejileri**

* **GÃ¼venli CI/CD Boru HatlarÄ±:** KatÄ± eriÅŸim kontrolleri, Ã§ok faktÃ¶rlÃ¼ kimlik doÄŸrulama (MFA) ve dÃ¼zenli denetimler uygulayÄ±n.
* **YapÄ±landÄ±rmayÄ± GÃ¼venli Bir Åekilde SaklayÄ±n:** DaÄŸÄ±tÄ±m dosyalarÄ±nÄ± sabitlenmiÅŸ sÄ±rlar ve hassas verilerden arÄ±ndÄ±rÄ±n.
* **AltyapÄ± Kod Olarak (IaC) GÃ¼venlik AraÃ§larÄ± KullanÄ±n:** GÃ¼venlik politikalarÄ±nÄ± zorlamak iÃ§in **Checkov** veya **Terraform Sentinel** gibi araÃ§larÄ± kullanÄ±n.
* **DeÄŸiÅŸmez DaÄŸÄ±tÄ±mlar:** DeÄŸiÅŸmez altyapÄ± uygulamalarÄ± benimseyerek daÄŸÄ±tÄ±m sonrasÄ± yetkisiz deÄŸiÅŸiklikleri Ã¶nleyin.

***

### **Eklentiler ve UzantÄ±lardaki ZayÄ±flÄ±klar**

OnaylanmamÄ±ÅŸ veya kÃ¶tÃ¼ niyetli Ã¼Ã§Ã¼ncÃ¼ taraf eklentilerin kullanÄ±lmasÄ±, sunucusuz uygulamalarÄ±nÄ±za zayÄ±flÄ±klar ekleyebilir.

#### **Azaltma Stratejileri**

* **Eklentileri KapsamlÄ± Bir Åekilde DeÄŸerlendirin:** Entegrasyondan Ã¶nce eklentilerin gÃ¼venliÄŸini deÄŸerlendirin, gÃ¼venilir kaynaklardan gelenleri tercih edin.
* **Eklenti KullanÄ±mÄ±nÄ± SÄ±nÄ±rlayÄ±n:** SaldÄ±rÄ± yÃ¼zeyini en aza indirmek iÃ§in yalnÄ±zca gerekli eklentileri kullanÄ±n.
* **Eklenti GÃ¼ncellemelerini Ä°zleyin:** GÃ¼venlik yamalarÄ±ndan yararlanmak iÃ§in eklentileri gÃ¼ncel tutun.
* **Eklenti OrtamlarÄ±nÄ± Ä°zole Edin:** Potansiyel tehlikeleri sÄ±nÄ±rlamak iÃ§in eklentileri izole ortamlarda Ã§alÄ±ÅŸtÄ±rÄ±n.

***

### **Hassas UÃ§ NoktalarÄ±n AÃ§Ä±ÄŸa Ã‡Ä±kmasÄ±**

Herkese aÃ§Ä±k eriÅŸilebilir fonksiyonlar veya kÄ±sÄ±tlanmamÄ±ÅŸ API'ler, yetkisiz iÅŸlemler iÃ§in istismar edilebilir.

#### **Azaltma Stratejileri**

* **Fonksiyon EriÅŸimini KÄ±sÄ±tlayÄ±n:** VPC'ler, gÃ¼venlik gruplarÄ± ve gÃ¼venlik duvarÄ± kurallarÄ± kullanarak eriÅŸimi gÃ¼venilir kaynaklarla sÄ±nÄ±rlayÄ±n.
* **SaÄŸlam Kimlik DoÄŸrulama UygulayÄ±n:** TÃ¼m aÃ§Ä±k uÃ§ noktalarÄ±n uygun kimlik doÄŸrulama ve yetkilendirme gerektirdiÄŸinden emin olun.
* **API Gateway'leri GÃ¼venli Bir Åekilde KullanÄ±n:** API Gateway'leri, giriÅŸ doÄŸrulamasÄ± ve hÄ±z sÄ±nÄ±rlamasÄ± dahil olmak Ã¼zere gÃ¼venlik politikalarÄ±nÄ± zorlamak iÃ§in yapÄ±landÄ±rÄ±n.
* **KullanÄ±lmayan UÃ§ NoktalarÄ± Devre DÄ±ÅŸÄ± BÄ±rakÄ±n:** DÃ¼zenli olarak gÃ¶zden geÃ§irin ve artÄ±k kullanÄ±lmayan uÃ§ noktalarÄ± devre dÄ±ÅŸÄ± bÄ±rakÄ±n.

***

### **Ekip Ãœyeleri ve DÄ±ÅŸ Ä°ÅŸbirlikÃ§ileri iÃ§in AÅŸÄ±rÄ± Ä°zinler**

Ekip Ã¼yelerine ve dÄ±ÅŸ iÅŸbirlikÃ§ilere aÅŸÄ±rÄ± izinler vermek, yetkisiz eriÅŸim, veri ihlalleri ve kaynaklarÄ±n kÃ¶tÃ¼ye kullanÄ±lmasÄ±na yol aÃ§abilir. Bu risk, birden fazla bireyin farklÄ± eriÅŸim seviyelerine sahip olduÄŸu ortamlarda artar ve saldÄ±rÄ± yÃ¼zeyini ve iÃ§ tehdit potansiyelini artÄ±rÄ±r.

#### **Azaltma Stratejileri**

* **En Az AyrÄ±calÄ±k Ä°lkesi:** Ekip Ã¼yelerinin ve iÅŸbirlikÃ§ilerinin yalnÄ±zca gÃ¶revlerini yerine getirmek iÃ§in gerekli izinlere sahip olduÄŸundan emin olun.

***

### **EriÅŸim AnahtarlarÄ± ve Lisans AnahtarlarÄ± GÃ¼venliÄŸi**

**EriÅŸim AnahtarlarÄ±** ve **Lisans AnahtarlarÄ±**, Serverless Framework CLI ile etkileÅŸimleri kimlik doÄŸrulamak ve yetkilendirmek iÃ§in kullanÄ±lan kritik kimlik bilgileridir.

* **Lisans AnahtarlarÄ±:** CLI Ã¼zerinden giriÅŸ yapmayÄ± saÄŸlayan Serverless Framework SÃ¼rÃ¼m 4'e eriÅŸimi kimlik doÄŸrulamak iÃ§in gereken benzersiz tanÄ±mlayÄ±cÄ±lardÄ±r.
* **EriÅŸim AnahtarlarÄ±:** Serverless Framework Dashboard ile kimlik doÄŸrulamak iÃ§in Serverless Framework CLI'ye izin veren kimlik bilgileridir. `serverless` cli ile giriÅŸ yapÄ±ldÄ±ÄŸÄ±nda bir eriÅŸim anahtarÄ± **oluÅŸturulacak ve dizÃ¼stÃ¼ bilgisayarda saklanacaktÄ±r**. AyrÄ±ca `SERVERLESS_ACCESS_KEY` adÄ±nda bir ortam deÄŸiÅŸkeni olarak ayarlayabilirsiniz.

#### **GÃ¼venlik Riskleri**

1. **Kod DepolarÄ± Ãœzerinden AÃ§Ä±ÄŸa Ã‡Ä±kma:**
* EriÅŸim AnahtarlarÄ±nÄ± ve Lisans AnahtarlarÄ±nÄ± sÃ¼rÃ¼m kontrol sistemlerine sabitlemek veya yanlÄ±ÅŸlÄ±kla taahhÃ¼t etmek, yetkisiz eriÅŸime yol aÃ§abilir.
2. **GÃ¼vensiz Depolama:**
* AnahtarlarÄ± dÃ¼z metin olarak ortam deÄŸiÅŸkenlerinde veya yapÄ±landÄ±rma dosyalarÄ±nda uygun ÅŸifreleme olmadan saklamak, sÄ±zÄ±ntÄ± olasÄ±lÄ±ÄŸÄ±nÄ± artÄ±rÄ±r.
3. **YanlÄ±ÅŸ DaÄŸÄ±tÄ±m:**
* AnahtarlarÄ± gÃ¼vensiz kanallar (Ã¶rneÄŸin, e-posta, sohbet) aracÄ±lÄ±ÄŸÄ±yla paylaÅŸmak, kÃ¶tÃ¼ niyetli aktÃ¶rler tarafÄ±ndan ele geÃ§irilmesine neden olabilir.
4. **DÃ¶ngÃ¼ EksikliÄŸi:**
* AnahtarlarÄ± dÃ¼zenli olarak dÃ¶ndÃ¼rmemek, anahtarlar tehlikeye girerse maruz kalma sÃ¼resini uzatÄ±r.
5. **AÅŸÄ±rÄ± Ä°zinler:**
* GeniÅŸ izinlere sahip anahtarlar, birden fazla kaynakta yetkisiz eylemler gerÃ§ekleÅŸtirmek iÃ§in istismar edilebilir.

{% hint style="success" %}
AWS Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n:<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
GCP Hacking'i Ã¶ÄŸrenin ve pratik yapÄ±n: <img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>HackTricks'i Destekleyin</summary>

* [**abonelik planlarÄ±nÄ±**](https://github.com/sponsors/carlospolop) kontrol edin!
* **ğŸ’¬ [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katÄ±lÄ±n ya da **Twitter'da** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**'i takip edin.**
* **Hacking ipuÃ§larÄ±nÄ± paylaÅŸmak iÃ§in [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna PR gÃ¶nderin.**

</details>
{% endhint %}
