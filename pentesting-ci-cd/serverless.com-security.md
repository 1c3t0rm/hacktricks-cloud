# Serverless.com Security

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Informa√ß√µes B√°sicas

### Organiza√ß√£o

Uma **Organiza√ß√£o** √© a entidade de n√≠vel mais alto dentro do ecossistema do Serverless Framework. Ela representa um **grupo coletivo**, como uma empresa, departamento ou qualquer entidade grande, que abrange m√∫ltiplos projetos, equipes e aplica√ß√µes.

### Equipe

A **Equipe** s√£o os usu√°rios com acesso dentro da organiza√ß√£o. As equipes ajudam a organizar os membros com base em fun√ß√µes. **`Colaboradores`** podem visualizar e implantar aplicativos existentes, enquanto **`Administradores`** podem criar novos aplicativos e gerenciar as configura√ß√µes da organiza√ß√£o.

### Aplica√ß√£o

Um **App** √© um agrupamento l√≥gico de servi√ßos relacionados dentro de uma Organiza√ß√£o. Ele representa uma aplica√ß√£o completa composta por m√∫ltiplos servi√ßos serverless que trabalham juntos para fornecer uma funcionalidade coesa.

### **Servi√ßos**

Um **Servi√ßo** √© o componente central de uma aplica√ß√£o Serverless. Ele representa todo o seu projeto serverless, encapsulando todas as fun√ß√µes, configura√ß√µes e recursos necess√°rios. Geralmente √© definido em um arquivo `serverless.yml`, um servi√ßo inclui metadados como o nome do servi√ßo, configura√ß√µes do provedor, fun√ß√µes, eventos, recursos, plugins e vari√°veis personalizadas.
```yaml
service: my-service
provider:
name: aws
runtime: nodejs14.x
functions:
hello:
handler: handler.hello
```
<details>

<summary>Fun√ß√£o</summary>

Uma **Fun√ß√£o** representa uma √∫nica fun√ß√£o serverless, como uma fun√ß√£o AWS Lambda. Ela cont√©m o c√≥digo que √© executado em resposta a eventos.

Est√° definida na se√ß√£o `functions` em `serverless.yml`, especificando o manipulador, runtime, eventos, vari√°veis de ambiente e outras configura√ß√µes.
```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
```
</details>

<details>

<summary>Evento</summary>

**Eventos** s√£o gatilhos que invocam suas fun√ß√µes serverless. Eles definem como e quando uma fun√ß√£o deve ser executada.

Os tipos comuns de eventos incluem solicita√ß√µes HTTP, eventos agendados (jobs cron), eventos de banco de dados, uploads de arquivos e mais.
```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
- schedule:
rate: rate(10 minutes)
```
</details>

<details>

<summary>Recurso</summary>

**Recursos** permitem que voc√™ defina recursos de nuvem adicionais dos quais seu servi√ßo depende, como bancos de dados, buckets de armazenamento ou fun√ß√µes IAM.

Eles s√£o especificados na se√ß√£o `resources`, frequentemente usando a sintaxe do CloudFormation para AWS.
```yaml
resources:
Resources:
MyDynamoDBTable:
Type: AWS::DynamoDB::Table
Properties:
TableName: my-table
AttributeDefinitions:
- AttributeName: id
AttributeType: S
KeySchema:
- AttributeName: id
KeyType: HASH
ProvisionedThroughput:
ReadCapacityUnits: 1
WriteCapacityUnits: 1
```
</details>

<details>

<summary>Provedor</summary>

O **Provedor** objeto especifica o provedor de servi√ßos em nuvem (por exemplo, AWS, Azure, Google Cloud) e cont√©m configura√ß√µes relevantes para esse provedor.

Inclui detalhes como o runtime, regi√£o, est√°gio e credenciais.
```yaml
yamlCopy codeprovider:
name: aws
runtime: nodejs14.x
region: us-east-1
stage: dev
```
</details>

<details>

<summary>Est√°gio e Regi√£o</summary>

O est√°gio representa diferentes ambientes (por exemplo, desenvolvimento, homologa√ß√£o, produ√ß√£o) onde seu servi√ßo pode ser implantado. Ele permite configura√ß√µes e implanta√ß√µes espec√≠ficas para cada ambiente.
```yaml
provider:
stage: dev
```
A regi√£o especifica a regi√£o geogr√°fica onde seus recursos ser√£o implantados. √â importante para considera√ß√µes de lat√™ncia, conformidade e disponibilidade.
```yaml
provider:
region: us-west-2
```
</details>

<details>

<summary>Plugins</summary>

**Plugins** estendem a funcionalidade do Serverless Framework adicionando novos recursos ou integrando-se a outras ferramentas e servi√ßos. Eles s√£o definidos na se√ß√£o `plugins` e instalados via npm.
```yaml
plugins:
- serverless-offline
- serverless-webpack
```
</details>

<details>

<summary>Camadas</summary>

**Camadas** permitem que voc√™ empacote e gerencie c√≥digo compartilhado ou depend√™ncias separadamente de suas fun√ß√µes. Isso promove a reutiliza√ß√£o e reduz o tamanho dos pacotes de implanta√ß√£o. Elas s√£o definidas na se√ß√£o `layers` e referenciadas por fun√ß√µes.
```yaml
layers:
commonLibs:
path: layer-common
functions:
hello:
handler: handler.hello
layers:
- { Ref: CommonLibsLambdaLayer }
```
</details>

<details>

<summary>Vari√°veis e Vari√°veis Personalizadas</summary>

**Vari√°veis** permitem configura√ß√£o din√¢mica ao permitir o uso de espa√ßos reservados que s√£o resolvidos no momento da implanta√ß√£o.

*   **Sintaxe:** A sintaxe `${variable}` pode referenciar vari√°veis de ambiente, conte√∫dos de arquivos ou outros par√¢metros de configura√ß√£o.

```yaml
functions:
hello:
handler: handler.hello
environment:
TABLE_NAME: ${self:custom.tableName}
```

-   **Vari√°veis Personalizadas:** A se√ß√£o `custom` √© usada para definir vari√°veis e configura√ß√µes espec√≠ficas do usu√°rio que podem ser reutilizadas em todo o `serverless.yml`.

```yaml
custom:
tableName: my-dynamodb-table
stage: ${opt:stage, 'dev'}
```

</details>

<details>

<summary>Sa√≠das</summary>

**Sa√≠das** definem os valores que s√£o retornados ap√≥s um servi√ßo ser implantado, como ARNs de recursos, endpoints ou outras informa√ß√µes √∫teis. Elas s√£o especificadas na se√ß√£o `outputs` e frequentemente usadas para expor informa√ß√µes a outros servi√ßos ou para f√°cil acesso ap√≥s a implanta√ß√£o.
```yaml
¬°outputs:
ApiEndpoint:
Description: "API Gateway endpoint URL"
Value:
Fn::Join:
- ""
- - "https://"
- Ref: ApiGatewayRestApi
- ".execute-api."
- Ref: AWS::Region
- ".amazonaws.com/"
- Ref: AWS::Stage
```
</details>

<details>

<summary>Fun√ß√µes e Permiss√µes IAM</summary>

**Fun√ß√µes e Permiss√µes IAM** definem as credenciais de seguran√ßa e os direitos de acesso para suas fun√ß√µes e outros recursos. Elas s√£o gerenciadas sob as configura√ß√µes do `provider` ou de fun√ß√µes individuais para especificar as permiss√µes necess√°rias.
```yaml
provider:
iamRoleStatements:
- Effect: Allow
Action:
- dynamodb:Query
- dynamodb:Scan
Resource: arn:aws:dynamodb:${self:provider.region}:*:table/my-table
```
</details>

<details>

<summary>Vari√°veis de Ambiente</summary>

**Vari√°veis** permitem que voc√™ passe configura√ß√µes e segredos para suas fun√ß√µes sem codific√°-los diretamente. Elas s√£o definidas na se√ß√£o `environment` para o provedor ou fun√ß√µes individuais.
```yaml
provider:
environment:
STAGE: ${self:provider.stage}
functions:
hello:
handler: handler.hello
environment:
TABLE_NAME: ${self:custom.tableName}
```
</details>

<details>

<summary>Depend√™ncias</summary>

**Depend√™ncias** gerenciam as bibliotecas e m√≥dulos externos que suas fun√ß√µes requerem. Elas s√£o normalmente gerenciadas por meio de gerenciadores de pacotes como npm ou pip, e empacotadas com seu pacote de implanta√ß√£o usando ferramentas ou plugins como `serverless-webpack`.
```yaml
plugins:
- serverless-webpack
```
</details>

<details>

<summary>Hooks</summary>

**Hooks** permitem que voc√™ execute scripts ou comandos personalizados em pontos espec√≠ficos do ciclo de vida da implanta√ß√£o. Eles s√£o definidos usando plugins ou dentro do `serverless.yml` para realizar a√ß√µes antes ou depois das implanta√ß√µes.
```yaml
custom:
hooks:
before:deploy:deploy: echo "Starting deployment..."
```
</details>

### Tutorial

Este √© um resumo do tutorial oficial [**da documenta√ß√£o**](https://www.serverless.com/framework/docs/tutorial):

1. Crie uma conta na AWS (Serverless.com come√ßa na infraestrutura da AWS)
2. Crie uma conta em serverless.com
3. Crie um aplicativo:
```bash
# Create temp folder for the tutorial
mkdir /tmp/serverless-tutorial
cd /tmp/serverless-tutorial

# Install Serverless cli
npm install -g serverless

# Generate template
serverless #Choose first one (AWS / Node.js / HTTP API)
## Indicate a name like "Tutorial"
## Login/Register
## Create A New App
## Indicate a name like "tutorialapp)
```
Isso deve ter criado um **app** chamado `tutorialapp` que voc√™ pode verificar em [serverless.com](serverless.com-security.md) e uma pasta chamada `Tutorial` com o arquivo **`handler.js`** contendo algum c√≥digo JS com um c√≥digo `helloworld` e o arquivo **`serverless.yml`** declarando essa fun√ß√£o:

{% tabs %}
{% tab title="handler.js" %}
```javascript
exports.hello = async (event) => {
return {
statusCode: 200,
body: JSON.stringify({
message: "Go Serverless v4! Your function executed successfully!",
}),
};
};
```
{% endtab %}

{% tab title="serverless.yml" %}
```yaml
# "org" ensures this Service is used with the correct Serverless Framework Access Key.
org: testing12342
# "app" enables Serverless Framework Dashboard features and sharing them with other Services.
app: tutorialapp
# "service" is the name of this project. This will also be added to your AWS resource names.
service: Tutorial

provider:
name: aws
runtime: nodejs20.x

functions:
hello:
handler: handler.hello
events:
- httpApi:
path: /
method: get
```
{% endtab %}
{% endtabs %}

4. Crie um provedor AWS, acessando o **dashboard** em `https://app.serverless.com/<org name>/settings/providers?providerId=new&provider=aws`.
1. Para dar acesso ao `serverless.com` ao AWS, ser√° solicitado que voc√™ execute uma pilha do cloudformation usando este arquivo de configura√ß√£o (no momento da escrita): [https://serverless-framework-template.s3.amazonaws.com/roleTemplate.yml](https://serverless-framework-template.s3.amazonaws.com/roleTemplate.yml)
2. Este template gera um papel chamado **`SFRole-<ID>`** com **`arn:aws:iam::aws:policy/AdministratorAccess`** sobre a conta com uma Identidade de Confian√ßa que permite que a conta AWS do `Serverless.com` acesse o papel.

<details>

<summary>Yaml roleTemplate</summary>
```yaml
Description: This stack creates an IAM role that can be used by Serverless Framework for use in deployments.
Resources:
SFRole:
Type: AWS::IAM::Role
Properties:
AssumeRolePolicyDocument:
Version: '2012-10-17'
Statement:
- Effect: Allow
Principal:
AWS: arn:aws:iam::486128539022:root
Action:
- sts:AssumeRole
Condition:
StringEquals:
sts:ExternalId: !Sub 'ServerlessFramework-${OrgUid}'
Path: /
RoleName: !Ref RoleName
ManagedPolicyArns:
- arn:aws:iam::aws:policy/AdministratorAccess
ReporterFunction:
Type: Custom::ServerlessFrameworkReporter
Properties:
ServiceToken: 'arn:aws:lambda:us-east-1:486128539022:function:sp-providers-stack-reporter-custom-resource-prod-tmen2ec'
OrgUid: !Ref OrgUid
RoleArn: !GetAtt SFRole.Arn
Alias: !Ref Alias
Outputs:
SFRoleArn:
Description: 'ARN for the IAM Role used by Serverless Framework'
Value: !GetAtt SFRole.Arn
Parameters:
OrgUid:
Description: Serverless Framework Org Uid
Type: String
Alias:
Description: Serverless Framework Provider Alias
Type: String
RoleName:
Description: Serverless Framework Role Name
Type: String
```
</details>

<details>

<summary>Rela√ß√£o de Confian√ßa</summary>
```json
{
"Version": "2012-10-17",
"Statement": [
{
"Effect": "Allow",
"Principal": {
"AWS": "arn:aws:iam::486128539022:root"
},
"Action": "sts:AssumeRole",
"Condition": {
"StringEquals": {
"sts:ExternalId": "ServerlessFramework-7bf7ddef-e1bf-43eb-a111-4d43e0894ccb"
}
}
}
]
}
```
</details>

5. O tutorial pede para criar o arquivo `createCustomer.js`, que basicamente criar√° um novo endpoint de API tratado pelo novo arquivo JS e pede para modificar o arquivo `serverless.yml` para que ele gere uma **nova tabela DynamoDB**, defina uma **vari√°vel de ambiente**, o papel que estar√° usando as lambdas geradas.

{% tabs %}
{% tab title="createCustomer.js" %}
```javascript
'use strict'
const AWS = require('aws-sdk')
module.exports.createCustomer = async (event) => {
const body = JSON.parse(Buffer.from(event.body, 'base64').toString())
const dynamoDb = new AWS.DynamoDB.DocumentClient()
const putParams = {
TableName: process.env.DYNAMODB_CUSTOMER_TABLE,
Item: {
primary_key: body.name,
email: body.email,
},
}
await dynamoDb.put(putParams).promise()
return {
statusCode: 201,
}
}
```
{% endtab %}

{% tab title="serverless.yml" %}
```yaml
# "org" ensures this Service is used with the correct Serverless Framework Access Key.
org: testing12342
# "app" enables Serverless Framework Dashboard features and sharing them with other Services.
app: tutorialapp
# "service" is the name of this project. This will also be added to your AWS resource names.
service: Tutorial

provider:
name: aws
runtime: nodejs20.x
environment:
DYNAMODB_CUSTOMER_TABLE: ${self:service}-customerTable-${sls:stage}
iam:
role:
statements:
- Effect: 'Allow'
Action:
- 'dynamodb:PutItem'
- 'dynamodb:Get*'
- 'dynamodb:Scan*'
- 'dynamodb:UpdateItem'
- 'dynamodb:DeleteItem'
Resource: arn:aws:dynamodb:${aws:region}:${aws:accountId}:table/${self:service}-customerTable-${sls:stage}

functions:
hello:
handler: handler.hello
events:
- httpApi:
path: /
method: get
createCustomer:
handler: createCustomer.createCustomer
events:
- httpApi:
path: /
method: post

resources:
Resources:
CustomerTable:
Type: AWS::DynamoDB::Table
Properties:
AttributeDefinitions:
- AttributeName: primary_key
AttributeType: S
BillingMode: PAY_PER_REQUEST
KeySchema:
- AttributeName: primary_key
KeyType: HASH
TableName: ${self:service}-customerTable-${sls:stage}
```
{% endtab %}
{% endtabs %}

6. Fa√ßa o deploy executando **`serverless deploy`**
1. O deployment ser√° realizado via uma CloudFormation Stack
2. Note que as **lambdas est√£o expostas via API gateway** e n√£o via URLs diretas
7. **Teste**
1. O passo anterior imprimir√° as **URLs** onde suas fun√ß√µes lambda de endpoints da API foram implantadas

## Revis√£o de Seguran√ßa do Serverless.com

### **Fun√ß√µes e Permiss√µes IAM Mal Configuradas**

Fun√ß√µes IAM excessivamente permissivas podem conceder acesso n√£o autorizado a recursos em nuvem, levando a vazamentos de dados ou manipula√ß√£o de recursos.

#### **Estrat√©gias de Mitiga√ß√£o**

*   **Princ√≠pio do Menor Privil√©gio:** Atribua apenas as permiss√µes necess√°rias a cada fun√ß√£o.

```yaml
provider:
iamRoleStatements:
- Effect: Allow
Action:
- dynamodb:Query
- dynamodb:Scan
Resource: arn:aws:dynamodb:${self:provider.region}:*:table/my-table
```
* **Use Fun√ß√µes Separadas:** Diferencie fun√ß√µes com base nos requisitos da fun√ß√£o.

***

### **Segredos Inseguros e Gest√£o de Configura√ß√£o**

Armazenar informa√ß√µes sens√≠veis (por exemplo, chaves de API, credenciais de banco de dados) diretamente no **`serverless.yml`** ou no c√≥digo pode levar √† exposi√ß√£o se os reposit√≥rios forem comprometidos.

A maneira **recomendada** de armazenar vari√°veis de ambiente no arquivo **`serverless.yml`** do serverless.com (no momento da reda√ß√£o) √© usar os provedores `ssm` ou `s3`, que permitem obter os **valores de ambiente dessas fontes no momento do deployment** e **configurar** as vari√°veis de ambiente das **lambdas** com o **texto claro dos valores**!

{% hint style="danger" %}
Portanto, qualquer pessoa com permiss√µes para ler a configura√ß√£o das lambdas dentro da AWS poder√° **acessar todas essas vari√°veis de ambiente em texto claro!**
{% endhint %}

Por exemplo, o seguinte exemplo usar√° SSM para obter uma vari√°vel de ambiente:
```yaml
provider:
environment:
DB_PASSWORD: ${ssm:/aws/reference/secretsmanager/my-db-password~true}
```
E mesmo que isso impe√ßa a codifica√ß√£o do valor da vari√°vel de ambiente no arquivo **`serverless.yml`**, o valor ser√° obtido no momento da implanta√ß√£o e ser√° **adicionado em texto claro dentro da vari√°vel de ambiente da lambda**.

{% hint style="success" %}
A maneira recomendada de armazenar vari√°veis de ambiente usando serveless.com seria **armazen√°-las em um segredo da AWS** e apenas armazenar o nome do segredo na vari√°vel de ambiente e o **c√≥digo da lambda deve colet√°-lo**.
{% endhint %}

#### **Estrat√©gias de Mitiga√ß√£o**

* **Integra√ß√£o com o Secrets Manager:** Use servi√ßos como **AWS Secrets Manager.**
* **Vari√°veis Criptografadas:** Aproveite os recursos de criptografia do Serverless Framework para dados sens√≠veis.
* **Controles de Acesso:** Restringir o acesso a segredos com base em fun√ß√µes.

***

### **C√≥digo e Depend√™ncias Vulner√°veis**

Depend√™ncias desatualizadas ou inseguras podem introduzir vulnerabilidades, enquanto o manuseio inadequado de entradas pode levar a ataques de inje√ß√£o de c√≥digo.

#### **Estrat√©gias de Mitiga√ß√£o**

*   **Gerenciamento de Depend√™ncias:** Atualize regularmente as depend√™ncias e escaneie em busca de vulnerabilidades.

```yaml
plugins:
- serverless-webpack
- serverless-plugin-snyk
```
* **Valida√ß√£o de Entrada:** Implemente valida√ß√£o e sanitiza√ß√£o rigorosas de todas as entradas.
* **Revis√µes de C√≥digo:** Realize revis√µes minuciosas para identificar falhas de seguran√ßa.
* **An√°lise Est√°tica:** Use ferramentas para detectar vulnerabilidades na base de c√≥digo.

***

### **Registro e Monitoramento Inadequados**

Sem registro e monitoramento adequados, atividades maliciosas podem passar despercebidas, atrasando a resposta a incidentes.

#### **Estrat√©gias de Mitiga√ß√£o**

*   **Registro Centralizado:** Agregue logs usando servi√ßos como **AWS CloudWatch** ou **Datadog**.

```yaml
plugins:
- serverless-plugin-datadog
```
* **Ativar Registro Detalhado:** Capture informa√ß√µes essenciais sem expor dados sens√≠veis.
* **Configurar Alertas:** Configure alertas para atividades suspeitas ou anomalias.
* **Monitoramento Regular:** Monitore continuamente logs e m√©tricas em busca de potenciais incidentes de seguran√ßa.

***

### **Configura√ß√µes Inseguras do API Gateway**

APIs abertas ou mal protegidas podem ser exploradas para acesso n√£o autorizado, ataques de Nega√ß√£o de Servi√ßo (DoS) ou ataques entre sites.

#### **Estrat√©gias de Mitiga√ß√£o**

*   **Autentica√ß√£o e Autoriza√ß√£o:** Implemente mecanismos robustos como OAuth, chaves de API ou JWT.

```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
authorizer: aws_iam
```
*   **Limita√ß√£o de Taxa e Controle de Fluxo:** Prevenir abusos limitando as taxas de solicita√ß√£o.

```yaml
provider:
apiGateway:
throttle:
burstLimit: 200
rateLimit: 100
```
*   **Configura√ß√£o Segura de CORS:** Restringir origens, m√©todos e cabe√ßalhos permitidos.

```yaml
functions:
hello:
handler: handler.hello
events:
- http:
path: hello
method: get
cors:
origin: https://yourdomain.com
headers:
- Content-Type
```
* **Usar Firewalls de Aplica√ß√£o Web (WAF):** Filtrar e monitorar solicita√ß√µes HTTP em busca de padr√µes maliciosos.

***

### **Isolamento de Fun√ß√µes Insuficiente**

Recursos compartilhados e isolamento inadequado podem levar a eleva√ß√µes de privil√©gio ou intera√ß√µes n√£o intencionais entre fun√ß√µes.

#### **Estrat√©gias de Mitiga√ß√£o**

* **Isolar Fun√ß√µes:** Atribuir recursos e fun√ß√µes IAM distintos para garantir opera√ß√£o independente.
* **Particionamento de Recursos:** Usar bancos de dados ou buckets de armazenamento separados para diferentes fun√ß√µes.
*   **Usar VPCs:** Implantar fun√ß√µes dentro de Nuvens Privadas Virtuais para melhor isolamento de rede.

```yaml
provider:
vpc:
securityGroupIds:
- sg-xxxxxxxx
subnetIds:
- subnet-xxxxxx
```
* **Limitar Permiss√µes de Fun√ß√µes:** Garantir que as fun√ß√µes n√£o possam acessar ou interferir nos recursos umas das outras, a menos que explicitamente necess√°rio.

***

### **Prote√ß√£o de Dados Inadequada**

Dados n√£o criptografados em repouso ou em tr√¢nsito podem ser expostos, levando a vazamentos de dados ou adultera√ß√µes.

#### **Estrat√©gias de Mitiga√ß√£o**

*   **Criptografar Dados em Repouso:** Utilize recursos de criptografia do servi√ßo em nuvem.

```yaml
resources:
Resources:
MyDynamoDBTable:
Type: AWS::DynamoDB::Table
Properties:
SSESpecification:
SSEEnabled: true
```
* **Criptografar Dados em Tr√¢nsito:** Use HTTPS/TLS para todas as transmiss√µes de dados.
* **Comunica√ß√£o Segura de API:** Impor protocolos de criptografia e validar certificados.
* **Gerenciar Chaves de Criptografia de Forma Segura:** Usar servi√ßos de chave gerenciados e rotacionar chaves regularmente.

***

### **Falta de Tratamento Adequado de Erros**

Mensagens de erro detalhadas podem vazar informa√ß√µes sens√≠veis sobre a infraestrutura ou base de c√≥digo, enquanto exce√ß√µes n√£o tratadas podem levar a falhas na aplica√ß√£o.

#### **Estrat√©gias de Mitiga√ß√£o**

*   **Mensagens de Erro Gen√©ricas:** Evitar expor detalhes internos nas respostas de erro.

```javascript
javascriptCopy code// Exemplo em Node.js
exports.hello = async (event) => {
try {
// L√≥gica da fun√ß√£o
} catch (error) {
console.error(error);
return {
statusCode: 500,
body: JSON.stringify({ message: 'Erro Interno do Servidor' }),
};
}
};
```
* **Tratamento Centralizado de Erros:** Gerenciar e sanitizar erros de forma consistente em todas as fun√ß√µes.
* **Monitorar e Registrar Erros:** Rastrear e analisar erros internamente sem expor detalhes aos usu√°rios finais.

***

### **Pr√°ticas de Implanta√ß√£o Inseguras**

Configura√ß√µes de implanta√ß√£o expostas ou acesso n√£o autorizado a pipelines de CI/CD podem levar a implanta√ß√µes de c√≥digo malicioso ou configura√ß√µes incorretas.

#### **Estrat√©gias de Mitiga√ß√£o**

* **Pipelines de CI/CD Seguros:** Implementar controles de acesso rigorosos, autentica√ß√£o multifator (MFA) e auditorias regulares.
* **Armazenar Configura√ß√µes de Forma Segura:** Manter arquivos de implanta√ß√£o livres de segredos codificados e dados sens√≠veis.
* **Usar Ferramentas de Seguran√ßa de Infraestrutura como C√≥digo (IaC):** Empregar ferramentas como **Checkov** ou **Terraform Sentinel** para impor pol√≠ticas de seguran√ßa.
* **Implanta√ß√µes Imut√°veis:** Prevenir altera√ß√µes n√£o autorizadas ap√≥s a implanta√ß√£o adotando pr√°ticas de infraestrutura imut√°vel.

***

### **Vulnerabilidades em Plugins e Extens√µes**

Usar plugins de terceiros n√£o verificados ou maliciosos pode introduzir vulnerabilidades em suas aplica√ß√µes serverless.

#### **Estrat√©gias de Mitiga√ß√£o**

* **Avaliar Plugins Minuciosamente:** Avaliar a seguran√ßa dos plugins antes da integra√ß√£o, favorecendo aqueles de fontes respeit√°veis.
* **Limitar o Uso de Plugins:** Usar apenas plugins necess√°rios para minimizar a superf√≠cie de ataque.
* **Monitorar Atualiza√ß√µes de Plugins:** Manter plugins atualizados para se beneficiar de corre√ß√µes de seguran√ßa.
* **Isolar Ambientes de Plugins:** Executar plugins em ambientes isolados para conter poss√≠veis compromissos.

***

### **Exposi√ß√£o de Endpoints Sens√≠veis**

Fun√ß√µes publicamente acess√≠veis ou APIs sem restri√ß√µes podem ser exploradas para opera√ß√µes n√£o autorizadas.

#### **Estrat√©gias de Mitiga√ß√£o**

* **Restringir Acesso a Fun√ß√µes:** Usar VPCs, grupos de seguran√ßa e regras de firewall para limitar o acesso a fontes confi√°veis.
* **Implementar Autentica√ß√£o Robusta:** Garantir que todos os endpoints expostos exijam autentica√ß√£o e autoriza√ß√£o adequadas.
* **Usar API Gateways de Forma Segura:** Configurar API Gateways para impor pol√≠ticas de seguran√ßa, incluindo valida√ß√£o de entrada e limita√ß√£o de taxa.
* **Desativar Endpoints N√£o Utilizados:** Revisar regularmente e desativar quaisquer endpoints que n√£o estejam mais em uso.

***

### **Permiss√µes Excessivas para Membros da Equipe e Colaboradores Externos**

Conceder permiss√µes excessivas a membros da equipe e colaboradores externos pode levar a acesso n√£o autorizado, vazamentos de dados e uso indevido de recursos. Esse risco √© aumentado em ambientes onde m√∫ltiplos indiv√≠duos t√™m n√≠veis variados de acesso, aumentando a superf√≠cie de ataque e o potencial para amea√ßas internas.

#### **Estrat√©gias de Mitiga√ß√£o**

* **Princ√≠pio do Menor Privil√©gio:** Garantir que membros da equipe e colaboradores tenham apenas as permiss√µes necess√°rias para realizar suas tarefas.

***

### **Seguran√ßa de Chaves de Acesso e Chaves de Licen√ßa**

**Chaves de Acesso** e **Chaves de Licen√ßa** s√£o credenciais cr√≠ticas usadas para autenticar e autorizar intera√ß√µes com o CLI do Serverless Framework.

* **Chaves de Licen√ßa:** S√£o identificadores √∫nicos necess√°rios para autenticar o acesso √† vers√£o 4 do Serverless Framework, que permite login via CLI.
* **Chaves de Acesso:** Credenciais que permitem que o CLI do Serverless Framework se autentique com o Dashboard do Serverless Framework. Ao fazer login com o CLI `serverless`, uma chave de acesso ser√° **gerada e armazenada no laptop**. Voc√™ tamb√©m pode configur√°-la como uma vari√°vel de ambiente chamada `SERVERLESS_ACCESS_KEY`.

#### **Riscos de Seguran√ßa**

1. **Exposi√ß√£o Atrav√©s de Reposit√≥rios de C√≥digo:**
* Codificar ou cometer acidentalmente Chaves de Acesso e Chaves de Licen√ßa em sistemas de controle de vers√£o pode levar a acesso n√£o autorizado.
2. **Armazenamento Inseguro:**
* Armazenar chaves em texto claro dentro de vari√°veis de ambiente ou arquivos de configura√ß√£o sem criptografia adequada aumenta a probabilidade de vazamento.
3. **Distribui√ß√£o Inadequada:**
* Compartilhar chaves por canais n√£o seguros (por exemplo, e-mail, chat) pode resultar em intercepta√ß√£o por atores maliciosos.
4. **Falta de Rota√ß√£o:**
* N√£o rotacionar regularmente as chaves estende o per√≠odo de exposi√ß√£o se as chaves forem comprometidas.
5. **Permiss√µes Excessivas:**
* Chaves com permiss√µes amplas podem ser exploradas para realizar a√ß√µes n√£o autorizadas em v√°rios recursos.

{% hint style="success" %}
Aprenda e pratique Hacking AWS:<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Aprenda e pratique Hacking GCP: <img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-nos no** **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>
{% endhint %}
