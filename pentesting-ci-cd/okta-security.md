# Seguridad de Okta

<details>

<summary><strong>춰Apoya a HackTricks y obt칠n beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **칰ltima versi칩n de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop).
* Obt칠n [**productos oficiales de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) en GitHub.

</details>

## Informaci칩n b치sica

Okta, Inc. es una empresa de **gesti칩n de identidad y acceso** que proporciona software en la nube para ayudar a las empresas a **administrar y asegurar la autenticaci칩n de usuarios en aplicaciones modernas**, y para que los desarrolladores puedan construir controles de identidad en aplicaciones, servicios web y dispositivos.

Su servicio principal, llamado Okta Identity Cloud, ofrece productos que incluyen inicio de sesi칩n 칰nico (SSO), autenticaci칩n multifactor (MFA), gesti칩n del ciclo de vida, directorio universal, gesti칩n de acceso a API y m치s. Esto ayuda a las empresas a proteger sus datos sensibles y tambi칠n a agilizar el acceso de los usuarios, haciendo que las aplicaciones y servicios sean m치s accesibles y f치ciles de usar para los empleados o clientes.

Los servicios de Okta se utilizan ampliamente en contextos empresariales, as칤 como por empresas m치s peque침as y desarrolladores. Juega un papel crucial en permitir a las empresas adoptar y gestionar de forma segura las tecnolog칤as en la nube. Hasta mi fecha l칤mite de conocimiento en septiembre de 2021, Okta sigue siendo un jugador importante en la industria de la gesti칩n de identidad y acceso (IAM).

{% hint style="danger" %}
El objetivo principal de Okta es configurar el acceso de diferentes usuarios y grupos a aplicaciones externas. Si logras **comprometer privilegios de administrador en un entorno de Okta**, es muy probable que puedas **comprometer todas las dem치s plataformas que la empresa est칠 utilizando**.
{% endhint %}

{% hint style="success" %}
Para realizar una revisi칩n de seguridad de un entorno de Okta, debes solicitar acceso de solo lectura de **administrador**.
{% endhint %}

### Resumen

Existen **usuarios** (que pueden estar **almacenados en Okta**, registrados desde **proveedores de identidad** configurados o autenticados a trav칠s de **Active Directory** o LDAP). \
Estos usuarios pueden estar dentro de **grupos**.\
Tambi칠n existen **autenticadores**: diferentes opciones para autenticar como contrase침a y varios m칠todos de autenticaci칩n de dos factores (2FA) como WebAuthn, correo electr칩nico, tel칠fono, Okta Verify (pueden estar habilitados o deshabilitados)...

Luego, hay **aplicaciones** sincronizadas con Okta. Cada aplicaci칩n tendr치 un **mapeo con Okta** para compartir informaci칩n (como direcciones de correo electr칩nico, nombres...). Adem치s, cada aplicaci칩n debe estar dentro de una **Pol칤tica de Autenticaci칩n**, que indica los **autenticadores necesarios** para que un usuario pueda **acceder** a la aplicaci칩n.

{% hint style="danger" %}
El rol m치s poderoso es el de **Super Administrador**.

Si un atacante compromete Okta con acceso de administrador, es muy probable que todas las **aplicaciones que conf칤an en Okta** sean comprometidas.
{% endhint %}

## Ataque de suplantaci칩n de compa침ero

Los **atributos que cada usuario puede tener y modificar** (como correo electr칩nico o nombre) se pueden configurar en Okta. Si una **aplicaci칩n** conf칤a en un **atributo** que el usuario puede **modificar**, podr치 **suplantar a otros usuarios en esa plataforma**.

Por lo tanto, si la aplicaci칩n conf칤a en el campo **`userName`**, probablemente no podr치s cambiarlo (porque generalmente no se puede cambiar ese campo), pero si conf칤a, por ejemplo, en **`primaryEmail`**, es posible que puedas **cambiarlo por la direcci칩n de correo electr칩nico de un compa침ero** y suplantarlo (necesitar치s tener acceso al correo electr칩nico y aceptar el cambio).

Ten en cuenta que esta suplantaci칩n depende de c칩mo se haya configurado cada aplicaci칩n. Solo las que conf칤an en el campo que modificaste y aceptan actualizaciones ser치n comprometidas.\
Por lo tanto, la aplicaci칩n debe tener este campo habilitado si existe:

<figure><img src="../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

Tambi칠n he visto otras aplicaciones que eran vulnerables pero no ten칤an ese campo en la configuraci칩n de Okta (al final, las diferentes aplicaciones se configuran de manera diferente).

춰La mejor manera de averiguar si puedes suplantar a alguien en cada aplicaci칩n es intentarlo!

## Directorio

### Personas

Desde la perspectiva de un atacante, esto es muy interesante, ya que podr치s ver **todos los usuarios registrados**, sus direcciones de **correo electr칩nico**, los **grupos** a los que pertenecen, los **perfiles** e incluso los **dispositivos** (m칩viles junto con sus sistemas operativos).

Para una revisi칩n en modo caja blanca, verifica que no haya varios "**Pending user action**" y "**Password reset**".

### Grupos

Aqu칤 es donde se encuentran todos los grupos creados en Okta. Es interesante comprender los diferentes grupos (conjunto de **permisos**) que se pueden otorgar a los **usuarios**.\
Es posible ver las **personas incluidas en los grupos** y las **aplicaciones asignadas** a cada grupo.

Por supuesto, cualquier grupo con el nombre de **admin** es interesante, especialmente el grupo **Global Administrators**, verifica los miembros para saber qui칠nes son los miembros m치s privilegiados.

Desde una revisi칩n en modo caja blanca, **no deber칤a haber m치s de 5 administradores globales** (mejor si hay solo 2 o 3).

### Dispositivos

Aqu칤 encontrar치s una **lista de todos los dispositivos** de todos los usuarios. Tambi칠n puedes ver si se est치 **gestionando activamente** o no.

### Editor de perfiles

Aqu칤 es posible observar c칩mo se comparten informaci칩n clave como nombres, apellidos, correos electr칩nicos, nombres de usuario, etc. entre Okta y otras aplicaciones. Esto es interesante porque si un usuario puede **modificar en Okta un campo** (como su nombre o correo electr칩nico) que luego es utilizado por una **aplicaci칩n externa** para **identificar** al usuario, un empleado podr칤a intentar **apoderarse de otras cuentas**.

Adem치s, en el perfil **`User (default)`** de Okta puedes ver **qu칠 campos** tiene cada **usuario** y cu치les son **modificables** por los usuarios. Si no puedes ver el panel de administraci칩n, simplemente ve a **actualizar la informaci칩n de tu perfil** y ver치s qu칠 campos puedes actualizar (ten en cuenta que para actualizar una direcci칩n de correo electr칩nico deber치s verificarla).
### Integraciones de directorios

Los directorios te permiten importar personas desde fuentes existentes. Supongo que aqu칤 ver치s los usuarios importados de otros directorios.

No lo he visto, pero supongo que es interesante descubrir **otros directorios que Okta est치 utilizando para importar usuarios**, para poder comprometer ese directorio y establecer algunos valores de atributos en los usuarios creados en Okta y **quiz치s comprometer el entorno de Okta**.

### Fuentes de perfil

Una fuente de perfil es una **aplicaci칩n que act칰a como fuente de verdad** para los atributos del perfil de usuario. Un usuario solo puede tener una 칰nica aplicaci칩n o directorio como fuente a la vez.

No lo he visto, as칤 que cualquier informaci칩n sobre seguridad y hacking relacionada con esta opci칩n es apreciada.

## Personalizaciones

### Marcas

Verifica en la pesta침a **Dominios** de esta secci칩n las direcciones de correo electr칩nico utilizadas para enviar correos electr칩nicos y el dominio personalizado dentro de Okta de la empresa (que probablemente ya conozcas).

Adem치s, en la pesta침a **Configuraci칩n**, si eres administrador, puedes "**Usar una p치gina de cierre de sesi칩n personalizada**" y establecer una URL personalizada.

### SMS

Nada interesante aqu칤.

### Panel de usuario final

Aqu칤 puedes encontrar las aplicaciones configuradas, pero veremos los detalles de estas m치s adelante en una secci칩n diferente.

### Otros

Configuraci칩n interesante, pero nada super interesante desde el punto de vista de la seguridad.

## Aplicaciones

### Aplicaciones

Aqu칤 puedes encontrar todas las **aplicaciones configuradas** y sus detalles: qui칠n tiene acceso a ellas, c칩mo est치 configurado (SAML, OpenID), URL para iniciar sesi칩n, las asignaciones entre Okta y la aplicaci칩n...

En la pesta침a **`Inicio de sesi칩n`** tambi칠n hay un campo llamado **`Revelar contrase침a`** que permitir칤a a un usuario **revelar su contrase침a** al verificar la configuraci칩n de la aplicaci칩n. Para verificar la configuraci칩n de una aplicaci칩n desde el Panel de Usuario, haz clic en los 3 puntos:

<figure><img src="../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

Y podr칤as ver m치s detalles sobre la aplicaci칩n (como la funci칩n de revelar contrase침a, si est치 habilitada):

<figure><img src="../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## Gobierno de identidad

### Certificaciones de acceso

Utiliza las Certificaciones de acceso para crear campa침as de auditor칤a para revisar peri칩dicamente el acceso de tus usuarios a los recursos y aprobar o revocar el acceso autom치ticamente cuando sea necesario.

No lo he visto utilizado, pero supongo que desde un punto de vista defensivo es una caracter칤stica interesante.

## Seguridad

### General

* **Correos electr칩nicos de notificaci칩n de seguridad**: Todos deber칤an estar habilitados.
* **Integraci칩n de CAPTCHA**: Se recomienda configurar al menos el reCaptcha invisible.
* **Seguridad de la organizaci칩n**: Todo se puede habilitar y los correos electr칩nicos de activaci칩n no deber칤an durar mucho tiempo (7 d칤as est치 bien).
* **Prevenci칩n de enumeraci칩n de usuarios**: Ambos deben estar habilitados.
* Ten en cuenta que la prevenci칩n de enumeraci칩n de usuarios no tiene efecto si se permiten alguna de las siguientes condiciones (consultar [Gesti칩n de usuarios](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) para obtener m치s informaci칩n):
* Registro de autoservicio
* Flujos JIT con autenticaci칩n por correo electr칩nico
* **Configuraci칩n de Okta ThreatInsight**: Registrar y hacer cumplir la seguridad en funci칩n del nivel de amenaza.

### HealthInsight

Aqu칤 es posible encontrar configuraciones correctamente y **peligrosas**.

### Autenticadores

Aqu칤 puedes encontrar todos los m칠todos de autenticaci칩n que un usuario podr칤a usar: contrase침a, tel칠fono, correo electr칩nico, c칩digo, WebAuthn... Al hacer clic en el autenticador de contrase침a, puedes ver la **pol칤tica de contrase침as**. Verifica que sea fuerte.

En la pesta침a **Inscripci칩n** puedes ver cu치les son los que son requeridos u opcionales:

<figure><img src="../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

Se recomienda desactivar el tel칠fono. Los m치s fuertes probablemente sean una combinaci칩n de contrase침a, correo electr칩nico y WebAuthn.

### Pol칤ticas de autenticaci칩n

Cada aplicaci칩n tiene una pol칤tica de autenticaci칩n. La pol칤tica de autenticaci칩n verifica que los usuarios que intentan iniciar sesi칩n en la aplicaci칩n cumplan con condiciones espec칤ficas y aplica requisitos de factor basados en esas condiciones.

Aqu칤 puedes encontrar los **requisitos para acceder a cada aplicaci칩n**. Se recomienda solicitar al menos una contrase침a y otro m칠todo para cada aplicaci칩n. Pero si como atacante encuentras algo m치s d칠bil, podr칤as intentar atacarlo.

### Pol칤tica global de sesiones

Aqu칤 puedes encontrar las pol칤ticas de sesi칩n asignadas a diferentes grupos. Por ejemplo:

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

Se recomienda solicitar MFA, limitar la duraci칩n de la sesi칩n a algunas horas, no persistir las cookies de sesi칩n en extensiones del navegador y limitar la ubicaci칩n y el proveedor de identidad (si esto es posible). Por ejemplo, si todos los usuarios deben iniciar sesi칩n desde un pa칤s espec칤fico, solo puedes permitir esta ubicaci칩n.

### Proveedores de identidad

Los proveedores de identidad (IdP) son servicios que **gestionan cuentas de usuario**. Agregar IdP en Okta permite que tus usuarios finales se **autoregistren** con tus aplicaciones personalizadas autentic치ndose primero con una cuenta social o una tarjeta inteligente.

En la p치gina de Proveedores de identidad, puedes agregar inicio de sesi칩n social (IdP) y configurar Okta como un proveedor de servicios (SP) agregando SAML entrante. Despu칠s de agregar IdP, puedes configurar reglas de enrutamiento para dirigir a los usuarios a un IdP seg칰n el contexto, como la ubicaci칩n del usuario, el dispositivo o el dominio de correo electr칩nico.

**Si se configura alg칰n proveedor de identidad** desde el punto de vista de un atacante y un defensor, verifica esa configuraci칩n y **si la fuente es realmente confiable**, ya que un atacante que comprometa tambi칠n podr칤a obtener acceso al entorno de Okta.

### Autenticaci칩n delegada

La autenticaci칩n delegada permite a los usuarios iniciar sesi칩n en Okta ingresando las credenciales de su servidor de **Active Directory (AD) o LDAP** de la organizaci칩n.

Nuevamente, verifica esto, ya que un atacante que comprometa el AD de una organizaci칩n podr칤a ser capaz de pivotar a Okta gracias a esta configuraci칩n.

### Red

Una zona de red es un l칤mite configurable que puedes usar para **conceder o restringir el acceso a computadoras y dispositivos** en tu organizaci칩n seg칰n la **direcci칩n IP** que solicita el acceso. Puedes definir una zona de red especificando una o m치s direcciones IP individuales, rangos de direcciones IP o ubicaciones geogr치ficas.

Despu칠s de definir una o m치s zonas de red, puedes **utilizarlas en las pol칤ticas globales de sesi칩n**, las pol칤ticas de autenticaci칩n, las notificaciones de VPN y las reglas de enrutamiento.

Desde la perspectiva de un atacante, es interesante saber qu칠 IPs est치n permitidas (y verificar si alguna **IP tiene m치s privilegios** que otras). Desde la perspectiva de un atacante, si se supone que los usuarios deben acceder desde una direcci칩n IP o regi칩n espec칤fica, verifica que esta funci칩n se utilice correctamente.

### Integraciones de dispositivos

* **Gesti칩n de puntos finales**: La gesti칩n de puntos finales es una condici칩n que se puede aplicar en una pol칤tica de autenticaci칩n para garantizar que los dispositivos administrados tengan acceso a una aplicaci칩n.
* A칰n no lo he visto utilizado. POR HACER
* **Servicios de notificaci칩n**: A칰n no lo he visto utilizado. POR HACER
### API

Puedes crear tokens de API de Okta en esta p치gina y ver los que han sido **creados**, sus **privilegios**, tiempo de **expiraci칩n** y **URLs de origen**. Ten en cuenta que los tokens de API se generan con los permisos del usuario que cre칩 el token y solo son v치lidos si el **usuario** que los cre칩 est치 **activo**.

Los **Or칤genes de confianza** otorgan acceso a sitios web que controlas y en los que conf칤as para acceder a tu organizaci칩n de Okta a trav칠s de la API de Okta.

No deber칤a haber muchos tokens de API, ya que si hay muchos, un atacante podr칤a intentar acceder y utilizarlos.

## Flujo de trabajo

### Automatizaciones

Las automatizaciones te permiten crear acciones automatizadas que se ejecutan en funci칩n de un conjunto de condiciones de activaci칩n que ocurren durante el ciclo de vida de los usuarios finales.

Por ejemplo, una condici칩n podr칤a ser "Inactividad del usuario en Okta" o "Caducidad de la contrase침a del usuario en Okta" y la acci칩n podr칤a ser "Enviar un correo electr칩nico al usuario" o "Cambiar el estado del ciclo de vida del usuario en Okta".

## Informes

### Informes

Descarga registros. Se **env칤an** a la **direcci칩n de correo electr칩nico** de la cuenta actual.

### Registro del sistema

Aqu칤 puedes encontrar los **registros de las acciones realizadas por los usuarios** con muchos detalles, como inicio de sesi칩n en Okta o en aplicaciones a trav칠s de Okta.

### Monitoreo de importaci칩n

Esto puede **importar registros de otras plataformas** a las que se accede con Okta.

### L칤mites de velocidad

Verifica los l칤mites de velocidad de la API alcanzados.

## Configuraci칩n

### Cuenta

Aqu칤 puedes encontrar **informaci칩n gen칠rica** sobre el entorno de Okta, como el nombre de la empresa, la direcci칩n, el **contacto de facturaci칩n por correo electr칩nico**, el **contacto t칠cnico por correo electr칩nico** y tambi칠n qui칠n debe recibir las actualizaciones de Okta y qu칠 tipo de actualizaciones de Okta.

### Descargas

Aqu칤 puedes descargar agentes de Okta para sincronizar Okta con otras tecnolog칤as.

<details>

<summary><strong>춰Apoya a HackTricks y obt칠n beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **칰ltima versi칩n de PEASS o descargar HackTricks en PDF**, 춰consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s칤gueme** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
