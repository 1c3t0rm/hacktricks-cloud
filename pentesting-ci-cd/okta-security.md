# S√©curit√© d'Okta

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez** üí¨ [**le groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informations de base

Okta, Inc. est une entreprise de **gestion des identit√©s et des acc√®s** qui fournit des logiciels cloud pour aider les entreprises √† **g√©rer et s√©curiser l'authentification des utilisateurs dans les applications modernes**, et pour les d√©veloppeurs √† int√©grer des contr√¥les d'identit√© dans les applications, les services web et les appareils.

Leur service principal, appel√© Okta Identity Cloud, propose des produits tels que la connexion unique (SSO), l'authentification multi-facteurs (MFA), la gestion du cycle de vie, l'annuaire universel, la gestion de l'acc√®s aux API, et plus encore. Cela permet aux entreprises de prot√©ger leurs donn√©es sensibles et de faciliter l'acc√®s des utilisateurs, rendant les applications et les services plus accessibles et faciles √† utiliser pour les employ√©s ou les clients.

Les services d'Okta sont largement utilis√©s dans les contextes d'entreprise, ainsi que par des petites entreprises et des d√©veloppeurs. Elle joue un r√¥le crucial dans la possibilit√© pour les entreprises d'adopter et de g√©rer de mani√®re s√©curis√©e les technologies cloud. √Ä ma connaissance en septembre 2021, Okta reste un acteur important de l'industrie de la gestion des identit√©s et des acc√®s (IAM).

{% hint style="danger" %}
L'objectif principal d'Okta est de configurer l'acc√®s √† diff√©rentes applications externes pour les utilisateurs et les groupes. Si vous parvenez √† **compromettre les privil√®ges d'administrateur dans un environnement Okta**, vous pourrez tr√®s probablement **compromettre toutes les autres plateformes utilis√©es par l'entreprise**.
{% endhint %}

{% hint style="success" %}
Pour effectuer une analyse de s√©curit√© d'un environnement Okta, vous devriez demander un **acc√®s en lecture seule en tant qu'administrateur**.
{% endhint %}

### R√©sum√©

Il y a des **utilisateurs** (qui peuvent √™tre **stock√©s dans Okta**, connect√©s √† partir de **fournisseurs d'identit√©** configur√©s ou authentifi√©s via **Active Directory** ou LDAP). \
Ces utilisateurs peuvent √™tre regroup√©s dans des **groupes**.\
Il y a aussi des **authentificateurs** : diff√©rentes options d'authentification comme le mot de passe, et plusieurs 2FA comme WebAuthn, e-mail, t√©l√©phone, Okta Verify (ils peuvent √™tre activ√©s ou d√©sactiv√©s)...

Ensuite, il y a des **applications** synchronis√©es avec Okta. Chaque application aura une **correspondance avec Okta** pour partager des informations (telles que les adresses e-mail, les pr√©noms...). De plus, chaque application doit √™tre incluse dans une **politique d'authentification**, qui indique les **authentificateurs n√©cessaires** pour qu'un utilisateur puisse **acc√©der** √† l'application.

{% hint style="danger" %}
Le r√¥le le plus puissant est celui de **Super Administrateur**.

Si un attaquant compromet Okta avec un acc√®s administrateur, toutes les **applications faisant confiance √† Okta** seront tr√®s probablement **compromises**.
{% endhint %}

## Attaque d'usurpation de coll√®gue

Les **attributs que chaque utilisateur peut avoir et modifier** (comme l'e-mail ou le pr√©nom) peuvent √™tre configur√©s dans Okta. Si une **application** utilise comme ID un **attribut** que l'utilisateur peut **modifier**, il pourra **usurper l'identit√© d'autres utilisateurs sur cette plateforme**.

Par cons√©quent, si l'application utilise le champ **`userName`**, vous ne pourrez probablement pas le modifier (car vous ne pouvez g√©n√©ralement pas modifier ce champ), mais si elle utilise par exemple **`primaryEmail`**, vous pourrez peut-√™tre le **modifier avec l'adresse e-mail d'un coll√®gue** et usurper son identit√© (vous devrez avoir acc√®s √† l'e-mail et accepter la modification).

Notez que cette usurpation d√©pend de la configuration de chaque application. Seules celles qui font confiance au champ que vous avez modifi√© et qui acceptent les mises √† jour seront compromises.\
Par cons√©quent, l'application devrait avoir ce champ activ√© s'il existe :

<figure><img src="../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

J'ai √©galement vu d'autres applications qui √©taient vuln√©rables mais qui n'avaient pas ce champ dans les param√®tres d'Okta (au final, les diff√©rentes applications sont configur√©es diff√©remment).

La meilleure fa√ßon de savoir si vous pouvez usurper l'identit√© de quelqu'un sur chaque application serait de l'essayer !

## R√©pertoire

### Personnes

Du point de vue d'un attaquant, cela est tr√®s int√©ressant car vous pourrez voir **tous les utilisateurs enregistr√©s**, leurs adresses e-mail, les **groupes** auxquels ils appartiennent, les **profils** et m√™me les **appareils** (t√©l√©phones mobiles avec leurs syst√®mes d'exploitation).

Pour une revue en bo√Æte blanche, v√©rifiez qu'il n'y a pas plusieurs "**Actions utilisateur en attente**" et "**R√©initialisation de mot de passe**".

### Groupes

C'est ici que vous trouverez tous les groupes cr√©√©s dans Okta. Il est int√©ressant de comprendre les diff√©rents groupes (ensemble de **permissions**) qui peuvent √™tre accord√©s aux **utilisateurs**.\
Il est possible de voir les **personnes incluses dans les groupes** et les **applications attribu√©es** √† chaque groupe.

Bien s√ªr, tout groupe portant le nom d'**admin** est int√©ressant, en particulier le groupe **Administrateurs globaux**, v√©rifiez les membres pour savoir qui sont les membres les plus privil√©gi√©s.

Dans le cadre d'une revue en bo√Æte blanche, il **ne devrait pas y avoir plus de 5 administrateurs globaux** (il est pr√©f√©rable qu'il n'y en ait que 2 ou 3).

### Appareils

Trouvez ici une **liste de tous les appareils** de tous les utilisateurs. Vous pouvez √©galement voir s'ils sont **g√©r√©s activement** ou non.

### √âditeur de profil

Ici, il est possible d'observer comment les informations cl√©s telles que les pr√©noms, les noms de famille, les adresses e-mail, les noms d'utilisateur... sont partag√©es entre Okta et d'autres applications. C'est int√©ressant car si un utilisateur peut **modifier dans Okta un champ** (comme son nom ou son e-mail) qui est ensuite utilis√© par une **application externe** pour **identifier** l'utilisateur, un employ√© malveillant pourrait essayer de **prendre le contr√¥le d'autres comptes**.

De plus, dans le profil **`Utilisateur (par d√©faut)`** d'Okta, vous pouvez voir **quels champs** chaque **utilisateur** poss√®de et lesquels peuvent √™tre **modifi√©s** par les utilisateurs. Si vous ne pouvez pas voir le panneau d'administration, allez simplement **mettre √† jour vos informations de profil** et vous verrez quels champs vous pouvez mettre √† jour (notez que pour mettre √† jour une adresse e-mail, vous devrez la v√©rifier).
### Int√©grations de r√©pertoires

Les r√©pertoires vous permettent d'importer des personnes √† partir de sources existantes. Je suppose qu'ici vous verrez les utilisateurs import√©s √† partir d'autres r√©pertoires.

Je ne l'ai pas vu, mais je suppose que c'est int√©ressant de d√©couvrir **les autres r√©pertoires qu'Okta utilise pour importer des utilisateurs** afin que si vous **compromettez ce r√©pertoire**, vous pourriez d√©finir certaines valeurs d'attributs dans les utilisateurs cr√©√©s dans Okta et **peut-√™tre compromettre l'environnement Okta**.

### Sources de profil

Une source de profil est une **application qui agit comme une source de v√©rit√©** pour les attributs de profil utilisateur. Un utilisateur ne peut √™tre sourc√© que par une seule application ou un seul r√©pertoire √† la fois.

Je ne l'ai pas vu, donc toute information sur la s√©curit√© et le piratage concernant cette option est appr√©ci√©e.

## Personnalisations

### Marques

V√©rifiez dans l'onglet **Domaines** de cette section les adresses e-mail utilis√©es pour envoyer des e-mails et le domaine personnalis√© √† l'int√©rieur d'Okta de l'entreprise (que vous connaissez probablement d√©j√†).

De plus, dans l'onglet **Param√®tres**, si vous √™tes administrateur, vous pouvez "**Utiliser une page de d√©connexion personnalis√©e**" et d√©finir une URL personnalis√©e.

### SMS

Rien d'int√©ressant ici.

### Tableau de bord utilisateur final

Vous pouvez trouver ici les applications configur√©es, mais nous verrons les d√©tails de celles-ci plus tard dans une section diff√©rente.

### Autres

Param√®tre int√©ressant, mais rien de super int√©ressant d'un point de vue s√©curit√©.

## Applications

### Applications

Ici, vous pouvez trouver toutes les **applications configur√©es** et leurs d√©tails : Qui y a acc√®s, comment est-elle configur√©e (SAML, OpenID), URL de connexion, les correspondances entre Okta et l'application...

Dans l'onglet **`Connexion`**, il y a √©galement un champ appel√© **`R√©v√©lation du mot de passe`** qui permettrait √† un utilisateur de **r√©v√©ler son mot de passe** lors de la v√©rification des param√®tres de l'application. Pour v√©rifier les param√®tres d'une application √† partir du panneau utilisateur, cliquez sur les 3 points :

<figure><img src="../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

Et vous pourriez voir plus de d√©tails sur l'application (comme la fonction de r√©v√©lation du mot de passe, si elle est activ√©e) :

<figure><img src="../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## Gouvernance de l'identit√©

### Certifications d'acc√®s

Utilisez les certifications d'acc√®s pour cr√©er des campagnes d'audit afin de revoir p√©riodiquement l'acc√®s de vos utilisateurs aux ressources et d'approuver ou de r√©voquer automatiquement l'acc√®s lorsque cela est n√©cessaire.

Je ne l'ai pas vu utilis√©, mais je suppose que d'un point de vue d√©fensif, c'est une fonctionnalit√© int√©ressante.

## S√©curit√©

### G√©n√©ral

* **E-mails de notification de s√©curit√©** : Tout devrait √™tre activ√©.
* **Int√©gration CAPTCHA** : Il est recommand√© de d√©finir au moins le reCaptcha invisible.
* **S√©curit√© de l'organisation** : Tout peut √™tre activ√© et les e-mails d'activation ne devraient pas durer longtemps (7 jours, c'est bien).
* **Pr√©vention de l'√©num√©ration des utilisateurs** : Les deux devraient √™tre activ√©s.
* Notez que la pr√©vention de l'√©num√©ration des utilisateurs n'a pas d'effet si l'une des conditions suivantes est autoris√©e (voir [Gestion des utilisateurs](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) pour plus d'informations) :
* Inscription en libre-service
* Flux JIT avec authentification par e-mail
* **Param√®tres Okta ThreatInsight** : Journaliser et appliquer la s√©curit√© en fonction du niveau de menace.

### HealthInsight

Ici, il est possible de trouver des **param√®tres** correctement et **dangereusement** configur√©s.

### Authentificateurs

Vous pouvez trouver ici toutes les m√©thodes d'authentification qu'un utilisateur peut utiliser : Mot de passe, t√©l√©phone, e-mail, code, WebAuthn... En cliquant sur l'authentificateur de mot de passe, vous pouvez voir la **politique de mot de passe**. V√©rifiez qu'elle est solide.

Dans l'onglet **Inscription**, vous pouvez voir celles qui sont obligatoires ou facultatives :

<figure><img src="../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

Il est recommand√© de d√©sactiver le t√©l√©phone. Les plus solides sont probablement une combinaison de mot de passe, d'e-mail et de WebAuthn.

### Politiques d'authentification

Chaque application a une politique d'authentification. La politique d'authentification v√©rifie que les utilisateurs qui tentent de se connecter √† l'application remplissent des conditions sp√©cifiques et impose des exigences de facteur en fonction de ces conditions.

Ici, vous pouvez trouver les **exigences pour acc√©der √† chaque application**. Il est recommand√© de demander au moins un mot de passe et une autre m√©thode pour chaque application. Mais si en tant qu'attaquant vous trouvez quelque chose de plus faible, vous pourriez √™tre en mesure de l'attaquer.

### Politique de session globale

Ici, vous pouvez trouver les politiques de session attribu√©es √† diff√©rents groupes. Par exemple :

<figure><img src="../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

Il est recommand√© de demander une authentification multifacteur (MFA), de limiter la dur√©e de la session √† quelques heures, de ne pas persister les cookies de session dans les extensions de navigateur et de limiter l'emplacement et le fournisseur d'identit√© (si cela est possible). Par exemple, si chaque utilisateur doit se connecter depuis un pays sp√©cifique, vous pouvez uniquement autoriser cet emplacement.

### Fournisseurs d'identit√©

Les fournisseurs d'identit√© (IdP) sont des services qui **g√®rent les comptes utilisateur**. L'ajout de fournisseurs d'identit√© dans Okta permet √† vos utilisateurs finaux de **s'inscrire eux-m√™mes** avec vos applications personnalis√©es en s'authentifiant d'abord avec un compte social ou une carte √† puce.

Sur la page des fournisseurs d'identit√©, vous pouvez ajouter des connexions sociales (IdP) et configurer Okta en tant que fournisseur de services (SP) en ajoutant du SAML entrant. Apr√®s avoir ajout√© des IdP, vous pouvez configurer des r√®gles de routage pour diriger les utilisateurs vers un IdP en fonction du contexte, tel que l'emplacement de l'utilisateur, l'appareil ou le domaine de messagerie.

**Si un fournisseur d'identit√© est configur√©**, du point de vue des attaquants et des d√©fenseurs, v√©rifiez cette configuration et **si la source est vraiment digne de confiance**, car un attaquant qui compromettrait cette source pourrait √©galement acc√©der √† l'environnement Okta.

### Authentification d√©l√©gu√©e

L'authentification d√©l√©gu√©e permet aux utilisateurs de se connecter √† Okta en entrant des informations d'identification pour le serveur **Active Directory (AD) ou LDAP** de leur organisation.

Encore une fois, v√©rifiez cela, car un attaquant qui compromettrait l'AD d'une organisation pourrait √™tre en mesure de pivoter vers Okta gr√¢ce √† ce param√®tre.

### R√©seau

Une zone r√©seau est une limite configurable que vous pouvez utiliser pour **accorder ou restreindre l'acc√®s aux ordinateurs et aux appareils** de votre organisation en fonction de l'**adresse IP** qui demande l'acc√®s. Vous pouvez d√©finir une zone r√©seau en sp√©cifiant une ou plusieurs adresses IP individuelles, des plages d'adresses IP ou des emplacements g√©ographiques.

Apr√®s avoir d√©fini une ou plusieurs zones r√©seau, vous pouvez les **utiliser dans les politiques de session globales**, les politiques d'authentification, les notifications VPN et les r√®gles de routage.

D'un point de vue des attaquants, il est int√©ressant de savoir quels fournisseurs d'identit√© sont autoris√©s (et v√©rifier si certaines **adresses IP sont plus privil√©gi√©es** que d'autres). D'un point de vue des attaquants, si les utilisateurs doivent acc√©der depuis une adresse IP ou une r√©gion sp√©cifique, v√©rifiez que cette fonctionnalit√© est utilis√©e correctement.

### Int√©grations de p√©riph√©riques

* **Gestion des terminaux** : La gestion des terminaux est une condition qui peut √™tre appliqu√©e dans une politique d'authentification pour garantir que les appareils g√©r√©s ont acc√®s √† une application.
* Je ne l'ai pas encore vu utilis√©. √Ä FAIRE
* **Services de notification** : Je ne l'ai pas encore vu utilis√©. √Ä FAIRE
### API

Vous pouvez cr√©er des jetons API Okta sur cette page et voir ceux qui ont √©t√© **cr√©√©s**, leurs **privil√®ges**, leur **expiration** et leurs **URL d'origine**. Notez que les jetons API sont g√©n√©r√©s avec les permissions de l'utilisateur qui les a cr√©√©s et ne sont valides que si l'utilisateur qui les a cr√©√©s est **actif**.

Les **Origines de confiance** accordent l'acc√®s aux sites Web que vous contr√¥lez et en lesquels vous avez confiance pour acc√©der √† votre organisation Okta via l'API Okta.

Il ne devrait pas y avoir beaucoup de jetons API, car si c'est le cas, un attaquant pourrait essayer de les acc√©der et de les utiliser.

## Flux de travail

### Automatisations

Les automatisations vous permettent de cr√©er des actions automatis√©es qui s'ex√©cutent en fonction d'un ensemble de conditions de d√©clenchement qui se produisent pendant le cycle de vie des utilisateurs finaux.

Par exemple, une condition pourrait √™tre "Inactivit√© de l'utilisateur dans Okta" ou "Expiration du mot de passe de l'utilisateur dans Okta" et l'action pourrait √™tre "Envoyer un e-mail √† l'utilisateur" ou "Changer l'√©tat du cycle de vie de l'utilisateur dans Okta".

## Rapports

### Rapports

T√©l√©chargez les journaux. Ils sont **envoy√©s** √† l'**adresse e-mail** du compte actuel.

### Journal syst√®me

Ici, vous pouvez trouver les **journaux des actions effectu√©es par les utilisateurs** avec de nombreux d√©tails tels que la connexion √† Okta ou aux applications via Okta.

### Surveillance des importations

Cela peut **importer des journaux des autres plateformes** auxquelles on acc√®de avec Okta.

### Limites de taux

V√©rifiez les limites de taux d'API atteintes.

## Param√®tres

### Compte

Ici, vous pouvez trouver des **informations g√©n√©riques** sur l'environnement Okta, telles que le nom de l'entreprise, l'adresse, le **contact de facturation par e-mail**, le **contact technique par e-mail** et √©galement qui doit recevoir les mises √† jour Okta et quel type de mises √† jour Okta.

### T√©l√©chargements

Ici, vous pouvez t√©l√©charger les agents Okta pour synchroniser Okta avec d'autres technologies.

<details>

<summary><strong>Soutenez HackTricks et b√©n√©ficiez d'avantages !</strong></summary>

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou si vous souhaitez acc√©der √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **d√©p√¥ts GitHub**.

</details>
