# Gh Actions - Inyecciones de Script

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver a tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop).
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm).

* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>

## Información básica

Ten en cuenta que hay ciertos [**contextos de github**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) cuyos valores son **controlados** por el **usuario** que crea la PR. Si la acción de github está utilizando esos **datos para ejecutar cualquier cosa**, podría llevar a una **ejecución de código arbitrario**. Estos contextos suelen terminar con `body`, `default_branch`, `email`, `head_ref`, `label`, `message`, `name`, `page_name`,`ref` y `title`. Por ejemplo (lista de este [**artículo**](https://medium.com/tinder/exploiting-github-actions-on-open-source-projects-5d93936d189f)):

* github.event.comment.body
* github.event.issue.body
* github.event.issue.title
* github.head\_ref
* github.pull\_request.\*
* github.\*.\*.authors.name
* github.\*.\*.authors.email

Ten en cuenta que hay **fuentes menos obvias** de entrada potencialmente no confiable, como los nombres de las ramas y las direcciones de correo electrónico, que pueden ser **bastante flexibles en cuanto a su contenido permitido**. Por ejemplo, `zzz";echo${IFS}"hello";#` sería un nombre de rama válido y podría ser un posible vector de ataque para un repositorio objetivo.

### Ejemplo de un ataque de inyección de script <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

Un ataque de inyección de script puede ocurrir directamente dentro del script en línea de un flujo de trabajo. En el siguiente ejemplo, una acción utiliza una **expresión para probar la validez del título de una pull request**, pero también agrega el riesgo de inyección de script:
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
Antes de que se ejecute el script de shell, las expresiones dentro de `${{ }}` se **evalúan** y luego se sustituyen por los valores resultantes, lo que puede hacerlo **vulnerable a la inyección de comandos de shell**.

Para inyectar comandos en este flujo de trabajo, el atacante podría crear una solicitud de extracción con un título de **`a"; ls $GITHUB_WORKSPACE"`**

En este ejemplo, el carácter **`"`** se utiliza para interrumpir la declaración `title=`**`"${{ github.event.pull_request.title }}"`**, lo que permite que se ejecute el comando `ls` en el runner.

<details>

<summary><strong>¡Apoya a HackTricks y obtén beneficios!</strong></summary>

* Si quieres ver tu **empresa anunciada en HackTricks** o si quieres acceder a la **última versión de PEASS o descargar HackTricks en PDF**, ¡consulta los [**PLANES DE SUSCRIPCIÓN**](https://github.com/sponsors/carlospolop)!
* Obtén el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colección exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Únete al** 💬 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **sígueme** en **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
