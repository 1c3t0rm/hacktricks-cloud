# Gh Actions - スクリプトインジェクション

<details>

<summary><strong>HackTricksをサポートして特典を受け取ろう！</strong></summary>

* **HackTricksで会社を宣伝したい**場合や、**最新バージョンのPEASSやHackTricksのPDFをダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れよう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを楽しもう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローしましょう 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)
* **ハッキングのテクニックを共有するために、PRを** [**HackTricks**](https://github.com/carlospolop/hacktricks) **と** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **のGitHubリポジトリに提出してください。**

</details>

## 基本情報

注意：[**githubのコンテキスト**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context)には、PRを作成する**ユーザーが制御する**値があることに注意してください。GitHubアクションがそのデータを使用して**何かを実行する場合**、任意のコードの実行につながる可能性があります。これらのコンテキストは通常、`body`、`default_branch`、`email`、`head_ref`、`label`、`message`、`name`、`page_name`、`ref`、`title`で終わります。例えば（この[**記事**](https://medium.com/tinder/exploiting-github-actions-on-open-source-projects-5d93936d189f)からのリスト）：

* github.event.comment.body
* github.event.issue.body
* github.event.issue.title
* github.head\_ref
* github.pull\_request.\*
* github.\*.\*.authors.name
* github.\*.\*.authors.email

また、ブランチ名やメールアドレスなど、**明らかでない潜在的な信頼できない入力元**もあります。これらは、許可される内容に関しては**非常に柔軟**です。例えば、`zzz";echo${IFS}"hello";#`は有効なブランチ名であり、対象リポジトリの攻撃ベクトルとなり得ます。

### スクリプトインジェクション攻撃の例 <a href="#example-of-a-script-injection-attack" id="example-of-a-script-injection-attack"></a>

スクリプトインジェクション攻撃は、ワークフローのインラインスクリプト内で直接発生することがあります。次の例では、アクションが**プルリクエストのタイトルの妥当性をテストするための式**を使用していますが、スクリプトインジェクションのリスクも追加されています：
```yaml
- name: Check PR title
run: |
title="${{ github.event.pull_request.title }}"
if [[ $title =~ ^octocat ]]; then
echo "PR title starts with 'octocat'"
exit 0
else
echo "PR title did not start with 'octocat'"
exit 1
fi
```
シェルスクリプトが実行される前に、`${{ }}` 内の式が**評価**され、その結果の値で置換されます。これにより、シェルコマンドインジェクションの**脆弱性が生じる可能性があります**。

攻撃者は、このワークフローに対して、タイトルが**`a"; ls $GITHUB_WORKSPACE"`**となるプルリクエストを作成することで、コマンドを注入することができます。

この例では、**`"`**文字が`title=`**`"${{ github.event.pull_request.title }}"`**ステートメントを中断するために使用され、`ls`コマンドがランナー上で実行されます。

<details>

<summary><strong>Support HackTricks and get benefits!</strong></summary>

* もしもあなたの**会社をHackTricksで宣伝したい**場合や、**PEASSの最新バージョンにアクセスしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を見つけて、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを発見しましょう
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**Telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォロー**してください。
* **HackTricks**と**HackTricks Cloud**のGitHubリポジトリに対して、PRを提出することで、あなたのハッキングトリックを共有してください。

</details>
