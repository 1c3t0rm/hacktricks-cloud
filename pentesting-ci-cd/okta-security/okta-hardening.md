# Okta Hardening

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Directory

### People

From an attackers perspective, this is super interesting as you will be able to see **all the users registered**, their **email** addresses, the **groups** they are part of, **profiles** and even **devices** (mobiles along with their OSs).

For a whitebox review check that there aren't several "**Pending user action**" and "**Password reset**".

### Groups

This is where you find all the created groups in Okta. it's interesting to understand the different groups (set of **permissions**) that could be granted to **users**.\
It's possible to see the **people included inside groups** and **apps assigned** to each group.

Ofc, any group with the name of **admin** is interesting, specially the group **Global Administrators,** check the members to learn who are the most privileged members.

From a whitebox review, there **shouldn't be more than 5 global admins** (better if there are only 2 or 3).

### Devices

Find here a **list of all the devices** of all the users. You can also see if it's being **actively managed** or not.

### Profile Editor

Here is possible to observe how key information such as first names, last names, emails, usernames... are shared between Okta and other applications. This is interesting because if a user can **modify in Okta a field** (such as his name or email) that then is used by an **external application** to **identify** the user, an insider could try to **take over other accounts**.

Moreover, in the profile **`User (default)`** from Okta you can see **which fields** each **user** has and which ones are **writable** by users. If you cannot see the admin panel, just go to **update your profile** information and you will see which fields you can update (note that to update an email address you will need to verify it).

### Directory Integrations

Directories allow you to import people from existing sources. I guess here you will see the users imported from other directories.

I haven't seen it, but I guess this is interesting to find out **other directories that Okta is using to import users** so if you **compromise that directory** you could set some attributes values in the users created in Okta and **maybe compromise the Okta env**.

### Profile Sources

A profile source is an **application that acts as a source of truth** for user profile attributes. A user can only be sourced by a single application or directory at a time.

I haven't seen it, so any information about security and hacking regarding this option is appreciated.

## Customizations

### Brands

Check in the **Domains** tab of this section the email addresses used to send emails and the custom domain inside Okta of the company (which you probably already know).

Moreover, in the **Setting** tab, if you are admin, you can "**Use a custom sign-out page**" and set a custom URL.

### SMS

Nothing interesting here.

### End-User Dashboard

You can find here applications configured, but we will see the details of those later in a different section.

### Other

Interesting setting, but nothing super interesting from a security point of view.

## Applications

### Applications

Here you can find all the **configured applications** and their details: Who has access to them, how is it configured (SAML, OPenID), URL to login, the mappings between Okta and the application...

In the **`Sign On`** tab there is also a field called **`Password reveal`** that would allow a user to **reveal his password** when checking the application settings. To check the settings of an application from the User Panel, click the 3 dots:

<figure><img src="../../.gitbook/assets/image (4) (7).png" alt=""><figcaption></figcaption></figure>

And you could see some more details about the app (like the password reveal feature, if it's enabled):

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## Identity Governance

### Access Certifications

Use Access Certifications to create audit campaigns to review your users' access to resources periodically and approve or revoke access automatically when required.

I haven't seen it used, but I guess that from a defensive point of view it's a nice feature.

## Security

### General

* **Security notification emails**: All should be enabled.
* **CAPTCHA integration**: It's recommended to set at least the invisible reCaptcha
* **Organization Security**: Everything can be enabled and activation emails shouldn't last long (7 days is ok)
* **User enumeration prevention**: Both should be enabled
* Note that User Enumeration Prevention doesn't take effect if either of the following conditions are allowed (See [User management](https://help.okta.com/oie/en-us/Content/Topics/users-groups-profiles/usgp-main.htm) for more information):
* Self-Service Registration
* JIT flows with email authentication
* **Okta ThreatInsight settings**: Log and enforce security based on threat level

### HealthInsight

Here is possible to find correctly and **dangerous** configured **settings**.

### Authenticators

Here you can find all the authentication methods that a user could use: Password, phone, email, code, WebAuthn... Clicking in the Password authenticator you can see the **password policy**. Check that it's strong.

In the **Enrollment** tab you can see how the ones that are required or optinal:

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

It's recommendatble to disable Phone. The strongest ones are probably a combination of password, email and WebAuthn.

### Authentication policies

Every app has an authentication policy. The authentication policy verifies that users who try to sign in to the app meet specific conditions, and it enforces factor requirements based on those conditions.

Here you can find the **requirements to access each application**. It's recommended to request at least password and another method for each application. But if as attacker you find something more weak you might be able to attack it.
### Global Session Policy

**Qa'pla'!** QaH jatlhpu' ghotpu' ghom policies. **Qapla'!**

<figure><img src="../../.gitbook/assets/image (2) (1) (2).png" alt=""><figcaption></figcaption></figure>

**MFA** yIlo'lu', **session lifetime** jajvam vItlhutlh, **session cookies** browser extensions vItlhutlh, **location** je **Identity Provider** (ghaH 'oH possible) vItlhutlh. **Qapla'!** 'oH, user qaStaHvIS country login vItlhutlh.

### Identity Providers

Identity Providers (IdPs) **user accounts** **manage**. Okta vItlhutlh IdPs **add** 'ej **self-register** **end users** **custom applications** **authenticate** social account 'ej smart card.

Identity Providers page, social logins (IdPs) **add** 'ej Okta **service provider** (SP) **configure** **inbound SAML**. IdPs **add** vItlhutlh, routing rules **set up** users **direct** IdP based on context, **user's location**, **device**, 'ej **email domain**.

**Identity provider** configured **ghaH** **attackers** 'ej **defender** **check** configuration **source** **trustable**. 'ach attacker compromising Okta environment **access** **get**.

### Delegated Authentication

Delegated authentication **Okta** **sign in** **users** **entering credentials** **organization's Active Directory (AD) or LDAP** server.

**Recheck** 'oH, attacker compromising organization's AD **pivot** Okta **thanks** setting.

### Network

**Network zone** configurable boundary **grant** 'ej **restrict access** computers 'ej devices **organization** **IP address** **requesting access**. Network zone **define** IP addresses, IP address ranges, 'ej geographic locations **specify**.

Network zones **define**, **Global Session Policies**, **authentication policies**, VPN notifications, 'ej **routing rules** **use**.

**Attackers perspective** 'oH, Ps allowed (IPs **privileged**). **Attackers perspective**, users accessing **specific IP address** region **check** feature **used properly**.

### Device Integrations

* **Endpoint Management**: Endpoint management **condition** authentication policy **apply** **ensure** managed devices **access** application.
* **TODO**: 'ach **used**.
* **Notification services**: 'ach **used**.

### API

Okta API tokens **create** 'ej **page** **see** tokens **created**, **privileges**, **expiration** time, 'ej **Origin URLs**. API tokens **generate** permissions user created token **valid** **user** created **active**.

**Trusted Origins** **grant access** websites **control** 'ej **trust** access Okta org **Okta API**.

**API tokens** **lot** **shouldn't**. 'ach attacker **try** access **use**.

## Workflow

### Automations

Automations **create** automated actions **run** **trigger conditions** **occur** **lifecycle** end users.

**Example**: "User inactivity in Okta" **condition**, "Send email to the user" **action**.

## Reports

### Reports

**Download logs**. **Sent** **email address** current account.

### System Log

**Logs** actions performed users **find** **lot** details **login** Okta 'ej applications through Okta.

### Import Monitoring

**Import logs** platforms **accessed** Okta.

### Rate limits

**Check** API rate limits **reached**.

## Settings

### Account

**Generic information** Okta environment **find**, company name, address, **email billing contact**, **email technical contact**, 'ej Okta updates **receive** 'ej **kind** Okta updates.

### Downloads

Okta agents **download** Okta **sync** technologies.

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Other ways to support HackTricks:

* If you want to see your **company advertised in HackTricks** or **download HackTricks in PDF** Check the [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Get the [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Discover [**The PEASS Family**](https://opensea.io/collection/the-peass-family), our collection of exclusive [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Join the** üí¨ [**Discord group**](https://discord.gg/hRep4RUj7f) or the [**telegram group**](https://t.me/peass) or **follow** us on **Twitter** üê¶ [**@hacktricks_live**](https://twitter.com/hacktricks_live)**.**
* **Share your hacking tricks by submitting PRs to the** [**HackTricks**](https://github.com/carlospolop/hacktricks) and [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
